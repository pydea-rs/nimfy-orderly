import{bv as Ii,bw as Sn,_ as ee,bx as rt,z as _,M as U,O as Tt,q as E,aC as On,Z as N,aD as kn,x as re,a4 as V,$ as d,af as Et,by as Ln,a as Ne,ad as Z,Q as tr,C as ir,S as Re,P as Dn,a5 as qn,a6 as In,g as O,aB as rr,bz as nr,I as it,aa as sr,T as yt,r as Oe,e as Ti,K as si,bA as Tn,J as or,ai as En,bl as ar,bB as lr,bm as Mn,bC as kt,bD as An,X as Ee,bE as zn,bF as Fn,N as ti,Y as cr,A as ur,B as Rn,D as dr,bG as mr,U as tt,bH as Un,bk as Wn,G as ye,bI as Bn,n as Ae,bJ as oi,t as ke,b as pr,bq as K,aJ as ai,bK as li,aL as ci,bp as Vn,o as Y,bL as Ce,bM as fr,bh as Qn,bN as Hn,bO as ge,bP as de,p as De,bQ as nt,bR as ui,bS as Kn,bT as Gn,bU as Xt,bV as Yn,bW as hr,h as Mt,bX as bt,bY as At,bZ as Se,a0 as xr,b_ as Xn,b$ as ie,c0 as J,c1 as Jn,c2 as Zn,ag as gr,aH as jt,c3 as yr,c4 as br,aS as $n,aU as es,c5 as jr,c6 as se,c7 as ts,y as _r,c8 as is,c9 as rs,bs as Q,av as wr,ca as ns,cb as ss,cc as os,cd as as,a9 as ii,ce as ls,cf as cs,aE as di,cg as us,ch as vr,ci as ds,cj as ms,ck as ps}from"./index-hxeryC1o.js";import{j as t,r as m,W as he}from"./index-_b-vxSi4.js";import{L as mi,r as fs,T as _t,x as zt}from"./index-BcrQDpUm.js";import{S as Nr,F as hs,d as Ft}from"./index-D1SqNoN2.js";import{T as Ot}from"./Trans-DyzQVnhk.js";function Cr(e,i){const r=Ii(e),n=Ii(i),s=Ei(r,n),o=Math.abs(Sn(r,n));r.setDate(r.getDate()-s*o);const a=+(Ei(r,n)===-s),l=s*(o-a);return l===0?0:l}function Ei(e,i){const r=e.getFullYear()-i.getFullYear()||e.getMonth()-i.getMonth()||e.getDate()-i.getDate()||e.getHours()-i.getHours()||e.getMinutes()-i.getMinutes()||e.getSeconds()-i.getSeconds()||e.getMilliseconds()-i.getMilliseconds();return r<0?-1:r>0?1:r}var xs=e=>{let{currentLeverage:i=0}=e,{t:r}=N();return t.jsxs(_,{itemAlign:"start",direction:"column",mb:0,children:[t.jsx(gs,{currentLeverage:i}),t.jsx(ys,{...e}),t.jsxs(_,{direction:"row",gap:2,width:"100%",mt:0,pt:5,children:[t.jsx(re,{variant:"contained",color:"gray",fullWidth:!0,onClick:e.onCancel,"data-testid":"oui-testid-leverage-cancel-btn",children:r("common.cancel")}),t.jsx(re,{fullWidth:!0,loading:e.isLoading,onClick:e.onSave,"data-testid":"oui-testid-leverage-save-btn",children:r("common.save")})]})]})},gs=e=>{let{t:i}=N();return t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(d,{as:"div",size:"sm",intensity:54,className:"oui-mt-2",children:i("leverage.maxAccountLeverage")}),t.jsxs(_,{gap:1,children:[`${i("common.current")}:`,t.jsx(d.numeral,{unit:"x",size:"sm",intensity:80,children:e.currentLeverage??"--"})]})]})},ys=e=>t.jsxs(ee,{pt:3,width:"100%",className:e.className,children:[t.jsx(rt,{max:e.maxLeverage,min:1,markCount:5,value:[e.value],onValueChange:i=>{e.onLeverageChange(i[0]),e.setShowSliderTip(!0)},color:"primary",onValueCommit:i=>{var r;(r=e.onValueCommit)==null||r.call(e,i),e.setShowSliderTip(!1)},showTip:e.showSliderTip,tipFormatter:(i,r,n,s)=>`${i}x`}),t.jsx(_,{justify:"between",width:"100%",pt:3,children:[1,10,20,30,40,50].map((i,r)=>t.jsx("button",{onClick:n=>{var s;e.onLeverageChange(i),(s=e.onValueCommit)==null||s.call(e,[i])},className:U(" oui-text-2xs oui-pb-3",r===0?"oui-pr-2":r===5?"oui-pl-0":"oui-px-0 oui-ml-2",e.value>=i&&"oui-text-primary-light"),"data-testid":`oui-testid-leverage-${i}-btn`,children:`${i}x`}))})]}),bs=e=>{let{currentLeverage:i}=On(),[r,n]=m.useState(!1),{t:s}=N(),[o,{update:a,config:l,isMutating:c}]=kn(),u=m.useMemo(()=>(l==null?void 0:l.map(b=>({label:`${b}x`,value:b})))||[],[l]),[p,h]=m.useState(o??0),x=l==null?void 0:l.reduce((b,j)=>Math.max(b,Number(j),0),0),y=100/(((u==null?void 0:u.length)||0)-1),f=b=>{h(b)},g=async()=>{try{a({leverage:p}).then(b=>{var j;(j=e==null?void 0:e.close)==null||j.call(e),V.success(s("leverage.updated"))},b=>{V.error(b.message)})}catch{}};return{currentLeverage:i,value:p,marks:u,onLeverageChange:f,step:y,onCancel:e==null?void 0:e.close,onSave:g,isLoading:c,showSliderTip:r,setShowSliderTip:n,maxLeverage:x}},js=e=>{let i=bs({close:e.close});return t.jsx(xs,{...i})},_s="leverageEditor";Tt(_s,js,{title:()=>E.t("leverage.maxAccountLeverage"),size:"md"});function ws(e,i){let[r,n]=m.useState(""),[s,o]=m.useState(!1);return m.useEffect(()=>{s||typeof i!="function"||(o(!0),i(e.address,e.decimals).then(a=>{n(a)}).catch(a=>{}).finally(()=>{o(!1)}))},[e]),{balance:r,loading:s}}var vs=e=>{let{token:i,isActive:r,onTokenChange:n,fetchBalance:s}=e,{symbol:o,precision:a,decimals:l}=i,{balance:c,loading:u}=ws(i,s),p=typeof s=="function",h=a??2,x=()=>p?u?t.jsx(Et,{size:"sm"}):t.jsx(d.numeral,{rule:"price",dp:h,rm:O.ROUND_DOWN,className:U("oui-text-base-contrast-80 group-hover:oui-text-base-contrast-54",r&&"oui-text-base-contrast-54"),children:c}):null;return t.jsxs(_,{justify:"between",px:2,r:"base",className:U("group","oui-h-[30px] hover:oui-bg-base-5","oui-text-2xs oui-font-semibold","oui-cursor-pointer",r&&"oui-bg-base-5",e.index!==0&&"oui-mt-[2px]"),onClick:()=>{n==null||n(i)},children:[t.jsxs(_,{gapX:1,children:[t.jsx(Dn,{name:o,className:"oui-w-[16px] oui-h-[16px]"}),t.jsx(d,{className:U("oui-text-base-contrast-54 group-hover:oui-text-base-contrast-80",r&&"oui-text-base-contrast-80"),children:o})]}),x()]},o)},Lt=m.forwardRef((e,i)=>{let{token:r,tokens:n=[],classNames:s,label:o,status:a,hintMessage:l,value:c,onValueChange:u,onTokenChange:p,fetchBalance:h,loading:x,placeholder:y,...f}=e,{t:g}=N(),b=m.useRef(null),[j,w]=m.useState(!1),[v,S]=m.useState(0),I=m.useMemo(()=>n.map(q=>({...q,name:q.display_name||q.symbol})),[n]);m.useEffect(()=>{var z;let q=(z=b==null?void 0:b.current)==null?void 0:z.getBoundingClientRect();S((q==null?void 0:q.width)||0)},[b]);let k=q=>{let z=n.find(W=>W.symbol===q);z&&(p==null||p(z))},D=q=>{let z=q.symbol===(r==null?void 0:r.symbol);return t.jsx(vs,{token:q,fetchBalance:h,onTokenChange:W=>{p==null||p(W),w(!1)},isActive:z})},P=t.jsxs(ee,{children:[t.jsx(ee,{className:"oui-absolute oui-top-0",children:t.jsx(d,{size:"2xs",intensity:36,children:o||g("common.quantity")})}),x&&t.jsx(ee,{className:"oui-absolute oui-bottom-1",children:t.jsx(Et,{size:"sm"})})]}),C=n.length>1,L=t.jsx("div",{className:"oui-absolute oui-right-0",children:t.jsx(Ln.tokens,{open:C?j:!1,onOpenChange:w,disabled:f.disabled,variant:"text",tokens:I,value:(r==null?void 0:r.display_name)||(r==null?void 0:r.symbol),size:f.size,onValueChange:k,showIcon:!0,optionRenderer:D,contentProps:{onCloseAutoFocus:q=>{var z;q.preventDefault(),(z=b.current)==null||z.focus()},onClick:q=>{var z;q.preventDefault(),(z=b.current)==null||z.focus()},style:{width:v},align:"end",sideOffset:5,className:"oui-border oui-border-line-6"}})}),M=t.jsxs(_,{mt:1,gapX:1,px:1,children:[t.jsx(ee,{width:4,height:4,r:"full",className:U(a==="error"&&"oui-bg-danger-light",a==="warning"&&"oui-bg-warning-light")}),t.jsx(d,{size:"2xs",className:U(a==="error"&&"oui-text-danger-light",a==="warning"&&"oui-text-warning-light"),children:l})]}),F=y??(x?"":"0");return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{"data-testid":e.testId,ref:b,autoComplete:"off",placeholder:F,prefix:P,suffix:L,value:c,onValueChange:q=>{var z;(z=e.onValueChange)==null||z.call(e,q)},formatters:[Z.numberFormatter,Z.dpFormatter((r==null?void 0:r.precision)??2),Z.currencyFormatter],...f,classNames:{...s,root:U("oui-h-[54px] oui-relative oui-px-3","oui-border oui-border-line oui-rounded-lg",a==="error"&&"focus-within:oui-outline-danger-light oui-outline-danger-light",a==="warning"&&"focus-within:oui-outline-warning-light oui-outline-warning-light",e.readOnly?"oui-bg-base-6 focus-within:oui-outline-0 oui-border-none":"oui-bg-base-5",s==null?void 0:s.root),input:U("oui-absolute oui-bottom-0",s==null?void 0:s.input)}}),l&&M]})}),Ns=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M10.997 8.004a.5.5 0 0 0-.14-.36l-1.86-1.843-.703.703.984 1h-7.28a.5.5 0 0 0 0 1h7.28l-.984 1 .703.703 1.86-1.844a.5.5 0 0 0 .14-.36m-.5-4a.5.5 0 0 0-.5-.5H2.716l.984-1-.703-.703-1.859 1.843a.515.515 0 0 0 0 .719l1.86 1.844.702-.703-.984-1h7.281a.5.5 0 0 0 .5-.5"})}),Cs=e=>t.jsx("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M9.994 5.51a.83.83 0 0 0-.832.833v6.295l-2.498-2.471-1.17 1.17 3.902 3.929a.84.84 0 0 0 .599.244.84.84 0 0 0 .597-.244l3.903-3.928-1.171-1.171-2.498 2.471V6.343a.83.83 0 0 0-.832-.833"})}),Ps=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 1.744a2.333 2.333 0 0 0-2.333 2.333v5.834a2.333 2.333 0 0 0 2.333 2.333h5.833a2.333 2.333 0 0 0 2.334-2.333V4.077A2.333 2.333 0 0 0 9.91 1.744zm2.917 2.333c.322 0 .583.262.583.584v2.916h1.75L6.995 9.911 4.66 7.577h1.75V4.661c0-.322.262-.584.584-.584"})}),Ss=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 12.244a2.333 2.333 0 0 1-2.333-2.333V4.077a2.333 2.333 0 0 1 2.333-2.333h5.833a2.333 2.333 0 0 1 2.334 2.333v5.834a2.333 2.333 0 0 1-2.334 2.333zm2.917-2.333a.584.584 0 0 0 .583-.584V6.411h1.75L6.995 4.077 4.66 6.411h1.75v2.916c0 .322.262.584.584.584"})}),Os=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M6.00342 1.49561C4.97642 1.49561 3.99542 1.84011 3.20642 2.46461C2.98992 2.63561 2.95692 2.9511 3.12842 3.1676C3.29992 3.3841 3.61492 3.4171 3.83142 3.2456C4.44492 2.7601 5.20392 2.4956 6.00342 2.4956C7.93642 2.4956 9.50342 4.0626 9.50342 5.9956H8.50342L10.0034 7.9956L11.5034 5.9956H10.5034C10.5034 3.5101 8.48892 1.49561 6.00342 1.49561ZM2.00342 3.9956L0.503418 5.9956H1.50342C1.50342 8.4811 3.51792 10.4956 6.00342 10.4956C7.03092 10.4956 8.01142 10.1516 8.80042 9.52659C9.01692 9.35559 9.04992 9.0401 8.87842 8.8236C8.70692 8.6071 8.39191 8.5741 8.17542 8.7456C7.56142 9.2316 6.80342 9.4956 6.00342 9.4956C4.07042 9.4956 2.50342 7.9286 2.50342 5.9956H3.50342L2.00342 3.9956Z"})}),Pr=e=>{var f,g;let{chains:i,value:r,wrongNetwork:n,loading:s}=e,[o,a]=m.useState(!1),{t:l}=N(),c=n||(i==null?void 0:i.length)>1,u=n?t.jsx(_,{width:18,height:18,intensity:100,r:"full",justify:"center",itemAlign:"center",children:t.jsx(d,{size:"2xs",intensity:80,children:"U"})}):t.jsx(ti,{className:"oui-w-[18px] oui-h-[18px]",chainId:r==null?void 0:r.id}),p=n?"Unknown":(g=(f=r==null?void 0:r.info)==null?void 0:f.network_infos)==null?void 0:g.name,h=()=>{if(s)return t.jsx(Et,{size:"sm"});if(c)return t.jsx(Ns,{className:"oui-text-base-contrast-54"})},x=t.jsxs(_,{intensity:500,className:U("oui-rounded-t-xl oui-rounded-b-sm oui-border oui-border-line",c?"oui-cursor-pointer":"oui-cursor-auto"),height:54,px:3,justify:"between",itemAlign:"center",children:[t.jsxs("div",{children:[t.jsx(_,{children:t.jsx(d,{size:"2xs",intensity:54,children:l("transfer.network")})}),t.jsxs(_,{gapX:1,children:[u,t.jsx(d,{size:"sm",intensity:80,children:p})]})]}),h()]}),y=i.map((b,j)=>{let w=b.chain_id===(r==null?void 0:r.id);return t.jsxs(_,{px:2,r:"base",justify:"between",className:U("oui-deposit-network-select-item","hover:oui-bg-base-5 oui-h-[30px] oui-cursor-pointer",w&&"oui-bg-base-5",j!==0&&"oui-mt-[2px]"),onClick:async()=>{a(!1),await e.onValueChange(b)},children:[t.jsxs(_,{gapX:1,itemAlign:"center",children:[t.jsx(ti,{className:"oui-w-[18px] oui-h-[18px]",chainId:b.chain_id}),t.jsx(d,{size:"2xs",intensity:54,children:b.name}),b.bridgeless&&t.jsx(_,{className:"oui-bg-success-light/15",height:18,px:2,r:"base",justify:"center",itemAlign:"center",children:t.jsx(d,{size:"2xs",className:"oui-text-success-light",children:l("transfer.lowestFee")})})]}),w&&t.jsx(ee,{width:4,height:4,r:"full",className:"oui-deposit-network-select-active-dot oui-bg-[linear-gradient(270deg,#59B0FE_0%,#26FEFE_100%)]"})]},b.chain_id)});return t.jsxs(cr,{open:c?o:!1,onOpenChange:a,children:[t.jsx(ur,{asChild:!0,children:x}),t.jsx(Rn,{children:t.jsx(dr,{onCloseAutoFocus:b=>b.preventDefault(),align:"start",sideOffset:2,className:U("oui-deposit-token-select-dropdown-menu-content","oui-bg-base-8 oui-p-1","oui-w-[var(--radix-dropdown-menu-trigger-width)]","oui-rounded-md oui-select-none"),children:t.jsx(mr,{children:t.jsxs("div",{className:"oui-max-h-[254px]",children:[y," "]})})})})]})},Sr=()=>t.jsxs(_,{height:40,gapX:3,children:[t.jsx(_,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"}),t.jsx(Cs,{className:"oui-text-primary-light"}),t.jsx(_,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"})]});function ks(e){return e?e.replace(/^(.{6})(.*)(.{4})$/,"$1......$3"):"--"}var Ls=(e=[])=>{let i=e.reduce((r,n)=>(r[n.symbol]=n,r),{});return i.USDC||i.USDbC||e[0]},Ds=e=>e+3,Or=()=>{let{t:e}=N(),{wallet:i}=si(),{walletName:r,address:n}=m.useMemo(()=>{var s;return{walletName:i==null?void 0:i.label,address:ks((s=i==null?void 0:i.accounts)==null?void 0:s[0].address)}},[i]);return t.jsxs(_,{justify:"between",children:[t.jsx(d,{size:"sm",intensity:98,children:e("transfer.web3Wallet")}),t.jsxs(_,{gapX:1,children:[t.jsx(Fn,{size:"xs",name:r??""}),t.jsx(d,{size:"sm",intensity:54,children:n})]})]})},kr=()=>{let{t:e}=N(),{appIcons:i}=fs(),r=it("brokerName"),n=m.useMemo(()=>{let{secondary:s}=i||{};if(!(s!=null&&s.img)&&(s!=null&&s.component))return null;if(s!=null&&s.img)return t.jsx("img",{src:s==null?void 0:s.img,className:"oui-w-5 oui-h-5"});if(s!=null&&s.component)return t.jsx(t.Fragment,{children:s.component})},[i]);return t.jsxs(_,{justify:"between",children:[t.jsx(d,{size:"sm",intensity:98,children:e("transfer.brokerAccount",{brokerName:r})}),n]})},Lr=e=>{let{amount:i,maxQuantity:r,token:n,loading:s}=e,{t:o}=N(),a=(n==null?void 0:n.display_name)||(n==null?void 0:n.symbol)||"",l=(n==null?void 0:n.precision)??2;return t.jsxs(_,{justify:"between",px:2,children:[t.jsxs(d,{size:"2xs",intensity:36,children:["$",t.jsx(d.numeral,{dp:2,padding:!1,rm:O.ROUND_DOWN,children:i})]}),t.jsxs(_,{gapX:2,children:[t.jsxs(d,{size:"2xs",intensity:36,children:[`${o("common.available")}: `,t.jsx(d.numeral,{rm:O.ROUND_DOWN,dp:l,padding:!1,"data-testid":"oui-testid-withdraw_deposit-dialog-available-value",children:r}),` ${a}`]}),s&&t.jsx(Et,{size:"sm"}),t.jsx(d,{size:"2xs",color:"primary",className:"oui-cursor-pointer oui-select-none",onClick:e.onClick,children:o("common.max")})]})]})},qs=e=>{let{token:i,dst:r,price:n}=e,s=(i==null?void 0:i.display_name)||(i==null?void 0:i.symbol)||"USDC";return t.jsx(_,{children:t.jsxs(d,{size:"xs",intensity:36,className:e.className,children:[t.jsx(d,{size:"xs",intensity:80,children:"1"}),` ${s} = `,n?t.jsx(d.numeral,{size:"xs",intensity:80,dp:3,padding:!1,children:n}):"-",` ${r==null?void 0:r.symbol}`]})})},Is=e=>{let{dstGasFee:i,feeQty:r,feeAmount:n,dp:s,nativeSymbol:o}=e,{t:a}=N(),l=()=>{let u=t.jsxs("div",{className:"oui-text-2xs",children:[t.jsxs(_,{gapX:1,children:[t.jsx(d,{intensity:54,children:`${a("transfer.deposit.destinationGasFee")}: `}),t.jsx(d.numeral,{intensity:80,dp:s,rm:O.ROUND_UP,padding:!1,children:r}),t.jsx(d,{intensity:54,children:o})]}),t.jsx(ee,{mt:2,children:t.jsx(d,{intensity:36,children:a("transfer.deposit.destinationGasFee.description")})})]});ye.alert({title:a("common.fee"),message:u})},c=!!i&&i!=="0";return t.jsxs(d,{size:"xs",intensity:36,className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",onClick:l,children:[`${a("common.fee")} ≈ `,t.jsxs(d,{size:"xs",intensity:80,children:["$",t.jsx(d.numeral,{dp:2,padding:!1,rm:O.ROUND_UP,children:n})," "]}),c&&t.jsxs("span",{children:["(",t.jsxs(d,{intensity:54,children:[t.jsx(d.numeral,{dp:s,padding:!1,rm:O.ROUND_UP,children:r}),o]}),")"]})]})},Ts=(e=>(e[e.Deposit=0]="Deposit",e[e.Approve=1]="Approve",e[e.Increase=2]="Increase",e))(Ts||{}),Es=e=>{let{disabled:i,loading:r,actionType:n,symbol:s="USDC",onDeposit:o,onApprove:a,networkId:l}=e,{t:c}=N(),u=m.useMemo(()=>({1:{children:c("transfer.deposit.approve.symbol",{symbol:s}),onClick:a,disabled:!1,"data-testid":"oui-testid-deposit-dialog-approve-btn"},2:{children:c("transfer.deposit.increase.symbol",{symbol:s}),onClick:a,"data-testid":"oui-testid-deposit-dialog-increase-btn"},0:{children:c("common.deposit"),onClick:o,"data-testid":"oui-testid-deposit-dialog-deposit-btn"}})[n],[a,o,n,s,c]),p={initial:"md",lg:"lg"};return t.jsx(ee,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(Nr,{status:tt.EnableTrading,networkId:l,buttonProps:{fullWidth:!0,size:p},children:t.jsx(re,{fullWidth:!0,disabled:i,loading:r,size:p,...u})})})},Ms=e=>{let{token:i,tokens:r,onTokenChange:n,amount:s,quantity:o,maxQuantity:a,onQuantityChange:l,hintMessage:c,inputStatus:u,chains:p,currentChain:h,settingChain:x,onChainChange:y,actionType:f,onDeposit:g,onApprove:b,fetchBalance:j,dst:w,wrongNetwork:v,balanceRevalidating:S,loading:I,disabled:k,networkId:D,fee:P}=e;return t.jsxs(ee,{id:"oui-deposit-form",className:kt({weight:"semibold"}),children:[t.jsxs(ee,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(Or,{}),t.jsxs(ee,{mt:3,mb:1,children:[t.jsx(Pr,{chains:p,value:h,onValueChange:y,wrongNetwork:v,loading:x}),t.jsx(Lt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},value:o,onValueChange:l,tokens:r,token:i,onTokenChange:n,status:u,hintMessage:c,fetchBalance:j,"data-testId":"oui-testid-deposit-dialog-quantity-input"})]}),t.jsx(Lr,{token:i,amount:s,maxQuantity:a,loading:S,onClick:()=>{l(a)}}),t.jsx(Sr,{}),t.jsx(kr,{}),t.jsx(Lt,{readOnly:!0,token:w,value:o,classNames:{root:"oui-mt-3 oui-border-transparent focus-within:oui-outline-transparent"}}),t.jsxs(_,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:[t.jsx(qs,{token:i,dst:w,price:1}),t.jsx(Is,{...P})]})]}),t.jsx(_,{justify:"center",children:t.jsx(Es,{actionType:f,symbol:i==null?void 0:i.symbol,disabled:k,loading:I,onDeposit:g,onApprove:b,networkId:D})})]})};function As(e){let{isNativeToken:i,allowance:r,quantity:n,maxQuantity:s}=e;return m.useMemo(()=>{let o=i?Number.MAX_VALUE:Number(r);if(o<=0)return 1;let a=Number(n),l=Number(s);return o<a&&a<=l?2:0},[i,r,n,s])}function zs(){let{t:e}=N(),i=it("networkId"),[r]=Oe("orderly_link_device",{}),{connectedChain:n,settingChain:s,setChain:o}=si(),[a,{findByChainId:l}]=or(i,{pick:"network_infos",filter:p=>{var h,x;return((h=p.network_infos)==null?void 0:h.bridge_enable)||((x=p.network_infos)==null?void 0:x.bridgeless)}}),c=m.useMemo(()=>{let p=n?ar(n.id):parseInt(r==null?void 0:r.chainId);if(!p)return null;let h=l(p);return{...n,id:p,info:h}},[l,n,r]),u=m.useCallback(async p=>{var x,y;let h=l(p.chain_id);if(n)return!h||((x=h.network_infos)==null?void 0:x.chain_id)===(c==null?void 0:c.id)?Promise.resolve():o({chainId:lr(Number((y=h.network_infos)==null?void 0:y.chain_id))}).then(f=>{f?V.success(e("connector.networkSwitched")):V.error(e("connector.switchChain.failed"))}).catch(f=>{f&&f.message&&V.error(`${e("connector.switchChain.failed")}: ${f.message}`)})},[c,o,l]);return{chains:a,currentChain:c,settingChain:s,onChainChange:u}}function Fs(e){let{quantity:i,allowance:r,approve:n,deposit:s,enableCustomDeposit:o,customDeposit:a,onSuccess:l}=e,[c,u]=m.useState(!1),p=sr(),{t:h}=N(),x=m.useCallback(async()=>{if(!c)return u(!0),n(i).then(g=>{V.success(h("transfer.deposit.approve.success"))}).catch(g=>{V.error(g.message||g.errorCode||h("transfer.deposit.approve.failed"))}).finally(()=>{u(!1)})},[n,c,i,r,h]),y=m.useCallback(async()=>s().then(g=>{V.success(h("transfer.deposit.requested")),p.emit("deposit:requested"),l==null||l()}).catch(g=>{V.error(g.message||g.errorCode||h("transfer.deposit.failed"))}),[s,l,h]),f=m.useCallback(()=>{var b,j;let g=Number(i);if(isNaN(g)||g<=0){V.error(h("transfer.quantity.invalid"));return}c||(u(!0),(j=(b=o?a:y)==null?void 0:b())==null||j.finally(()=>{u(!1)}))},[i,c,y,o,a,h]);return{submitting:c,onApprove:x,onDeposit:f}}function Rs(e){let{quantity:i,maxQuantity:r}=e,{t:n}=N(),[s,o]=m.useState("default"),[a,l]=m.useState();return m.useEffect(()=>{if(!i){o("default"),l("");return}new O(i).gt(r)?(o("error"),l(n("transfer.insufficientBalance"))):(o("default"),l(""))},[i,r]),{inputStatus:s,hintMessage:a}}function Us(e){let{currentChain:i,tokensFilter:r}=e,[n,s]=m.useState(),[o,a]=m.useState([]),l=m.useCallback(c=>{var u;if(c&&((u=c==null?void 0:c.token_infos)==null?void 0:u.length)>0){let p=typeof r=="function"?r(c):c.token_infos;a(p);let h=Ls(p);if(!h)return;s(h)}},[r]);return m.useEffect(()=>{l(i==null?void 0:i.info)},[i==null?void 0:i.id,l]),{token:n,tokens:o,onTokenChange:s}}var Ws=e=>{var T;let{wrongNetwork:i}=mi(),r=it("networkId"),{chains:n,currentChain:s,settingChain:o,onChainChange:a}=zs(),{token:l,tokens:c,onTokenChange:u}=Us({currentChain:s}),{dst:p,balance:h,allowance:x,depositFeeRevalidating:y,depositFee:f,quantity:g,setQuantity:b,approve:j,deposit:w,isNativeToken:v,balanceRevalidating:S,fetchBalance:I}=An({address:l==null?void 0:l.address,decimals:l==null?void 0:l.decimals,srcChainId:s==null?void 0:s.id,srcToken:l==null?void 0:l.symbol}),k=m.useMemo(()=>new O(h||0).todp((l==null?void 0:l.precision)??2,O.ROUND_DOWN).toString(),[h,l]),{inputStatus:D,hintMessage:P}=Rs({quantity:g,maxQuantity:k}),C=()=>{b("")},L=m.useCallback(()=>{var te;C(),(te=e.onClose)==null||te.call(e)},[e.onClose]),{submitting:M,onApprove:F,onDeposit:q}=Fs({quantity:g,allowance:x,approve:j,deposit:w,onSuccess:L}),z=M||y,W=!g||Number(g)===0||!l||D==="error"||y,H=m.useMemo(()=>new O(g||0).mul(1).toNumber(),[g]),ne=As({isNativeToken:v,allowance:x,quantity:g,maxQuantity:k}),B=Bs({nativeToken:(T=s==null?void 0:s.info)==null?void 0:T.nativeToken,depositFee:f});return m.useEffect(()=>{C()},[l,s==null?void 0:s.id]),{token:l,tokens:c,onTokenChange:u,amount:H,quantity:g,maxQuantity:k,onQuantityChange:b,hintMessage:P,inputStatus:D,chains:n,currentChain:s,settingChain:o,onChainChange:a,actionType:ne,onDeposit:q,onApprove:F,fetchBalance:I,dst:p,wrongNetwork:i,balanceRevalidating:S,loading:z,disabled:W,networkId:r,fee:B}};function Bs(e){let{nativeToken:i,depositFee:r=0}=e,{account:n}=yt(),s=i==null?void 0:i.symbol,{data:o}=Un(`SPOT_${s}_USDC`);return{...m.useMemo(()=>{var c;let a=new O(r.toString()).div(new O(10).pow(((c=n.walletAdapter)==null?void 0:c.chainNamespace)===Wn.solana?9:18)).toString(),l=new O(a).mul(o||0).toString();return{dstGasFee:a,feeQty:a,feeAmount:l,dp:Ds(4)}},[r,o]),nativeSymbol:s}}var Vs=e=>{let i=Ws(e);return t.jsx(Ms,{...i})},Qs=({checkIsBridgeless:e,quantity:i,chainVaultBalance:r,currentChain:n,maxAmount:s,crossChainTrans:o})=>{let{t:a}=N(),{wrongNetwork:l}=mi(),{state:c}=yt(),u=m.useMemo(()=>{if(n&&n.info&&n.info.network_infos)return n.info.network_infos.name},[n]),p=m.useMemo(()=>!r||!s||!i||new O(i).gt(s)?!1:!!new O(i).gt(r),[i,r]),h=(()=>{if(c.status!==tt.NotConnected){if(l||!e)return t.jsx(ee,{children:u?a("transfer.withdraw.unsupported.networkName",{networkName:u}):a("transfer.withdraw.unsupported.chain")});if(o)return a("transfer.withdraw.crossChain.process");if(p)return a("transfer.withdraw.crossChain.vaultWarning",{networkName:u,chainVaultBalance:r})}})();return h?t.jsx(_,{className:"oui-text-warning-darken oui-text-xs oui-justify-center oui-text-center",mb:3,children:h}):null},Hs=({hasPositions:e,unsettledPnl:i,onSettlle:r})=>{let{t:n}=N();if(i===0&&!e)return t.jsx(t.Fragment,{});let s=()=>{ye.confirm({title:n("settle.settlePnl"),content:t.jsx(Ot,{i18nKey:"settle.settlePnl.description"}),onOk:()=>r()})};return t.jsxs(_,{justify:"between",className:"oui-text-2xs oui-text-base-contrast-36 oui-mt-1 oui-mx-2",children:[t.jsxs(_,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(Ee,{className:"oui-max-w-[274px]",content:n("settle.unsettled.tooltip"),children:t.jsxs(_,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(zn,{size:14,className:"oui-text-warning-darken"}),t.jsx(d,{className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",children:`${n("settle.unsettled")}:`})]})}),t.jsx(d.numeral,{showIdentifier:!0,coloring:!0,weight:"semibold",dp:6,"data-testid":"oui-testid-withdraw-dialog-unsettledPnl-value",children:i}),t.jsx(d,{children:"USDC"})]}),t.jsxs(_,{itemAlign:"center",gap:1,className:"oui-cursor-pointer",children:[t.jsx(Os,{className:"oui-text-primary"}),t.jsx(d,{"data-testid":"oui-testid-withdraw-dialog-settle-text",size:"2xs",color:"primary",className:" oui-select-none",onClick:s,children:n("common.settle")})]})]})},Ks=({address:e,amount:i,currentChain:r})=>{let{t:n}=N(),s=m.useMemo(()=>{if(r&&r.info&&r.info.network_infos)return r.info.network_infos.name},[r]);return t.jsxs(_,{direction:"column",itemAlign:"start",justify:"start",className:"oui-gap-1 lg:oui-gap-3",children:[t.jsxs(_,{direction:"column",itemAlign:"start",mb:5,className:"oui-gap-3 lg:oui-gap-4",children:[t.jsxs(_,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(d,{size:"2xs",intensity:36,children:n("transfer.withdraw.crossChain.recipientAddress")}),t.jsx(d,{size:"sm",intensity:98,className:"oui-break-all",children:e})]}),t.jsxs(_,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(d,{size:"2xs",intensity:36,children:n("transfer.withdraw.crossChain.recipientNetwork")}),t.jsxs(_,{gap:1,children:[t.jsx(ti,{className:"oui-h-[18px] oui-w-[18px]",size:"sm",chainId:r.id}),t.jsx(d,{size:"sm",intensity:98,children:s})]})]}),t.jsxs(_,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(d,{size:"2xs",intensity:36,children:`${n("transfer.withdraw.crossChain.withdrawAmount")} (USDC)`}),t.jsx(d.numeral,{size:"sm",intensity:98,dp:2,children:i})]})]}),t.jsx(_,{justify:"center",className:"oui-text-warning-darken oui-text-2xs lg:oui-text-xs oui-text-center",mb:3,children:n("transfer.withdraw.crossChain.warning")})]})};function Gs(e){let{t:i}=N(),r=()=>{ye.show(hs,{networkId:e.networkId,bridgeLessOnly:!0}).then(n=>{V.success(i("connector.networkSwitched"))},n=>{})};return t.jsx(_,{direction:"column",children:t.jsx(re,{color:"warning",size:e.size,fullWidth:!0,onClick:()=>{r()},children:i("connector.switchNetwork")})})}var Ys=e=>{let{disabled:i,loading:r,onWithdraw:n,networkId:s,crossChainWithdraw:o,address:a,currentChain:l,quantity:c,fee:u,checkIsBridgeless:p}=e,{t:h}=N(),x=m.useMemo(()=>c?new O(c).minus(u??0).toNumber():0,[c,u]),y=()=>{if(o){ye.confirm({title:h("transfer.withdraw.crossChain.confirmWithdraw"),content:t.jsx(Ks,{address:a,amount:x,currentChain:l}),classNames:{content:"oui-font-semibold",body:"!oui-pb-0",footer:"!oui-pt-0"},onOk:async()=>{n()}});return}n()},f={initial:"md",lg:"lg"};return t.jsx(ee,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(Nr,{status:tt.EnableTrading,networkId:s,bridgeLessOnly:!0,buttonProps:{fullWidth:!0,size:f},children:p?t.jsx(re,{"data-testid":"oui-testid-withdraw-dialog-withdraw-btn",fullWidth:!0,disabled:i,loading:r,onClick:y,size:f,children:h("common.withdraw")}):t.jsx(Gs,{networkId:s,size:f})})})},Xs=({address:e,loading:i,disabled:r,quantity:n,onQuantityChange:s,token:o,inputStatus:a,hintMessage:l,amount:c,maxQuantity:u,balanceRevalidating:p,chains:h,currentChain:x,onChainChange:y,fee:f,settingChain:g,wrongNetwork:b,hasPositions:j,unsettledPnL:w,onSettlePnl:v,onWithdraw:S,chainVaultBalance:I,crossChainWithdraw:k,crossChainTrans:D,showQty:P,networkId:C,checkIsBridgeless:L})=>{let{t:M}=N();return t.jsxs(ee,{id:"oui-withdraw-form",className:kt({weight:"semibold"}),children:[t.jsxs(ee,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(kr,{}),t.jsx(ee,{mt:3,mb:1,children:t.jsx(Lt,{value:n,onValueChange:s,token:o,onTokenChange:()=>{},status:a,hintMessage:l,testId:"oui-testid-withdraw-dialog-quantity-input"})}),t.jsx(Lr,{token:o,amount:c,maxQuantity:u.toString(),loading:p,onClick:()=>{s(u.toString())}}),t.jsx(Hs,{unsettledPnl:w,hasPositions:j,onSettlle:v}),t.jsx(Sr,{}),t.jsx(Or,{}),t.jsxs(ee,{mt:3,children:[t.jsx(Pr,{chains:h,value:x,onValueChange:y,wrongNetwork:b,loading:g}),t.jsx(Lt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},token:o,value:P,readOnly:!0})]}),t.jsx(_,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:t.jsxs(d,{size:"xs",intensity:36,children:[`${M("common.fee")} ≈ `,t.jsx(d,{size:"xs",intensity:80,children:`${f} `}),t.jsx(d,{children:"USDC"})]})})]}),t.jsx(Qs,{checkIsBridgeless:L,chainVaultBalance:I,currentChain:x,quantity:n,maxAmount:u,crossChainTrans:D}),t.jsx(_,{justify:"center",children:t.jsx(Ys,{checkIsBridgeless:L,networkId:C,disabled:r,loading:i,onWithdraw:S,crossChainWithdraw:k,currentChain:x,address:e,quantity:n,fee:f})})]})},Mi=1,Js=({onClose:e})=>{let{t:i}=N(),[r]=rr(),[n,s]=m.useState(!1),[o,a]=m.useState(!1),{data:l}=nr("/v1/asset/history",{revalidateOnMount:!0}),c=it("networkId"),u=sr(),[p,h]=m.useState(""),[x,y]=m.useState({symbol:"USDC",decimals:6,address:"",display_name:"",precision:6}),[f,g]=m.useState("default"),[b,j]=m.useState(),{wrongNetwork:w}=mi(),{account:v}=yt(),[S]=Oe("orderly_link_device",{}),{data:I}=Ti("/v1/public/vault_balance",{revalidateOnMount:!0}),{connectedChain:k,wallet:D,setChain:P,settingChain:C}=si();it();let{walletName:L,address:M}=m.useMemo(()=>{var A;return{walletName:D==null?void 0:D.label,address:(A=D==null?void 0:D.accounts)==null?void 0:A[0].address}},[D]),F=A=>{h(A)},q=m.useMemo(()=>new O(p||0).mul(Mi).toNumber(),[p,Mi]),{dst:z,withdraw:W,maxAmount:H,unsettledPnL:ne}=Tn(),[B,T]=m.useState(!0),[te,{findByChainId:G}]=or(c,{pick:"network_infos",filter:A=>{var ae,be;return((ae=A.network_infos)==null?void 0:ae.bridge_enable)||((be=A.network_infos)==null?void 0:be.bridgeless)}}),me=m.useMemo(()=>c==="mainnet"?te.filter(A=>A.bridgeless):te,[te,c]),{configStore:Te}=m.useContext(En),Pe=Te.get("apiBaseUrl"),{data:Le}=Ti(`${Pe}/v1/public/token?t=withdraw`,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateOnMount:!0,dedupingInterval:36e5,formatter:A=>{if(A.rows.length===1)return A.rows[0].chain_details}}),$=m.useMemo(()=>{let A=k?ar(k.id):parseInt(S==null?void 0:S.chainId);if(!A)return null;let ae=G(A);return{...k,id:A,info:ae}},[G,k,S]),pe=m.useMemo(()=>w||!$?!1:c==="testnet"?!0:!(!$.info||!$.info.network_infos||!$.info.network_infos.bridgeless),[$,w]),ue=()=>{h("")},xe=m.useCallback(async A=>{var be,Fe;let ae=G(A.chain_id);return!ae||((be=ae.network_infos)==null?void 0:be.chain_id)===($==null?void 0:$.id)?Promise.resolve():P==null?void 0:P({chainId:lr(Number((Fe=ae.network_infos)==null?void 0:Fe.chain_id))}).then(We=>{We?(V.success(i("connector.networkSwitched")),ue()):V.error(i("connector.switchChain.failed"))}).catch(We=>{V.error(`${i("connector.switchChain.failed")}: ${We.message}`)})},[$,P,G,i]),we=m.useMemo(()=>{var A;return((A=r==null?void 0:r.rows)==null?void 0:A.length)>0},[r]),oe=async()=>v.settle().catch(A=>(A.code==-1104&&V.error(i("settle.settlement.error")),A.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1&&u.emit("wallet:sign-message-with-ledger-error",{message:A.message,userAddress:v.address}),A.message.indexOf("user rejected")!==-1&&V.error(i("transfer.rejectTransaction")),Promise.reject(A))).then(A=>(V.success(i("settle.settlement.requested")),Promise.resolve(A))),R=m.useMemo(()=>{if(!I||!$)return null;let A=I.find(ae=>parseInt(ae.chain_id)===($==null?void 0:$.id));return A?A.balance:null},[me,$,I]),X=m.useMemo(()=>{if(R!==null){let A=parseFloat(p);return A>R&&A<=H}return!1},[p,H,R]),le=m.useMemo(()=>me.minimum_withdraw_amount??1,[me]),fe=async()=>{if(!o&&f==="default"){if(new O(p).lt(le)){V.error(i("transfer.withdraw.minAmount.error",{minAmount:le}));return}return a(!0),W({amount:p,token:"USDC",chainId:$==null?void 0:$.id,allowCrossChainWithdraw:X}).then(A=>{V.success(i("transfer.withdraw.requested")),u.emit("withdraw:requested"),e&&e(),h("")}).catch(A=>{if(A.message.indexOf("user rejected")!==-1){V.error(i("transfer.rejectTransaction"));return}if(A.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1){u.emit("wallet:sign-message-with-ledger-error",{message:A.message,userAddress:v.address});return}V.error(A.message)}).finally(()=>{a(!1)})}},ve=m.useMemo(()=>{if(!$)return 0;let A=Le==null?void 0:Le.find(ae=>parseInt(ae.chain_id)===$.id);return A?X?(A.withdrawal_fee||0)+(A.cross_chain_withdrawal_fee||0):A.withdrawal_fee||0:0},[$,Le,me,X]),qe=m.useMemo(()=>{if(!p)return"";let A=new O(p).sub(ve??0);return A.isNegative()?"":A.toNumber()},[ve,p]);return m.useEffect(()=>{if(n&&T(!0),!p){g("default"),j(""),T(!0);return}let A=new O(p??0);ne<0?A.gt(H)?(g("error"),j(i("transfer.insufficientBalance")),T(!0)):(g("default"),j(""),T(!1)):A.gt(H)?(g("error"),j(i("transfer.insufficientBalance")),T(!0)):A.gt(new O(H).minus(ne))&&A.lessThanOrEqualTo(H)?(g("warning"),j(i("settle.settlePnl.warning")),T(!0)):(g("default"),j(""),T(!1))},[p,H,ne,n]),m.useEffect(()=>{let A=l==null?void 0:l.find(ae=>ae.trans_status==="pending_rebalance".toUpperCase());s(!!A)},[l]),Mn({onMessage(A){if(!n)return;let{trxId:ae,transStatus:be}=A;ae===n&&be==="COMPLETED"&&s(!1)}}),{walletName:L,address:M,quantity:p,onQuantityChange:F,token:x,inputStatus:f,hintMessage:b,dst:z,amount:q,balanceRevalidating:!1,maxQuantity:H,disabled:B,loading:o,hasPositions:we,unsettledPnL:ne,wrongNetwork:w,settingChain:C,chains:me,currentChain:$,onChainChange:xe,onSettlePnl:oe,onWithdraw:fe,chainVaultBalance:R,fee:ve,crossChainWithdraw:X,crossChainTrans:n,showQty:qe,networkId:c,checkIsBridgeless:pe}},Zs=e=>{let i=Js({onClose:e.close});return t.jsx(Xs,{...i})},$s=e=>t.jsx(qn,{position:In.DepositForm,defaultWidget:Vs,...e}),eo="DepositAndWithdrawWithDialogId",to="DepositAndWithdrawWithSheetId",Dr=e=>{let[i,r]=m.useState(e.activeTab||"deposit"),{t:n}=N();return t.jsxs(ir,{value:i,onValueChange:r,variant:"contained",size:"lg",classNames:{tabsList:"oui-px-0",tabsContent:"oui-pt-5"},children:[t.jsx(Re,{title:n("common.deposit"),icon:t.jsx(Ps,{}),value:"deposit",children:t.jsx($s,{onClose:e.close})}),t.jsx(Re,{title:n("common.withdraw"),icon:t.jsx(Ss,{}),value:"withdraw",children:t.jsx(Zs,{...e})})]})};Tt(eo,Dr,{size:"md",classNames:{content:"oui-border oui-border-line-6"}});tr(to,Dr);function io(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ai(e){return io(e)||Array.isArray(e)}function ro(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function pi(e,i){const r=Object.keys(e),n=Object.keys(i);if(r.length!==n.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(i.breakpoints||{}));return s!==o?!1:r.every(a=>{const l=e[a],c=i[a];return typeof l=="function"?`${l}`==`${c}`:!Ai(l)||!Ai(c)?l===c:pi(l,c)})}function zi(e){return e.concat().sort((i,r)=>i.name>r.name?1:-1).map(i=>i.options)}function no(e,i){if(e.length!==i.length)return!1;const r=zi(e),n=zi(i);return r.every((s,o)=>{const a=n[o];return pi(s,a)})}function fi(e){return typeof e=="number"}function ri(e){return typeof e=="string"}function Rt(e){return typeof e=="boolean"}function Fi(e){return Object.prototype.toString.call(e)==="[object Object]"}function ce(e){return Math.abs(e)}function hi(e){return Math.sign(e)}function mt(e,i){return ce(e-i)}function so(e,i){if(e===0||i===0||ce(e)<=ce(i))return 0;const r=mt(ce(e),ce(i));return ce(r/e)}function oo(e){return Math.round(e*100)/100}function pt(e){return ft(e).map(Number)}function Ie(e){return e[wt(e)]}function wt(e){return Math.max(0,e.length-1)}function xi(e,i){return i===wt(e)}function Ri(e,i=0){return Array.from(Array(e),(r,n)=>i+n)}function ft(e){return Object.keys(e)}function qr(e,i){return[e,i].reduce((r,n)=>(ft(n).forEach(s=>{const o=r[s],a=n[s],l=Fi(o)&&Fi(a);r[s]=l?qr(o,a):a}),r),{})}function ni(e,i){return typeof i.MouseEvent<"u"&&e instanceof i.MouseEvent}function ao(e,i){const r={start:n,center:s,end:o};function n(){return 0}function s(c){return o(c)/2}function o(c){return i-c}function a(c,u){return ri(e)?r[e](c):e(i,c,u)}return{measure:a}}function ht(){let e=[];function i(s,o,a,l={passive:!0}){let c;if("addEventListener"in s)s.addEventListener(o,a,l),c=()=>s.removeEventListener(o,a,l);else{const u=s;u.addListener(a),c=()=>u.removeListener(a)}return e.push(c),n}function r(){e=e.filter(s=>s())}const n={add:i,clear:r};return n}function lo(e,i,r,n){const s=ht(),o=1e3/60;let a=null,l=0,c=0;function u(){s.add(e,"visibilitychange",()=>{e.hidden&&f()})}function p(){y(),s.clear()}function h(b){if(!c)return;a||(a=b,r(),r());const j=b-a;for(a=b,l+=j;l>=o;)r(),l-=o;const w=l/o;n(w),c&&(c=i.requestAnimationFrame(h))}function x(){c||(c=i.requestAnimationFrame(h))}function y(){i.cancelAnimationFrame(c),a=null,l=0,c=0}function f(){a=null,l=0}return{init:u,destroy:p,start:x,stop:y,update:r,render:n}}function co(e,i){const r=i==="rtl",n=e==="y",s=n?"y":"x",o=n?"x":"y",a=!n&&r?-1:1,l=p(),c=h();function u(f){const{height:g,width:b}=f;return n?g:b}function p(){return n?"top":r?"right":"left"}function h(){return n?"bottom":r?"left":"right"}function x(f){return f*a}return{scroll:s,cross:o,startEdge:l,endEdge:c,measureSize:u,direction:x}}function He(e=0,i=0){const r=ce(e-i);function n(u){return u<e}function s(u){return u>i}function o(u){return n(u)||s(u)}function a(u){return o(u)?n(u)?e:i:u}function l(u){return r?u-r*Math.ceil((u-i)/r):u}return{length:r,max:i,min:e,constrain:a,reachedAny:o,reachedMax:s,reachedMin:n,removeOffset:l}}function Ir(e,i,r){const{constrain:n}=He(0,e),s=e+1;let o=a(i);function a(x){return r?ce((s+x)%s):n(x)}function l(){return o}function c(x){return o=a(x),h}function u(x){return p().set(l()+x)}function p(){return Ir(e,l(),r)}const h={get:l,set:c,add:u,clone:p};return h}function uo(e,i,r,n,s,o,a,l,c,u,p,h,x,y,f,g,b,j,w){const{cross:v,direction:S}=e,I=["INPUT","SELECT","TEXTAREA"],k={passive:!1},D=ht(),P=ht(),C=He(50,225).constrain(y.measure(20)),L={mouse:300,touch:400},M={mouse:500,touch:600},F=f?43:25;let q=!1,z=0,W=0,H=!1,ne=!1,B=!1,T=!1;function te(R){if(!w)return;function X(fe){(Rt(w)||w(R,fe))&&$(fe)}const le=i;D.add(le,"dragstart",fe=>fe.preventDefault(),k).add(le,"touchmove",()=>{},k).add(le,"touchend",()=>{}).add(le,"touchstart",X).add(le,"mousedown",X).add(le,"touchcancel",ue).add(le,"contextmenu",ue).add(le,"click",xe,!0)}function G(){D.clear(),P.clear()}function me(){const R=T?r:i;P.add(R,"touchmove",pe,k).add(R,"touchend",ue).add(R,"mousemove",pe,k).add(R,"mouseup",ue)}function Te(R){const X=R.nodeName||"";return I.includes(X)}function Pe(){return(f?M:L)[T?"mouse":"touch"]}function Le(R,X){const le=h.add(hi(R)*-1),fe=p.byDistance(R,!f).distance;return f||ce(R)<C?fe:b&&X?fe*.5:p.byIndex(le.get(),0).distance}function $(R){const X=ni(R,n);T=X,B=f&&X&&!R.buttons&&q,q=mt(s.get(),a.get())>=2,!(X&&R.button!==0)&&(Te(R.target)||(H=!0,o.pointerDown(R),u.useFriction(0).useDuration(0),s.set(a),me(),z=o.readPoint(R),W=o.readPoint(R,v),x.emit("pointerDown")))}function pe(R){if(!ni(R,n)&&R.touches.length>=2)return ue(R);const le=o.readPoint(R),fe=o.readPoint(R,v),ve=mt(le,z),qe=mt(fe,W);if(!ne&&!T&&(!R.cancelable||(ne=ve>qe,!ne)))return ue(R);const A=o.pointerMove(R);ve>g&&(B=!0),u.useFriction(.3).useDuration(.75),l.start(),s.add(S(A)),R.preventDefault()}function ue(R){const le=p.byDistance(0,!1).index!==h.get(),fe=o.pointerUp(R)*Pe(),ve=Le(S(fe),le),qe=so(fe,ve),A=F-10*qe,ae=j+qe/50;ne=!1,H=!1,P.clear(),u.useDuration(A).useFriction(ae),c.distance(ve,!f),T=!1,x.emit("pointerUp")}function xe(R){B&&(R.stopPropagation(),R.preventDefault(),B=!1)}function we(){return H}return{init:te,destroy:G,pointerDown:we}}function mo(e,i){let n,s;function o(h){return h.timeStamp}function a(h,x){const f=`client${(x||e.scroll)==="x"?"X":"Y"}`;return(ni(h,i)?h:h.touches[0])[f]}function l(h){return n=h,s=h,a(h)}function c(h){const x=a(h)-a(s),y=o(h)-o(n)>170;return s=h,y&&(n=h),x}function u(h){if(!n||!s)return 0;const x=a(s)-a(n),y=o(h)-o(n),f=o(h)-o(s)>170,g=x/y;return y&&!f&&ce(g)>.1?g:0}return{pointerDown:l,pointerMove:c,pointerUp:u,readPoint:a}}function po(){function e(r){const{offsetTop:n,offsetLeft:s,offsetWidth:o,offsetHeight:a}=r;return{top:n,right:s+o,bottom:n+a,left:s,width:o,height:a}}return{measure:e}}function fo(e){function i(n){return e*(n/100)}return{measure:i}}function ho(e,i,r,n,s,o,a){const l=[e].concat(n);let c,u,p=[],h=!1;function x(b){return s.measureSize(a.measure(b))}function y(b){if(!o)return;u=x(e),p=n.map(x);function j(w){for(const v of w){if(h)return;const S=v.target===e,I=n.indexOf(v.target),k=S?u:p[I],D=x(S?e:n[I]);if(ce(D-k)>=.5){b.reInit(),i.emit("resize");break}}}c=new ResizeObserver(w=>{(Rt(o)||o(b,w))&&j(w)}),r.requestAnimationFrame(()=>{l.forEach(w=>c.observe(w))})}function f(){h=!0,c&&c.disconnect()}return{init:y,destroy:f}}function xo(e,i,r,n,s,o){let a=0,l=0,c=s,u=o,p=e.get(),h=0;function x(){const k=n.get()-e.get(),D=!c;let P=0;return D?(a=0,r.set(n),e.set(n),P=k):(r.set(e),a+=k/c,a*=u,p+=a,e.add(a),P=p-h),l=hi(P),h=p,I}function y(){const k=n.get()-i.get();return ce(k)<.001}function f(){return c}function g(){return l}function b(){return a}function j(){return v(s)}function w(){return S(o)}function v(k){return c=k,I}function S(k){return u=k,I}const I={direction:g,duration:f,velocity:b,seek:x,settled:y,useBaseFriction:w,useBaseDuration:j,useFriction:S,useDuration:v};return I}function go(e,i,r,n,s){const o=s.measure(10),a=s.measure(50),l=He(.1,.99);let c=!1;function u(){return!(c||!e.reachedAny(r.get())||!e.reachedAny(i.get()))}function p(y){if(!u())return;const f=e.reachedMin(i.get())?"min":"max",g=ce(e[f]-i.get()),b=r.get()-i.get(),j=l.constrain(g/a);r.subtract(b*j),!y&&ce(b)<o&&(r.set(e.constrain(r.get())),n.useDuration(25).useBaseFriction())}function h(y){c=!y}return{shouldConstrain:u,constrain:p,toggleActive:h}}function yo(e,i,r,n,s){const o=He(-i+e,0),a=h(),l=p(),c=x();function u(f,g){return mt(f,g)<=1}function p(){const f=a[0],g=Ie(a),b=a.lastIndexOf(f),j=a.indexOf(g)+1;return He(b,j)}function h(){return r.map((f,g)=>{const{min:b,max:j}=o,w=o.constrain(f),v=!g,S=xi(r,g);return v?j:S||u(b,w)?b:u(j,w)?j:w}).map(f=>parseFloat(f.toFixed(3)))}function x(){if(i<=e+s)return[o.max];if(n==="keepSnaps")return a;const{min:f,max:g}=l;return a.slice(f,g)}return{snapsContained:c,scrollContainLimit:l}}function bo(e,i,r){const n=i[0],s=r?n-e:Ie(i);return{limit:He(s,n)}}function jo(e,i,r,n){const o=i.min+.1,a=i.max+.1,{reachedMin:l,reachedMax:c}=He(o,a);function u(x){return x===1?c(r.get()):x===-1?l(r.get()):!1}function p(x){if(!u(x))return;const y=e*(x*-1);n.forEach(f=>f.add(y))}return{loop:p}}function _o(e){const{max:i,length:r}=e;function n(o){const a=o-i;return r?a/-r:0}return{get:n}}function wo(e,i,r,n,s){const{startEdge:o,endEdge:a}=e,{groupSlides:l}=s,c=h().map(i.measure),u=x(),p=y();function h(){return l(n).map(g=>Ie(g)[a]-g[0][o]).map(ce)}function x(){return n.map(g=>r[o]-g[o]).map(g=>-ce(g))}function y(){return l(u).map(g=>g[0]).map((g,b)=>g+c[b])}return{snaps:u,snapsAligned:p}}function vo(e,i,r,n,s,o){const{groupSlides:a}=s,{min:l,max:c}=n,u=p();function p(){const x=a(o),y=!e||i==="keepSnaps";return r.length===1?[o]:y?x:x.slice(l,c).map((f,g,b)=>{const j=!g,w=xi(b,g);if(j){const v=Ie(b[0])+1;return Ri(v)}if(w){const v=wt(o)-Ie(b)[0]+1;return Ri(v,Ie(b)[0])}return f})}return{slideRegistry:u}}function No(e,i,r,n,s){const{reachedAny:o,removeOffset:a,constrain:l}=n;function c(f){return f.concat().sort((g,b)=>ce(g)-ce(b))[0]}function u(f){const g=e?a(f):l(f),b=i.map((w,v)=>({diff:p(w-g,0),index:v})).sort((w,v)=>ce(w.diff)-ce(v.diff)),{index:j}=b[0];return{index:j,distance:g}}function p(f,g){const b=[f,f+r,f-r];if(!e)return f;if(!g)return c(b);const j=b.filter(w=>hi(w)===g);return j.length?c(j):Ie(b)-r}function h(f,g){const b=i[f]-s.get(),j=p(b,g);return{index:f,distance:j}}function x(f,g){const b=s.get()+f,{index:j,distance:w}=u(b),v=!e&&o(b);if(!g||v)return{index:j,distance:f};const S=i[j]-w,I=f+p(S,0);return{index:j,distance:I}}return{byDistance:x,byIndex:h,shortcut:p}}function Co(e,i,r,n,s,o,a){function l(h){const x=h.distance,y=h.index!==i.get();o.add(x),x&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),y&&(r.set(i.get()),i.set(h.index),a.emit("select"))}function c(h,x){const y=s.byDistance(h,x);l(y)}function u(h,x){const y=i.clone().set(h),f=s.byIndex(y.get(),x);l(f)}return{distance:c,index:u}}function Po(e,i,r,n,s,o,a,l){const c={passive:!0,capture:!0};let u=0;function p(y){if(!l)return;function f(g){if(new Date().getTime()-u>10)return;a.emit("slideFocusStart"),e.scrollLeft=0;const w=r.findIndex(v=>v.includes(g));fi(w)&&(s.useDuration(0),n.index(w,0),a.emit("slideFocus"))}o.add(document,"keydown",h,!1),i.forEach((g,b)=>{o.add(g,"focus",j=>{(Rt(l)||l(y,j))&&f(b)},c)})}function h(y){y.code==="Tab"&&(u=new Date().getTime())}return{init:p}}function dt(e){let i=e;function r(){return i}function n(c){i=a(c)}function s(c){i+=a(c)}function o(c){i-=a(c)}function a(c){return fi(c)?c:c.get()}return{get:r,set:n,add:s,subtract:o}}function Tr(e,i){const r=e.scroll==="x"?a:l,n=i.style;let s=null,o=!1;function a(x){return`translate3d(${x}px,0px,0px)`}function l(x){return`translate3d(0px,${x}px,0px)`}function c(x){if(o)return;const y=oo(e.direction(x));y!==s&&(n.transform=r(y),s=y)}function u(x){o=!x}function p(){o||(n.transform="",i.getAttribute("style")||i.removeAttribute("style"))}return{clear:p,to:c,toggleActive:u}}function So(e,i,r,n,s,o,a,l,c){const p=pt(s),h=pt(s).reverse(),x=j().concat(w());function y(D,P){return D.reduce((C,L)=>C-s[L],P)}function f(D,P){return D.reduce((C,L)=>y(C,P)>0?C.concat([L]):C,[])}function g(D){return o.map((P,C)=>({start:P-n[C]+.5+D,end:P+i-.5+D}))}function b(D,P,C){const L=g(P);return D.map(M=>{const F=C?0:-r,q=C?r:0,z=C?"end":"start",W=L[M][z];return{index:M,loopPoint:W,slideLocation:dt(-1),translate:Tr(e,c[M]),target:()=>l.get()>W?F:q}})}function j(){const D=a[0],P=f(h,D);return b(P,r,!1)}function w(){const D=i-a[0]-1,P=f(p,D);return b(P,-r,!0)}function v(){return x.every(({index:D})=>{const P=p.filter(C=>C!==D);return y(P,i)<=.1})}function S(){x.forEach(D=>{const{target:P,translate:C,slideLocation:L}=D,M=P();M!==L.get()&&(C.to(M),L.set(M))})}function I(){x.forEach(D=>D.translate.clear())}return{canLoop:v,clear:I,loop:S,loopPoints:x}}function Oo(e,i,r){let n,s=!1;function o(c){if(!r)return;function u(p){for(const h of p)if(h.type==="childList"){c.reInit(),i.emit("slidesChanged");break}}n=new MutationObserver(p=>{s||(Rt(r)||r(c,p))&&u(p)}),n.observe(e,{childList:!0})}function a(){n&&n.disconnect(),s=!0}return{init:o,destroy:a}}function ko(e,i,r,n){const s={};let o=null,a=null,l,c=!1;function u(){l=new IntersectionObserver(f=>{c||(f.forEach(g=>{const b=i.indexOf(g.target);s[b]=g}),o=null,a=null,r.emit("slidesInView"))},{root:e.parentElement,threshold:n}),i.forEach(f=>l.observe(f))}function p(){l&&l.disconnect(),c=!0}function h(f){return ft(s).reduce((g,b)=>{const j=parseInt(b),{isIntersecting:w}=s[j];return(f&&w||!f&&!w)&&g.push(j),g},[])}function x(f=!0){if(f&&o)return o;if(!f&&a)return a;const g=h(f);return f&&(o=g),f||(a=g),g}return{init:u,destroy:p,get:x}}function Lo(e,i,r,n,s,o){const{measureSize:a,startEdge:l,endEdge:c}=e,u=r[0]&&s,p=f(),h=g(),x=r.map(a),y=b();function f(){if(!u)return 0;const w=r[0];return ce(i[l]-w[l])}function g(){if(!u)return 0;const w=o.getComputedStyle(Ie(n));return parseFloat(w.getPropertyValue(`margin-${c}`))}function b(){return r.map((w,v,S)=>{const I=!v,k=xi(S,v);return I?x[v]+p:k?x[v]+h:S[v+1][l]-w[l]}).map(ce)}return{slideSizes:x,slideSizesWithGaps:y,startGap:p,endGap:h}}function Do(e,i,r,n,s,o,a,l,c){const{startEdge:u,endEdge:p,direction:h}=e,x=fi(r);function y(j,w){return pt(j).filter(v=>v%w===0).map(v=>j.slice(v,v+w))}function f(j){return j.length?pt(j).reduce((w,v,S)=>{const I=Ie(w)||0,k=I===0,D=v===wt(j),P=s[u]-o[I][u],C=s[u]-o[v][p],L=!n&&k?h(a):0,M=!n&&D?h(l):0,F=ce(C-M-(P+L));return S&&F>i+c&&w.push(v),D&&w.push(j.length),w},[]).map((w,v,S)=>{const I=Math.max(S[v-1]||0);return j.slice(I,w)}):[]}function g(j){return x?y(j,r):f(j)}return{groupSlides:g}}function qo(e,i,r,n,s,o,a){const{align:l,axis:c,direction:u,startIndex:p,loop:h,duration:x,dragFree:y,dragThreshold:f,inViewThreshold:g,slidesToScroll:b,skipSnaps:j,containScroll:w,watchResize:v,watchSlides:S,watchDrag:I,watchFocus:k}=o,D=2,P=po(),C=P.measure(i),L=r.map(P.measure),M=co(c,u),F=M.measureSize(C),q=fo(F),z=ao(l,F),W=!h&&!!w,H=h||!!w,{slideSizes:ne,slideSizesWithGaps:B,startGap:T,endGap:te}=Lo(M,C,L,r,H,s),G=Do(M,F,b,h,C,L,T,te,D),{snaps:me,snapsAligned:Te}=wo(M,z,C,L,G),Pe=-Ie(me)+Ie(B),{snapsContained:Le,scrollContainLimit:$}=yo(F,Pe,Te,w,D),pe=W?Le:Te,{limit:ue}=bo(Pe,pe,h),xe=Ir(wt(pe),p,h),we=xe.clone(),oe=pt(r),R=({dragHandler:Ge,scrollBody:Gt,scrollBounds:Yt,options:{loop:Ct}})=>{Ct||Yt.constrain(Ge.pointerDown()),Gt.seek()},X=({scrollBody:Ge,translate:Gt,location:Yt,offsetLocation:Ct,previousLocation:bn,scrollLooper:jn,slideLooper:_n,dragHandler:wn,animation:vn,eventHandler:Oi,scrollBounds:Nn,options:{loop:ki}},Li)=>{const Di=Ge.settled(),Cn=!Nn.shouldConstrain(),qi=ki?Di:Di&&Cn;qi&&!wn.pointerDown()&&(vn.stop(),Oi.emit("settle")),qi||Oi.emit("scroll");const Pn=Yt.get()*Li+bn.get()*(1-Li);Ct.set(Pn),ki&&(jn.loop(Ge.direction()),_n.loop()),Gt.to(Ct.get())},le=lo(n,s,()=>R(Kt),Ge=>X(Kt,Ge)),fe=.68,ve=pe[xe.get()],qe=dt(ve),A=dt(ve),ae=dt(ve),be=dt(ve),Fe=xo(qe,ae,A,be,x,fe),We=No(h,pe,Pe,ue,be),Ht=Co(le,xe,we,Fe,We,be,a),Ci=_o(ue),Pi=ht(),gn=ko(i,r,a,g),{slideRegistry:Si}=vo(W,w,pe,$,G,oe),yn=Po(e,r,Si,Ht,Fe,Pi,a,k),Kt={ownerDocument:n,ownerWindow:s,eventHandler:a,containerRect:C,slideRects:L,animation:le,axis:M,dragHandler:uo(M,e,n,s,be,mo(M,s),qe,le,Ht,Fe,We,xe,a,q,y,f,j,fe,I),eventStore:Pi,percentOfView:q,index:xe,indexPrevious:we,limit:ue,location:qe,offsetLocation:ae,previousLocation:A,options:o,resizeHandler:ho(i,a,s,r,M,v,P),scrollBody:Fe,scrollBounds:go(ue,ae,be,Fe,q),scrollLooper:jo(Pe,ue,ae,[qe,ae,A,be]),scrollProgress:Ci,scrollSnapList:pe.map(Ci.get),scrollSnaps:pe,scrollTarget:We,scrollTo:Ht,slideLooper:So(M,F,Pe,ne,B,me,pe,ae,r),slideFocus:yn,slidesHandler:Oo(i,a,S),slidesInView:gn,slideIndexes:oe,slideRegistry:Si,slidesToScroll:G,target:be,translate:Tr(M,i)};return Kt}function Io(){let e={},i;function r(u){i=u}function n(u){return e[u]||[]}function s(u){return n(u).forEach(p=>p(i,u)),c}function o(u,p){return e[u]=n(u).concat([p]),c}function a(u,p){return e[u]=n(u).filter(h=>h!==p),c}function l(){e={}}const c={init:r,emit:s,off:a,on:o,clear:l};return c}const To={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Eo(e){function i(o,a){return qr(o,a||{})}function r(o){const a=o.breakpoints||{},l=ft(a).filter(c=>e.matchMedia(c).matches).map(c=>a[c]).reduce((c,u)=>i(c,u),{});return i(o,l)}function n(o){return o.map(a=>ft(a.breakpoints||{})).reduce((a,l)=>a.concat(l),[]).map(e.matchMedia)}return{mergeOptions:i,optionsAtMedia:r,optionsMediaQueries:n}}function Mo(e){let i=[];function r(o,a){return i=a.filter(({options:l})=>e.optionsAtMedia(l).active!==!1),i.forEach(l=>l.init(o,e)),a.reduce((l,c)=>Object.assign(l,{[c.name]:c}),{})}function n(){i=i.filter(o=>o.destroy())}return{init:r,destroy:n}}function Dt(e,i,r){const n=e.ownerDocument,s=n.defaultView,o=Eo(s),a=Mo(o),l=ht(),c=Io(),{mergeOptions:u,optionsAtMedia:p,optionsMediaQueries:h}=o,{on:x,off:y,emit:f}=c,g=M;let b=!1,j,w=u(To,Dt.globalOptions),v=u(w),S=[],I,k,D;function P(){const{container:oe,slides:R}=v;k=(ri(oe)?e.querySelector(oe):oe)||e.children[0];const le=ri(R)?k.querySelectorAll(R):R;D=[].slice.call(le||k.children)}function C(oe){const R=qo(e,k,D,n,s,oe,c);if(oe.loop&&!R.slideLooper.canLoop()){const X=Object.assign({},oe,{loop:!1});return C(X)}return R}function L(oe,R){b||(w=u(w,oe),v=p(w),S=R||S,P(),j=C(v),h([w,...S.map(({options:X})=>X)]).forEach(X=>l.add(X,"change",M)),v.active&&(j.translate.to(j.location.get()),j.animation.init(),j.slidesInView.init(),j.slideFocus.init(we),j.eventHandler.init(we),j.resizeHandler.init(we),j.slidesHandler.init(we),j.options.loop&&j.slideLooper.loop(),k.offsetParent&&D.length&&j.dragHandler.init(we),I=a.init(we,S)))}function M(oe,R){const X=G();F(),L(u({startIndex:X},oe),R),c.emit("reInit")}function F(){j.dragHandler.destroy(),j.eventStore.clear(),j.translate.clear(),j.slideLooper.clear(),j.resizeHandler.destroy(),j.slidesHandler.destroy(),j.slidesInView.destroy(),j.animation.destroy(),a.destroy(),l.clear()}function q(){b||(b=!0,l.clear(),F(),c.emit("destroy"),c.clear())}function z(oe,R,X){!v.active||b||(j.scrollBody.useBaseFriction().useDuration(R===!0?0:v.duration),j.scrollTo.index(oe,X||0))}function W(oe){const R=j.index.add(1).get();z(R,oe,-1)}function H(oe){const R=j.index.add(-1).get();z(R,oe,1)}function ne(){return j.index.add(1).get()!==G()}function B(){return j.index.add(-1).get()!==G()}function T(){return j.scrollSnapList}function te(){return j.scrollProgress.get(j.location.get())}function G(){return j.index.get()}function me(){return j.indexPrevious.get()}function Te(){return j.slidesInView.get()}function Pe(){return j.slidesInView.get(!1)}function Le(){return I}function $(){return j}function pe(){return e}function ue(){return k}function xe(){return D}const we={canScrollNext:ne,canScrollPrev:B,containerNode:ue,internalEngine:$,destroy:q,off:y,on:x,emit:f,plugins:Le,previousScrollSnap:me,reInit:g,rootNode:pe,scrollNext:W,scrollPrev:H,scrollProgress:te,scrollSnapList:T,scrollTo:z,selectedScrollSnap:G,slideNodes:xe,slidesInView:Te,slidesNotInView:Pe};return L(i,r),setTimeout(()=>c.emit("init"),0),we}Dt.globalOptions=void 0;function Ut(e={},i=[]){const r=m.useRef(e),n=m.useRef(i),[s,o]=m.useState(),[a,l]=m.useState(),c=m.useCallback(()=>{s&&s.reInit(r.current,n.current)},[s]);return m.useEffect(()=>{pi(r.current,e)||(r.current=e,c())},[e,c]),m.useEffect(()=>{no(n.current,i)||(n.current=i,c())},[i,c]),m.useEffect(()=>{if(ro()&&a){Dt.globalOptions=Ut.globalOptions;const u=Dt(a,r.current,n.current);return o(u),()=>u.destroy()}else o(void 0)},[a,o]),[l,s]}Ut.globalOptions=void 0;var Er=e=>{let{pnl:i,hide:r}=e,n=i==null?void 0:i.entity,s=Ae(),{getFirstRefCode:o}=oi(),a=m.useMemo(()=>{var p;let u=(p=o())==null?void 0:p.code;return{code:(i==null?void 0:i.refCode)??u,slogan:i==null?void 0:i.refSlogan,link:i==null?void 0:i.refLink}},[o,i]),l=m.useMemo(()=>{if(n)return s[n==null?void 0:n.symbol]("base_dp")},[n,s]),c=m.useMemo(()=>{if(n)return s[n==null?void 0:n.symbol]("quote_dp")},[n,s]);return{entity:n,leverage:i==null?void 0:i.leverage,baseDp:l,quoteDp:c,referralInfo:a,shareOptions:i,hide:r}};function Mr(e,i,r,n,s,o,a,l,c){let{t:u}=N(),{symbol:p,currency:h}=Ao(e.symbol),x={symbol:p,currency:h,side:e.side};switch(s){case"pnl":{e.pnl!=null&&(x.pnl=new O(e.pnl).toFixed(2,O.ROUND_DOWN));break}case"roi":{e.roi!=null&&(x.ROI=new O(e.roi).toFixed(2,O.ROUND_DOWN));break}case"roi_pnl":{e.pnl!=null&&(x.pnl=new O(e.pnl).toFixed(2,O.ROUND_DOWN)),e.roi!=null&&(x.ROI=new O(e.roi).toFixed(2,O.ROUND_DOWN));break}}let y=[];o.has("leverage")&&(x.leverage=i),["openPrice","closePrice","openTime","closeTime","markPrice","quantity"].forEach(g=>{if(o.has(g))switch(g){case"leverage":break;case"openPrice":{e.openPrice!=null&&y.push({title:u("share.pnl.optionalInfo.openPrice"),value:Pt(e.openPrice,l||2)});break}case"closePrice":{e.closePrice!=null&&y.push({title:u("share.pnl.optionalInfo.closePrice"),value:Pt(e.closePrice,l||2)});break}case"openTime":{e.openTime!=null&&y.push({title:u("share.pnl.optionalInfo.openTime"),value:Ui(e.openTime)});break}case"closeTime":{e.closeTime!=null&&y.push({title:u("share.pnl.optionalInfo.closeTime"),value:Ui(e.closeTime)});break}case"markPrice":{e.markPrice!=null&&y.push({title:u("common.markPrice"),value:Pt(e.markPrice,l||2)});break}case"quantity":e.quantity!=null&&y.push({title:u("common.quantity"),value:Pt(e.quantity,a||2)})}}),x.informations=y;let f={position:x,updateTime:zo(new Date),domain:n};return r.length>0&&(f.message=r),typeof c<"u"&&c.code!==void 0&&(f.referral=c),f}function Ao(e){let i=e.split("_");if(i.length!==3)return{symbol:e,currency:"USDC"};let[r,n,s]=i;return{symbol:`${n}-${r}`,currency:s||"USDC"}}function zo(e){var u,p,h,x,y;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},n=new Intl.DateTimeFormat("en-US",r).formatToParts(i),s=(u=n.find(f=>f.type==="year"?f.value:""))==null?void 0:u.value,o=(p=n.find(f=>f.type==="month"?f.value:""))==null?void 0:p.value,a=(h=n.find(f=>f.type==="day"?f.value:""))==null?void 0:h.value,l=(x=n.find(f=>f.type==="hour"?f.value:""))==null?void 0:x.value,c=(y=n.find(f=>f.type==="minute"?f.value:""))==null?void 0:y.value;return`${s}-${o}-${a} ${l}:${c}`}function Ui(e){var c,u,p,h;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},n=new Intl.DateTimeFormat("en-US",r).formatToParts(i),s=(c=n.find(x=>x.type==="month"?x.value:""))==null?void 0:c.value,o=(u=n.find(x=>x.type==="day"?x.value:""))==null?void 0:u.value,a=(p=n.find(x=>x.type==="hour"?x.value:""))==null?void 0:p.value,l=(h=n.find(x=>x.type==="minute"?x.value:""))==null?void 0:h.value;return`${s}-${o} ${a}:${l}`}function Pt(e,i){return new O(e).toFixed(i,O.ROUND_DOWN)}function Ar(e,i,r,n){localStorage.setItem("pnl_config_key",JSON.stringify({bgIndex:r,pnlFormat:e,options:Array.from(i),message:n}))}function zr(){let e=localStorage.getItem("pnl_config_key");if(e&&e.length>0)try{return JSON.parse(e)}catch{}return{bgIndex:0,pnlFormat:"roi_pnl",options:["openPrice","closePrice","openTime","closeTime","markPrice","quantity","leverage"],message:""}}var Fr=m.forwardRef((e,i)=>{let{width:r,height:n,className:s,data:o,style:a}=e,{ref:l,download:c,toDataURL:u,copy:p,toBlob:h}=Bn(o,{ratio:e.ratio});return m.useImperativeHandle(i,()=>({download:c,toDataURL:u,toBlob:h,copy:p})),t.jsx("canvas",{ref:l,width:r,height:n,className:s,style:a})}),Fo=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M11.186 5.348a.67.67 0 0 0-.436.27l-2.657 4a.69.69 0 0 0 0 .75l2.657 4a.68.68 0 0 0 .934.188.685.685 0 0 0 .187-.937L9.463 9.993 11.87 6.37a.685.685 0 0 0-.187-.938.65.65 0 0 0-.498-.083",fill:"#fff",fillOpacity:".54"})]})})},Ro=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M8.777 5.348a.65.65 0 0 0-.498.083.685.685 0 0 0-.187.938L10.5 9.993 8.092 13.62a.685.685 0 0 0 .187.937.68.68 0 0 0 .934-.187l2.657-4a.69.69 0 0 0 0-.75l-2.657-4a.67.67 0 0 0-.436-.271",fill:"#fff",fillOpacity:".54"})]})})},Uo=e=>{let{backgroundImages:i,selectedSnap:r,setSelectedSnap:n}=e,[s,o]=Ut({containScroll:"keepSnaps",dragFree:!0}),a=m.useCallback(()=>{o&&(o!=null&&o.canScrollPrev()?o.scrollPrev():r-1>=0&&n(r-1))},[o,r]),l=m.useCallback(()=>{o&&(o!=null&&o.canScrollNext()?o.scrollNext():r+1<i.length&&n(r+1))},[o,r]),c=m.useCallback(u=>{n(u.selectedScrollSnap())},[]);return m.useEffect(()=>{o&&(c(o),o.on("reInit",c),o.on("select",c),o==null||o.scrollTo(r))},[o,c]),t.jsxs(_,{mt:4,px:2,children:[t.jsx(Fo,{onClick:a}),t.jsx("div",{ref:s,className:"oui-w-full oui-overflow oui-overflow-x-auto oui-scrollbar-hidden oui-hide-scrollbar oui-mx-0",children:t.jsx(_,{children:i.map((u,p)=>t.jsx(ee,{onClick:()=>{o!=null&&o.canScrollPrev()||o!=null&&o.canScrollNext()?o==null||o.scrollTo(p):n(p)},mx:2,my:1,mr:6,r:"base",className:U("oui-shrink-0 oui-w-[162px]",r===p&&"oui-outline oui-outline-1 oui-outline-primary-darken"),children:t.jsx("img",{src:u,className:"oui-rounded-sm"})},u))})}),t.jsx(Ro,{onClick:l})]})},Wo=e=>{let{type:i,curType:r,setPnlFormat:n}=e,{t:s}=N(),o=m.useMemo(()=>{switch(i){case"roi_pnl":return s("share.pnl.displayFormat.roi&Pnl");case"roi":return s("share.pnl.displayFormat.roi");case"pnl":return s("share.pnl.displayFormat.pnl")}},[i,s]),a=i===r,l="oui-flex oui-items-center oui-gap-1 oui-cursor-pointer";return a?l+=" oui-text-base-contrast":l+="",t.jsxs("div",{className:l,onClick:()=>{n(i)},children:[t.jsx(Bo,{sel:a}),t.jsx(d,{size:"xs",intensity:54,className:U("oui-ml-2 "),children:o})]})},Bo=e=>t.jsx("button",{type:"button",children:e.sel===!0?t.jsx(Vo,{}):t.jsx(Qo,{})}),Vo=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-primary-darken",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),Qo=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Rr=e=>{let{size:i=16,className:r}=e;return t.jsx("button",{type:"button",onClick:n=>{e.onCheckedChange(!e.checked)},className:r,children:e.checked?t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm6.664 2.922a.8.8 0 0 1 .557-.208c.2 0 .406.063.558.208a.734.734 0 0 1 0 1.063l-5.434 5.179a.826.826 0 0 1-1.115 0l-2.33-2.22a.736.736 0 0 1 0-1.063.827.827 0 0 1 1.117 0l1.77 1.687z",fill:"#fff",fillOpacity:".8"})}):t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm0 1.334h6.667c.737 0 1.334.596 1.334 1.333v6.667c0 .736-.597 1.333-1.334 1.333H4.661a1.333 1.333 0 0 1-1.334-1.333V4.62c0-.737.597-1.333 1.334-1.333",fill:"#fff",fillOpacity:".8"})})})},Ho=e=>{let{type:i,curType:r,setShareOption:n}=e,{t:s}=N(),o=m.useMemo(()=>{switch(i){case"openPrice":return s("share.pnl.optionalInfo.openPrice");case"closePrice":return s("share.pnl.optionalInfo.closePrice");case"openTime":return s("share.pnl.optionalInfo.openTime");case"closeTime":return s("share.pnl.optionalInfo.closeTime");case"markPrice":return s("common.markPrice");case"quantity":return s("common.quantity");case"leverage":return s("common.leverage")}},[i,s]),a=r.has(i);return t.jsxs(_,{itemAlign:"center",gap:1,className:U("hover:oui-cursor-pointer"),onClick:()=>{n(l=>{let c=new Set(l);return a?c.delete(i):c.add(i),c})},children:[t.jsx(Rr,{size:16,checked:a,className:"oui-pt-[2px]",onCheckedChange:l=>{n(c=>{let u=new Set(c);return a?u.delete(i):u.add(i),u})}}),t.jsx(d,{size:"xs",intensity:54,children:o})]})},Ko=e=>{let{message:i,setMessage:r,check:n,setCheck:s}=e,[o,a]=m.useState(!1),l=m.useRef(null),{t:c}=N();return t.jsxs("div",{className:"oui-mt-3 oui-mb-6 oui-flex oui-items-center",children:[t.jsx(Rr,{className:"oui-mt-[2px]",checked:n,onCheckedChange:u=>{s(u)}}),t.jsx("div",{className:"oui-text-xs oui-text-base-contrast-54 oui-ml-1 hover:oui-cursor-pointer",onClick:()=>{s(!e.check)},children:c("share.pnl.optionalInfo.message")}),t.jsx("div",{className:"oui-bg-base-900 oui-mx-2 oui-rounded-sm",children:t.jsx(Ne,{ref:l,placeholder:c("share.pnl.optionalInfo.message.placeholder"),classNames:{root:"oui-w-[320px]"},size:"sm",value:i,autoFocus:!1,suffix:o&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:u=>{r(""),setTimeout(()=>{var p;(p=l.current)==null||p.focus()},50),u.stopPropagation()},children:t.jsx(pr,{size:18,color:"white"})}),onFocus:()=>a(!0),onBlur:()=>a(!1),onChange:u=>{if(u.target.value.length>25){V.error(c("share.pnl.optionalInfo.message.maxLength"));return}s(u.target.value.length>0),r(u.target.value)}})})]})},Go=e=>{let{onClickDownload:i,onClickCopy:r}=e,{t:n}=N();return t.jsxs(_,{px:8,gap:3,mt:3,itemAlign:"center",children:[t.jsxs(re,{color:"secondary",className:"oui-flex-1 oui-flex oui-gap-1",onClick:i,children:[t.jsx("span",{children:t.jsx(Yo,{})}),n("common.download")]}),t.jsxs(re,{className:"oui-flex-1 oui-flex oui-gap-1",onClick:r,children:[t.jsx("span",{children:t.jsx(Xo,{})}),n("common.copy")]})]})},Yo=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.994A2.667 2.667 0 0 0 1.995 4.66v6.666a2.667 2.667 0 0 0 2.667 2.667h6.666a2.667 2.667 0 0 0 2.667-2.667V4.661a2.667 2.667 0 0 0-2.667-2.667zM7.995 4.66c.368 0 .667.298.667.666V8.66h2l-2.667 2.666L5.328 8.66h2V5.327c0-.368.299-.667.667-.667",fill:"#fff",fillOpacity:".98"})}),Xo=()=>t.jsx("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5.166 1.994A2.667 2.667 0 0 0 2.499 4.66v4a2.667 2.667 0 0 0 2.667 2.667 2.667 2.667 0 0 0 2.666 2.667h4a2.667 2.667 0 0 0 2.667-2.667v-4a2.667 2.667 0 0 0-2.667-2.667 2.667 2.667 0 0 0-2.666-2.666zm6.666 4c.737 0 1.334.596 1.334 1.333v4c0 .737-.597 1.334-1.334 1.334h-4A1.333 1.333 0 0 1 6.5 11.327h2.667a2.667 2.667 0 0 0 2.666-2.667z",fill:"#fff",fillOpacity:".98"})}),Jo=e=>{let{shareOptions:i}=e,{t:r}=N(),n=zr(),s=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=m.useState(s.length==1?s[0]:n.pnlFormat),[l,c]=m.useState(new Set(n.options)),[u,p]=m.useState(n.bgIndex),[h,x]=m.useState(n.message),[y,f]=m.useState(!1),{backgroundImages:g,...b}=i??{backgroundImages:[]},[j,w]=m.useState(""),v=m.useRef(null);m.useEffect(()=>{let C=window.location.hostname;w(C)},[]);let S=m.useMemo(()=>{var C;return(C=i==null?void 0:i.backgroundImages)==null?void 0:C[u]},[i==null?void 0:i.backgroundImages,u]),I=Mr(e.entity,e.leverage,y?h:"",j,o,l,e.baseDp,e.quoteDp,e.referral),k=()=>{var C;(C=v.current)==null||C.copy().then(()=>{var L;(L=e.hide)==null||L.call(e),V.success(r("share.pnl.image.copied"))}).catch(L=>{V.error(()=>t.jsxs("div",{children:[t.jsx("div",{children:r("common.copy.failed")}),t.jsx("div",{className:"oui-text-2xs oui-max-w-[396px] oui-mt-2 oui-text-base-contrast-54",children:r("share.pnl.copy.failed.description")})]}))})},D=()=>{var C,L;(C=v.current)==null||C.download("Poster.png"),(L=e.hide)==null||L.call(e)},P=[...e.entity.openPrice?["openPrice"]:[],...e.entity.closePrice?["closePrice"]:[],...e.entity.markPrice?["markPrice"]:[],...e.entity.openTime?["openTime"]:[],...e.entity.closeTime?["closeTime"]:[],...e.leverage?["leverage"]:[],...e.entity.quantity?["quantity"]:[]];return Ar(o,l,u,h),t.jsxs("div",{className:"oui-h-full oui-flex oui-flex-col oui-relative oui-w-full",children:[t.jsxs("div",{className:"oui-flex-1 oui-h-full oui-overflow-y-auto",children:[t.jsxs(ee,{mt:9,height:422,children:[t.jsx(_,{itemAlign:"center",justify:"center",children:t.jsx(Fr,{width:552,height:310,data:{backgroundImg:S,...b,data:I},ratio:3,ref:v})}),t.jsx(Uo,{backgroundImages:(i==null?void 0:i.backgroundImages)??[],selectedSnap:u,setSelectedSnap:p})]}),t.jsxs(_,{direction:"column",px:10,mt:6,justify:"start",itemAlign:"start",width:"100%",children:[t.jsx(d,{size:"sm",intensity:80,children:r("share.pnl.displayFormat")}),t.jsx(_,{pt:3,gap:3,itemAlign:"center",children:s.map((C,L)=>t.jsx(Wo,{setPnlFormat:a,type:C,curType:o},L))}),t.jsx(ke,{className:"oui-w-full oui-pt-6 oui-border-white/10"}),t.jsxs(_,{mt:6,direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(d,{size:"sm",intensity:80,children:r("share.pnl.optionalInfo")}),t.jsx(_,{mt:3,gap:4,className:"oui-flex-wrap",children:P.map((C,L)=>t.jsx(Ho,{setShareOption:c,type:C,curType:l},L))})]}),t.jsx(Ko,{message:h,setMessage:x,check:y,setCheck:f})]})]}),t.jsx(Go,{onClickCopy:k,onClickDownload:D})]})},Ur=he.createContext(null);function st(){let e=he.useContext(Ur);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}var Wr=he.forwardRef(({orientation:e="horizontal",opts:i,setApi:r,plugins:n,className:s,children:o,...a},l)=>{let[c,u]=Ut({...i,axis:e==="horizontal"?"x":"y"},n),[p,h]=he.useState(!1),[x,y]=he.useState(!1),[f,g]=he.useState(a.initIndex||0),[b,j]=he.useState([]),w=he.useCallback(k=>{k&&(b.length===0&&j(k.scrollSnapList()),g(k.selectedScrollSnap()),h(k.canScrollPrev()),y(k.canScrollNext()))},[b]),v=he.useCallback(()=>{u==null||u.scrollPrev()},[u]),S=he.useCallback(()=>{u==null||u.scrollNext()},[u]),I=he.useCallback(k=>{k.key==="ArrowLeft"?(k.preventDefault(),v()):k.key==="ArrowRight"&&(k.preventDefault(),S())},[v,S]);return he.useEffect(()=>{!u||!r||r(u)},[u,r]),he.useEffect(()=>{if(u)return w(u),u.on("reInit",w),u.on("select",w),a.initIndex&&u.scrollTo(a.initIndex),()=>{u==null||u.off("select",w)}},[u,w]),t.jsx(Ur.Provider,{value:{carouselRef:c,api:u,opts:i,orientation:e||((i==null?void 0:i.axis)==="y"?"vertical":"horizontal"),scrollPrev:v,scrollNext:S,canScrollPrev:p,canScrollNext:x,selectedIndex:f,scrollSnaps:b},children:t.jsx("div",{ref:l,onKeyDownCapture:I,className:U("oui-relative",s),role:"region","aria-roledescription":"carousel",...a,children:o})})});Wr.displayName="Carousel";var gi=he.forwardRef(({className:e,...i},r)=>{let{carouselRef:n,orientation:s}=st();return t.jsx("div",{ref:n,className:"oui-overflow-hidden",children:t.jsx("div",{ref:r,className:U("oui-flex",s==="horizontal"?"oui--ml-4":"oui--mt-4 oui-flex-col",e),...i})})});gi.displayName="CarouselContent";var yi=he.forwardRef(({className:e,...i},r)=>{let{orientation:n}=st();return t.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:U("oui-min-w-0 oui-shrink-0 oui-grow-0 oui-basis-full",n==="horizontal"?"oui-pl-4":"oui-pt-4",e),...i})});yi.displayName="CarouselItem";var Br=he.forwardRef(({className:e,variant:i="contained",size:r="icon",...n},s)=>{let{orientation:o,scrollPrev:a,canScrollPrev:l}=st();return t.jsxs(re,{ref:s,variant:i,className:U("oui-absolute  oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--left-12 oui-top-1/2 oui--translate-y-1/2":"oui--top-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(ChevronLeft,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Previous slide"})]})});Br.displayName="CarouselPrevious";var Vr=he.forwardRef(({className:e,variant:i="contained",size:r="icon",...n},s)=>{let{orientation:o,scrollNext:a,canScrollNext:l}=st();return t.jsxs(re,{ref:s,variant:i,className:U("oui-absolute oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--right-12 oui-top-1/2 oui--translate-y-1/2":"oui--bottom-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(ChevronRight,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Next slide"})]})});Vr.displayName="CarouselNext";var Qr=e=>{let{scrollSnaps:i,selectedIndex:r}=st();return t.jsx("div",{className:U("oui-flex oui-gap-1",e.className),children:i.map((n,s)=>t.jsx(Hr,{index:s,active:s===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},s))})};Qr.displayName="CarouselIdentifier";var Hr=({index:e,active:i,onClick:r,className:n,activeClassName:s})=>t.jsx("button",{onClick:()=>r==null?void 0:r(e),className:U("oui-w-2 oui-h-2 oui-rounded-full oui-bg-white/30",n,i&&`active ${s||"oui-bg-primary-darken"}`)}),ot=Wr;ot.Content=gi;ot.Item=yi;ot.Next=Vr;ot.Previous=Br;ot.indentify=Qr;var Zo=e=>{var q,z;let{shareOptions:i}=e,{t:r}=N(),n=zr(),s=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=m.useState(s.length==1?s[0]:n.pnlFormat),[l,c]=m.useState(new Set(n.options)),[u,p]=m.useState(n.message),[h,x]=m.useState(n.bgIndex),{backgroundImages:y,...f}=i??{backgroundImages:[]},[g,b]=m.useState(""),j=(q=i==null?void 0:i.backgroundImages)==null?void 0:q.map(()=>m.useRef(null));m.useEffect(()=>{let W=window.location.hostname;b(W)},[]);let w=Mr(e.entity,e.leverage,u,g,o,l,e.baseDp,e.quoteDp,e.referral),v=m.useRef(),S=552/310,[I,k]=m.useState(1),[D,P]=m.useState(0),[C,L]=m.useState(!1),M=m.useRef(null);m.useEffect(()=>{if(v.current){let W=v.current.offsetWidth,H=W/S;P(H),k(W/552)}},[v,g]);let F=async W=>{var B,T;if(!W.current)return;let H=(B=W.current)==null?void 0:B.toDataURL(),ne=ea(H);try{navigator.share&&await navigator.share({text:u,files:[new File([ne],"image.png",{type:"image/png"})]}),(T=e.hide)==null||T.call(e)}catch{}};return Ar(o,l,h,u),t.jsxs("div",{className:"oui-w-full",children:[t.jsx("div",{ref:v,className:"oui-w-full oui-mt-4 oui-overflow-hidden",style:{height:`${D+20}px`},children:t.jsxs(ot,{className:"oui-w-full oui-overflow-hidden",opts:{align:"start"},initIndex:h,children:[t.jsx(gi,{style:{height:`${D}px`},children:(z=i==null?void 0:i.backgroundImages)==null?void 0:z.map((W,H)=>t.jsx(yi,{children:t.jsx(Fr,{className:"oui-transform oui-origin-top-left",style:{scale:`${I}`},width:552,height:310,data:{backgroundImg:W,...f,data:w},ratio:3,ref:j==null?void 0:j[H]})},H))}),t.jsx("div",{className:"oui-mt-2 oui-mb-1 oui-flex oui-justify-center",children:t.jsx(ta,{dotClassName:"oui-w-[16px] oui-h-[4px] oui-bg-base-300",dotActiveClassName:"!oui-bg-primary-darken oui-w-[20px]",setSelectIndex:x})})]})}),t.jsxs(mr,{className:"oui-max-h-[200px] oui-overflow-y-auto oui-custom-scrollbar",children:[t.jsxs("div",{className:"oui-mt-4",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54",children:r("share.pnl.displayFormat")}),t.jsx("div",{className:"oui-pt-3 oui-px-1 oui-justify-between oui-gap-3 oui-grid oui-grid-cols-3 oui-row-span-1",children:s.map(W=>t.jsx($o,{setPnlFormat:a,type:W,curType:o}))})]}),t.jsxs("div",{className:"oui-mt-3",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:r("share.pnl.optionalInfo")}),t.jsxs("div",{className:"oui-flex oui-flex-wrap oui-gap-3 oui-mt-3",children:[e.entity.openPrice&&t.jsx(Be,{setShareOption:c,type:"openPrice",curType:l}),e.entity.closePrice&&t.jsx(Be,{setShareOption:c,type:"closePrice",curType:l}),e.entity.openTime&&t.jsx(Be,{setShareOption:c,type:"openTime",curType:l}),e.entity.closeTime&&t.jsx(Be,{setShareOption:c,type:"closeTime",curType:l}),e.leverage&&t.jsx(Be,{setShareOption:c,type:"leverage",curType:l}),e.entity.markPrice&&t.jsx(Be,{setShareOption:c,type:"markPrice",curType:l}),e.entity.quantity&&t.jsx(Be,{setShareOption:c,type:"quantity",curType:l})]})]}),t.jsxs("div",{className:"oui-mt-3 oui-mb-8",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:r("share.pnl.optionalInfo.message")}),t.jsx("div",{className:"oui-mt-3 oui-h-[48px] oui-bg-base-600 oui-mx-1",children:t.jsx(Ne,{placeholder:r("share.pnl.optionalInfo.message.placeholder"),containerClassName:"oui-bg-transparent oui-h-[48px]",value:u,autoFocus:!1,onChange:W=>{if(W.target.value.length>25){V.error(r("share.pnl.optionalInfo.message.maxLength"));return}p(W.target.value)},ref:M,onFocus:()=>L(!0),onBlur:()=>L(!1),suffix:C&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:W=>{p(""),setTimeout(()=>{var H;(H=M.current)==null||H.focus()},50),W.stopPropagation()},children:t.jsx(pr,{size:18,color:"white"})})})})]})]}),t.jsx("div",{className:"oui-pt-2",children:t.jsx(re,{fullWidth:!0,className:"oui-h-[40px] oui-text-[16px]",onClick:()=>{let W=j==null?void 0:j[h];W&&F(W)},children:r("common.share")})})]})},$o=e=>{let{type:i,curType:r,setPnlFormat:n}=e,{t:s}=N(),o=m.useMemo(()=>{switch(i){case"roi_pnl":return s("share.pnl.displayFormat.roi&Pnl");case"roi":return s("share.pnl.displayFormat.roi");case"pnl":return s("share.pnl.displayFormat.pnl")}},[i]);return t.jsx("div",{className:U("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-flex-1 oui-bg-base-4 hover:oui-cursor-pointer oui-flex oui-items-center oui-px-3 oui-referral-shadow",i===r&&"oui-bg-primary-darken oui-dot-sel"),onClick:()=>{n(i)},children:t.jsx("div",{className:"oui-text-sm oui-text-base-contrast",children:o})})},Be=e=>{let{type:i,curType:r,setShareOption:n}=e,{t:s}=N(),o=m.useMemo(()=>{switch(i){case"openPrice":return s("share.pnl.optionalInfo.openPrice");case"closePrice":return s("share.pnl.optionalInfo.closePrice");case"openTime":return s("share.pnl.optionalInfo.openTime");case"closeTime":return s("share.pnl.optionalInfo.closeTime");case"markPrice":return s("common.markPrice");case"quantity":return s("common.quantity");case"leverage":return s("common.leverage")}},[i,s]),a=r.has(i);return t.jsxs("div",{className:U("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-mt-0 oui-w-[calc(50%-6px)] oui-bg-base-4 hover:oui-cursor-pointer oui-items-center oui-flex oui-p-3 oui-referral-shadow"),onClick:()=>{n(l=>{let c=new Set(l);return a?c.delete(i):c.add(i),c})},children:[t.jsx("div",{className:"oui-text-sm oui-flex-1 oui-text-base-contrast",children:o}),a&&t.jsx(ia,{})]})};function ea(e){let i=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(i.length),s=new Uint8Array(n);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return new Blob([n],{type:r})}var ta=e=>{let{scrollSnaps:i,selectedIndex:r}=st();return m.useEffect(()=>{e.setSelectIndex(r)},[r]),t.jsx("div",{className:U("oui-flex oui-gap-1"),children:i.map((n,s)=>t.jsx(Hr,{index:s,active:s===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},s))})},ia=()=>t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.01416 11.9989C2.01416 6.47589 6.49136 1.9989 12.0142 1.9989C17.5372 1.9989 22.0142 6.47589 22.0142 11.9989C22.0142 17.5219 17.5372 21.9989 12.0142 21.9989C6.49136 21.9989 2.01416 17.5219 2.01416 11.9989ZM16.9853 7.31211C17.2125 7.09537 17.5236 7 17.8218 7C18.1201 7 18.4312 7.09537 18.6583 7.31211C19.1139 7.74546 19.1139 8.47384 18.6583 8.9072L10.5077 16.675C10.0534 17.1083 9.28909 17.1083 8.83472 16.675L5.34077 13.3459C4.88641 12.9126 4.88641 12.1841 5.34077 11.7508C5.79631 11.3175 6.56057 11.3175 7.01493 11.7508L9.67122 14.2822L16.9853 7.31211Z",fill:"white",fillOpacity:"1"})}),ra=e=>{let{leverage:i,entity:r,baseDp:n,quoteDp:s,referralInfo:o,shareOptions:a,hide:l}=e,[c,u]=m.useState(window.innerHeight<900?660:807);return m.useEffect(()=>{let p=()=>{u(window.innerHeight<900?660:807)};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]),a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Jo,{entity:r,leverage:i,hide:l,baseDp:n,quoteDp:s,referral:o,shareOptions:a})},na=e=>{let{leverage:i,entity:r,baseDp:n,quoteDp:s,referralInfo:o,shareOptions:a,hide:l}=e;return a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Zo,{entity:r,leverage:i,hide:l,baseDp:n,quoteDp:s,referral:o,shareOptions:a})},sa=e=>{let i=Er({hide:e.hide,pnl:e.pnl});return t.jsx(na,{...i})},oa=e=>{let i=Er({hide:e.hide,pnl:e.pnl});return t.jsx(ra,{...i})},Wt="sharePnLDialog",Bt="sharePnLBottomSheet";Tt(Wt,oa,{classNames:{content:"!oui-max-w-[624px] oui-p-0"}});tr(Bt,sa,{title:E.t("share.pnl.sharePnl"),classNames:{body:"oui-pb-4 oui-pt-0"}});var aa=e=>{let{type:i,values:r}=e,[n,s]=Oe("TP/SL_Mode","Offset%"),[o,a]=m.useState(!0),{t:l}=N(),c=m.useMemo(()=>{switch(n){case"Offset":return`${i.toLowerCase()}_offset`;case"Offset%":return`${i.toLowerCase()}_offset_percentage`;default:return`${i.toLowerCase()}_pnl`}},[n]),u=m.useMemo(()=>r[n],[r,n]),p=m.useMemo(()=>[{label:l("tpsl.pnl"),value:"PnL",testId:"PnL_menu_item"},{label:l("tpsl.offset"),value:"Offset",testId:"Offset_mneu_item"},{label:`${l("tpsl.offset")}%`,value:"Offset%",testId:"Offset%_menu_item"}],[l]),h=m.useRef(""),x=f=>{e.onChange(c,f)},y=f=>{let{dp:g=2}=f;return{onRenderBefore:(b,j)=>(b=`${b}`,o&&i==="SL"&&n==="PnL"&&(b=b.startsWith("-")?b:"-"+b),b===""||b==="-"?"":n==="Offset%"?`${new O(b.replace(new RegExp(h.current.replace(".","\\.")+"$"),"")).mul(100).todp(2,4).toString()}${h.current}`:(n==="Offset"&&(b=Xt(b,g)),`${b}`)),onSendBefore:b=>{if(/^\-?0{2,}$/.test(b))return"0";if(n==="Offset%"){if(b!==""){b=Xt(b,2);let j=b.match(/\.0{0,2}$/);j?h.current=j[0]:h.current="",b=new O(b).div(100).toString(),b=`${b}${h.current}`}}else n==="PnL"&&i==="SL"&&o?b=b.startsWith("-")?b:"-"+b:b=Xt(b,g);return b===""||b==="-"?"":b}}};return{mode:n,modes:p,type:e.type,formatter:y,onModeChange:f=>{s(f)},value:u,pnl:r.PnL,onValueChange:x,quote_dp:e.quote_dp,setFocus:a}},la=e=>{let{mode:i,modes:r,onModeChange:n,onValueChange:s,quote:o,quote_dp:a,value:l,pnl:c}=e,{t:u}=N(),[p,h]=m.useState(i),[x,y]=m.useState(i==="Offset%"?"%":o),f=m.useMemo(()=>{let g=Number(c);if(isNaN(g)||g===0)return"";if(g>0)return"oui-text-trade-profit";if(g<0)return"oui-text-trade-loss"},[c]);return m.useEffect(()=>{var b;let g=(b=r.find(j=>j.value===i))==null?void 0:b.label;h(g),y(i==="Offset%"?"%":o)},[i,r]),t.jsx(Ne,{prefix:p,size:{initial:"lg",lg:"md"},placeholder:x,align:"right",value:l,"data-testid":e.testId,autoComplete:"off",onValueChange:s,formatters:[e.formatter({dp:a,mode:i}),Z.currencyFormatter,Z.decimalPointFormatter],classNames:{input:f,prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onFocus:()=>{y(""),e.setFocus(!0)},onBlur:()=>{y(i==="Offset%"?"%":o),e.setFocus(!1)},suffix:t.jsxs(t.Fragment,{children:[i==="Offset%"&&!!l&&t.jsx(d,{size:"2xs",color:"inherit",className:U("oui-ml-[2px]",f),children:"%"}),t.jsx(ca,{mode:i,modes:r,onModeChange:g=>n(g.value)})]})})},ca=e=>t.jsx(Yn,{currentValue:e.mode,menu:e.modes,align:"end",size:"xs",className:"oui-min-w-[80px]",onSelect:i=>e.onModeChange(i),children:t.jsx("button",{className:"oui-p-2",children:t.jsx(hr,{size:12,color:"white"})})}),Wi=e=>{let{testId:i,quote:r,...n}=e,s=aa(n);return t.jsx(la,{...s,testId:i,quote:r})},ua=e=>{let{TPSL_OrderEntity:i,symbolInfo:r,onCancel:n,onComplete:s,status:o,errors:a,isPosition:l}=e,{t:c}=N(),{parseErrorMsg:u}=_t(a);return t.jsxs("div",{id:"orderly-tp_sl-order-edit-content",children:[(!e.isEditing||e.isEditing&&!e.isPosition)&&t.jsxs(t.Fragment,{children:[t.jsx(da,{maxQty:e.maxQty,quantity:e.orderQuantity??e.maxQty,baseTick:r("base_tick"),dp:r("base_dp"),onQuantityChange:e.setQuantity,quote:r("base"),isEditing:e.isEditing,isPosition:l,errorMsg:u("quantity")}),t.jsx(ke,{my:4,intensity:8})]}),t.jsx(ma,{sl_pnl:i.sl_pnl,tp_pnl:i.tp_pnl,quote:r("quote"),quote_dp:r("quote_dp"),onPriceChange:e.setOrderPrice,onPnLChange:e.setPnL,errors:a,tp_values:{PnL:`${i.tp_pnl??""}`,Offset:`${i.tp_offset??""}`,"Offset%":`${i.tp_offset_percentage??""}`},sl_values:{PnL:`${i.sl_pnl??""}`,Offset:`${i.sl_offset??""}`,"Offset%":`${i.sl_offset_percentage??""}`},tp_trigger_price:i.tp_trigger_price??"",sl_trigger_price:i.sl_trigger_price??""}),t.jsxs(De,{cols:2,gap:3,mt:4,children:[t.jsx(re,{size:"md",color:"secondary","data-testid":"tpsl-cancel",onClick:()=>{n==null||n()},children:c("common.cancel")}),t.jsx(nt,{size:"md","data-testid":"tpsl-confirm",disabled:!e.valid||o.isCreateMutating,loading:o.isCreateMutating||o.isUpdateMutating,onClick:()=>{e.onSubmit().then(()=>{s==null||s()},()=>{})},children:c("common.confirm")})]})]})},da=e=>{let{isPosition:i}=e,r=m.useRef(null),n=Kn(e.quantity,0,e.maxQty)/100,{t:s}=N(),o=()=>{var c,u;(c=e.onQuantityChange)==null||c.call(e,0),(u=r.current)==null||u.focus(),setTimeout(()=>{var p;(p=r.current)==null||p.setSelectionRange(0,1)},0)},a=c=>{var u;e.baseTick>0&&((u=e.onQuantityChange)==null||u.call(e,de.formatNumber(c,e.baseTick)??c))},l=(i?"":e.quantity).toString().length>0?e.errorMsg:void 0;return t.jsxs(t.Fragment,{children:[t.jsxs(_,{gap:2,children:[t.jsx("div",{className:"oui-flex-1",children:t.jsx(Ne.tooltip,{"data-testid":"oui-testid-tpsl-popUp-quantity-input",ref:r,prefix:s("common.quantity"),size:{initial:"lg",lg:"md"},align:"right",value:i?"":e.quantity,autoComplete:"off",classNames:{prefix:"oui-text-base-contrast-54",root:U("oui-bg-base-5 oui-outline-line-12",l&&"oui-outline-danger")},tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},tooltip:l,color:l?"danger":void 0,formatters:[Z.dpFormatter(e.dp),Z.numberFormatter,Z.currencyFormatter,Z.decimalPointFormatter],onValueChange:c=>{var p,h,x;(p=e.onQuantityChange)==null||p.call(e,c);let u=Number(c);if(u&&u>e.maxQty){let y=i?0:e.maxQty;(h=e.onQuantityChange)==null||h.call(e,y),(x=r.current)==null||x.blur()}},onBlur:c=>a(c.target.value),suffix:i?t.jsx("button",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",onClick:()=>{o()},children:s("tpsl.entirePosition")}):t.jsx("span",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",children:e.quote})})}),!e.isEditing&&t.jsx(re,{onClick:()=>{var u;let c=i?0:e.maxQty;(u=e.onQuantityChange)==null||u.call(e,c),c===0&&o()},variant:"outlined",className:U("oui-text-2xs oui-w-[68px] oui-h-[40px] xl:oui-h-[32px]",i?"oui-border-primary-light oui-text-primary-light hover:oui-bg-primary-light/20":"oui-bg-base-6 oui-border-line-12 oui-text-base-contrast-54 hover:oui-bg-base-5"),children:s("common.position")})]}),t.jsx(_,{mt:2,itemAlign:"center",height:"15px",children:t.jsx(rt.single,{markCount:5,color:"primary",max:e.maxQty,min:0,showTip:!0,step:e.baseTick,value:e.quantity,onValueCommit:c=>{a(`${c}`)},onValueChange:c=>{var u;(u=e.onQuantityChange)==null||u.call(e,c)}})}),t.jsxs(_,{justify:"between",children:[t.jsx(d.numeral,{rule:"percentages",color:"primary",size:"2xs",children:n}),t.jsxs(_,{itemAlign:"center",gap:1,children:[t.jsx("button",{className:"oui-leading-none",style:{lineHeight:0},onClick:()=>{var c;(c=e.onQuantityChange)==null||c.call(e,e.maxQty)},children:t.jsx(d,{color:"primary",size:"2xs",children:s("common.max")})}),t.jsx(d.numeral,{rule:"price",size:"2xs",intensity:54,tick:e.baseTick,children:e.maxQty})]})]})]})},ma=e=>{var s,o;let{t:i}=N(),{parseErrorMsg:r}=_t(e.errors),n=(a,l)=>{e.onPnLChange(a,l)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsxs(_,{justify:"between",children:[t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",intensity:80,children:i("tpsl.takeProfit")}),t.jsx(d,{size:"2xs",intensity:36,children:`(${(s=i("orderEntry.orderType.marketOrder"))==null?void 0:s.toLowerCase()})`})]}),t.jsxs(_,{children:[t.jsx(d,{size:"2xs",intensity:36,children:`${i("tpsl.estPnl")}:`}),t.jsx(d.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.tp_pnl??"-"})]})]}),t.jsxs(De,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(Bi,{type:"TP",value:e.tp_trigger_price,error:r("tp_trigger_price"),onValueChange:a=>{e.onPriceChange("tp_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(Wi,{type:"TP",onChange:n,quote:e.quote,quote_dp:e.quote_dp,values:e.tp_values})]})]}),t.jsxs("div",{children:[t.jsxs(_,{justify:"between",children:[t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",intensity:80,children:i("tpsl.stopLoss")}),t.jsx(d,{size:"2xs",intensity:36,children:`(${(o=i("orderEntry.orderType.marketOrder"))==null?void 0:o.toLowerCase()})`})]}),t.jsxs(_,{children:[t.jsx(d,{size:"2xs",intensity:36,children:`${i("tpsl.estPnl")}:`}),t.jsx(d.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.sl_pnl??"-"})]})]}),t.jsxs(De,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(Bi,{type:"SL",value:e.sl_trigger_price,error:r("sl_trigger_price"),onValueChange:a=>{e.onPriceChange("sl_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(Wi,{type:"SL",onChange:n,quote:e.quote,quote_dp:e.quote_dp,values:e.sl_values})]})]})]})},Bi=e=>{let[i,r]=m.useState("USDC"),{t:n}=N();return t.jsx(Ne.tooltip,{"data-testid":`oui-testid-tpsl-popUp-${e.type.toLowerCase()}-input`,prefix:n("common.markPrice"),size:{initial:"lg",lg:"md"},tooltip:e.error,placeholder:i,align:"right",autoComplete:"off",value:e.value,color:e.error?"danger":void 0,classNames:{prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onValueChange:e.onValueChange,onFocus:()=>{r("")},onBlur:()=>{r("USDC")},formatters:[Z.numberFormatter,Z.dpFormatter(e.quote_dp),Z.currencyFormatter,Z.decimalPointFormatter]})},Kr=e=>{let{symbol:i,tpPrice:r,slPrice:n,qty:s,maxQty:o,side:a,quoteDP:l,baseDP:c,isEditing:u,isPositionTPSL:p}=e,{t:h}=N(),[x,y]=Oe("orderly_order_confirm",!0),f=kt({size:"xs",intensity:54}),g=p??s>=o;return t.jsxs(t.Fragment,{children:[u&&t.jsx(d,{as:"div",size:"2xs",intensity:80,className:"oui-mb-3",children:`You agree to edit your ${Vn(i)} order.`}),t.jsxs(_,{pb:4,children:[t.jsx(ee,{grow:!0,children:t.jsx(d.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,as:"div",intensity:80,children:i})}),t.jsxs(_,{gap:1,children:[g&&t.jsx(Y,{size:"xs",color:"primary",children:h("common.position")}),t.jsx(pa,{tpPrice:r,slPrice:n}),a===Ce.SELL?t.jsx(Y,{size:"xs",color:"success",children:h("common.buy")}):t.jsx(Y,{size:"xs",color:"danger",children:h("common.sell")})]})]}),t.jsx(ke,{}),t.jsxs(_,{direction:"column",itemAlign:"stretch",gapY:1,pt:4,className:U(f,"oui-pb-4 xl:oui-pb-5"),children:[t.jsxs(_,{children:[t.jsx(ee,{grow:!0,children:h("common.qty")}),t.jsx("div",{children:g?t.jsx("span",{className:"oui-text-base-contrast",children:h("tpsl.entirePosition")}):t.jsx(d.numeral,{intensity:98,dp:c,padding:!1,children:s})})]}),typeof r=="number"&&r>0?t.jsxs(_,{children:[t.jsx(ee,{grow:!0,children:h("tpsl.tpPrice")}),t.jsx(d.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:r})]}):null,typeof n=="number"&&n>0?t.jsxs(_,{children:[t.jsx(ee,{grow:!0,children:h("tpsl.slPrice")}),t.jsx(d.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,className:"oui-text-trade-loss",unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:n})]}):null,t.jsxs(_,{children:[t.jsx(ee,{grow:!0,children:h("common.price")}),t.jsx("div",{className:"oui-text-base-contrast",children:h("common.marketPrice")})]})]}),t.jsx(ee,{pt:2,children:t.jsxs(_,{gap:1,children:[t.jsx(fr,{id:"disabledConfirm",color:"white",checked:!x,onCheckedChange:b=>{y(!b)}}),t.jsx("label",{htmlFor:"disabledConfirm",className:kt({size:"xs",intensity:54,className:"oui-ml-1"}),children:h("orderEntry.disableOrderConfirm")})]})})]})},pa=e=>{let{tpPrice:i,slPrice:r}=e,{t:n}=N();return i&&r?t.jsx(Y,{size:"xs",color:"neutral",children:n("common.tpsl")}):i?t.jsx(Y,{size:"xs",color:"neutral",children:n("tpsl.tp")}):r?t.jsx(Y,{size:"xs",color:"neutral",children:n("tpsl.sl")}):null},fa=e=>{let{position:i,order:r,isEditing:n}=e;if(n&&!r)throw new Qn("order is required when isEditing is true");let s=n?r.symbol:i.symbol,o=Ae(),a=m.useRef(K.TP_SL),[l]=Oe("orderly_order_confirm",!0),[c,{submit:u,deleteOrder:p,setValue:h,validate:x,errors:y,isCreateMutating:f,isUpdateMutating:g}]=Hn({symbol:s,position_qty:i.position_qty,average_open_price:i.average_open_price},{defaultOrder:r,isEditing:n}),b=C=>{h("quantity",C)},j=(C,L)=>{h(C,L)},w=(C,L)=>{h(C,L)},v=m.useMemo(()=>Math.abs(Number(i.position_qty)),[i.position_qty]),S=m.useMemo(()=>{let C=(r==null?void 0:r.algo_type)===K.POSITIONAL_TP_SL?v:r==null?void 0:r.quantity,L=0;if((Number(c.quantity)!==C||!n&&c.quantity)&&(L=1),r&&n){let M=r.child_orders.find(q=>q.algo_type===ge.TAKE_PROFIT),F=r.child_orders.find(q=>q.algo_type===ge.STOP_LOSS);(M==null?void 0:M.trigger_price)!==Number(c.tp_trigger_price)&&typeof typeof c.tp_trigger_price<"u"&&(L=2),(F==null?void 0:F.trigger_price)!==Number(c.sl_trigger_price)&&typeof c.sl_trigger_price<"u"&&(L=3)}return L===1&&!c.tp_trigger_price&&!c.sl_trigger_price&&(L=-1),L},[c.tp_trigger_price,c.sl_trigger_price,c.quantity,r,n]),I=m.useMemo(()=>(r==null?void 0:r.algo_type)===K.POSITIONAL_TP_SL&&Number(c.quantity)<v&&!c.tp_trigger_price&&!c.sl_trigger_price?!1:S>0&&!!c.quantity&&!y,[c.quantity,v,S,y]),k=m.useMemo(()=>n?r&&r.algo_type!==K.POSITIONAL_TP_SL?!1:c.algo_order_id&&c.quantity==0?!0:Number(c.quantity)>=v:Number(c.quantity)>=v,[c.quantity,v,r==null?void 0:r.algo_type,n]);m.useEffect(()=>{if(!n&&k){let C=de.findTPSLFromOrder(r);!c.tp_trigger_price&&C.tp_trigger_price&&j("tp_trigger_price",C.tp_trigger_price),!c.sl_trigger_price&&C.sl_trigger_price&&j("sl_trigger_price",C.sl_trigger_price)}},[n,k,c]),m.useEffect(()=>{let C=Number(c.quantity)<v?K.TP_SL:K.POSITIONAL_TP_SL;typeof e.onTPSLTypeChange=="function"&&a.current!==C&&e.onTPSLTypeChange(C),a.current=C},[c.quantity,v]);let D=()=>r!=null&&r.algo_order_id&&(r!=null&&r.symbol)?p(r==null?void 0:r.algo_order_id,r==null?void 0:r.symbol):Promise.reject("order id or symbol is invalid"),P=async()=>Promise.resolve().then(()=>typeof e.onConfirm!="function"||!l?u().then(()=>!0,C=>(C!=null&&C.message&&V.error(C.message),Promise.reject(!1))):e.onConfirm(c,{position:i,submit:u,cancel:D})).then(C=>{});return{isEditing:n,symbolInfo:o[s],maxQty:v,setQuantity:b,orderQuantity:c.quantity,isPosition:k,TPSL_OrderEntity:c,setOrderValue:h,setPnL:w,setOrderPrice:j,onSubmit:P,valid:I,errors:y,status:{isCreateMutating:f,isUpdateMutating:g}}},Gr=e=>{let{onCancel:i,onComplete:r,...n}=e,s=fa(n);return t.jsx(ua,{...s,onCancel:i,onComplete:r})},bi=e=>{let{position:i,order:r,baseDP:n,quoteDP:s,buttonProps:o,isEditing:a}=e,[l,c]=m.useState(!1),[u,p]=m.useState(!0),[h]=Oe("orderly_order_confirm",!0),{t:x}=N(),y=a?(r==null?void 0:r.algo_type)===K.POSITIONAL_TP_SL:void 0;return t.jsxs(ai,{onOpenChange:f=>{u&&c(f)},open:l,children:[t.jsx(li,{asChild:!0,onClick:()=>{c(!0)},children:e.children||t.jsx(re,{variant:"outlined",size:"sm",color:"secondary",...o,children:e.label})}),t.jsx(ci,{className:U("oui-w-[360px]",u?"oui-visible":"oui-invisible"),align:"end",side:"top",children:t.jsx(Gr,{position:i,order:r,isEditing:a,onComplete:()=>{c(!1)},onCancel:()=>{c(!1)},onConfirm:(f,g)=>{if(!h)return Promise.resolve(!0);p(!1);let b=Math.abs(Number(i.position_qty));if(`${f.tp_trigger_price??""}`.length===0&&`${f.sl_trigger_price??""}`.length===0)return ye.confirm({title:x("orders.cancelOrder"),content:x("tpsl.cancelOrder.description"),onOk:()=>g.cancel()}).then(()=>(c(!1),p(!0),!0),()=>(p(!0),Promise.reject(!1)));let j=a||!!f&&f.algo_type===K.POSITIONAL_TP_SL&&f.quantity===b;return ye.confirm({title:x(j?"orders.editOrder":"tpsl.confirmOrder"),onOk:()=>g.submit(),classNames:{body:"!oui-pb-0"},content:t.jsx(Kr,{isPositionTPSL:y,isEditing:j,symbol:f.symbol,qty:Number(f.quantity),maxQty:b,tpPrice:Number(f.tp_trigger_price),slPrice:Number(f.sl_trigger_price),side:f.side,quoteDP:s??2,baseDP:n??2})}).then(()=>(c(!1),p(!0),!0),()=>(p(!0),Promise.reject(!1)))}})})]})},Yr=e=>{let{position:i,order:r,symbolInfo:n,isEditing:s}=e,{resolve:o,hide:a,updateArgs:l}=ui(),[c]=Oe("orderly_order_confirm",!0),{t:u}=N(),p=s?(r==null?void 0:r.algo_type)===K.POSITIONAL_TP_SL:void 0,h=g=>{s||l({title:g})},x=()=>{o(),a()},{quote_dp:y,base_dp:f}=n;return t.jsxs(t.Fragment,{children:[t.jsx(ha,{position:i,symbolInfo:n}),t.jsx(Gr,{...e,onTPSLTypeChange:g=>{h(g===K.TP_SL?u("common.tpsl"):u("tpsl.positionTpsl"))},onComplete:x,onConfirm:(g,b)=>{if(!c)return Promise.resolve(!0);let j=Math.abs(Number(i.position_qty)),w=s||!!g&&g.algo_type===K.POSITIONAL_TP_SL&&g.quantity===j;return ye.confirm({title:u(w?"orders.editOrder":"tpsl.confirmOrder"),bodyClassName:"oui-pb-0 lg:oui-pb-0",onOk:()=>b.submit(),content:t.jsx(Kr,{isPositionTPSL:p,isEditing:s,symbol:g.symbol,qty:Number(g.quantity),maxQty:j,tpPrice:Number(g.tp_trigger_price),slPrice:Number(g.sl_trigger_price),side:g.side,quoteDP:y??2,baseDP:f??2})}).then(()=>!0,v=>(v!=null&&v.message&&V.error(v.message),Promise.reject(!1)))},onCancel:()=>{a()}})]})},ha=e=>{var l;let{position:i,symbolInfo:r}=e,{data:n}=Gn(i.symbol),s=ui(),{t:o}=N(),a=m.useMemo(()=>{var c;return((c=s.args)==null?void 0:c.title)===o("tpsl.positionTpsl")},[(l=s.args)==null?void 0:l.title,o]);return t.jsxs(t.Fragment,{children:[t.jsxs(_,{justify:"between",pb:3,itemAlign:"center",children:[t.jsx(d.formatted,{rule:"symbol",className:"oui-text-xs",showIcon:!0,children:i.symbol}),t.jsxs(_,{gapX:1,children:[a&&t.jsx(Y,{size:"xs",color:"primary",children:o("common.position")}),t.jsx(Y,{size:"xs",color:"neutral",children:o("common.tpsl")}),i.position_qty<0?t.jsx(Y,{size:"xs",color:"buy",children:o("common.buy")}):t.jsx(Y,{size:"xs",color:"sell",children:o("common.sell")})]})]}),t.jsx(ke,{intensity:8}),t.jsxs(ee,{py:3,className:"oui-space-y-1",children:[t.jsxs(_,{justify:"between",children:[t.jsx(d,{size:"sm",intensity:54,children:o("common.avgOpen")}),t.jsx(d.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:i.average_open_price})]}),t.jsxs(_,{justify:"between",children:[t.jsx(d,{size:"sm",intensity:54,children:o("common.markPrice")}),t.jsx(d.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:n})]})]})]})},Xr=m.createContext({}),ze=()=>m.useContext(Xr),Jr=e=>{var C;let[i,r]=m.useState(Math.abs(e.position.position_qty).toString()),{t:n}=N();m.useEffect(()=>{r(Math.abs(e.position.position_qty).toString())},[e.position.position_qty]);let[s,o]=m.useState(""),a=e.position.position_qty>0?Ce.SELL:Ce.BUY,[l,c]=m.useState(void 0),[u,p]=m.useState(J.MARKET),h=Ae(),x=e.position.symbol,y=h==null?void 0:h[x],f=y("quote_dp"),g=y("base_dp"),b=y("base_tick"),{helper:j,onSubmit:w,submitting:v}=Jn((C=e.position)==null?void 0:C.symbol,a,!0),S=(L,M)=>{if(p(L),L===J.LIMIT){if(!M)throw new Error(n("orderEntry.orderPrice.error.required"));o(M)}else o("")},I=m.useMemo(()=>{let{position:L}=e;if(!L)return null;let M={order_quantity:i,symbol:e.position.symbol,order_type:u,side:a,reduce_only:!0};return u===J.LIMIT&&(M.order_price=s),M},[e.position,s,u,i]),k=L=>{let M=j.calculate({},"order_quantity",L);r(M.order_quantity)},D=L=>{let M=j.calculate({},"order_price",L);o(M.order_price)};m.useEffect(()=>{let L=I;j.validator(L).then(M=>{c(M)})},[I]);let P=()=>w(I).catch(L=>(typeof L=="string"?V.error(L):V.error(L.message),Promise.resolve()));return t.jsx(Xr.Provider,{value:{quantity:i,price:s,type:u,side:a,position:e.position,updatePriceChange:D,updateQuantity:k,updateOrderType:S,tpslOrder:e.position.algo_order,onSubmit:P,submitting:v,closeOrderData:I,quoteDp:f,baseDp:g,baseTick:b,errors:l},children:e.children})},Zr=m.createContext({}),Me=()=>m.useContext(Zr),Vt=e=>{let i=Ae()[e.symbol];return t.jsx(Zr.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},xa=()=>{let[e,i]=m.useState(!1),{onSubmit:r,price:n,quantity:s,closeOrderData:o,type:a,submitting:l,quoteDp:c,errors:u}=ze(),{base:p,quote:h}=Me(),[x]=Oe("orderly_order_confirm",!0),{t:y}=N(),{parseErrorMsg:f}=_t(u),g=()=>r().then(w=>{i(!1)},w=>{typeof w=="string"?V.error(w):V.error(w.message)}).catch(w=>{typeof w=="string"?V.error(w):V.error(w.message)}),b=()=>{i(!1)},j=m.useMemo(()=>a===J.MARKET?!s:!n||!s,[n,s,a]);return t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"outlined",size:"sm",color:"secondary",disabled:j||l,loading:l,onClick:w=>{w.stopPropagation();let v=f("order_quantity"),S=f("order_price");if(v||S){V.error(v??S);return}if(!x){r();return}i(!0)},children:y("positions.column.close")}),t.jsx(jt,{open:e,onOpenChange:i,size:"sm",children:a===J.MARKET?t.jsx(ji,{base:p,quantity:s,onClose:b,onConfirm:g,submitting:l,classNames:{root:"oui-items-start"},hideCloseIcon:!0}):t.jsx(tn,{base:p,quantity:s,price:n,onClose:b,onConfirm:g,submitting:l,quoteDp:c,order:o,hideCloseIcon:!0})})]})},$r=e=>{let{hideCloseIcon:i=!1}=e;return t.jsxs("div",{className:"oui-pb-3 oui-border-b oui-border-line-4 oui-relative oui-w-full",children:[t.jsx(d,{size:"base",children:e.title}),!i&&t.jsx("button",{onClick:e.onClose,className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54 hover:oui-text-base-contrast-80 oui-p-2",children:t.jsx(_r,{size:18,color:"white"})})]})},en=({onCancel:e,onConfirm:i,submitting:r})=>{let{t:n}=N();return t.jsxs(_,{id:"oui-positions-confirm-footer",gap:2,width:"100%",className:"oui-mt-3 oui-pb-1",children:[t.jsx(re,{id:"oui-positions-confirm-footer-cancel-button",color:"secondary",fullWidth:!0,onClick:e,size:"md",children:n("common.cancel")}),t.jsx(nt,{id:"oui-positions-confirm-footer-confirm-button",onClick:i,fullWidth:!0,loading:r,size:"md",children:n("common.confirm")})]})},ga=e=>{let{quantity:i,price:r,quoteDp:n,side:s}=e,{t:o}=N(),a=m.useMemo(()=>r&&i?new O(r).mul(i).toFixed(n,O.ROUND_DOWN):"--",[r,i]);return t.jsxs(_,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:5,children:[t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:o("common.qty")}),t.jsx(d,{color:s===Ce.BUY?"success":"danger",children:i})]}),t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:o("common.price")}),t.jsx(d.formatted,{intensity:98,suffix:t.jsx(d,{intensity:54,children:"USDC"}),children:r})]}),t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:o("common.notional")}),t.jsx(d.formatted,{intensity:98,suffix:t.jsx(d,{intensity:54,children:"USDC"}),children:a})]})]})},ji=e=>{var n;let{t:i}=N(),r=()=>{var s;(s=(e==null?void 0:e.onClose)??e.close)==null||s()};return t.jsxs(_,{direction:"column",className:(n=e.classNames)==null?void 0:n.root,children:[t.jsx($r,{onClose:r,title:i("positions.marketClose"),hideCloseIcon:e.hideCloseIcon}),t.jsx(d,{intensity:54,size:"sm",className:"oui-my-5",children:i("positions.marketClose.description",{quantity:ie(e.quantity),base:e.base})}),t.jsx(en,{onCancel:r,onConfirm:async()=>{var s;await((s=e.onConfirm)==null?void 0:s.call(e)),r()},submitting:e.submitting})]})},tn=e=>{let{order:i,quoteDp:r,quantity:n,price:s,submitting:o}=e,{side:a}=i,{t:l}=N(),c=()=>{var u;(u=e.onClose)==null||u.call(e)};return t.jsxs(t.Fragment,{children:[t.jsx($r,{onClose:c,title:l("positions.limitClose"),hideCloseIcon:e.hideCloseIcon}),t.jsx(ee,{mt:5,children:t.jsx(d,{intensity:54,size:"sm",children:l("positions.limitClose.description",{quantity:jr(e.quantity),base:e.base})})}),t.jsxs(_,{gap:2,mb:4,mt:5,justify:"between",children:[t.jsx(d.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:i.symbol}),t.jsxs(_,{gap:1,children:[t.jsx(Y,{color:"neutral",size:"xs",children:l("orderEntry.orderType.limit")}),t.jsx(Y,{color:a===Ce.BUY?"success":"danger",size:"xs",children:a===Ce.BUY?l("common.buy"):l("common.sell")})]})]}),t.jsx(ke,{className:"oui-w-full"}),t.jsx(ga,{className:"oui-text-sm",price:s,quantity:n,side:i.side,quoteDp:r??2}),t.jsx(en,{onCancel:c,onConfirm:e.onConfirm,submitting:e.submitting})]})},ya=()=>{let{type:e,quoteDp:i,price:r,updatePriceChange:n,updateOrderType:s,position:o}=ze(),[a,l]=m.useState(!1),{t:c}=N();return t.jsxs(cr,{children:[t.jsx(Ne,{size:"sm",value:e===J.LIMIT?r:c("orderEntry.orderType.market"),onValueChange:u=>n(u),formatters:[Z.numberFormatter,...i?[Z.dpFormatter(i)]:[]],onFocus:u=>{e===J.MARKET&&s(J.LIMIT,`${o.mark_price}`),l(!0)},onBlur:u=>{setTimeout(()=>{l(!1)},100)},suffix:t.jsx(ur,{asChild:!0,children:t.jsx("button",{className:"oui-px-1 oui-h-full",children:t.jsx(hr,{size:12,color:"white"})})}),classNames:{root:U("oui-outline-line-12 focus-within:oui-outline-primary-light")}}),t.jsx(dr,{align:"end",className:"oui-w-[96px] oui-min-w-[96px]",onCloseAutoFocus:u=>u.preventDefault(),children:t.jsx($n,{children:t.jsx(es,{size:"xs",onSelect:u=>{s(J.MARKET)},children:t.jsx("span",{children:c("common.marketPrice")})})})})]})},ba=e=>{let[i,r]=m.useState(!1),[n,s]=m.useState(100),{baseDp:o,quoteDp:a,updateQuantity:l,quantity:c,type:u,errors:p,baseTick:h}=ze();m.useEffect(()=>{let f=g=>{g.target.closest("[data-popover-root]")||r(!1)};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}},[]);let x=f=>{y(`${e.value*(f/100)}`)},y=f=>{if(h&&h>0){let g=de.formatNumber(f,h)??f;l(g)}};return t.jsxs(ai,{children:[t.jsx(li,{children:t.jsx(Ne,{size:"sm",onFocus:()=>{r(!0)},classNames:{root:"oui-outline-line-12 "},formatters:[Z.numberFormatter,...o?[Z.dpFormatter(o)]:[]],value:c,onBlur:f=>y(f.target.value),onValueChange:f=>{if(l(f),f=="0"||f==""){s(0);return}let g=new O(f).div(e.value).mul(100).abs().toFixed(0,O.ROUND_DOWN);s(Math.min(100,Number(g)))}})}),t.jsx(ci,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:f=>{f.preventDefault()},children:t.jsxs(_,{p:1,gap:2,width:"100%",itemAlign:"start",children:[t.jsx(d,{size:"xs",intensity:98,className:"oui-min-w-[30px]",children:`${n}%`}),t.jsxs(_,{direction:"column",width:"100%",gap:2,children:[t.jsx(rt,{markCount:4,value:[n],onValueChange:f=>{let g=Array.from(f.values());s(g[0]),x(g[0])}}),t.jsx(ja,{onClick:f=>{s(f*100),x(f*100)}})]})]})})]})},ja=e=>{let{t:i}=N(),r=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:i("common.max"),value:1}];return t.jsx(_,{gap:2,width:"100%",children:r.map((n,s)=>t.jsx(re,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),e.onClick(n.value)},className:"oui-w-1/5",children:n.label},s))})},_a=(e,i)=>{let r=Me();return t.jsx(d.numeral,{dp:r.base_dp,rm:O.ROUND_DOWN,padding:!1,coloring:!0,children:e})},wa=(e,i)=>t.jsx(ba,{value:i.position_qty}),va=e=>t.jsx(ya,{}),Na=e=>{if(e.sharePnLConfig==null)return t.jsx(t.Fragment,{});let{position:i}=e,r=()=>{let n=e.isPositionHistory?{side:i.side,pnl:i.netPnL,openPrice:Math.abs(i.avg_open_price),closePrice:Math.abs(i.avg_close_price),openTime:i.open_timestamp,closeTime:i.close_timestamp,quantity:i.closed_position_qty}:{side:i.position_qty>0?"LONG":"SHORT",pnl:i.unrealized_pnl,roi:new O(i.unrealized_pnl_ROI*100).toFixed(2,O.ROUND_DOWN),openPrice:Math.abs(i.average_open_price),markPrice:i.mark_price,openTime:i.timestamp,quantity:i.position_qty};ye.show(e.modalId,{pnl:{entity:{symbol:i.symbol,...n},refCode:e.refCode,...e.sharePnLConfig,leverage:e.isPositionHistory?void 0:e.leverage}})};return t.jsx("button",{type:"button",onClick:n=>{n.stopPropagation(),r()},children:t.jsx(br,{color:"white",opacity:.54,size:e.iconSize??16})})},Ca=e=>{let{sharePnLConfig:i,position:r,modalId:n,iconSize:s,isPositionHistory:o}=e,{getFirstRefCode:a}=oi(),l=m.useMemo(()=>{var u;return(u=a())==null?void 0:u.code},[a]),c=yr(e.position.symbol);return{iconSize:s,position:r,refCode:l,leverage:c,sharePnLConfig:i,modalId:n,isPositionHistory:o}},Qt=e=>{let i=Ca(e);return t.jsx(Na,{...i})},Pa=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:n}=ze(),{t:s}=N();return t.jsx(bi,{position:e,order:n,label:s("common.tpsl"),baseDP:i,quoteDP:r,isEditing:!1})},Sa=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:n}=ze();return t.jsx(bi,{position:e,order:n,baseDP:i,quoteDP:r,isEditing:!0,children:t.jsx(ts,{opacity:1,className:"oui-text-base-contrast-54 oui-cursor-pointer",size:16})})},Oa=e=>{let{stopLossPrice:i,takeProfitPrice:r}=e,{tpslOrder:n,position:s}=ze();return t.jsx(ka,{stopLossPrice:i,takeProfitPrice:r,direction:"column",order:n,position:s,tooltip:!0})},Vi=e=>{let{qty:i,price:r,entryPrice:n,orderSide:s,orderType:o,symbolInfo:a}=e,l=de.priceToPnl({qty:i,price:r,entryPrice:n,orderSide:s,orderType:o},{symbol:a}),c=o===ge.TAKE_PROFIT?"TP":"SL";return t.jsxs(_,{children:[t.jsx(d,{intensity:54,className:"oui-mr-1",children:`${c} PnL:`}),t.jsx(d.formatted,{rule:"price",className:l===0?"oui-text-base-contrast-36":l>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx(d,{children:l===0?"":l>0?"+":"-"}),suffix:t.jsx(d,{intensity:36,className:"oui-ml-1",children:"USDC"}),children:`${Math.abs(l)}`})]})},ka=e=>{let{direction:i="row",order:r,position:n}=e,s=Ae(),{t:o}=N(),a=m.useMemo(()=>{let p=[];if(!e.tooltip||!r||!n)return;let h=r.quantity;return h===0&&r.child_orders[0].type==="CLOSE_POSITION"&&(h=n.position_qty),e.takeProfitPrice&&p.push(t.jsx(Vi,{qty:h,price:e.takeProfitPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:ge.TAKE_PROFIT,symbolInfo:s[r.symbol]()},"tp")),e.stopLossPrice&&p.push(t.jsx(Vi,{qty:h,price:e.stopLossPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:ge.STOP_LOSS,symbolInfo:s[r.symbol]()},"sl")),t.jsx("div",{children:p})},[e.takeProfitPrice,e.stopLossPrice,n==null?void 0:n.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),l=m.useMemo(()=>{let p=[];return r!=null&&r.symbol?(e.takeProfitPrice&&p.push(t.jsx(d.formatted,{className:U("oui-text-trade-profit oui-gap-0 oui-decoration-white/20"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsx(d,{intensity:54,children:`${o("tpsl.tp")} - `}):""},"tp")),e.stopLossPrice&&p.push(t.jsx(d.formatted,{className:U("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 "),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsx(d,{intensity:54,children:`${o("tpsl.sl")} - `}):""},"sl")),p.length===0?t.jsx(d,{children:"-"}):(p.length===2&&i==="row"&&p.splice(1,0,t.jsx(d,{children:"/"},"split")),p)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol,o]),c=t.jsx("div",{className:U("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l}),u=Array.isArray(l)?!!l.length:!l;return e.tooltip?t.jsxs(_,{gapX:2,children:[t.jsx(Ee,{content:a,children:c}),u&&t.jsx(Sa,{})]}):c},La=e=>{let[i,r]=Oe("unPnlPriceBasis","markPrice"),{t:n}=N();return t.jsxs(_,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-items-start",children:[t.jsx(d,{children:n("positions.column.unrealPnl.tooltip")}),t.jsx(ke,{className:"oui-w-full"}),t.jsx("div",{className:"oui-mb-0",children:n("positions.column.unrealPnl.priceBasis")}),t.jsx(Da,{value:i,onValueChange:r})]})},Da=e=>{let{value:i,onValueChange:r}=e,{t:n}=N();return t.jsxs(_,{gap:2,children:[t.jsx(Qi,{sel:i==="markPrice",label:n("common.markPrice"),value:"markPrice",onCheckChange:r}),t.jsx(Qi,{sel:i==="lastPrice",label:n("common.lastPrice"),value:"lastPrice",onCheckChange:r})]})},Qi=e=>{let{sel:i,label:r,value:n,onCheckChange:s}=e;return t.jsxs(_,{onClick:o=>{s(n),o.stopPropagation()},gap:1,className:"oui-cursor-pointer",children:[i?t.jsx(qa,{}):t.jsx(Ia,{}),t.jsx(d,{size:"xs",intensity:i?98:54,children:r})]})},qa=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),Ia=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Jt=e=>{let{tick:i="quote_dp",...r}=e,n=Me();if(!n)throw new Error("NumeralWithCtx must be used inside SymbolProvider");return t.jsx(d.numeral,{as:"span",...r,dp:n[i]})},Ta=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e,{t:n}=N();return m.useMemo(()=>[{title:n("common.symbol"),dataIndex:"symbol",fixed:"left",width:140,onSort:(s,o)=>s.symbol.localeCompare(o.symbol),render:(s,o)=>t.jsxs(_,{gap:2,children:[t.jsx(ee,{width:4,height:20,className:U("oui-rounded-[1px]",o.position_qty>0?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsx(d.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:a=>{var l;(l=e.onSymbolChange)==null||l.call(e,{symbol:s}),a.stopPropagation(),a.preventDefault()},children:`${s.split("_")[1]}-PERP`})]})},{title:n("common.quantity"),dataIndex:"position_qty",onSort:(s,o)=>s.position_qty-o.position_qty,width:120,className:"oui-pl-6",render:_a},{title:n("common.avgOpen"),className:"oui-h-[48px]",width:120,onSort:!0,dataIndex:"average_open_price",render:(s,o)=>t.jsx(Jt,{rm:O.ROUND_DOWN,children:s})},{title:n("common.markPrice"),dataIndex:"mark_price",width:120,onSort:!0,className:"oui-h-[48px]",render:(s,o)=>t.jsx(Jt,{rm:O.ROUND_DOWN,children:s})},{title:t.jsx(Ee,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:n("positions.column.liqPrice.tooltip"),children:t.jsx(d,{children:n("positions.column.liqPrice")})}),width:100,onSort:!0,dataIndex:"est_liq_price",render:(s,o)=>Number(s)===0?"--":t.jsx(Jt,{rm:O.ROUND_DOWN,className:Number(s)>0?"oui-text-warning-light":"",children:s??"--"})},{title:t.jsx(Zn,{content:t.jsx(La,{}),side:"top",align:"center",className:"oui-max-w-[280px] oui-text-2xs",children:t.jsx(d,{children:n("common.unrealizedPnl")})}),dataIndex:"unrealized_pnl",width:180,onSort:!0,rule:"price",numeralProps:{coloring:!0},render:(s,o)=>t.jsxs(_,{gap:2,children:[t.jsxs(_,{children:[t.jsx(d.numeral,{dp:e.pnlNotionalDecimalPrecision,rm:O.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",children:s}),t.jsx(d.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:O.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",prefix:"(",suffix:")",children:o.unrealized_pnl_ROI})]}),t.jsx(Qt,{position:o,sharePnLConfig:e.sharePnLConfig,modalId:Wt})]})},{title:n("common.tpsl"),dataIndex:"__",width:150,render:(s,o)=>t.jsx(Oa,{stopLossPrice:o.sl_trigger_price,takeProfitPrice:o.tp_trigger_price})},{title:n("common.notional"),dataIndex:"notional",className:"oui-h-[48px]",width:100,onSort:!0,render:s=>t.jsx(d.numeral,{dp:i,children:s})},{title:t.jsx(Ee,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:t.jsxs(_,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-bg-base-8 oui-rounded-sm",children:[t.jsx("span",{children:n("positions.column.margin.tooltip")}),t.jsx(ke,{className:"oui-w-full"}),t.jsx("span",{children:n("positions.column.margin.formula")})]}),children:t.jsx(d,{children:n("positions.column.margin")})}),dataIndex:"mm",onSort:!0,width:100,rule:"price",render:s=>t.jsx(d.numeral,{children:s})},{title:n("common.qty"),dataIndex:"close_qty",width:100,fixed:"right",render:wa},{title:n("common.price"),dataIndex:"close_price",width:100,fixed:"right",render:va},{title:"",dataIndex:"close_position",align:"right",width:160,fixed:"right",render:s=>t.jsxs(_,{gapX:2,justify:"end",children:[t.jsx(xa,{}),t.jsx(Pa,{})]})}],[i,r,n])},Ea=e=>{let{item:i}=e,r=i.position_qty>0,{t:n}=N();return t.jsx(d.formatted,{rule:"symbol",formatString:"base-type",size:"2xs",suffix:t.jsx(Y,{color:r?"success":"danger",size:"xs",children:n(r?"common.buy":"common.sell")}),showIcon:!0,onClick:()=>{var s;(s=e.onSymbolChange)==null||s.call(e,{symbol:i.symbol})},children:i.symbol})},Ma=e=>{let{item:i}=e,{t:r}=N();return t.jsxs(_,{gap:3,children:[t.jsxs(_,{direction:"column",className:"oui-text-2xs",itemAlign:"end",children:[t.jsxs("div",{children:[t.jsx(d,{intensity:36,children:r("common.unrealizedPnl")}),t.jsx(d,{intensity:20,children:"(USDC)"})]}),t.jsx(d.numeral,{size:"xs",dp:e.pnlNotionalDecimalPrecision,rm:O.ROUND_DOWN,coloring:!0,className:"orderly-font-semibold",suffix:t.jsx(d.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:O.ROUND_DOWN,prefix:"(",suffix:")",className:U("oui-ml-1",i.unrealized_pnl_ROI>0?"oui-text-success-darken":"oui-text-danger-darken"),children:i.unrealized_pnl_ROI}),children:i.unrealized_pnl})]}),t.jsx(Qt,{position:i,sharePnLConfig:e.sharePnLConfig,modalId:Bt,iconSize:12})]})},Aa=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:r("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.base_dp,padding:!1,coloring:!0,children:i.position_qty})})},za=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:t.jsxs("span",{children:[r("positions.column.margin"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,intensity:80,children:i.mm})})},Fa=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{align:"end",label:t.jsxs("span",{children:[r("common.notional"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,intensity:80,children:i.notional})})},Ra=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:r("common.avgOpen"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,children:i.average_open_price})})},Ua=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:r("common.markPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,children:i.mark_price})})},Wa=e=>{let{item:i}=e,{t:r}=N(),n=i.est_liq_price&&i.est_liq_price>0?i.est_liq_price:"-";return t.jsx(se,{label:r("positions.column.liqPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,color:"warning",children:n})})},Ba=e=>{let{item:i}=e,{t:r}=N();return i.tp_trigger_price==null&&i.sl_trigger_price==null?t.jsx(t.Fragment,{}):t.jsxs(_,{className:"oui-text-2xs oui-text-base-contrast-36",children:[t.jsxs(d,{children:[`${r("common.tpsl")}:`," "]}),t.jsxs(_,{className:"oui-gap-[2px]",children:[i.tp_trigger_price&&t.jsx(d.numeral,{color:"buy",children:i.tp_trigger_price}),i.sl_trigger_price&&"/",i.sl_trigger_price&&t.jsx(d.numeral,{color:"sell",children:i.sl_trigger_price})]})]})},Va=e=>{var k,D;let{item:i,sheetOpen:r,setSheetOpen:n,dialogOpen:s,setDialogOpen:o,updatePriceChange:a,base:l,quantity:c,price:u,onClose:p,onConfirm:h,submitting:x,quote_dp:y,closeOrderData:f,onCloseDialog:g}=e,b=i.position_qty>0,{t:j}=N(),{parseErrorMsg:w}=_t(e.errors),v=w("order_quantity"),S=w("order_price"),I=P=>{if(e.baseTick&&e.baseTick>0){let C=de.formatNumber(P,e.baseTick)??P;e.updateQuantity(C)}};return t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{a("limit"),n(!0)},children:j("positions.limitClose")}),r&&t.jsx(rs,{title:j("positions.limitClose"),open:r,onOpenChange:n,children:t.jsxs(_,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d.formatted,{rule:"symbol",showIcon:!0,children:i.symbol}),t.jsxs(_,{gap:1,children:[t.jsx(Y,{color:"neutral",size:"xs",children:j("orderEntry.orderType.limit")}),b&&t.jsx(Y,{color:"success",size:"xs",children:j("common.buy")}),!b&&t.jsx(Y,{color:"danger",size:"xs",children:j("common.sell")})]})]}),t.jsx(ke,{className:"oui-w-full"}),t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d,{intensity:54,children:j("common.lastPrice")}),t.jsx(d.numeral,{dp:(D=(k=e.item)==null?void 0:k.symbolInfo)==null?void 0:D.quote_dp,suffix:t.jsx(d,{intensity:36,children:" USDC"}),children:e.curMarkPrice})]}),t.jsxs(_,{width:"100%",direction:"column",gap:2,children:[t.jsx(Ne.tooltip,{prefix:j("common.price"),suffix:e.quote,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Z.numberFormatter,Z.dpFormatter(e.quote_dp)],triggerClassName:"oui-w-full",tooltip:S,color:S?"danger":void 0,value:e.price,onValueChange:P=>e.updatePriceChange(P),classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:U("oui-outline-line-12 oui-w-full",S?"oui-outline-danger":void 0)}}),t.jsx(Ne,{prefix:j("common.quantity"),suffix:e.base,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Z.numberFormatter,Z.dpFormatter(e.base_dp)],value:e.quantity,onBlur:P=>I(P.target.value),onValueChange:P=>{e.updateQuantity(P);let C=new O(P).div(e.item.position_qty).mul(100).toDecimalPlaces(2,O.ROUND_DOWN).toNumber();e.setSliderValue(C)},classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:U("oui-outline-line-12 oui-w-full")}}),t.jsx(rt,{markCount:4,value:[e.sliderValue],color:"primary",onValueChange:P=>{e.setSliderValue(P[0]);let C=new O(P[0]).div(100).mul(e.item.position_qty).toFixed(e.base_dp,O.ROUND_DOWN);I(C)}}),t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d,{color:"primary",size:"2xs",children:`${e.sliderValue}%`}),t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",color:"primary",children:j("common.max")}),t.jsx(d.numeral,{intensity:54,size:"2xs",children:Math.abs(e.item.position_qty)})]})]})]}),t.jsxs(_,{width:"100%",gap:3,mt:2,children:[t.jsx(re,{fullWidth:!0,color:"secondary",onClick:P=>{p()},children:j("common.cancel")}),t.jsx(nt,{fullWidth:!0,disabled:x,loading:x,onClick:P=>{if(P.stopPropagation(),P.preventDefault(),v||S){V.error(v??S);return}if(!e.orderConfirm){h();return}o(!0)},children:j("common.confirm")})]})]})}),s&&t.jsx(jt,{open:s,onOpenChange:o,size:"xs",children:t.jsx(tn,{base:l,quantity:c,price:u,onClose:g,onConfirm:h,submitting:x,quoteDp:y,order:f,hideCloseIcon:!0})})]})},Qa=e=>{let{state:i}=e,[r,n]=m.useState(!1),[s,o]=m.useState(!1),{onSubmit:a,price:l,quantity:c,closeOrderData:u,submitting:p,type:h,updatePriceChange:x,updateOrderType:y,updateQuantity:f,errors:g,baseTick:b}=ze(),j=m.useRef(!1),[w,v]=m.useState(100),[S]=Oe("orderly_order_confirm",!0),I=()=>a().then(z=>{n(!1),o(!1)},z=>{typeof z=="string"?V.error(z):V.error(z.message)}),k=()=>{n(!1)},D=()=>{o(!1)},P=is(),C=m.useMemo(()=>{var z;return((z=P==null?void 0:P.data)==null?void 0:z[i.item.symbol])??"--"},[P]),{quote_dp:L,base_dp:M,base:F,quote:q}=Me();return m.useEffect(()=>{!j.current&&C&&r&&(j.current=!0,y(J.LIMIT,`${C}`))},[j,C,r]),m.useEffect(()=>{r||(y(J.MARKET),j.current=!1)},[r]),{...i,sheetOpen:r,setSheetOpen:n,curMarkPrice:C,quote_dp:L,base_dp:M,base:F,quote:q,baseTick:b,orderConfirm:S,onClose:k,onConfirm:I,price:l,quantity:c,closeOrderData:u,submitting:p,updatePriceChange:x,updateQuantity:f,errors:g,sliderValue:w,setSliderValue:v,dialogOpen:s,setDialogOpen:o,onCloseDialog:D}},Ha=e=>{let i=Qa(e);return t.jsx(Va,{...i})},Ka=e=>{let{t:i}=N();return t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",disabled:e.submitting,loading:e.submitting,onClick:r=>{if(r.stopPropagation(),r.preventDefault(),e.updateOrderType(J.MARKET),!e.orderConfirm){e.onConfirm();return}e.setDialogOpen(!0)},children:i("positions.marketClose")}),t.jsx(jt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,size:"xs",children:t.jsx(ji,{base:e.base,quantity:e.quantity,onClose:e.onClose,onConfirm:e.onConfirm,submitting:e.submitting,hideCloseIcon:!0})})]})},Ga=e=>{let i=Me(),[r,n]=m.useState(!1),{onSubmit:s,price:o,quantity:a,closeOrderData:l,submitting:c,type:u,updatePriceChange:p,updateOrderType:h,updateQuantity:x}=ze(),[y]=Oe("orderly_order_confirm",!0);return{...e,...i,dialogOpen:r,setDialogOpen:n,orderConfirm:y,onSubmit:s,quantity:a,onClose:()=>{n(!1)},onConfirm:()=>s().then(f=>{n(!1)},f=>{typeof f=="string"?V.error(f):V.error(f.message)}),submitting:c,updateOrderType:h,updateQuantity:x}},Ya=e=>{let i=Ga(e);return t.jsx(Ka,{...i})},Xa=e=>{let{t:i}=N();return t.jsx(re,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:r=>{r.stopPropagation(),r.preventDefault(),e.openTP_SL()},children:i("common.tpsl")})},Ja=e=>{let i=Ae()[e.state.item.symbol](),{tpslOrder:r}=ze(),{t:n}=N();return{openTP_SL:()=>{ye.sheet({title:n("common.tpsl"),content:t.jsx(Yr,{position:e.state.item,symbolInfo:i,order:r,isEditing:!1})})},...e,...i}},Za=e=>{let i=Ja(e);return t.jsx(Xa,{...i})},$a=e=>{let{className:i,...r}=e;return t.jsxs(_,{direction:"column",width:"100%",gap:2,p:2,r:"xl",itemAlign:"start",className:U(i,"oui-bg-base-9"),children:[t.jsx(el,{...r}),t.jsx(ke,{intensity:6,className:"oui-w-full"}),t.jsx(tl,{...r}),t.jsx(Ba,{...r}),t.jsx(il,{...r})]})},el=e=>t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(Ea,{...e}),t.jsx(Ma,{...e})]}),tl=e=>t.jsxs(De,{cols:3,rows:2,gap:2,width:"100%",children:[t.jsx(Aa,{...e}),t.jsx(za,{...e}),t.jsx(Fa,{...e}),t.jsx(Ra,{...e}),t.jsx(Ua,{...e}),t.jsx(Wa,{...e})]}),il=e=>t.jsxs(De,{width:"100%",gap:2,cols:3,rows:1,children:[t.jsx(Za,{state:e}),t.jsx(Ha,{state:e}),t.jsx(Ya,{state:e})]}),rl=e=>{let i=Me();return{...e,...i}},nl=e=>{let i=rl(e);return t.jsx($a,{...i,className:e.className})},sl=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r,pagination:n}=e,s=Ta({pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange});return t.jsx(Ft,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:s,bordered:!0,dataSource:e.dataSource,generatedRowKey:o=>o.symbol,renderRowContainer:(o,a,l)=>t.jsx(Vt,{symbol:o.symbol,children:t.jsx(Jr,{position:o,children:l})}),manualPagination:!1,pagination:n,testIds:{body:"oui-testid-dataList-position-tab-body"}})},ol=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e;return t.jsx(At,{className:"oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",contentClassName:"!oui-space-y-1",dataSource:e.dataSource,renderItem:(n,s)=>t.jsx(Vt,{symbol:n.symbol,children:t.jsx(Jr,{position:n,children:t.jsx(nl,{item:n,index:s,pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange})})})})},rn=e=>{let{symbol:i,calcMode:r,includedPendingOrder:n,pnlNotionalDecimalPrecision:s,sharePnLConfig:o,onSymbolChange:a}=e,{pagination:l,setPage:c}=Mt({pageSize:50}),[u,p,{isLoading:h}]=rr(i,{calcMode:r,includedPendingOrder:n});return m.useEffect(()=>{c(1)},[i]),{dataSource:zt(u==null?void 0:u.rows,{fallbackData:[]})??void 0,isLoading:h,pnlNotionalDecimalPrecision:s,sharePnLConfig:o,symbol:i,onSymbolChange:a,pagination:l}},du=e=>{let i=rn(e);return t.jsx(sl,{...i})},mu=e=>{let i=rn(e);return t.jsx(ol,{...i})},al=e=>{let{onSymbolChange:i,pnlNotionalDecimalPrecision:r}=e,{t:n}=N();return m.useMemo(()=>[{title:n("common.symbol"),dataIndex:"symbol",fixed:"left",width:200,onSort:(s,o)=>s.symbol.localeCompare(o.symbol),render:(s,o)=>t.jsx(ll,{record:o,onSymbolChange:i})},{title:n("positions.history.column.closed&maxClosed"),dataIndex:"close_maxClose",width:200,render:(s,o)=>t.jsx(cl,{record:o})},{title:n("positions.history.column.netPnl"),dataIndex:"netPnL",width:140,onSort:(s,o)=>s.netPnL==null||o.netPnL==null?-1:(s.netPnL??0)-(o.netPnL??0),render:(s,o)=>t.jsxs(_,{gapX:1,children:[t.jsx(ul,{record:o,pnlNotionalDecimalPrecision:r}),t.jsx(Qt,{position:o,sharePnLConfig:e.sharePnLConfig,modalId:Wt,isPositionHistory:!0})]})},{title:n("common.avgOpen"),dataIndex:"avg_open",width:140,render:(s,o)=>{let a=o.avg_open_price!=null?Math.abs(o.avg_open_price):"--",{quote_dp:l}=Me();return t.jsx(d.numeral,{dp:l,padding:!1,children:a})}},{title:n("common.avgClose"),dataIndex:"avg_close",width:175,render:(s,o)=>{let a=o.avg_close_price!=null?Math.abs(o.avg_close_price):"--",{quote_dp:l}=Me();return t.jsx(d.numeral,{dp:l,padding:!1,children:a})}},{title:n("positions.history.column.timeOpened"),dataIndex:"open_timestamp",width:175,onSort:!0,render:(s,o)=>t.jsx(d.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.open_timestamp})},{title:n("positions.history.column.timeClosed"),dataIndex:"close_timestamp",width:175,onSort:!0,render:(s,o)=>o.position_status=="closed"&&o.close_timestamp?t.jsx(d.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.close_timestamp??"--"}):"--"},{title:n("positions.history.column.updatedTime"),dataIndex:"last_update_time",width:175,onSort:!0,render:(s,o)=>t.jsx(d.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.last_update_time})}],[r,n])},ll=e=>{let{record:i,onSymbolChange:r}=e,{t:n}=N(),s=m.useMemo(()=>{let o=[],a=i.position_status,l=()=>a==="closed"?n("positions.history.status.closed"):a==="partial_closed"?n("positions.history.status.partialClosed"):gr(a.replace("_"," "));return o.push(t.jsx(Y,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:l()})),i.type==="adl"?o.push(t.jsx(Y,{color:"danger",size:"xs",children:n("positions.history.type.adl")})):i.type==="liquidated"&&o.push(t.jsx(Ee,{className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},content:t.jsxs(_,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[i.liquidation_id!=null&&t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("positions.history.liquidated.liquidationId")}),t.jsx(d,{intensity:98,children:i.liquidation_id})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("positions.history.liquidated.liquidatorFee")}),t.jsxs(d,{color:"lose",children:[i.liquidator_fee>0&&"-",ie(i.liquidator_fee)]})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("positions.history.liquidated.insFundFee")}),t.jsxs(d,{color:"lose",children:[i.insurance_fund_fee>0&&"-",ie(i.insurance_fund_fee)]})]})]}),children:t.jsx("div",{children:t.jsx(Y,{size:"xs",color:"danger",className:"oui-cursor-pointer",children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:n("positions.history.type.liquidated")})})})})),o},[i,n]);return t.jsxs(_,{gap:2,height:48,children:[t.jsx(ee,{width:4,height:38,className:U("oui-rounded-[1px] oui-shrink-0",i.side==="LONG"?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(_,{direction:"column",itemAlign:"start",children:[t.jsx(d.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:o=>{r==null||r({symbol:i.symbol}),o.stopPropagation(),o.preventDefault()},children:`${i.symbol.split("_")[1]}-PERP`}),t.jsx(_,{gap:1,children:s})]})]})},cl=e=>{let{record:i}=e,{base_dp:r}=Me();return t.jsxs(_,{gap:1,direction:"column",itemAlign:"start",className:"oui-overflow-hidden oui-whitespace-nowrap oui-text-ellipsis",children:[t.jsx(d.numeral,{dp:r,padding:!1,children:Math.abs(i.closed_position_qty)}),t.jsx(d.numeral,{dp:r,padding:!1,className:"oui-truncate",children:Math.abs(i.max_position_qty)})]})},ul=e=>{let{record:i,pnlNotionalDecimalPrecision:r}=e,{t:n}=N(),s=i.netPnL!=null?i.netPnL:void 0,o=()=>t.jsx(d.numeral,{dp:r,color:i.netPnL!=null?i.netPnL>0?"profit":"lose":void 0,className:s==null?"":"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:s??"--"});return i.netPnL==null?o():t.jsx(Ee,{delayDuration:200,content:t.jsxs(_,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[t.jsx(d,{intensity:80,children:n("positions.history.column.netPnl")}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("common.realizedPnl")}),t.jsx(d,{color:i.realized_pnl>=0?"profit":"lose",className:"oui-cursor-pointer",children:ie(i.realized_pnl)})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("positions.history.netPnl.fundingFee")}),t.jsx(d,{color:i.accumulated_funding_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:ie(-i.accumulated_funding_fee)})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:n("positions.history.netPnl.tradingFee")}),t.jsx(d,{color:i.trading_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:ie(-i.trading_fee)})]})]}),className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:t.jsx("div",{children:o()})})};function je(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function _e(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var qt=e=>({from:je(e.from),to:_e(e.to??e.from)}),It=(e,i)=>e.getTime()===i.getTime(),nn=e=>{let{onSymbolChange:i,symbol:r,pnlNotionalDecimalPrecision:n}=e,{state:s}=yt(),{data:o,isLoading:a}=nr(r?`/v1/position_history?symbol=${r}&limit=1000`:"/v1/position_history?limit=1000",{formatter(j){var w;return(w=j.rows??null)==null?void 0:w.map(v=>{if(v.realized_pnl!=null&&v.accumulated_funding_fee!=null&&v.trading_fee!=null){let S=v.realized_pnl-v.accumulated_funding_fee-v.trading_fee;return{...v,netPnL:S}}return v})},revalidateOnFocus:!0}),{pagination:l,setPage:c}=Mt({pageSize:10}),{status:u,side:p,dateRange:h,filterDays:x,updateFilterDays:y,filterItems:f,onFilter:g}=dl();m.useEffect(()=>{c(1)},[u,p,h,x,r]);let b=m.useMemo(()=>o==null?o:o.filter(j=>{let w=p==="all"?!0:j.side.toLowerCase()===p.toLowerCase(),v=u==="all"?!0:j.position_status.toLowerCase()===u.toLowerCase(),S=(j==null?void 0:j.last_update_time)??j.open_timestamp,I=h.from&&h.to?S>=h.from.getTime()&&S<=h.to.getTime():!0,k=r?j.symbol==r:!0;return w&&v&&I&&k}),[u,p,h,o,r]);return{dataSource:zt(b,{accountStatus:s.status===tt.EnableTradingWithoutConnected?tt.EnableTradingWithoutConnected:tt.EnableTrading,fallbackData:[]}),isLoading:a,onSymbolChange:i,pagination:l,filterItems:f,onFilter:g,symbol:r,filterDays:x,updateFilterDays:y,pnlNotionalDecimalPrecision:n}},dl=()=>{let{t:e}=N(),[i,r]=m.useState("all"),[n,s]=m.useState("all"),o=qt({to:_e(new Date),from:je(Se(new Date,89))}),[a,l]=m.useState(90),[c,u]=m.useState(o),p=y=>{l(y),u({from:je(Se(new Date,y-1)),to:_e(new Date)})},h=y=>{if(y.name==="side"&&s(y.value),y.name==="status"&&r(y.value),y.name==="dateRange"){let f=qt(y.value);if(u(f),f.from&&f.to){let g=Math.abs(Cr(f.from,f.to))+1,b={1:{from:je(new Date),to:_e(new Date)},7:{from:je(Se(new Date,6)),to:_e(new Date)},30:{from:je(Se(new Date,29)),to:_e(new Date)},90:{from:je(Se(new Date,89)),to:_e(new Date)}}[g];b&&It(b.from,f.from)&&It(b.to,f.to)?l(g):l(null)}}},{isMobile:x}=xr();return{filterItems:m.useMemo(()=>{let y={type:"select",name:"side",options:[{label:e("common.side.all"),value:"all"},{label:e("common.buy"),value:"LONG"},{label:e("common.sell"),value:"SHORT"}],value:n},f={type:"range",name:"dateRange",value:c,fromDate:je(Se(new Date,89)),toDate:_e(new Date)},g={type:"select",name:"status",options:[{label:e("common.status.all"),value:"all"},{label:e("positions.history.status.closed"),value:"closed"},{label:e("positions.history.status.partialClosed"),value:"partial_closed"}],value:i};return x?[y,g]:[y,g,f]},[n,i,c]),onFilter:h,side:n,dateRange:c,status:i,filterDays:a,updateFilterDays:p}},ml=e=>{let{side:i,symbol:r}=e.item,{t:n}=N(),s=i==="LONG";return t.jsx(d.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(Y,{color:s?"success":"danger",size:"xs",children:n(s?"common.buy":"common.sell")}),onClick:()=>{var o;(o=e.onSymbolChange)==null||o.call(e,{symbol:r})},children:r})},pl=e=>{let{item:i}=e,{t:r}=N(),n=()=>{ye.alert({title:r("positions.liquidation"),message:t.jsxs(_,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[i.liquidation_id!=null&&t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(d,{children:r("positions.history.liquidated.liquidationId")}),t.jsx(d,{intensity:98,children:i.liquidation_id})]}),t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(d,{children:r("positions.history.liquidated.liquidatorFee")}),t.jsxs(d,{color:"lose",children:[i.liquidator_fee>0&&"-",ie(i.liquidator_fee)]})]}),t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(d,{children:r("positions.history.liquidated.insFundFee")}),t.jsxs(d,{color:"lose",children:[i.insurance_fund_fee>0&&"-",ie(i.insurance_fund_fee)]})]})]})})},s=m.useMemo(()=>{let o=[],a=i.position_status,l=()=>a==="closed"?r("positions.history.status.closed"):a==="partial_closed"?r("positions.history.status.partialClosed"):gr(a.replace("_"," "));return o.push(t.jsx(Y,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",children:l()})),i.type==="adl"?o.push(t.jsx(Y,{color:"danger",size:"xs",children:r("positions.history.type.adl")})):i.type==="liquidated"&&o.push(t.jsx(Y,{size:"xs",color:"danger",className:"oui-cursor-pointer",onClick:n,children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:r("positions.history.type.liquidated")})})),o},[i]);return t.jsx(_,{gap:1,children:s})},fl=e=>{let{item:i}=e,{t:r}=N(),n=i.closed_position_qty!=null?Math.abs(i.closed_position_qty):"--";return t.jsx(se,{label:t.jsx(d,{children:r("positions.history.column.closed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:n})})},hl=e=>{let{item:i}=e,{t:r}=N(),n=i.max_position_qty!=null?Math.abs(i.max_position_qty):"--";return t.jsx(se,{label:t.jsx(d,{children:r("positions.history.column.maxClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:n})})},xl=e=>{let{item:i}=e,r=i.avg_open_price!=null?Math.abs(i.avg_open_price):"--",{t:n}=N();return t.jsx(se,{label:t.jsxs(_,{gap:1,children:[n("common.avgOpen"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:r})})},gl=e=>{let{item:i}=e,r=i.avg_close_price!=null?Math.abs(i.avg_close_price):"--",{t:n}=N();return t.jsx(se,{label:t.jsxs(_,{gap:1,children:[n("common.avgClose"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:r})})},yl=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:t.jsx(d,{children:r("positions.history.column.timeOpened")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsx(d.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.open_timestamp})})},bl=e=>{let{item:i}=e,{t:r}=N(),n=i.position_status=="closed"&&i.close_timestamp?t.jsx(d.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.close_timestamp}):"--";return t.jsx(se,{label:t.jsx(d,{children:r("positions.history.column.timeClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:n})},jl=e=>{var i;return t.jsxs(_,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(_l,{...e}),t.jsx(ke,{intensity:6,className:"oui-w-full"}),t.jsx(wl,{...e})]})},_l=e=>{let{t:i}=N(),r=()=>{let{item:n}=e;ye.alert({title:i("positions.history.column.netPnl"),message:t.jsxs(_,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:i("common.realizedPnl")}),t.jsx(d,{color:n.realized_pnl>=0?"profit":"lose",children:ie(n.realized_pnl)})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:i("positions.history.netPnl.fundingFee")}),t.jsx(d,{color:n.accumulated_funding_fee>0?"lose":"profit",children:ie(-n.accumulated_funding_fee)})]}),t.jsxs(_,{justify:"between",width:"100%",gap:2,children:[t.jsx(d,{intensity:54,children:i("positions.history.netPnl.tradingFee")}),t.jsx(d,{color:n.trading_fee>0?"lose":"profit",children:ie(-n.trading_fee)})]})]})})};return t.jsxs(_,{gap:1,width:"100%",children:[t.jsxs(_,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(ml,{...e}),t.jsx(pl,{...e})]}),t.jsxs(_,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(d,{size:"2xs",intensity:36,children:i("positions.history.column.netPnl")}),t.jsxs(_,{gapX:1,children:[t.jsx("button",{onClick:r,children:t.jsx(d.numeral,{size:"xs",coloring:!0,children:e.item.netPnL??"--"})}),t.jsx(Qt,{position:e.item,sharePnLConfig:e.sharePnLConfig,modalId:Bt,iconSize:12,isPositionHistory:!0})]})]})]})},wl=e=>t.jsxs(De,{cols:3,rows:2,width:"100%",gap:0,className:"oui-grid-cols-[1fr,1fr,135px]",children:[t.jsx(fl,{...e}),t.jsx(hl,{...e}),t.jsx(yl,{...e}),t.jsx(xl,{...e}),t.jsx(gl,{...e}),t.jsx(bl,{...e})]}),vl=e=>{let i=Me();return{...e,...i}},Nl=e=>{let i=vl(e);return t.jsx(jl,{...i})},Cl=e=>{let{onSymbolChange:i,pagination:r,pnlNotionalDecimalPrecision:n}=e,s=al({onSymbolChange:i,pnlNotionalDecimalPrecision:n,sharePnLConfig:e.sharePnLConfig}),{t:o}=N(),a=m.useMemo(()=>({1:o("common.select.1d"),7:o("common.select.7d"),30:o("common.select.30d"),90:o("common.select.90d")}),[o]);return t.jsxs(_,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(_,{gap:3,children:[e.filterItems.length>0&&t.jsx(bt,{items:e.filterItems,onFilter:l=>{e.onFilter(l)}}),[1,7,30,90].map(l=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(d.gradient,{color:e.filterDays===l?"brand":void 0,className:U("oui-break-normal oui-whitespace-nowrap",e.filterDays!==l?"oui-text-base-contrast-54":""),children:a[l]||`${l}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(l)}})]}))]}),t.jsx(Ft,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:s,bordered:!0,dataSource:e.dataSource,generatedRowKey:l=>`${l.symbol}_${l.position_id}`,renderRowContainer:(l,c,u)=>t.jsx(Vt,{symbol:l.symbol,children:u}),manualPagination:!1,pagination:r,testIds:{body:"oui-testid-dataList-positionHistory-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},Pl=e=>{var i,r;return t.jsxs(De,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(_,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(bt,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:n=>{e.onFilter(n)}})}),t.jsx(At,{className:U("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:U("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,renderItem:(n,s)=>{var o;return t.jsx(Vt,{symbol:n.symbol,children:t.jsx(Nl,{item:n,index:s,onSymbolChange:e.onSymbolChange,classNames:{root:(o=e.classNames)==null?void 0:o.cell},sharePnLConfig:e.sharePnLConfig})})}})]})},pu=e=>{let i=nn(e);return t.jsx(Cl,{...i,sharePnLConfig:e.sharePnLConfig})},fu=e=>{let{classNames:i,...r}=e,n=nn(r);return t.jsx(Pl,{...n,classNames:i,sharePnLConfig:e.sharePnLConfig})},Sl=e=>{let{t:i}=N();return m.useMemo(()=>[{title:i("common.time"),dataIndex:"timestamp",fixed:"left",width:202,render:r=>t.jsx(d.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:r})},{title:i("positions.Liquidation.column.liquidationId"),dataIndex:"liquidation_id",width:202,render:r=>t.jsx(d,{children:r})},{title:i("positions.Liquidation.column.insFundTransfer"),dataIndex:"transfer_amount_to_insurance_fund",width:202,render:r=>t.jsx(d,{children:ie(r)})},{title:i("common.symbol"),dataIndex:"Symbol",width:202,render:(r,n)=>{var s;return t.jsx(_,{direction:"column",itemAlign:"start",children:(s=n.positions_by_perp)==null?void 0:s.map(o=>t.jsx(d.formatted,{rule:"symbol",formatString:"base-quote",children:o.symbol}))})}},{title:`${i("common.price")} (USDC)`,dataIndex:"Price_(USDC)",width:202,render:(r,n)=>{var s;return t.jsx(_,{direction:"column",itemAlign:"start",children:(s=n.positions_by_perp)==null?void 0:s.map(o=>t.jsx(Zt,{value:o.transfer_price,type:"quote"}))})}},{title:i("common.quantity"),dataIndex:"Quantity",width:202,render:(r,n)=>{var s;return t.jsx(_,{direction:"column",itemAlign:"start",children:(s=n.positions_by_perp)==null?void 0:s.map(o=>t.jsx(Zt,{value:o.position_qty,type:"base"}))})}},{title:i("positions.Liquidation.column.liquidationFee"),dataIndex:"abs_liquidation_fee",width:202,render:(r,n)=>{var s;return t.jsx(_,{direction:"column",itemAlign:"start",children:(s=n.positions_by_perp)==null?void 0:s.map(o=>t.jsx(Zt,{value:o.abs_liquidation_fee,type:"quote"}))})}}],[i])},Zt=e=>t.jsx(d,{children:ie(e.value)}),Ol=e=>{let{t:i}=N();return t.jsxs(_,{width:"100%",justify:"between",children:[t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",intensity:36,children:i("common.price")}),t.jsx(d,{size:"2xs",intensity:20,children:"(USDC)"})]}),t.jsx(d,{size:"2xs",intensity:80,children:ie(e.transfer_price)})]})},kl=e=>{let{t:i}=N();return t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d,{size:"2xs",intensity:36,children:i("common.quantity")}),t.jsx(d,{size:"2xs",intensity:80,children:ie(e.position_qty)})]})},Ll=e=>{let{t:i}=N();return t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d,{size:"2xs",intensity:36,children:i("positions.Liquidation.column.liquidationFee")}),t.jsx(d,{size:"2xs",intensity:80,children:ie(e.abs_liquidation_fee)})]})},Dl=e=>{var i;return t.jsxs(_,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(ql,{...e}),t.jsx(Il,{...e})]},e.item.timestamp)},ql=e=>{let{t:i}=N();return t.jsxs(_,{gap:1,width:"100%",children:[t.jsxs(_,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(d.formatted,{size:"2xs",intensity:36,rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:e.item.timestamp}),t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",intensity:36,children:`${i("positions.Liquidation.column.liquidationId")}:`}),t.jsx(d,{size:"2xs",intensity:80,children:` ${e.item.liquidation_id}`})]})]}),t.jsxs(_,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(d,{size:"2xs",intensity:36,children:`${i("positions.Liquidation.column.insFundTransfer")}:`}),t.jsx(d,{intensity:80,size:"xs",children:ie(e.item.transfer_amount_to_insurance_fund)})]})]})},Il=e=>{var i;return t.jsx(_,{direction:"column",width:"100%",children:(i=e.item.positions_by_perp)==null?void 0:i.map((r,n)=>t.jsx(Tl,{isLast:n===e.item.positions_by_perp.length-1,...r},`${n}-${r.symbol}`))})},Tl=e=>t.jsxs(_,{width:"100%",itemAlign:"start",className:U("oui-border-t-[1px] oui-border-line-6 oui-pt-2",!e.isLast&&"oui-pb-2"),children:[t.jsx(d.formatted,{rule:"symbol",formatString:"base-quote",size:"xs",intensity:80,className:"oui-flex-1",children:e.symbol}),t.jsxs(De,{cols:1,rows:3,width:"100%",gap:1,className:"oui-flex-1",children:[t.jsx(Ol,{...e}),t.jsx(kl,{...e}),t.jsx(Ll,{...e})]})]},e.key),El=e=>({...e}),Ml=e=>{let{classNames:i,...r}=e,n=El(r);return t.jsx(Dl,{classNames:i,...n})},Al=e=>{let i=Sl();return t.jsxs(_,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(_,{gap:3,children:[e.filterItems.length>0&&t.jsx(bt,{items:e.filterItems,onFilter:r=>{e.onFilter(r)}}),[1,7,30,90].map(r=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(d.gradient,{color:e.filterDays===r?"brand":void 0,className:e.filterDays!==r?"oui-text-base-contrast-54":"",children:`${r}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(r)}})]}))]}),t.jsx(Ft,{loading:e.isLoading,id:"oui-desktop-liquidation-content",columns:i,bordered:!0,dataSource:e.dataSource,generatedRowKey:r=>`${r.liquidation_id}`,pagination:e.pagination,testIds:{body:"oui-testid-dataList-liquidation-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},zl=e=>{var i,r;return t.jsxs(De,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(_,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(bt,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:n=>{e.onFilter(n)}})}),t.jsx(At,{className:U("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:U("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,loadMore:e.loadMore,renderItem:(n,s)=>{var o;return t.jsx(Ml,{item:n,index:s,classNames:{root:(o=e.classNames)==null?void 0:o.cell}})}})]})},sn=e=>{let{symbol:i,enableLoadMore:r}=e,{page:n,pageSize:s,setPage:o,parsePagination:a}=Mt({pageSize:10}),{dateRange:l,filterDays:c,updateFilterDays:u,filterItems:p,onFilter:h}=Rl();m.useEffect(()=>{o(1)},[i,l,c]);let[x,{meta:y,isLoading:f,loadMore:g}]=Fl({page:r?void 0:n,size:s,symbol:i,start_t:l.from!=null?l.from.getTime():void 0,end_t:l.to!=null?l.to.getTime():void 0});return{dataSource:zt(x,{fallbackData:[]}),isLoading:f,loadMore:g,pagination:a(y),dateRange:l,filterDays:c,updateFilterDays:u,filterItems:p,onFilter:h}},Fl=e=>{var o;let i=Xn(Ul(e),{initialSize:1,formatter:a=>a,revalidateOnFocus:!0}),r=m.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a[0])==null?void 0:l.meta},[(o=i.data)==null?void 0:o[0]]),n=m.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a.map(c=>c.rows))==null?void 0:l.flat()},[i.data]),s=i.isLoading;return[n,{meta:r,isLoading:s,loadMore:()=>{i.setSize(i.size+1)}}]},Rl=()=>{let e=qt({to:_e(new Date),from:je(Se(new Date,89))}),[i,r]=m.useState(90),[n,s]=m.useState(e),o=c=>{r(c),s({from:je(Se(new Date,c-1)),to:_e(new Date)})},a=c=>{if(c.name==="dateRange"){let u=qt(c.value);if(s(u),u.from&&u.to){let p=Math.abs(Cr(u.from,u.to))+1,h={1:{from:je(new Date),to:_e(new Date)},7:{from:je(Se(new Date,6)),to:_e(new Date)},30:{from:je(Se(new Date,29)),to:_e(new Date)},90:{from:je(Se(new Date,89)),to:_e(new Date)}}[p];h&&It(h.from,u.from)&&It(h.to,u.to)?r(p):r(null)}}},{isMobile:l}=xr();return{filterItems:m.useMemo(()=>{let c={type:"range",name:"dateRange",value:n,fromDate:je(Se(new Date,89)),toDate:_e(new Date)};return l?[c]:[c]},[n]),onFilter:a,dateRange:n,filterDays:i,updateFilterDays:o}},Ul=e=>(i,r)=>{var u;if(r&&!((u=r.rows)!=null&&u.length))return null;let{symbol:n,size:s=10,page:o,end_t:a,start_t:l}=e,c=new URLSearchParams([["size",s.toString()],["page",`${i+1}`]]);return o&&c.set("page",`${o}`),n&&c.set("symbol",n),a&&c.set("end_t",`${a}`),l&&c.set("start_t",`${l}`),`/v1/liquidations?${c.toString()}`},hu=e=>{let i=sn(e);return t.jsx(Al,{...i})},xu=e=>{let{classNames:i,...r}=e,n=sn(r);return t.jsx(zl,{classNames:i,...n})},Wl="MarketCloseConfirmID";Tt(Wl,ji,{size:"md",closable:!1});var Bl=e=>{let{current:i,pnlNotionalDecimalPrecision:r,sharePnLConfig:n}=e,s=m.useRef(null);return m.useImperativeHandle(e.ref,()=>({download:()=>{var o,a;(a=(o=s.current)==null?void 0:o.download)==null||a.call(o)}})),{current:i,pnlNotionalDecimalPrecision:r,orderListRef:s,sharePnLConfig:n}},xt=e=>e===void 0||e.length===0?e:e.length===1?e.charAt(0).toUpperCase():e.charAt(0).toUpperCase()+e.toLowerCase().slice(1);function gt(e){var n,s;let i=e.type,r=e.algo_type;if(typeof i<"u"){let o=[];if(e.parent_algo_type){if(r===ge.STOP_LOSS){let l=i===J.CLOSE_POSITION?[E.t("common.position"),E.t("tpsl.sl")]:[E.t("tpsl.sl")];o.push(...l)}if(r===ge.TAKE_PROFIT){let l=i===J.CLOSE_POSITION?[E.t("common.position"),E.t("tpsl.tp")]:[E.t("tpsl.tp")];o.push(...l)}return o}let a=typeof i=="string"?i.replace("_ORDER",""):"";if([J.ASK,J.BID].includes(i))return[E.t("orderEntry.orderType.limit")];if(e.algo_order_id===void 0||e.algo_order_id&&r==="BRACKET")return[{[J.LIMIT]:E.t("orderEntry.orderType.limit"),[J.MARKET]:E.t("orderEntry.orderType.market"),[J.POST_ONLY]:E.t("orderEntry.orderType.postOnly"),[J.IOC]:E.t("orderEntry.orderType.ioc"),[J.FOK]:E.t("orderEntry.orderType.fok")}[a]||xt(a)];if(a)return[{[J.LIMIT]:E.t("orderEntry.orderType.stopLimit"),[J.MARKET]:E.t("orderEntry.orderType.stopMarket")}[a]||a]}if(typeof r<"u"){let o=[];r===K.POSITIONAL_TP_SL&&o.push(E.t("common.position"));let a=(n=e==null?void 0:e.child_orders)==null?void 0:n.find(c=>c.algo_type===ge.TAKE_PROFIT&&!!c.trigger_price),l=(s=e==null?void 0:e.child_orders)==null?void 0:s.find(c=>c.algo_type===ge.STOP_LOSS&&!!c.trigger_price);return(a||l)&&o.push(a&&l?E.t("common.tpsl"):a?E.t("tpsl.tp"):E.t("tpsl.sl")),o}}function vt(e){return e.status===Q.CANCELLED||e.algo_status===Q.CANCELLED}function Vl(e){var s,o,a;if(e.algo_type!==K.BRACKET)return{tpOrder:void 0,slOrder:void 0};let i=(s=e.child_orders)==null?void 0:s[0];if(!i)return{tpOrder:void 0,slOrder:void 0};let r=(o=i==null?void 0:i.child_orders)==null?void 0:o.find(l=>l.algo_type===ge.TAKE_PROFIT),n=(a=i==null?void 0:i.child_orders)==null?void 0:a.find(l=>l.algo_type===ge.STOP_LOSS);return{tpOrder:r,slOrder:n}}function on(e){let i={pnl:{tpPnL:void 0,slPnL:void 0},roi:{tpRoi:void 0,slRoi:void 0}},{tpOrder:r,slOrder:n}=Vl(e);if(!r&&!n||typeof e.price===void 0||!e.price)return i;let s=e.side===Ce.BUY?e.quantity:e.quantity*-1,o=(r==null?void 0:r.trigger_price)&&de.priceToPnl({qty:s,price:r==null?void 0:r.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:r.algo_type}),a=(n==null?void 0:n.trigger_price)&&de.priceToPnl({qty:s,price:n==null?void 0:n.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:n.algo_type}),l=o?de.calcTPSL_ROI({pnl:o,qty:e.quantity,price:e.price}):void 0,c=a?de.calcTPSL_ROI({pnl:a,qty:e.quantity,price:e.price}):void 0;return{pnl:{tpPnL:o,slPnL:a},roi:{tpRoi:l,slRoi:c}}}var an=m.createContext({}),Ue=()=>m.useContext(an),ln=e=>{let i=Ae()[e.symbol];return t.jsx(an.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},cn=m.createContext({}),at=()=>m.useContext(cn),un=e=>{let{cancelOrder:i,editOrder:r,cancelAlgoOrder:n,editAlgoOrder:s}=e,{t:o}=N(),a=Ae(),l=m.useCallback(async p=>p.algo_order_id!==void 0?"root_algo_order_id"in p&&p.root_algo_order_id!==p.algo_order_id?n(p.root_algo_order_id,p.symbol):n(p.algo_order_id,p.symbol).then(()=>{}):i(p.order_id,p.symbol).then(()=>{}),[]),c=m.useCallback(async(p,h)=>{p.visible_quantity!==void 0?p.visible_quantity:p.visible!==void 0&&p.visible,await ye.sheet({title:o("orders.editOrder"),classNames:{content:"oui-edit-order-sheet-content"},content:t.jsx(t.Fragment,{children:"Content"})})},[o]),u=m.useCallback((p,h,x)=>{let{min_notional:y}=a[p](),f=as({price:h,qty:x,min_notional:y});if(f!==void 0)return o("orderEntry.total.error.min",{value:f})},[a,o]);return t.jsx(cn.Provider,{value:{onCancelOrder:l,onEditOrder:c,editOrder:r,editAlgoOrder:s,checkMinNotional:u},children:e.children})},dn=m.createContext({}),Ke=()=>m.useContext(dn),mn=e=>{let{quote_dp:i}=Ue(),[r,n]=m.useState(),[s]=ii("/v1/algo/order","DELETE"),[o]=ii("/v1/algo/order","PUT"),a=ls(),{state:l}=yt(),c=m.useMemo(()=>cs(()=>["/v1/positions",l.accountId]),[l.accountId]),u=async b=>s(null,{order_id:b.algo_order_id,symbol:b.symbol}),p=async(b,j)=>o({order_id:b.algo_order_id,child_orders:b.child_orders.map(w=>({order_id:w.algo_order_id,quantity:j.order_quantity}))}),h=b=>{var j;return(j=a.cache.get(c))==null?void 0:j.data.rows.find(w=>w.symbol===b)},{sl_trigger_price:x,tp_trigger_price:y,tpPnL:f,slPnL:g}=Ql({order:e.order,position:r,quote_dp:i});return m.useEffect(()=>{var b;if("algo_type"in e.order||(((b=e.order)==null?void 0:b.reduce_only)??!1)){let j=h(e.order.symbol);j&&n(j)}},[e.order.symbol]),t.jsx(dn.Provider,{value:{order:e.order,sl_trigger_price:x,tp_trigger_price:y,tpPnL:f,slPnL:g,onCancelOrder:u,onUpdateOrder:p,getRelatedPosition:h,position:r},children:e.children})};function Ql(e){var p;let{order:i,position:r,quote_dp:n}=e;if(!r)return{sl_trigger_price:void 0,tp_trigger_price:void 0,slPnL:void 0,tpPnL:void 0};let{sl_trigger_price:s,tp_trigger_price:o}=!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:de.findTPSLFromOrder(i),a=i.quantity;a===0&&((p=i.child_orders)==null?void 0:p[0].type)==="CLOSE_POSITION"&&(a=r.position_qty);let l=r.average_open_price,c=typeof a=="number"&&typeof o=="number"&&typeof l=="number"?de.priceToPnl({qty:a,price:o,entryPrice:r.average_open_price,orderSide:i.side,orderType:ge.TAKE_PROFIT},{symbol:{quote_dp:n}}):void 0,u=typeof a=="number"&&typeof s=="number"&&typeof l=="number"?de.priceToPnl({qty:a,price:s,entryPrice:r.average_open_price,orderSide:i.side,orderType:ge.STOP_LOSS},{symbol:{quote_dp:n}}):void 0;return{sl_trigger_price:s,tp_trigger_price:o,slPnL:u,tpPnL:c}}var _i=e=>{let{type:i,base:r,value:n,cancelPopover:s,isSubmitting:o,onConfirm:a}=e,{t:l}=N();return t.jsxs("div",{className:"oui-pt-5 oui-relative",children:[t.jsx("div",{className:"oui-text-base-contrast-54 oui-text-2xs desktop:oui-text-sm",children:(()=>{let c={values:{base:r,value:jr(n)},components:[t.jsx("span",{className:"oui-text-warning-darken"})]};switch(i){case 0:return t.jsx(Ot,{i18nKey:"order.edit.confirm.quantity",...c});case 1:return t.jsx(Ot,{i18nKey:"order.edit.confirm.price",...c});case 2:return t.jsx(Ot,{i18nKey:"order.edit.confirm.triggerPrice",...c})}})()}),t.jsxs("div",{className:"oui-grid oui-grid-cols-2 oui-gap-2 oui-mt-5",children:[t.jsx(re,{color:"secondary",size:"md",onClick:s,disabled:o,children:l("common.cancel")}),t.jsx(nt,{size:"md",loading:o,onClick:a,children:l("common.confirm")})]}),t.jsx("button",{className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54",onClick:s,children:t.jsx(_r,{size:16,color:"white",opacity:1})})]})},wi=e=>{let{inputRef:i,dp:r,value:n,setValue:s,setEditing:o,error:a,handleKeyDown:l,onClick:c,onClose:u,onFocus:p,onBlur:h,hintInfo:x}=e;m.useEffect(()=>{let f=i.current;if(f){let g=f.value.length;f.setSelectionRange(g,g)}o(!0)},[]);let y=((x==null?void 0:x.length)||0)>0;return t.jsx(Ee,{content:x,open:y,children:t.jsx(Ne,{ref:i,type:"text",size:"sm",formatters:[Z.numberFormatter,Z.dpFormatter(r),Z.currencyFormatter],value:n,onValueChange:f=>s(f),helpText:a,onClick:f=>{f.stopPropagation(),f.preventDefault()},autoComplete:"off",onFocus:p,onBlur:h,onKeyDown:l,autoFocus:!0,color:y?"danger":void 0,classNames:{root:"oui-bg-base-700 oui-px-2 oui-py-1 oui-rounded",input:"oui-pr-2"},suffix:t.jsx("button",{onClick:c,children:t.jsx(ds,{size:18,color:"white",opacity:1,className:"oui-cursor-pointer oui-opacity-50 hover:oui-opacity-100"})})})})},pn=e=>{let{order:i,otherOrderQuantity:r}=e,{reduce_only:n}=i,[s,o]=m.useState(i.quantity.toString()),[a,l]=m.useState(!1),{t:c}=N();m.useEffect(()=>{I(i.quantity.toString())},[e.order.quantity]);let[u,p]=m.useState(!1),[h,x]=m.useState(),{editOrder:y,editAlgoOrder:f,checkMinNotional:g}=at(),{onUpdateOrder:b,position:j}=Ke(),{base_dp:w,base:v,base_tick:S}=Ue(),I=async(T,te)=>{o(T);let G=Math.abs((j==null?void 0:j.position_qty)||0);if(j&&n&&Number(T)>G)x(c("orders.quantity.lessThanPosition",{quantity:G}));else{let me=Number(T);te&&me>te?x(c("orders.quantity.lessThan",{quantity:ie(te,{fix:w})})):x(void 0)}return Promise.resolve()},k=()=>{p(!1),l(!1)},D=()=>{p(!1),I(i.quantity.toString()),l(!1)},[P,C]=m.useState(!1),L=m.useRef(null),M=()=>{if(h)return;if(Number(s)===Number(i.quantity)){l(!1);return}let T=i.algo_order_id!==void 0?i.trigger_price:i.price;if(T!==null&&i.reduce_only!==!0){let te=g(i.symbol,T,s);if(te){V.error(te),C(!1),D();return}}p(!0)},F=T=>{T==null||T.stopPropagation(),T==null||T.preventDefault(),M()},q=T=>{T.key==="Enter"&&(T==null||T.stopPropagation(),T==null||T.preventDefault(),M())},z=m.useCallback(()=>{C(!0);let T={symbol:i.symbol,order_type:i.type,side:i.side,order_price:i.price,order_quantity:s,algo_order_id:i.algo_order_id};if(typeof T.algo_order_id<"u"&&T.order_type==="MARKET"){let{order_price:G,...me}=T;T=me}typeof i.reduce_only<"u"&&(T.reduce_only=i.reduce_only),i.order_tag!==void 0&&(T={...T,order_tag:i.order_tag}),(i==null?void 0:i.visible_quantity)===0&&(T.visible_quantity=0),(i==null?void 0:i.tag)!==void 0&&(T.order_tag=i.tag);let te;"algo_type"in i&&i.algo_type===K.TP_SL?te=b(i,T):i.algo_order_id!==void 0?te=f(i.algo_order_id.toString(),T):te=y(i.order_id.toString(),T),te.then(G=>{k(),I(s.toString())},G=>{V.error(G.message),I(i.quantity.toString()),D()}).finally(()=>C(!1))},[s]),W=m.useRef(null),H=m.useRef(null),ne=T=>{W.current&&H.current&&!W.current.contains(T.target)&&!H.current.contains(T.target)&&!u&&D()};m.useEffect(()=>(document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}),[u,i.quantity]);let B=()=>!a||e.disableEdit?t.jsx(Hl,{order:i,quantity:s,setEditing:l,disableEdit:e.disableEdit}):t.jsx(Kl,{inputRef:L,quantitySliderRef:H,base_dp:w,base_tick:S,quantity:s,setQuantity:I,editing:a,setEditing:l,handleKeyDown:q,onClick:F,onClose:D,symbol:i.symbol,reduce_only:n,positionQty:j==null?void 0:j.position_qty,error:h,confirmOpen:u,side:i.side,order:i,setError:x});return t.jsx(di,{open:u,onOpenChange:p,content:t.jsx(_i,{type:0,base:v,value:s,cancelPopover:D,isSubmitting:P,onConfirm:z}),contentProps:{onOpenAutoFocus:T=>{}},children:t.jsx("div",{onClick:T=>{T.stopPropagation(),T.preventDefault()},ref:W,children:B()})})},Hl=e=>{let{order:i,quantity:r}=e,n=i.total_executed_quantity;return t.jsxs(_,{direction:"row",justify:"start",gap:1,className:U("oui-max-w-[110px] oui-relative",i.side===Ce.BUY&&"oui-text-trade-profit",i.side===Ce.SELL&&"oui-text-trade-loss",vt(i)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:["algo_type"in i&&i.algo_type===K.TP_SL?null:t.jsxs(t.Fragment,{children:[t.jsx("span",{children:n}),t.jsx("span",{children:"/"})]}),t.jsx(_,{r:"base",className:U("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(d,{size:"2xs",children:r})})]})},Kl=e=>{let{inputRef:i,quantitySliderRef:r,base_dp:n,base_tick:s,quantity:o,setQuantity:a,editing:l,setEditing:c,handleKeyDown:u,onClick:p,onClose:h,error:x,symbol:y,reduce_only:f,positionQty:g,confirmOpen:b,side:j,order:w}=e,v=vr(y,w.side,w.reduce_only),S=m.useMemo(()=>f?Math.abs(g??0):w.quantity+Math.abs(v),[w.quantity,v,f,g]),[I,k]=m.useState(void 0);m.useEffect(()=>{if(I===void 0){let P=new O(o).div(S).abs().mul(100).toNumber();k(P)}},[I,S,o]);let D=async P=>(s>0&&(P=de.formatNumber(P,s)??P),a(`${P}`,S));return t.jsxs(ai,{open:!b,children:[t.jsx(li,{children:t.jsx(wi,{inputRef:i,dp:n,value:o,setValue:P=>{let C=Math.abs(Math.min(Number(P),S)).toString();if(a(P,S),P.endsWith("."))return;if(Number(C)===0){k(0);return}let L=new O(P).div(S).mul(100).toDecimalPlaces(2,O.ROUND_DOWN).toNumber();k(Math.min(100,L))},setEditing:c,handleKeyDown:u,onClick:p,onClose:h,onBlur:P=>{D(P.target.value)},hintInfo:x})}),t.jsx(ci,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:P=>{P.preventDefault()},children:t.jsxs(_,{p:1,gap:2,width:"100%",itemAlign:"start",ref:r,children:[t.jsx(d.numeral,{size:"xs",intensity:98,className:"oui-min-w-[30px] ",dp:2,padding:!1,unit:"%",rm:O.ROUND_DOWN,children:`${I}`}),t.jsxs(_,{direction:"column",width:"100%",gap:2,className:"oui-mt-[6px]",children:[t.jsx(rt,{markCount:4,value:[I??0],onValueChange:P=>{let C=Array.from(P.values());k(C[0]);let L=new O(C[0]).div(100).mul(S).abs().toFixed(n,O.ROUND_DOWN);a(L,S)},onValueCommit:P=>{let C=new O(P[0]).div(100).mul(S).abs().toFixed(n,O.ROUND_DOWN);D(C).finally(()=>{i.current.focus()})}}),t.jsx(Gl,{onClick:P=>{k(P*100);let C=new O(P).mul(S).abs().toFixed(n,O.ROUND_DOWN);C=de.formatNumber(C,s)??C,a(C,S),setTimeout(()=>{i.current.focus(),i.current.setSelectionRange(C.length,C.length)},100)}})]})]})})]})},Gl=e=>{let{t:i}=N(),r=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:i("common.max"),value:1}];return t.jsx(_,{gap:2,width:"100%",children:r.map((n,s)=>t.jsx(re,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.onClick(n.value)},className:"oui-w-1/5",children:n.label},s))})},Yl=e=>{let{order:i}=e,{t:r}=N(),[n,s]=m.useState(()=>{var q;return i.type===J.MARKET&&!i.price?"Market":((q=i.price)==null?void 0:q.toString())??"Market"}),[o,a]=m.useState(!1),[l,c]=m.useState(!1),u=(i==null?void 0:i.algo_order_id)!==void 0,p=(i==null?void 0:i.type)==="MARKET"&&u,[h,x]=m.useState(!1),{editOrder:y,editAlgoOrder:f,checkMinNotional:g}=at(),{base:b,quote_dp:j}=Ue(),w=us(i.symbol,i.side,u?i.trigger_price:void 0),v=()=>{a(!1),c(!1)},S=()=>{var q;a(!1),s(((q=i.price)==null?void 0:q.toString())??"Market"),c(!1)},I=m.useMemo(()=>!w||p||!l?"":Number(n)>w.max?r("orders.price.greaterThan",{max:w.max}):Number(n)<w.min?r("orders.price.lessThan",{min:w.min}):"",[p,l,w,n,r]),k=q=>{if(q==null||q.stopPropagation(),q==null||q.preventDefault(),!(I.length>0)){if(n===`${i.price}`){c(!1);return}if(i.reduce_only!==!0){let z=g(i.symbol,n,i.quantity);if(z){V.error(z),x(!1),S();return}}a(!0)}},D=q=>{q.key==="Enter"&&k(q)},P=()=>{x(!0);let q=i.order_id,z={order_price:n,order_quantity:i.quantity,symbol:i.symbol,order_type:i.type,side:i.side};typeof i.reduce_only<"u"&&(z.reduce_only=i.reduce_only),i.order_tag!==void 0&&(z={...z,order_tag:i.order_tag}),u&&(q=i.algo_order_id,z={...z,order_id:q,price:n,algo_order_id:q}),(i==null?void 0:i.visible_quantity)===0&&(z.visible_quantity=0),i.tag!==void 0&&(z.order_tag=i.tag);let W;i.algo_order_id!==void 0?W=f(i.algo_order_id.toString(),z):W=y(i.order_id.toString(),z),W.then(H=>{v(),s(n)},H=>{V.error(H.message),S()}).finally(()=>x(!1))},C=m.useRef(null);m.useEffect(()=>{e.order.price&&s(`${e.order.price}`)},[e.order.price]);let L=m.useRef(null),M=q=>{L.current&&!L.current.contains(q.target)&&!o&&S()};if(m.useEffect(()=>(document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}),[o,i.price]),i.algo_order_id&&i.type=="MARKET"||n==="Market")return t.jsx("span",{children:r("common.marketPrice")});let F=()=>!l||e.disableEdit?t.jsx(Xl,{order:i,price:n,setEditing:c,disableEdit:e.disableEdit}):t.jsx(wi,{inputRef:C,dp:j,value:n,setValue:s,setEditing:c,handleKeyDown:D,onClick:k,onClose:S,hintInfo:I});return t.jsx(di,{open:o,onOpenChange:a,content:t.jsx(_i,{type:1,base:b,value:n,cancelPopover:S,isSubmitting:h,onConfirm:P}),children:t.jsx("div",{onClick:q=>{q.stopPropagation(),q.preventDefault()},ref:L,children:F()})})},Xl=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:U("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",vt(i)&&"oui-text-base-contrast-20"),onClick:n=>{n.stopPropagation(),n.preventDefault(),e.setEditing(!0)},children:t.jsx(_,{r:"base",className:U("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2  oui-border oui-border-line-12"),children:t.jsx(d,{size:"2xs",children:ie(r)})})})},Jl=e=>{let{order:i}=e,[r,n]=m.useState("");m.useEffect(()=>{var F;n(((F=i.trigger_price)==null?void 0:F.toString())??"0")},[i.trigger_price]);let s=(i==null?void 0:i.algo_order_id)!==void 0,o=(i==null?void 0:i.algo_type)==="BRACKET",[a,l]=m.useState(!1),[c,u]=m.useState(!1),[p,h]=m.useState(!1),{editAlgoOrder:x,checkMinNotional:y}=at(),{base:f,quote_dp:g,quote_max:b,quote_min:j}=Ue(),w=m.useMemo(()=>{if(!((!s||o)&&!c)){if(Number(r)>b)return`Trigger price must be less than ${b}`;if(Number(r)<j)return`Trigger price must be greater than ${j}`}},[c,r,s,o]),v=()=>{l(!1),u(!1)},S=()=>{var F;n(((F=i.trigger_price)==null?void 0:F.toString())??"0"),l(!1),u(!1)},I=m.useRef(null),k=F=>{I.current&&!I.current.contains(F.target)&&!a&&S()};m.useEffect(()=>(document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}),[a,i.trigger_price]);let D=F=>{if(F==null||F.stopPropagation(),F==null||F.preventDefault(),u(!1),Number(r)!==Number(i.trigger_price)){if(i.price&&i.reduce_only!==!0){let q=y(i.symbol,i.price,i.quantity);if(q){V.error(q),h(!1),S();return}}l(!0)}},P=F=>{F.key==="Enter"&&D(F)},C=()=>{if((w??"").length>0)return;h(!0);let F={quantity:i.quantity,trigger_price:r,symbol:i.symbol,algo_order_id:i.algo_order_id};i.order_tag!==void 0&&(F={...F,order_tag:i.order_tag}),x(`${i.algo_order_id}`,F).then(q=>{v(),n(r)},q=>{var z;V.error(q.message),n(((z=i.trigger_price)==null?void 0:z.toString())??"--"),S()}).finally(()=>h(!1))},L=m.useRef(null);if(!s||o)return t.jsx(d,{children:"--"});let M=()=>!c||e.disableEdit?t.jsx(Zl,{order:i,price:r,setEditing:u,disableEdit:e.disableEdit}):t.jsx(wi,{inputRef:L,dp:g,value:r,setValue:n,setEditing:u,handleKeyDown:P,onClick:D,onClose:S,hintInfo:w});return t.jsx(di,{open:a,onOpenChange:l,content:t.jsx(_i,{type:2,base:f,value:r,cancelPopover:S,isSubmitting:p,onConfirm:C}),children:t.jsx("div",{onClick:F=>{F.stopPropagation(),F.preventDefault()},ref:I,children:M()})})},Zl=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:U("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",vt(i)&&"oui-text-base-contrast-20"),onClick:n=>{n.stopPropagation(),n.preventDefault(),e.setEditing(!0)},children:t.jsx(_,{r:"base",className:U("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(d,{size:"2xs",children:r})})})},vi=e=>{let{order:i}=e,{t:r}=N(),{onCancelOrder:n}=at(),[s,o]=m.useState(!1);return t.jsx(nt,{size:"sm",variant:"outlined",color:"secondary",onClick:a=>{n&&(a.preventDefault(),a.stopPropagation(),o(!0),n(i).then(l=>l,l=>{V.error(l.message)}).finally(()=>{o(!1)}))},loading:s,children:r("common.cancel")})},$l=e=>{let{record:i}=e,[r,n]=m.useState(!1),[s,{data:o,error:a,reset:l,isMutating:c}]=ii("/v1/order"),{t:u}=N(),p=it("brokerId"),h=m.useCallback(()=>{n(!1);let x={symbol:i.symbol,order_type:i.type,order_price:i.price,order_quantity:i.quantity,order_amount:i.amount,side:i.side,broker_id:p};Number(i.visible_quantity)<Number(i.quantity)&&(x.visible_quantity=0),typeof i.reduce_only<"u"&&(x.reduce_only=i.reduce_only),s(x)},[]);return t.jsx(re,{size:"sm",variant:"outlined",color:"secondary",loading:c,disabled:c,onClick:x=>{c||(x.preventDefault(),x.stopPropagation(),h())},children:u("orders.history.renew")})},ec=()=>{let{sl_trigger_price:e,tp_trigger_price:i,order:r,position:n}=Ke();return t.jsx(tc,{stopLossPrice:e,takeProfitPrice:i,direction:"column",order:r,position:n,tooltip:!0})},tc=e=>{let{direction:i="row",order:r,position:n}=e,s=Ae(),{t:o}=N(),a=m.useMemo(()=>{var h;let u=[];if(!e.tooltip||!r||!n)return;let p=r.quantity;return p===0&&((h=r.child_orders)==null?void 0:h[0].type)==="CLOSE_POSITION"&&(p=n.position_qty),e.takeProfitPrice&&u.push(t.jsx(Hi,{qty:p,price:e.takeProfitPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:ge.TAKE_PROFIT,symbolInfo:s[r.symbol]()},"tp")),e.stopLossPrice&&u.push(t.jsx(Hi,{qty:p,price:e.stopLossPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:ge.STOP_LOSS,symbolInfo:s[r.symbol]()},"sl")),t.jsx("div",{children:u})},[e.takeProfitPrice,e.stopLossPrice,n==null?void 0:n.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),l=m.useMemo(()=>{let u=[];return r!=null&&r.symbol?(e.takeProfitPrice&&u.push(t.jsx(d.numeral,{className:U("oui-text-trade-profit oui-gap-0  oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.tp")} -`," "]}):""},"tp")),e.stopLossPrice&&u.push(t.jsx(d.numeral,{className:U("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.sl")} -`," "]}):""},"sl")),u.length===0?t.jsx("span",{children:"-"}):(u.length===2&&i==="row"&&u.splice(1,0,t.jsx("span",{children:"/"},"split")),u)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol,o]),c=t.jsx("div",{className:U("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l});return e.tooltip?t.jsx(Ee,{content:a,className:"oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:c}):c},Hi=e=>{let{qty:i,price:r,entryPrice:n,orderSide:s,orderType:o,symbolInfo:a}=e,{t:l}=N(),c=de.priceToPnl({qty:i,price:r,entryPrice:n,orderSide:s,orderType:o},{symbol:a}),u=(o===ge.TAKE_PROFIT?"TP":"SL")=="TP"?`${l("tpsl.tpPnl")}:`:`${l("tpsl.slPnl")}:`;return t.jsxs("div",{className:"oui-flex oui-items-center",children:[t.jsx("span",{className:"oui-text-base-contrast-54 oui-mr-1",children:u}),t.jsx(d.numeral,{rule:"price",dp:a.quote_dp,padding:!1,className:c===0?"oui-text-base-contrast-36":c>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx("span",{children:c===0?"":c>0?"+":"-"}),suffix:t.jsx("span",{className:"oui-text-base-contrast-36 oui-ml-1",children:"USDC"}),children:`${Math.abs(c)}`})]})},ic=e=>{let{order:i}=e,{quote_dp:r,base_dp:n}=Ue(),{t:s}=N(),{sl_trigger_price:o,tp_trigger_price:a}=m.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:de.findTPSLFromOrder(e.order.child_orders[0]),[e.order]),{pnl:l,roi:c}=on(i);return!a&&!o?"--":t.jsx(Ee,{content:t.jsxs(_,{direction:"column",itemAlign:"start",gap:1,children:[typeof l.tpPnL<"u"&&t.jsx(d.numeral,{prefix:t.jsxs(d,{intensity:80,children:[`${s("tpsl.tpPnl")}:`,"  "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),dp:r,color:"buy",showIdentifier:!0,children:l.tpPnL}),typeof l.slPnL<"u"&&t.jsx(d.numeral,{prefix:t.jsxs(d,{intensity:80,children:[`${s("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),dp:r,color:"sell",children:l.slPnL})]}),className:"oui-bg-base-6",children:t.jsxs(_,{direction:"column",width:"100%",justify:"start",itemAlign:"start",children:[t.jsx(Ki,{type:"TP",value:a,quote_dp:r}),t.jsx(Ki,{type:"SL",value:o,quote_dp:r})]})})},Ki=e=>{let{type:i,value:r,quote_dp:n}=e,{t:s}=N();return r?t.jsx(d.numeral,{className:U("oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:n,prefix:t.jsxs("span",{className:"oui-text-base-contrast-54",children:[i==="TP"?`${s("tpsl.tp")} -`:`${s("tpsl.sl")} -`," "]}),children:r},"tp"):t.jsx(t.Fragment,{})},rc=e=>{let{position:i,order:r}=Ke(),{quote_dp:n,base_dp:s}=Ue(),{t:o}=N();return t.jsx(bi,{quoteDP:n,baseDP:s,position:i,order:r,label:o("common.edit"),isEditing:!0})},nc=()=>{let{sl_trigger_price:e,tp_trigger_price:i}=Ke(),{t:r}=N();return t.jsxs("div",{children:[i?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsxs(d,{intensity:54,children:[`${r("tpsl.tp")} -`," "]}),t.jsx("span",{children:r("common.marketPrice")})]}):null,e?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${r("tpsl.sl")} -`," "]}),t.jsx("span",{children:r("common.marketPrice")})]}):null]})};function sc(e){let{sl_trigger_price:i,tp_trigger_price:r}=!("algo_type"in e)||!Array.isArray(e.child_orders)?{}:de.findTPSLFromOrder(e),n=r?`${E.t("tpsl.tp")} - ${E.t("common.marketPrice")}`:void 0,s=i?`${E.t("tpsl.sl")} - ${E.t("common.marketPrice")}`:void 0;return{tpTriggerPrice:n,slTriggerPrice:s}}var oc=e=>{let{t:i}=N();return e.sharePnLConfig==null?t.jsx(t.Fragment,{}):t.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),ye.show(e.modalId,{pnl:{entity:{symbol:e.order.symbol,pnl:e.order.realized_pnl,side:e.order.side=="BUY"?i("share.pnl.share.long"):i("share.pnl.share.short"),openPrice:e.order.average_executed_price,openTime:e.order.updated_time,quantity:e.order.quantity},refCode:e.refCode,leverage:e.leverage,...e.sharePnLConfig}})},children:t.jsx(br,{color:"white",opacity:.54,size:e.iconSize??16})})},ac=e=>{let{sharePnLConfig:i,order:r,modalId:n,iconSize:s}=e,{getFirstRefCode:o}=oi(),a=m.useMemo(()=>{var c;return(c=o())==null?void 0:c.code},[o]),l=yr(e.order.symbol);return{iconSize:s,order:r,refCode:a,leverage:l,sharePnLConfig:i,modalId:n}},fn=e=>{let i=ac(e);return t.jsx(oc,{...i})},lc=e=>{let{_type:i,onSymbolChange:r,pnlNotionalDecimalPrecision:n,sharePnLConfig:s}=e,{t:o}=N();return m.useMemo(()=>{switch(i){case"all":return[Ve({width:130,showType:!0,onSymbolChange:r,enableSort:!1}),Ye({width:130,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Xe({width:130,title:o("orders.column.orderPrice"),disableEdit:!0,enableSort:!1}),St({width:130,enableSort:!1}),Gi({width:130,symbolsInfo:e.symbolsInfo}),$t({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo}),Je({width:130,enableSort:!1}),ct({width:130}),ut({width:130}),Qe({width:130}),Ze({width:130}),Yi({width:130}),$e({width:160,enableSort:!1})];case"pending":return[Ve({width:172,showType:!0,onSymbolChange:r,enableSort:!1}),Ye({width:162,className:"oui-pr-0",enableSort:!1}),Xe({width:162,className:"oui-pr-0",enableSort:!1}),lt({width:162,className:"oui-pr-0"}),mc({width:130}),Je({width:162,isPending:!0}),Qe({width:162}),Ze({width:162}),$e({width:162,enableSort:!1}),fc({width:162})];case"tp_sl":return[Ve({width:176,showType:!0,onSymbolChange:r,enableSort:!1}),cc({width:176}),Gi({width:176,symbolsInfo:e.symbolsInfo}),uc({width:176}),pc({width:176}),Qe({width:176}),$e({width:176,enableSort:!1}),hc({width:176})];case"filled":return[Ve({showType:!0,width:154,onSymbolChange:r}),Ye({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Xe({width:124,title:o("orders.column.orderPrice"),disableEdit:!0}),dc({width:124}),lt({width:124,disableEdit:!0}),$t({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo,hideShare:!0}),Je({width:124}),ct({width:124}),ut({width:124}),Qe({width:124}),Ze({width:124}),$e({width:176})];case"cancelled":return[Ve({showType:!0,width:154,onSymbolChange:r,enableSort:!1}),Ye({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Xe({width:124,disableEdit:!0,enableSort:!1}),St({width:124,enableSort:!1}),lt({width:124,disableEdit:!0}),Je({width:124}),ct({width:124}),ut({width:124}),Qe({width:124}),Ze({width:124})];case"rejected":return[Ve({showType:!0,width:154,onSymbolChange:r}),Ye({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Xe({width:124,disableEdit:!0}),St({width:124}),lt({width:124,disableEdit:!0}),Je({width:124}),ct({width:124}),ut({width:124}),Qe({width:124}),Ze({width:124}),$e({width:176})];case"orderHistory":return[Ve({showType:!0,width:154,onSymbolChange:r}),Ye({width:150,disableEdit:!0,className:"oui-pl-6 oui-pr-0"}),Xe({width:124,disableEdit:!0}),St({width:124}),lt({width:124,disableEdit:!0}),$t({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo}),Je({width:124}),ct({width:124}),ut({width:124}),Qe({width:124}),Ze({width:124}),$e({width:150}),Yi({width:80})]}},[i,n,s,o])};function Ve(e){return{title:E.t("common.symbol"),dataIndex:"symbol",fixed:"left",width:e==null?void 0:e.width,onSort:e!=null&&e.enableSort?(i,r)=>i.symbol.localeCompare(r.symbol):void 0,renderPlantText:(i,r)=>{var o;let n=(o=gt(r))==null?void 0:o.join(","),s=n!=null&&n.length?` (${n})`:"";return`${i.split("_")[1]}-PERP${s}`},render:(i,r)=>{var s;let n=vt(r);return t.jsxs(_,{gap:2,children:[t.jsx("div",{className:U("oui-rounded-[1px] oui-w-1 oui-h-7 oui-shrink-0",r.side===Ce.BUY?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(_,{direction:"column",itemAlign:"start",children:[t.jsx(d.formatted,{size:"xs",className:"oui-cursor-pointer oui-text-xs",onClick:o=>{var a;(a=e==null?void 0:e.onSymbolChange)==null||a.call(e,{symbol:i}),o.stopPropagation(),o.preventDefault()},children:`${i.split("_")[1]}-PERP`}),(e==null?void 0:e.showType)&&t.jsx(_,{direction:"row",gap:1,children:(s=gt(r))==null?void 0:s.map((o,a)=>t.jsx(Y,{color:o.toLocaleLowerCase()==="position"?n?"neutral":"primary":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:o},a))})]})]})}}}function Ye(e){return{title:E.t("orders.column.fill&Quantity"),dataIndex:"fill_quantity",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let n=(i.algo_type===K.POSITIONAL_TP_SL?0:i.quantity)??0,s=(r.algo_type===K.POSITIONAL_TP_SL?0:r.quantity)??0;return Nt(n,s)}:void 0,renderPlantText:(i,r)=>{if(r.type===J.CLOSE_POSITION&&r.status!==Q.FILLED)return E.t("tpsl.entirePosition");let n=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===K.TP_SL?"":`${n} / `)+`${r.quantity}`},render:(i,r)=>r.type===J.CLOSE_POSITION&&r.status!==Q.FILLED?E.t("tpsl.entirePosition"):t.jsx(pn,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function cc(e){return{title:E.t("common.quantity"),className:e==null?void 0:e.className,dataIndex:"quantity",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let n=(i.algo_type===K.POSITIONAL_TP_SL?0:i.quantity)??0,s=(r.algo_type===K.POSITIONAL_TP_SL?0:r.quantity)??0;return Nt(n,s)}:void 0,renderPlantText:(i,r)=>{if(r.algo_type===K.POSITIONAL_TP_SL)return E.t("tpsl.entirePosition");let n=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===K.TP_SL?"":`${n}/`)+`${r.quantity}`},render:(i,r)=>r.algo_type===K.POSITIONAL_TP_SL?E.t("tpsl.entirePosition"):t.jsx(pn,{order:r})}}function Xe(e){return{title:(e==null?void 0:e.title)??E.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,n)=>Nt(i.price??0,r.price??0):void 0,renderPlantText:(i,r)=>{var n;return ie((n=r.price)==null?void 0:n.toString(),{fallback:E.t("common.marketPrice")})},render:(i,r)=>t.jsx(Yl,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function uc(e){return{title:(e==null?void 0:e.title)??E.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let{tpTriggerPrice:n,slTriggerPrice:s}=sc(r),o=`${n||""}${s?`${n?`
`:""}${s}`:""}`;return o.length>0?o:"--"},render:(i,r)=>t.jsx(nc,{})}}function dc(e){return{title:E.t("common.avgPrice"),dataIndex:"average_executed_price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,render:(i,r)=>ie(i)}}function lt(e){return{title:E.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let n=(r==null?void 0:r.algo_order_id)!==void 0,s=(r==null?void 0:r.algo_type)==="BRACKET";return!n||s?"--":ie(i)},render:(i,r)=>t.jsx(Jl,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function Gi(e){return{title:(e==null?void 0:e.title)??E.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"tpsl_trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{var c;let n=(c=e==null?void 0:e.symbolsInfo)==null?void 0:c[r.symbol],s=n==null?void 0:n("quote_dp"),{sl_trigger_price:o,tp_trigger_price:a}=!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:de.findTPSLFromOrder(r),l=(a!=null?`${E.t("tpsl.tp")}: ${ie(a,{fix:s,padEnd:!0})}`:"")+(o!=null?`${a?`
`:""}${E.t("tpsl.sl")}: ${ie(o,{fix:s,padEnd:!0})}`:"");return l.length>0?l:"--"},render:(i,r)=>t.jsx(ec,{})}}function mc(e){return{title:E.t("common.tpsl"),className:e==null?void 0:e.className,dataIndex:"bracketOrderPrice",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let n=()=>!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:de.findTPSLFromOrder(r.child_orders[0]),{sl_trigger_price:s,tp_trigger_price:o}=n(),a=(o!=null?`${E.t("tpsl.tp")}: ${o}`:"")+(s!=null?`${o?`
`:""}${E.t("tpsl.sl")}: ${s}`:"");return a.length>0?a:"--"},render:(i,r)=>t.jsx(ic,{order:r})}}function Je(e){return{title:E.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,className:e==null?void 0:e.className,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,n)=>{let s=i.type===J.CLOSE_POSITION&&i.status!==Q.FILLED||i.total_executed_quantity===0||Number.isNaN(i.average_executed_price)||i.average_executed_price===null?0:i.total_executed_quantity*i.average_executed_price,o=r.type===J.CLOSE_POSITION&&r.status!==Q.FILLED||r.total_executed_quantity===0||Number.isNaN(r.average_executed_price)||r.average_executed_price===null?0:r.total_executed_quantity*r.average_executed_price;return Nt(s,o)}:void 0,renderPlantText:(i,r)=>ei(r,(e==null?void 0:e.isPending)??!1)==="Entire position"?E.t("tpsl.entirePosition"):ie(ei(r,(e==null?void 0:e.isPending)??!1),{fix:2}),render:(i,r)=>{let n=ei(r,(e==null?void 0:e.isPending)??!1);return n==="Entire position"?E.t("tpsl.entirePosition"):t.jsx(d.numeral,{rm:O.ROUND_DOWN,dp:2,children:n})}}}function $t(e){return{title:E.t("common.realizedPnl"),dataIndex:"realized_pnl",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{var c;let n=(c=e==null?void 0:e.symbolsInfo)==null?void 0:c[r.symbol],s=n==null?void 0:n("quote_dp"),o=(e==null?void 0:e.pnlNotionalDecimalPrecision)??s,a=new O(i??0).toDecimalPlaces(o,O.ROUND_DOWN).toNumber(),l=ie(a);return a>0?`+${l}`:l},render:(i,r)=>{let{quote_dp:n}=Ue(),s=(e==null?void 0:e.pnlNotionalDecimalPrecision)??n,o=new O(i??0).toDecimalPlaces(s,O.ROUND_DOWN).toNumber();return t.jsxs(_,{gap:1,children:[t.jsx(d.numeral,{dp:s,rm:O.ROUND_DOWN,padding:!1,intensity:(o??0)==0?80:void 0,showIdentifier:(o??0)>0,coloring:(o??0)!=0,children:o??"--"}),!(e!=null&&e.hideShare)&&t.jsx(fn,{order:r,sharePnLConfig:e==null?void 0:e.sharePnLConfig,modalId:Wt})]})}}}function Qe(e){return{title:E.t("orderEntry.reduceOnly"),dataIndex:"reduce_only",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i?E.t("common.yes"):E.t("common.no"),render:i=>t.jsx(d,{children:i?E.t("common.yes"):E.t("common.no")})}}function Ze(e){return{title:E.t("orders.column.hidden"),dataIndex:"visible",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i!==0?E.t("common.no"):E.t("common.yes"),render:(i,r)=>t.jsx(d,{children:r.visible_quantity!==0?E.t("common.no"):E.t("common.yes")})}}function $e(e){return{title:E.t("orders.column.orderTime"),dataIndex:"created_time",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{let n=new Date(i);return wr(n,"yyyy-MM-dd HH:mm:ss")},render:i=>t.jsx(d.formatted,{rule:"date",formatString:(e==null?void 0:e.formatString)||"yyyy-MM-dd HH:mm:ss",className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i})}}function ct(e){return{title:E.t("common.fee"),dataIndex:"total_fee",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className}}function pc(e){return{title:E.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>r.algo_type===K.POSITIONAL_TP_SL?E.t("tpsl.entirePosition"):ie(r.quantity===0?"--":`${new O(r.mark_price).mul(r.quantity).todp(2).toNumber()}`),render:(i,r)=>r.algo_type===K.POSITIONAL_TP_SL?E.t("tpsl.entirePosition"):t.jsx(d.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:r.quantity===0?"--":`${new O(r.mark_price).mul(r.quantity).todp(2).toNumber()}`})}}function ut(e){let i={[Q.NEW]:E.t("orders.status.pending"),[Q.FILLED]:E.t("orders.status.filled"),[Q.PARTIAL_FILLED]:E.t("orders.status.partialFilled"),[Q.CANCELLED]:E.t("orders.status.canceled"),[Q.REJECTED]:E.t("orders.status.rejected"),[Q.INCOMPLETE]:E.t("orders.status.incomplete"),[Q.COMPLETED]:E.t("orders.status.completed")};return{title:E.t("common.status"),dataIndex:"status",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(r,n)=>{let s=r||n.algo_status;return i[s]||xt(s)},render:(r,n)=>{let s=r||n.algo_status;return i[s]||xt(s)}}}function St(e){return{title:E.t("common.avgOpen"),dataIndex:"average_executed_price",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>Nt(i.average_executed_price??0,r.average_executed_price??0):void 0,className:e==null?void 0:e.className,render:(i,r)=>r.type===J.MARKET&&!i?"--":t.jsx(d.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i}),renderPlantText:(i,r)=>ie(i,{fix:2})}}function Yi(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>r.status===Q.CANCELLED?t.jsx($l,{record:r}):r.status===Q.NEW||r.algo_status===Q.NEW?t.jsx(vi,{order:r}):null}}function fc(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsx(vi,{order:r})}}function hc(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsxs(_,{gap:3,children:[t.jsx(rc,{order:r}),t.jsx(vi,{order:r})]})}}function Nt(e,i){return e>i?1:e<i?-1:0}function ei(e,i){return i?e.price&&e.quantity?new O(e.price).mul(e.quantity).toFixed(2,O.ROUND_DOWN):"--":e.type===J.CLOSE_POSITION&&e.status!==Q.FILLED?E.t("tpsl.entirePosition"):e.total_executed_quantity===0||Number.isNaN(e.average_executed_price)||e.average_executed_price===null?"--":`${e.total_executed_quantity*e.average_executed_price}`}var xc=e=>{let{item:i}=e,r=i.side===Ce.BUY,{t:n}=N();return t.jsx(d.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(Y,{color:r?"success":"danger",size:"xs",children:n(r?"common.buy":"common.sell")}),onClick:()=>{var s;(s=e.onSymbolChange)==null||s.call(e,{symbol:i.symbol})},children:i.symbol})},gc=e=>{var r;let{item:i}=e;return m.useCallback(()=>{let n=typeof i.type=="string"?i.type.replace("_ORDER","").toLowerCase():i.type;return i.algo_order_id&&i.algo_type!==K.BRACKET?`Stop ${n}`:xt(i.type)},[i]),t.jsx(_,{direction:"row",gap:1,children:(r=gt(e.item))==null?void 0:r.map((n,s)=>t.jsx(Y,{color:n.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:n},s))})},yc=e=>{let{item:i}=e;return t.jsx(d.formatted,{rule:"date",formatString:"yyyy-MM-dd hh:mm:ss",intensity:36,size:"2xs",children:i.updated_time})},bc=e=>{let{item:i}=e,{t:r}=N(),n=i.status||i.algo_status,s=m.useMemo(()=>({[Q.NEW]:r("orders.status.pending"),[Q.FILLED]:r("orders.status.filled"),[Q.PARTIAL_FILLED]:r("orders.status.partialFilled"),[Q.CANCELLED]:r("orders.status.canceled"),[Q.REJECTED]:r("orders.status.rejected"),[Q.INCOMPLETE]:r("orders.status.incomplete"),[Q.COMPLETED]:r("orders.status.completed")}),[r]);return t.jsx(d.formatted,{intensity:80,size:"2xs",children:s[n]||xt(n)})},Xi=e=>{let{item:i}=e,{t:r}=N(),n=i.type===J.CLOSE_POSITION&&(i==null?void 0:i.status)!==Q.FILLED;return t.jsx(se,{label:r("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.base_dp,padding:!1,coloring:!0,placeholder:r("tpsl.entirePosition"),intensity:80,children:n?r("tpsl.entirePosition"):i.quantity})})},Ji=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:t.jsx(d,{children:r("orders.status.filled")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.base_dp,intensity:80,padding:!1,rm:O.ROUND_DOWN,children:i.total_executed_quantity})})},jc=e=>{let{item:i}=e,{t:r}=N(),n=m.useMemo(()=>i.price&&i.quantity?new O(i.price).mul(i.quantity).toFixed(e.quote_dp,O.ROUND_DOWN):"--",[i.price,i.quantity]);return t.jsx(se,{align:"end",label:t.jsxs(d,{children:[r("common.notional"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,coloring:!0,intensity:80,padding:!1,rm:O.ROUND_DOWN,children:n})})},Zi=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:r("orders.column.triggerPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:e.align,children:t.jsx(d.numeral,{dp:e.quote_dp,intensity:80,padding:!1,rm:O.ROUND_DOWN,children:i.trigger_price??"--"})})},_c=e=>{let{item:i}=e,{t:r}=N();return t.jsx(se,{label:r("common.markPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,padding:!1,children:i.mark_price})})},wc=e=>{let{item:i}=e,{t:r}=N(),n=(i==null?void 0:i.algo_order_id)!==void 0,s=(i==null?void 0:i.type)==="MARKET"&&n;return t.jsx(se,{label:r("common.limitPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:s?t.jsx(d,{children:r("common.marketPrice")}):t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,padding:!1,children:i.price??"--"})})},vc=e=>{let{tp_trigger_price:i,tpPnL:r}=Ke(),{t:n}=N();return t.jsx(se,{label:n("tpsl.tpTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(Ni,{content:r&&t.jsx(d.numeral,{size:"2xs",showIdentifier:!0,prefix:t.jsxs(d,{intensity:54,children:[`${n("tpsl.tpPnl")}:`," "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,color:"buy",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},Nc=e=>{let{sl_trigger_price:i,slPnL:r}=Ke(),{t:n}=N();return t.jsx(se,{label:n("tpsl.slTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(Ni,{content:r&&t.jsx(d.numeral,{size:"2xs",prefix:t.jsxs(d,{intensity:54,children:[`${n("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,color:"sell",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},Cc=e=>{let{t:i}=N();return t.jsx(se,{label:i("tpsl.tpPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d,{intensity:80,children:i("common.marketPrice")})})},Pc=e=>{let{t:i}=N();return t.jsx(se,{label:i("tpsl.slPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d,{intensity:80,children:i("common.marketPrice")})})},Sc=e=>{let{item:i}=e,{t:r}=N(),n=m.useMemo(()=>i.algo_type===K.POSITIONAL_TP_SL?t.jsx("span",{className:"oui-text-base-contrast-80",children:r("tpsl.entirePosition")}):t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,padding:!1,children:i.quantity}),[i,r]);return t.jsx(se,{label:r("common.quantity"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:n})},Oc=e=>{var r;let{t:i}=N();return t.jsx(se,{label:t.jsxs(d,{children:[i("common.avgPrice"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,padding:!1,children:((r=e.item)==null?void 0:r.average_executed_price)??"--"})})},kc=e=>{var r;let{t:i}=N();return t.jsx(se,{label:t.jsxs(d,{children:[i("orders.column.orderPrice"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,intensity:80,padding:!1,placeholder:i("common.marketPrice"),children:((r=e.item)==null?void 0:r.price)??"--"})})},Lc=e=>{var n;let i=(n=e==null?void 0:e.item)==null?void 0:n.realized_pnl,{t:r}=N();return t.jsx(se,{label:t.jsxs(d,{children:[r("common.realizedPnl"),t.jsx(d,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsxs(_,{gap:1,children:[t.jsx(d.numeral,{dp:e.quote_dp,rm:O.ROUND_DOWN,padding:!1,intensity:(i??0)==0?80:void 0,showIdentifier:(i??0)>0,coloring:(i??0)!=0,children:i??"--"}),t.jsx(fn,{order:e.item,sharePnLConfig:e.sharePnLConfig,modalId:Bt,iconSize:12})]})})},Ni=e=>{let{classNames:i,content:r}=e,[n,s]=m.useState(!1);return typeof r>"u"?e.children:t.jsx(Ee,{content:r,className:i==null?void 0:i.content,open:n,onOpenChange:s,arrow:{className:i==null?void 0:i.arrow},children:t.jsx("div",{onClick:()=>s(o=>!o),children:e.children})})},Dc=e=>{let{t:i}=N(),{item:r}=e;return r.quantity>0,t.jsx(t.Fragment,{children:t.jsx(re,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{e.onShowEditSheet()},children:i("common.edit")})})},qc=e=>{var c;let{side:i}=e.item,{price:r,quantity:n,triggerPrice:s,isAlgoOrder:o}=e,a=i===Ce.BUY,{t:l}=N();return t.jsxs("div",{className:"oui-pt-2",children:[t.jsx(d,{intensity:80,children:`You agree to edit your ${e.base}-PERP order.`}),t.jsxs(_,{gap:2,mb:3,mt:2,justify:"between",children:[t.jsx(d.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:e.item.symbol}),t.jsxs(_,{direction:"row",gap:1,children:[(c=gt(e.item))==null?void 0:c.map((u,p)=>t.jsx(Y,{color:u.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:u},p)),a&&t.jsx(Y,{color:"success",size:"xs",children:l("common.buy")}),!a&&t.jsx(Y,{color:"danger",size:"xs",children:l("common.sell")})]})]}),t.jsx(ke,{}),t.jsxs(_,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:3,children:[o&&t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:l("orders.column.triggerPrice")}),t.jsx(d.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:O.ROUND_DOWN,suffix:t.jsx(d,{intensity:54,children:" USDC"}),children:s??"--"})]}),t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:l("common.price")}),t.jsx(d.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:O.ROUND_DOWN,suffix:t.jsx(d,{intensity:54,children:" USDC"}),placeholder:e.isStopMarket?l("common.marketPrice"):"--",children:e.isStopMarket?l("common.marketPrice"):r??"--"})]}),t.jsxs(_,{justify:"between",width:"100%",gap:1,children:[t.jsx(d,{children:l("common.qty")}),t.jsx(d.numeral,{color:i===Ce.BUY?"buy":"sell",dp:e.base_dp,padding:!1,rm:O.ROUND_DOWN,children:n??"--"})]})]}),t.jsxs(_,{className:"oui-gap-[2px]",children:[t.jsx(fr,{color:"white",id:"oui-checkbox-disableOrderConfirmation",checked:!e.orderConfirm,onCheckedChange:u=>{e.setOrderConfirm(!u)}}),t.jsx("label",{className:"oui-text-2xs oui-text-base-contrast-54",htmlFor:"oui-checkbox-disableOrderConfirmation",children:l("orderEntry.disableOrderConfirm")})]})]})},Ic=e=>{var p,h,x;let{item:i}=e,r=i.side===Ce.BUY,{t:n}=N(),{parseErrorMsg:s}=_t(e.errors),o=s("order_quantity"),a=s("order_price"),l=s("trigger_price"),c=e.quantity&&e.maxQty?Math.min(Number(e.quantity)/e.maxQty,1):void 0,u=y=>{let f=e.baseTick;if(f&&f>0){let g=de.formatNumber(y,f)??y;e.setQuantity(g)}};return t.jsxs(t.Fragment,{children:[t.jsxs(_,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d.formatted,{rule:"symbol",showIcon:!0,intensity:80,children:i.symbol}),t.jsxs(_,{direction:"row",gap:1,children:[(p=gt(e.item))==null?void 0:p.map((y,f)=>t.jsx(Y,{color:y.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:y},f)),r&&t.jsx(Y,{color:"success",size:"xs",children:n("common.buy")}),!r&&t.jsx(Y,{color:"danger",size:"xs",children:n("common.sell")})]})]}),t.jsx(ke,{intensity:8,className:"oui-w-full"}),t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d,{children:n("common.lastPrice")}),t.jsx(d.numeral,{dp:(x=(h=e.item)==null?void 0:h.symbolInfo)==null?void 0:x.duote_dp,children:e.curMarkPrice??"--"})]}),t.jsxs(_,{width:"100%",direction:"column",itemAlign:"stretch",gap:2,children:[e.isAlgoOrder&&t.jsx(Ne.tooltip,{prefix:t.jsx(d,{intensity:54,className:"oui-px-3",children:n("orders.column.triggerPrice")}),suffix:t.jsx(d,{intensity:54,className:"oui-px-3",children:e.quote}),color:l?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Z.numberFormatter,Z.dpFormatter(e.quote_dp)],value:e.triggerPrice,onValueChange:y=>e.setTriggerPrice(y),tooltip:l,tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast-98 oui-w-full",root:U("oui-outline-line-12",l&&"oui-outline-danger")}}),t.jsx(Ne.tooltip,{prefix:t.jsx(d,{intensity:54,className:"oui-px-3",children:n("common.price")}),suffix:t.jsx(d,{intensity:54,className:"oui-px-3",children:e.quote}),color:a?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Z.numberFormatter,Z.dpFormatter(e.quote_dp)],disabled:!e.priceEdit,value:e.isStopMarket?n("orderEntry.orderType.market"):e.price,onValueChange:y=>e.setPrice(y),tooltip:a,tooltipProps:{content:{className:"oui-bg-base-5"},arrow:{className:"oui-fill-base-5"}},classNames:{input:"oui-text-base-contrast-98",root:U("oui-outline-line-12",a&&"oui-outline-danger")}}),t.jsx(Ne.tooltip,{prefix:t.jsx(d,{intensity:54,className:"oui-px-3",children:n("common.quantity")}),suffix:t.jsx(d,{intensity:54,className:"oui-px-3",children:e.base}),color:o?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Z.numberFormatter,Z.dpFormatter(e.base_dp)],value:e.quantity,onValueChange:y=>{e.setQuantity(y)},onBlur:y=>u(y.target.value),tooltip:o,tooltipProps:{content:{className:"oui-bg-base-6"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast-98",root:U("oui-outline-line-12",o&&"oui-outline-danger")}}),t.jsx(rt,{markCount:4,value:[e.sliderValue??0],onValueChange:y=>{e.setSliderValue(y[0])},color:"primary"}),t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(d.numeral,{color:"primary",size:"2xs",dp:2,padding:!1,rule:"percentages",children:`${c??0}`}),t.jsxs(_,{gap:1,children:[t.jsx(d,{size:"2xs",color:"primary",children:n("common.max")}),t.jsx(d.numeral,{intensity:54,size:"2xs",dp:e.base_dp,children:e.maxQty})]})]})]}),t.jsxs(_,{width:"100%",gap:3,mt:2,children:[t.jsx(re,{fullWidth:!0,color:"secondary",onClick:y=>{e.onClose()},children:n("common.cancel")}),t.jsx(nt,{fullWidth:!0,onClick:y=>{y.stopPropagation(),y.preventDefault(),e.onSheetConfirm()},loading:e.submitting,disabled:!e.isChanged,children:n("common.confirm")})]})]}),t.jsx(jt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,title:n("orders.editOrder"),size:"xs",actions:{primary:{label:n("common.confirm"),onClick:e.onDialogConfirm,loading:e.submitting,fullWidth:!0},secondary:{label:n("common.cancel"),onClick:e.onCloseDialog,fullWidth:!0}},classNames:{content:"oui-pb-4",body:"oui-p-0",footer:"oui-pt-3 oui-pb-0"},children:t.jsx(qc,{...e})})]})},Tc=e=>{let{state:i,editAlgoOrder:r,editOrder:n,autoCheckInput:s=!0,position:o}=e,{item:a}=i,{hide:l}=ui(),[c,u]=m.useState(!1),p=(a==null?void 0:a.algo_order_id)!==void 0&&a.algo_type!==K.BRACKET,h=(a==null?void 0:a.type)==="MARKET"&&p;h||(a==null||a.type);let[x,y]=m.useState(!1),f=m.useMemo(()=>p&&a.algo_type!==K.BRACKET?`STOP_${a.type}`:a.type,[a,p]),[g,b]=Oe("orderly_order_confirm",!0),{base_dp:j,base_tick:w}=e.state,{formattedOrder:v,setValue:S,markPrice:I,errors:k,validate:D,maxQty:P}=Ec({order:a,orderType:f,position:o}),C=()=>{D().then(B=>{g?u(!0):q(v)},B=>{var T;(T=B==null?void 0:B.total)!=null&&T.message&&V.error(B==null?void 0:B.total.message)}).catch(B=>{})},L=m.useCallback(()=>{u(!1)},[]),M=()=>v?q(v):Promise.reject(),F=m.useCallback(()=>{l()},[]),q=m.useCallback(async B=>{let T,te=a.visible_quantity!==void 0?a.visible_quantity===0:a.visible!==void 0?a.visible===0:!1;if(a.algo_order_id!==void 0){if(h&&"order_price"in B){let{order_price:G,...me}=B;B=me}T=r(a.algo_order_id.toString(),{...B})}else T=n(a.order_id.toString(),{...B,...te?{visible_quantity:0}:{}});try{y(!0);let G=await T;F()}catch(G){V.error((G==null?void 0:G.message)??`${G}`)}finally{y(!1)}},[r,n]),z=m.useMemo(()=>{let B=v.order_quantity;return B&&Number(B)!==0&&P!==0?new O(B).div(P).mul(100).toDecimalPlaces(2,O.ROUND_DOWN).toNumber():0},[v.order_quantity,P]),W=a.price!=v.order_price||a.quantity!=v.order_quantity||a.trigger_price!=v.trigger_price,H=ms(B=>{let T=new O(B).div(100).mul(P).toDecimalPlaces(j,O.ROUND_DOWN).toNumber();S("order_quantity",de.formatNumber(T,w))},50,{}),ne=(B,T)=>{S(B,T)};return{...i,curMarkPrice:I,isAlgoOrder:p,isStopMarket:h,price:v.order_price,setPrice:B=>ne("order_price",B),priceEdit:!h,triggerPrice:v.trigger_price,setTriggerPrice:B=>ne("trigger_price",B),quantity:v.order_quantity,setQuantity:B=>{ne("order_quantity",B)},maxQty:P,sliderValue:z,setSliderValue:H,onClose:F,onSheetConfirm:C,errors:k,orderType:f,isChanged:W,baseTick:w,dialogOpen:c,setDialogOpen:u,onDialogConfirm:M,onCloseDialog:L,submitting:x,orderConfirm:g,setOrderConfirm:b}},Ec=e=>{let{order:i,orderType:r,position:n}=e,[s,o]=m.useState({side:i.side,order_type:r,order_price:i.price,order_quantity:i.quantity,trigger_price:i.trigger_price,reduce_only:i.reduce_only,symbol:i.symbol}),{reduce_only:a}=i,l=n==null?void 0:n.position_qty,c=vr(i.symbol,i.side,i.reduce_only),u=m.useMemo(()=>a?Math.abs(l??0):i.quantity+Math.abs(c),[i.quantity,c,a,l]),{symbolInfo:p,markPrice:h,errors:x,validate:y}=ps({...s,symbol:i.symbol},{maxQty:u});return{symbolInfo:p,markPrice:h,errors:x,validate:y,setValue:(f,g)=>{o(b=>({...b,[f]:g}))},formattedOrder:s,maxQty:u}},Mc=e=>{let i=Tc(e);return t.jsx(Ic,{...i})},Ac=e=>{let{state:i}=e,{t:r}=N(),{editAlgoOrder:n,editOrder:s}=at(),{order:o,position:a}=Ke(),l=m.useCallback(()=>{e.state.type==="tp_sl"?ye.sheet({title:r("common.tpsl"),content:t.jsx(Yr,{isEditing:!0,order:e.state.item,position:a,symbolInfo:e.state.origin})}).catch(c=>{}):ye.sheet({title:r("orders.editOrder"),classNames:{content:"oui-bg-base-8"},content:t.jsx(Mc,{position:a,state:i,editAlgoOrder:n,editOrder:s})}).catch(c=>{})},[i]);return{...i,onShowEditSheet:l}},zc=e=>{let i=Ac(e);return t.jsx(Dc,{...i})},Fc=e=>{let{t:i}=N();return t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:r=>e.setOpen(!0),children:i("common.cancel")}),e.open&&t.jsx(jt,{size:"xs",open:e.open,onOpenChange:e.setOpen,title:i("orders.cancelOrder"),actions:{primary:{label:i("common.confirm"),loading:e.isLoading,fullWidth:!0,size:"md",onClick:r=>{e.onCancel(r)}},secondary:{label:i("common.cancel"),fullWidth:!0,size:"md",onClick:()=>{e.onClose()}}},children:t.jsx(d,{size:"2xs",intensity:54,children:i("orders.cancelOrder.description")})})]})},Rc=e=>{let{state:i}=e,[r,n]=m.useState(!1),{onCancelOrder:s}=at(),[o,a]=m.useState(!1);return{...i,open:r,setOpen:n,onCancel:l=>s?(l==null||l.preventDefault(),l==null||l.stopPropagation(),a(!0),s(i.item).then(c=>{n(!1)},c=>{V.error(c.message)}).finally(()=>{a(!1)})):Promise.resolve(),onClose:()=>{n(!1)},isLoading:o}},Uc=e=>{let i=Rc(e);return t.jsx(Fc,{...i})},Wc=e=>{var r,n,s,o;let{t:i}=N();return!e.sl_trigger_price&&!e.tp_trigger_price?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx(Ni,{classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},content:t.jsxs(_,{direction:"column",itemAlign:"start",gap:1,children:[typeof((r=e.pnl)==null?void 0:r.tpPnL)<"u"&&t.jsx(d.numeral,{prefix:t.jsxs(d,{intensity:80,children:[`${i("tpsl.tpPnl")}:`,"  "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"buy",showIdentifier:!0,children:(n=e.pnl)==null?void 0:n.tpPnL}),typeof((s=e.pnl)==null?void 0:s.slPnL)<"u"&&t.jsx(d.numeral,{prefix:t.jsxs(d,{intensity:80,children:[`${i("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(d,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"sell",children:(o=e.pnl)==null?void 0:o.slPnL})]}),children:t.jsx("button",{onClick:()=>{e.setOpen(!e.open)},children:t.jsxs(_,{gap:1,width:"1",children:[e.tp_trigger_price&&t.jsx($i,{type:"TP",value:e.tp_trigger_price,quote_dp:e.quote_dp}),e.sl_trigger_price&&t.jsx($i,{type:"SL",value:e.sl_trigger_price,quote_dp:e.quote_dp})]})})})})},$i=e=>{let{type:i,value:r,quote_dp:n}=e;return r?t.jsx(d.numeral,{size:"2xs",className:U("oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:n,padding:!1,rm:O.ROUND_DOWN,prefix:t.jsxs("span",{className:"oui-text-base-contrast-36",children:[`${i} `,":  "]}),children:r},"tp"):t.jsx(t.Fragment,{})},Bc=e=>{let{item:i,quote_dp:r,base_dp:n}=e,[s,o]=m.useState(!1),{sl_trigger_price:a,tp_trigger_price:l}=m.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:de.findTPSLFromOrder(i.child_orders[0]),[i]),{pnl:c,roi:u}=on(i);return{sl_trigger_price:a,tp_trigger_price:l,pnl:c,roi:u,quote_dp:r,open:s,setOpen:o}},Vc=e=>{let i=Bc(e);return t.jsx(Wc,{...i})},Qc=e=>t.jsxs(_,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:e.className,children:[t.jsx(Hc,{...e}),t.jsx(ke,{intensity:6,className:"oui-w-full"}),t.jsx(Kc,{...e}),e.type==="pending"&&t.jsx(Vc,{...e}),e.type!=="orderHistory"&&t.jsx(Gc,{...e})]}),Hc=e=>t.jsxs(_,{direction:"column",gap:1,width:"100%",children:[t.jsxs(_,{justify:"between",width:"100%",children:[t.jsx(xc,{...e}),t.jsx(yc,{...e})]}),t.jsxs(_,{width:"100%",justify:"between",children:[t.jsx(gc,{...e}),e.type==="orderHistory"&&t.jsx(bc,{...e})]})]}),Kc=e=>t.jsx(De,{cols:3,rows:2,width:"100%",gap:1,children:Yc(e)}),Gc=e=>t.jsxs(De,{cols:3,rows:1,width:"100%",gap:2,children:[t.jsx("div",{}),t.jsx(zc,{state:e}),t.jsx(Uc,{state:e})]});function Yc(e){switch(e.type){case"all":return t.jsx(t.Fragment,{});case"pending":return t.jsxs(t.Fragment,{children:[t.jsx(Xi,{...e}),t.jsx(Ji,{...e}),t.jsx(jc,{...e}),t.jsx(Zi,{...e}),t.jsx(wc,{...e}),t.jsx(_c,{...e})]});case"tp_sl":return t.jsxs(t.Fragment,{children:[t.jsx(vc,{...e}),t.jsx(Cc,{...e}),t.jsx(Sc,{...e}),t.jsx(Nc,{...e}),t.jsx(Pc,{...e})]});case"filled":return t.jsx(t.Fragment,{});case"cancelled":return t.jsx(t.Fragment,{});case"rejected":return t.jsx(t.Fragment,{});case"orderHistory":return t.jsxs(t.Fragment,{children:[t.jsx(Xi,{...e}),t.jsx(Ji,{...e}),t.jsx(Zi,{...e,align:"end"}),t.jsx(Oc,{...e}),t.jsx(kc,{...e}),t.jsx(Lc,{...e})]})}}var Xc=e=>{let i=Ue();return{...e,...i}},Jc=e=>{let{className:i,...r}=e,n=Xc(r);return t.jsx(Qc,{...n,className:i})},Zc=e=>{var s;let{sharePnLConfig:i,...r}=e,n=lc({_type:e.type,onSymbolChange:e.onSymbolChange,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:i,symbolsInfo:e.symbolsInfo});return t.jsx(un,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(_,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[e.filterItems.length>0&&t.jsx(bt,{items:e.filterItems,onFilter:o=>{e.onFilter(o)},trailing:["pending","tp_sl"].includes(e.type)&&t.jsx(eu,{...e})}),t.jsx(Ft,{columns:n,loading:e.isLoading,dataSource:e.dataSource,bordered:!0,ignoreLoadingCheck:!0,testIds:{body:(s=e.testIds)==null?void 0:s.tableBody},classNames:{header:"oui-h-[38px]",root:"oui-items-start !oui-h-[calc(100%_-_49px)]"},onRow:(o,a)=>({className:U("oui-h-[48px]",vt(o)?"oui-text-base-contrast-20":"oui-text-base-contrast-80")}),generatedRowKey:(o,a)=>`${e.type}${a}${o.order_id||o.algo_order_id}_index${a}`,renderRowContainer:(o,a,l)=>((e.type==="tp_sl"||e.type==="pending")&&(l=t.jsx(mn,{order:o,children:l})),t.jsx(ln,{symbol:o.symbol,children:l})),pagination:e.pagination,manualPagination:e.manualPagination,features:[ss.DownloadFeature],getTableInstance:o=>{e.tableInstance.current=o}})]})})},$c=e=>{var r,n;let{t:i}=N();return t.jsx(un,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(De,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:2,children:[e.showFilter?t.jsx(_,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:e.filterItems.map(s=>s.type!=="select"?t.jsx(t.Fragment,{}):t.jsx(os,{options:s.options,size:"sm",value:s.value,className:"oui-text-2xs oui-text-base-contrast-54 ",placeholder:s.name==="side"?i("common.side.all"):s.name==="status"?i("common.status.all"):"",onValueChange:o=>{var a;(a=e.onFilter)==null||a.call(e,{name:s.name,value:o})}}))}):t.jsx("div",{}),t.jsx(At,{className:(r=e.classNames)==null?void 0:r.root,contentClassName:(n=e.classNames)==null?void 0:n.content,dataSource:e.dataSource,loadMore:e.loadMore,isLoading:e.isLoading,renderItem:(s,o)=>{var l;let a=t.jsx(Jc,{item:s,index:o,className:(l=e.classNames)==null?void 0:l.cell,type:e.type,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig});return["tp_sl","pending"].includes(e.type)&&(a=t.jsx(mn,{order:s,children:a})),t.jsx(ln,{symbol:s.symbol,children:a})}})]})})},eu=e=>{var r;let{t:i}=N();return t.jsx(re,{variant:"outlined",color:"secondary",size:"xs",disabled:(((r=e.dataSource)==null?void 0:r.length)??0)==0,className:"disabled:oui-bg-transport",onClick:n=>e.onCancelAll(),"data-testid":`oui-testid-dataList-${e.type.toLowerCase()}-cancelAll-button`,children:i("orders.cancelAll")})},tu=e=>m.useMemo(()=>{let i=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.algo_type===K.POSITIONAL_TP_SL||n.algo_type===K.TP_SL)if(n.algo_status!==Q.FILLED&&n.algo_status!==Q.PARTIAL_FILLED)for(let s=0;s<n.child_orders.length;s++){let o=n.child_orders[s];!o.is_activated||!o.trigger_price||(o.parent_algo_type=n.algo_type,i.push(o))}else for(let s=0;s<n.child_orders.length;s++){let o=n.child_orders[s];o&&(o.algo_status===Q.FILLED||o.algo_status===Q.PARTIAL_FILLED)&&(o.parent_algo_type=n.algo_type,i.push(o))}else i.push(n)}return i},[e]),hn=e=>{let{ordersStatus:i,type:r,enableLoadMore:n=!1,onSymbolChange:s,filterConfig:o,pnlNotionalDecimalPrecision:a,sharePnLConfig:l}=e,{t:c}=N(),u=Ae(),p=m.useMemo(()=>i!==Q.INCOMPLETE,[i]),h=50,{page:x,pageSize:y,setPage:f,pagination:g,parsePagination:b}=Mt({pageSize:h});m.useEffect(()=>{f(1)},[e.symbol]);let{orderStatus:j,ordersSide:w,dateRange:v,filterItems:S,onFilter:I}=iu(r,{ordersStatus:i,setPage:f,filterConfig:o}),k=m.useMemo(()=>{if(r==="tp_sl")return[K.POSITIONAL_TP_SL,K.TP_SL]},[r]),D=m.useMemo(()=>{if(r==="pending")return[K.POSITIONAL_TP_SL,K.TP_SL]},[r]),P=m.useRef();m.useImperativeHandle(e.ref,()=>({download:()=>{var ue;let pe=`orders_${wr(new Date,"yyyyMMdd_HHmmss")}`;(ue=P.current)==null||ue.download(pe)}}));let[C,{isLoading:L,loadMore:M,cancelOrder:F,updateOrder:q,cancelAlgoOrder:z,updateAlgoOrder:W,cancelAllOrders:H,cancelAllTPSLOrders:ne,meta:B,refresh:T}]=ns({symbol:e.symbol,status:j,side:w,page:n||!p?void 0:x,size:p?y:500,dateRange:v,includes:k,excludes:D}),te=`orderly_${r}_pageSize`,[G,me]=Oe(te,h);m.useEffect(()=>{G!==y&&me(y)},[y,G]);let Te=m.useCallback(()=>{let pe=e.type==="pending"?c("orders.pending.cancelAll"):e.type==="tp_sl"?c("orders.tpsl.cancelAll"):"",ue=c("orders.pending.cancelAll.description");ye.confirm({title:pe,content:t.jsx(d,{size:"sm",children:ue}),onCancel:async()=>{},onOk:async()=>{try{return r==="tp_sl"?await ne():await H(),T(),Promise.resolve(!0)}catch(xe){return(xe==null?void 0:xe.message)!==void 0&&toast.error(xe.message),Promise.resolve(!1)}finally{Promise.resolve()}}})},[r,c]),Pe=tu(C??[]),Le=zt(r!=="tp_sl"?Pe:C,{fallbackData:[]})??void 0,$=m.useMemo(()=>p?b(B):g,[B,p,b,g]);return{type:r,dataSource:Le,isLoading:L,loadMore:M,cancelOrder:F,updateOrder:q,cancelAlgoOrder:z,updateAlgoOrder:W,pagination:$,manualPagination:p,pnlNotionalDecimalPrecision:a,onFilter:I,filterItems:S,onCancelAll:Te,onSymbolChange:s,sharePnLConfig:l,tableInstance:P,symbolsInfo:u}},iu=(e,i)=>{var h,x;let{t:r}=N(),[n,s]=m.useState(i.ordersStatus??"all"),[o,a]=m.useState(((h=i.filterConfig)==null?void 0:h.side)??"all"),l=((x=i.filterConfig)==null?void 0:x.range)??(e==="all"||e==="orderHistory"?er({to:new Date,from:xn(Se(new Date,7))}):{}),[c,u]=m.useState(l),p=y=>{y.name==="side"&&(a(y.value),i.setPage(1)),y.name==="status"&&(s(y.value),i.setPage(1)),y.name==="dateRange"&&(u(er(y.value)),i.setPage(1))};return{filterItems:m.useMemo(()=>{let y={type:"select",name:"side",options:[{label:r("common.side.all"),value:"all"},{label:r("common.buy"),value:"BUY"},{label:r("common.sell"),value:"SELL"}],value:o},f={type:"range",name:"dateRange",value:c},g={type:"select",name:"status",options:[{label:r("common.status.all"),value:"all"},{label:r("orders.status.pending"),value:Q.INCOMPLETE},{label:r("orders.status.filled"),value:Q.FILLED},{label:r("orders.status.partialFilled"),value:Q.PARTIAL_FILLED},{label:r("orders.status.canceled"),value:Q.CANCELLED},{label:r("orders.status.rejected"),value:Q.REJECTED}],value:n};switch(e){case"all":return[y,g,f];case"pending":return[y];case"tp_sl":return[y];case"filled":return[y];case"cancelled":return[y];case"rejected":return[y];case"orderHistory":return[y,g,f]}},[e,o,n,c,r]),onFilter:p,ordersSide:o==="all"?void 0:o,dateRange:c,orderStatus:n==="all"?void 0:n}};function ru(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function xn(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var er=e=>({from:ru(e.from),to:xn(e.to??e.from)}),et=m.forwardRef((e,i)=>{let{testIds:r,...n}=e,s=hn({...n,ref:i});return t.jsx(Zc,{...s,testIds:r})}),gu=e=>{let i=hn({...e,enableLoadMore:!0});return t.jsx($c,{...i,classNames:e.classNames,showFilter:e.showFilter})},nu=e=>{let{t:i}=N(),r={pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision};return t.jsxs(ir,{defaultValue:e.current||"all",variant:"contained",className:"oui-h-full",classNames:{tabsContent:"oui-h-[calc(100%_-_28px)]"},children:[t.jsx(Re,{value:"all",title:i("common.all"),children:t.jsx(et,{ref:e.orderListRef,type:"all",pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...r})}),t.jsx(Re,{value:"pending",title:i("orders.status.pending"),children:t.jsx(et,{ref:e.orderListRef,type:"pending",ordersStatus:Q.INCOMPLETE,...r})}),t.jsx(Re,{value:"tp_sl",title:i("common.tpsl"),children:t.jsx(et,{ref:e.orderListRef,type:"tp_sl",ordersStatus:Q.INCOMPLETE,...r})}),t.jsx(Re,{value:"filled",title:i("orders.status.filled"),children:t.jsx(et,{ref:e.orderListRef,type:"filled",ordersStatus:Q.FILLED,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...r})}),t.jsx(Re,{value:"cancelled",title:i("orders.status.canceled"),children:t.jsx(et,{ref:e.orderListRef,type:"cancelled",ordersStatus:Q.CANCELLED,...r})}),t.jsx(Re,{value:"rejected",title:i("orders.status.rejected"),children:t.jsx(et,{ref:e.orderListRef,type:"rejected",ordersStatus:Q.REJECTED,...r})})]})},su=(e=>(e.all="all",e.pending="pending",e.tp_sl="tp_sl",e.filled="filled",e.cancelled="cancelled",e.rejected="rejected",e.orderHistory="orderHistory",e))(su||{}),yu=m.forwardRef((e,i)=>{let r=Bl({...e,ref:i});return t.jsx(nu,{...r})});export{to as $,du as G,mu as K,pu as L,su as P,_s as U,yu as W,eo as a,Cr as d,ys as f,et as h,hu as j,gu as k,fu as q,xu as t};
