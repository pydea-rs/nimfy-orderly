import{b3 as si,b4 as Er,a2 as xt,o as O,a3 as zt,n as _,aP as Mr,z as h,v as J,ab as z,Q as u,ak as Q,M as I,b5 as zr,F as me,C as Ar,W as X,b6 as Ue,am as gt,b7 as Fr,j as vi,$ as we,T as Rr,ac as Ur,ad as Wr,g as N,aN as Ni,b8 as Ci,X as Re,ah as Pi,a4 as We,l as xe,b as ni,Z as At,b9 as Br,Y as Si,ap as Vr,ba as ki,bb as Oi,bc as Qr,bd as ct,be as Hr,x as ye,bf as Kr,bg as Yr,bh as Xr,a1 as Et,w as qi,y as Di,A as Gr,B as Li,bi as Ii,a5 as Fe,bj as Jr,bk as Zr,E as de,bl as es,h as je,bm as Ft,k as ge,e as Ti,bn as V,aV as Rt,bo as Ut,aX as Wt,bp as ts,i as H,bq as pe,br as $i,bs as is,bt as rs,bu as le,bv as ie,S as fe,bw as Be,bx as Bt,by as ss,bz as ns,bA as qt,bB as os,bC as Ei,p as ft,bD as et,bE as yt,bF as oe,a7 as Mi,bG as as,bH as G,bI as Y,bJ as ls,bK as ds,an as zi,au as tt,bL as Ai,bM as Fi,b0 as us,b2 as cs,bN as Ri,bO as Z,bP as ms,D as Ui,bQ as ps,aS as hs,bR as U,aJ as Wi,bS as xs,bT as gs,bU as fs,bV as ys,ag as Mt,bW as bs,bX as js,aQ as Vt,bY as _s,bZ as Bi,b_ as ws,b$ as vs,c0 as Ns}from"./index-09RN6Rey.js";import{j as t,r as c,W as se}from"./index-_b-vxSi4.js";import{L as Qt,o as Cs,a as it,T as bt}from"./index-B9ha-PaS.js";import{a as Vi,F as Ps,d as jt}from"./index-CLPnXxgr.js";import{T as ut}from"./Trans-mxr8gQX7.js";import{u as Qi}from"./embla-carousel-react.esm-DDFcFn3T.js";function Ht(e,i){const r=si(e),s=si(i),n=oi(r,s),o=Math.abs(Er(r,s));r.setDate(r.getDate()-n*o);const a=+(oi(r,s)===-n),l=n*(o-a);return l===0?0:l}function oi(e,i){const r=e.getFullYear()-i.getFullYear()||e.getMonth()-i.getMonth()||e.getDate()-i.getDate()||e.getHours()-i.getHours()||e.getMinutes()-i.getMinutes()||e.getSeconds()-i.getSeconds()||e.getMilliseconds()-i.getMilliseconds();return r<0?-1:r>0?1:r}var Ss=[5,10,20,50,100],ai=e=>{let{Icon:i,onClick:r,disabled:s}=e;return t.jsx(i,{onClick:s?void 0:r,className:I("oui-m-2 oui-text-white oui-transition-all",s?"oui-cursor-not-allowed oui-opacity-20":"oui-cursor-pointer oui-opacity-100")})},ks=e=>{let i=se.useMemo(()=>[Q.numberFormatter,Q.currencyFormatter,Q.decimalPointFormatter],[]),r=c.useId();return t.jsxs("label",{htmlFor:r,className:I("oui-w-full","oui-rounded","oui-bg-base-6","oui-flex","oui-items-center","oui-justify-between","oui-outline","oui-outline-offset-0","oui-outline-1","oui-outline-transparent","focus-within:oui-outline-primary-light","oui-input-root"),children:[t.jsx(ai,{Icon:zr,onClick:e.onLeverageReduce,disabled:e.isReduceDisabled}),t.jsxs(h,{itemAlign:"center",justify:"center",children:[t.jsx(me,{value:e.value,id:r,autoComplete:"off",classNames:{input:I("oui-text-center"),root:I("oui-text-center","oui-w-7","oui-px-0","oui-outline","oui-outline-offset-0","oui-outline-1","oui-outline-transparent","focus-within:oui-outline-primary-none")},formatters:i,onChange:e.onInputChange}),t.jsx("div",{className:"oui-select-none",children:"x"})]}),t.jsx(ai,{Icon:Ar,onClick:e.onLeverageIncrease,disabled:e.isIncreaseDisabled})]})},Os=e=>{let{currentLeverage:i}=e,{t:r}=_();return t.jsxs(h,{itemAlign:"start",direction:"column",mb:0,children:[t.jsx(qs,{currentLeverage:i}),t.jsx(ks,{...e}),t.jsx(Ds,{...e}),t.jsx(Ls,{...e}),t.jsxs(h,{direction:"row",gap:2,width:"100%",mt:0,pt:5,children:[t.jsx(J,{variant:"contained",color:"gray",fullWidth:!0,onClick:e.onCancel,"data-testid":"oui-testid-leverage-cancel-btn",children:r("common.cancel")}),t.jsx(J,{fullWidth:!0,loading:e.isLoading,onClick:e.onSave,"data-testid":"oui-testid-leverage-save-btn",children:r("common.save")})]})]})},qs=e=>{let{t:i}=_(),{currentLeverage:r}=e;return t.jsx(h,{justify:"center",width:"100%",mb:2,children:t.jsxs(h,{gap:1,children:[`${i("common.current")}:`,t.jsx(u.numeral,{unit:"x",size:"sm",intensity:80,children:r??"--"})]})})},Ds=e=>{let{value:i,onLeverageChange:r}=e;return t.jsx(h,{itemAlign:"center",justify:"between",width:"100%",mt:2,children:Ss.map(s=>t.jsx(h,{itemAlign:"center",justify:"center",className:I("oui-box-border oui-cursor-pointer oui-rounded-md oui-border oui-border-solid oui-bg-clip-padding oui-px-3 oui-py-2.5 oui-transition-all",i===s?"oui-border-primary oui-bg-base-6":"oui-border-line-12"),onClick:()=>r==null?void 0:r(s),children:t.jsxs(h,{itemAlign:"center",justify:"center",className:I("oui-h-3 oui-w-9 oui-select-none"),children:[s,"x"]})},s))})},Ls=e=>{let{leverageLevers:i,maxLeverage:r,className:s,value:n,showSliderTip:o}=e;return t.jsxs(X,{pt:4,width:"100%",className:s,children:[t.jsx(Ue,{max:r,min:1,markCount:5,value:[n],onValueChange:a=>{e.onLeverageChange(a[0]),e.setShowSliderTip(!0)},color:"primary",onValueCommit:a=>{var l;(l=e.onValueCommit)==null||l.call(e,a),e.setShowSliderTip(!1)},showTip:o,tipFormatter:a=>`${a}x`}),t.jsx(h,{justify:"between",width:"100%",pt:3,children:i==null?void 0:i.map((a,l)=>t.jsx("button",{onClick:()=>{var d;e.onLeverageChange(a),(d=e.onValueCommit)==null||d.call(e,[a])},className:I("oui-pb-3 oui-text-2xs",l===0?"oui-pr-2":l===5?"oui-pl-0":"oui-ml-2 oui-px-0",e.value>=a&&"oui-text-primary-light"),"data-testid":`oui-testid-leverage-${a}-btn`,children:`${a}x`},a))})]})},Is=e=>{let[i,r]=c.useState(!1),{t:s}=_(),{curLeverage:n,maxLeverage:o,isLoading:a,leverageLevers:l,update:d}=Mr(),m=c.useMemo(()=>l.map(v=>({label:`${v}x`,value:v})),[l]),[p,x]=c.useState(n??0),y=100/(((m==null?void 0:m.length)||0)-1),b=v=>{x(v)},g=()=>{x(v=>v+1)},j=()=>{x(v=>v-1)},f=c.useCallback(v=>{let P=Number.parseInt(v.target.value,10),k=Number.isNaN(P)?0:P,$=Math.min(Math.max(k,1),o);x($)},[o]),w=async()=>{try{d({leverage:p}).then(()=>{var v;(v=e==null?void 0:e.close)==null||v.call(e),z.success(s("leverage.updated"))},v=>{z.error(v.message)})}catch{}};return{leverageLevers:l,currentLeverage:n,value:p,marks:m,onLeverageChange:b,onLeverageIncrease:g,onLeverageReduce:j,onInputChange:f,isReduceDisabled:p<=1,isIncreaseDisabled:p>=o,step:y,onCancel:e==null?void 0:e.close,onSave:w,isLoading:a,showSliderTip:i,setShowSliderTip:r,maxLeverage:o}},Hi=e=>{let i=Is({close:e.close});return t.jsx(Os,{...i})},Ts="LeverageWidgetWithDialog",$s="LeverageWidgetWithSheet";xt(Ts,Hi,{title:()=>O.t("leverage.maxAccountLeverage"),size:"md"});zt($s,Hi,{title:()=>O.t("leverage.maxAccountLeverage")});function Es(e,i){let[r,s]=c.useState(""),[n,o]=c.useState(!1);return c.useEffect(()=>{n||typeof i!="function"||(o(!0),i(e.address,e.decimals).then(a=>{s(a)}).catch(a=>{}).finally(()=>{o(!1)}))},[e]),{balance:r,loading:n}}var Ms=e=>{let{token:i,isActive:r,onTokenChange:s,fetchBalance:n}=e,{symbol:o,precision:a,decimals:l}=i,{balance:d,loading:m}=Es(i,n),p=typeof n=="function",x=a??2,y=()=>p?m?t.jsx(gt,{size:"sm"}):t.jsx(u.numeral,{rule:"price",dp:x,rm:N.ROUND_DOWN,className:I("oui-text-base-contrast-80 group-hover:oui-text-base-contrast-54",r&&"oui-text-base-contrast-54"),children:d}):null;return t.jsxs(h,{justify:"between",px:2,r:"base",className:I("group","oui-h-[30px] hover:oui-bg-base-5","oui-text-2xs oui-font-semibold","oui-cursor-pointer",r&&"oui-bg-base-5",e.index!==0&&"oui-mt-[2px]"),onClick:()=>{s==null||s(i)},children:[t.jsxs(h,{gapX:1,children:[t.jsx(Rr,{name:o,className:"oui-w-[16px] oui-h-[16px]"}),t.jsx(u,{className:I("oui-text-base-contrast-54 group-hover:oui-text-base-contrast-80",r&&"oui-text-base-contrast-80"),children:o})]}),y()]},o)},mt=c.forwardRef((e,i)=>{let{token:r,tokens:s=[],classNames:n,label:o,status:a,hintMessage:l,value:d,onValueChange:m,onTokenChange:p,fetchBalance:x,loading:y,placeholder:b,...g}=e,{t:j}=_(),f=c.useRef(null),[w,v]=c.useState(!1),[P,k]=c.useState(0),$=c.useMemo(()=>s.map(q=>({...q,name:q.display_name||q.symbol})),[s]);c.useEffect(()=>{var M;let q=(M=f==null?void 0:f.current)==null?void 0:M.getBoundingClientRect();k((q==null?void 0:q.width)||0)},[f]);let T=q=>{let M=s.find(W=>W.symbol===q);M&&(p==null||p(M))},A=q=>{let M=q.symbol===(r==null?void 0:r.symbol);return t.jsx(Ms,{token:q,fetchBalance:x,onTokenChange:W=>{p==null||p(W),v(!1)},isActive:M})},S=t.jsxs(X,{children:[t.jsx(X,{className:"oui-absolute oui-top-0",children:t.jsx(u,{size:"2xs",intensity:36,children:o||j("common.quantity")})}),y&&t.jsx(X,{className:"oui-absolute oui-bottom-1",children:t.jsx(gt,{size:"sm"})})]}),C=s.length>1,L=t.jsx("div",{className:"oui-absolute oui-right-0",children:t.jsx(Fr.tokens,{open:C?w:!1,onOpenChange:v,disabled:g.disabled,variant:"text",tokens:$,value:(r==null?void 0:r.display_name)||(r==null?void 0:r.symbol),size:g.size,onValueChange:T,showIcon:!0,optionRenderer:A,contentProps:{onCloseAutoFocus:q=>{var M;q.preventDefault(),(M=f.current)==null||M.focus()},onClick:q=>{var M;q.preventDefault(),(M=f.current)==null||M.focus()},style:{width:P},align:"end",sideOffset:5,className:"oui-border oui-border-line-6"}})}),R=t.jsxs(h,{mt:1,gapX:1,px:1,children:[t.jsx(X,{width:4,height:4,r:"full",className:I(a==="error"&&"oui-bg-danger-light",a==="warning"&&"oui-bg-warning-light")}),t.jsx(u,{size:"2xs",className:I(a==="error"&&"oui-text-danger-light",a==="warning"&&"oui-text-warning-light"),children:l})]}),F=b??(y?"":"0");return t.jsxs(t.Fragment,{children:[t.jsx(me,{"data-testid":e.testId,ref:f,autoComplete:"off",placeholder:F,prefix:S,suffix:L,value:d,onValueChange:q=>{var M;(M=e.onValueChange)==null||M.call(e,q)},formatters:[Q.numberFormatter,Q.dpFormatter((r==null?void 0:r.precision)??2),Q.currencyFormatter],...g,classNames:{...n,root:I("oui-h-[54px] oui-relative oui-px-3","oui-border oui-border-line oui-rounded-lg",a==="error"&&"focus-within:oui-outline-danger-light oui-outline-danger-light",a==="warning"&&"focus-within:oui-outline-warning-light oui-outline-warning-light",e.readOnly?"oui-bg-base-6 focus-within:oui-outline-0 oui-border-none":"oui-bg-base-5",n==null?void 0:n.root),input:I("oui-absolute oui-bottom-0",n==null?void 0:n.input)}}),l&&R]})}),zs=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M10.997 8.004a.5.5 0 0 0-.14-.36l-1.86-1.843-.703.703.984 1h-7.28a.5.5 0 0 0 0 1h7.28l-.984 1 .703.703 1.86-1.844a.5.5 0 0 0 .14-.36m-.5-4a.5.5 0 0 0-.5-.5H2.716l.984-1-.703-.703-1.859 1.843a.515.515 0 0 0 0 .719l1.86 1.844.702-.703-.984-1h7.281a.5.5 0 0 0 .5-.5"})}),As=e=>t.jsx("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M9.994 5.51a.83.83 0 0 0-.832.833v6.295l-2.498-2.471-1.17 1.17 3.902 3.929a.84.84 0 0 0 .599.244.84.84 0 0 0 .597-.244l3.903-3.928-1.171-1.171-2.498 2.471V6.343a.83.83 0 0 0-.832-.833"})}),Fs=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 1.744a2.333 2.333 0 0 0-2.333 2.333v5.834a2.333 2.333 0 0 0 2.333 2.333h5.833a2.333 2.333 0 0 0 2.334-2.333V4.077A2.333 2.333 0 0 0 9.91 1.744zm2.917 2.333c.322 0 .583.262.583.584v2.916h1.75L6.995 9.911 4.66 7.577h1.75V4.661c0-.322.262-.584.584-.584"})}),Rs=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 12.244a2.333 2.333 0 0 1-2.333-2.333V4.077a2.333 2.333 0 0 1 2.333-2.333h5.833a2.333 2.333 0 0 1 2.334 2.333v5.834a2.333 2.333 0 0 1-2.334 2.333zm2.917-2.333a.584.584 0 0 0 .583-.584V6.411h1.75L6.995 4.077 4.66 6.411h1.75v2.916c0 .322.262.584.584.584"})}),Us=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M6.00342 1.49561C4.97642 1.49561 3.99542 1.84011 3.20642 2.46461C2.98992 2.63561 2.95692 2.9511 3.12842 3.1676C3.29992 3.3841 3.61492 3.4171 3.83142 3.2456C4.44492 2.7601 5.20392 2.4956 6.00342 2.4956C7.93642 2.4956 9.50342 4.0626 9.50342 5.9956H8.50342L10.0034 7.9956L11.5034 5.9956H10.5034C10.5034 3.5101 8.48892 1.49561 6.00342 1.49561ZM2.00342 3.9956L0.503418 5.9956H1.50342C1.50342 8.4811 3.51792 10.4956 6.00342 10.4956C7.03092 10.4956 8.01142 10.1516 8.80042 9.52659C9.01692 9.35559 9.04992 9.0401 8.87842 8.8236C8.70692 8.6071 8.39191 8.5741 8.17542 8.7456C7.56142 9.2316 6.80342 9.4956 6.00342 9.4956C4.07042 9.4956 2.50342 7.9286 2.50342 5.9956H3.50342L2.00342 3.9956Z"})}),Ki=e=>{var g,j;let{chains:i,value:r,wrongNetwork:s,loading:n}=e,[o,a]=c.useState(!1),{t:l}=_(),d=s||(i==null?void 0:i.length)>1,m=s?t.jsx(h,{width:18,height:18,intensity:100,r:"full",justify:"center",itemAlign:"center",children:t.jsx(u,{size:"2xs",intensity:80,children:"U"})}):t.jsx(Et,{className:"oui-w-[18px] oui-h-[18px]",chainId:r==null?void 0:r.id}),p=s?"Unknown":(j=(g=r==null?void 0:r.info)==null?void 0:g.network_infos)==null?void 0:j.name,x=()=>{if(n)return t.jsx(gt,{size:"sm"});if(d)return t.jsx(zs,{className:"oui-text-base-contrast-54"})},y=t.jsxs(h,{intensity:500,className:I("oui-rounded-t-xl oui-rounded-b-sm oui-border oui-border-line",d?"oui-cursor-pointer":"oui-cursor-auto"),height:54,px:3,justify:"between",itemAlign:"center",children:[t.jsxs("div",{children:[t.jsx(h,{children:t.jsx(u,{size:"2xs",intensity:54,children:l("transfer.network")})}),t.jsxs(h,{gapX:1,children:[m,t.jsx(u,{size:"sm",intensity:80,children:p})]})]}),x()]}),b=i.map((f,w)=>{let v=f.chain_id===(r==null?void 0:r.id);return t.jsxs(h,{px:2,r:"base",justify:"between",className:I("oui-deposit-network-select-item","hover:oui-bg-base-5 oui-h-[30px] oui-cursor-pointer",v&&"oui-bg-base-5",w!==0&&"oui-mt-[2px]"),onClick:async()=>{a(!1),await e.onValueChange(f)},children:[t.jsxs(h,{gapX:1,itemAlign:"center",children:[t.jsx(Et,{className:"oui-w-[18px] oui-h-[18px]",chainId:f.chain_id}),t.jsx(u,{size:"2xs",intensity:54,children:f.name}),f.bridgeless&&t.jsx(h,{className:"oui-bg-success-light/15",height:18,px:2,r:"base",justify:"center",itemAlign:"center",children:t.jsx(u,{size:"2xs",className:"oui-text-success-light",children:l("transfer.lowestFee")})})]}),v&&t.jsx(X,{width:4,height:4,r:"full",className:"oui-deposit-network-select-active-dot oui-bg-[linear-gradient(270deg,#59B0FE_0%,#26FEFE_100%)]"})]},f.chain_id)});return t.jsxs(qi,{open:d?o:!1,onOpenChange:a,children:[t.jsx(Di,{asChild:!0,children:y}),t.jsx(Gr,{children:t.jsx(Li,{onCloseAutoFocus:f=>f.preventDefault(),align:"start",sideOffset:2,className:I("oui-deposit-token-select-dropdown-menu-content","oui-bg-base-8 oui-p-1","oui-w-[var(--radix-dropdown-menu-trigger-width)]","oui-rounded-md oui-select-none"),children:t.jsx(Ii,{children:t.jsxs("div",{className:"oui-max-h-[254px]",children:[b," "]})})})})]})},Yi=()=>t.jsxs(h,{height:40,gapX:3,children:[t.jsx(h,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"}),t.jsx(As,{className:"oui-text-primary-light"}),t.jsx(h,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"})]});function Ws(e){return e?e.replace(/^(.{6})(.*)(.{4})$/,"$1......$3"):"--"}var Bs=(e=[])=>{let i=e.reduce((r,s)=>(r[s.symbol]=s,r),{});return i.USDC||i.USDbC||e[0]},Vs=e=>e+3,Xi=()=>{let{t:e}=_(),{wallet:i,connectedChain:r}=At(),{state:s,account:n}=We(),{walletName:o,address:a}=c.useMemo(()=>{var d;let l=s.address;return r!=null&&r.id&&Yr.has(parseInt(r==null?void 0:r.id))&&(l=(d=n.getAdditionalInfo())==null?void 0:d.AGWAddress),{walletName:i==null?void 0:i.label,address:Ws(l)}},[i,s,n,r]);return t.jsxs(h,{justify:"between",children:[t.jsx(u,{size:"sm",intensity:98,children:e("transfer.web3Wallet")}),t.jsxs(h,{gapX:1,children:[t.jsx(Xr,{size:"xs",name:o??""}),t.jsx(u,{size:"sm",intensity:54,children:a})]})]})},Gi=()=>{let{t:e}=_(),{appIcons:i}=Cs(),r=Re("brokerName"),s=c.useMemo(()=>{let{secondary:n}=i||{};if(!(n!=null&&n.img)&&(n!=null&&n.component))return null;if(n!=null&&n.img)return t.jsx("img",{src:n==null?void 0:n.img,className:"oui-w-5 oui-h-5"});if(n!=null&&n.component)return t.jsx(t.Fragment,{children:n.component})},[i]);return t.jsxs(h,{justify:"between",children:[t.jsx(u,{size:"sm",intensity:98,children:e("transfer.brokerAccount",{brokerName:r})}),s]})},Ji=e=>{let{amount:i,maxQuantity:r,token:s,loading:n}=e,{t:o}=_(),a=(s==null?void 0:s.display_name)||(s==null?void 0:s.symbol)||"",l=(s==null?void 0:s.precision)??2;return t.jsxs(h,{justify:"between",px:2,children:[t.jsxs(u,{size:"2xs",intensity:36,children:["$",t.jsx(u.numeral,{dp:2,padding:!1,rm:N.ROUND_DOWN,children:i})]}),t.jsxs(h,{gapX:2,children:[t.jsxs(u,{size:"2xs",intensity:36,children:[`${o("common.available")}: `,t.jsx(u.numeral,{rm:N.ROUND_DOWN,dp:l,padding:!1,"data-testid":"oui-testid-withdraw_deposit-dialog-available-value",children:r}),` ${a}`]}),n&&t.jsx(gt,{size:"sm"}),t.jsx(u,{size:"2xs",color:"primary",className:"oui-cursor-pointer oui-select-none",onClick:e.onClick,children:o("common.max")})]})]})},Qs=e=>{let{token:i,dst:r,price:s}=e,n=(i==null?void 0:i.display_name)||(i==null?void 0:i.symbol)||"USDC";return t.jsx(h,{children:t.jsxs(u,{size:"xs",intensity:36,className:e.className,children:[t.jsx(u,{size:"xs",intensity:80,children:"1"}),` ${n} = `,s?t.jsx(u.numeral,{size:"xs",intensity:80,dp:3,padding:!1,children:s}):"-",` ${r==null?void 0:r.symbol}`]})})},Hs=e=>{let{dstGasFee:i,feeQty:r,feeAmount:s,dp:n,nativeSymbol:o}=e,{t:a}=_(),l=()=>{let m=t.jsxs("div",{className:"oui-text-2xs",children:[t.jsxs(h,{gapX:1,children:[t.jsx(u,{intensity:54,children:`${a("transfer.deposit.destinationGasFee")}: `}),t.jsx(u.numeral,{intensity:80,dp:n,rm:N.ROUND_UP,padding:!1,children:r}),t.jsx(u,{intensity:54,children:o})]}),t.jsx(X,{mt:2,children:t.jsx(u,{intensity:36,children:a("transfer.deposit.destinationGasFee.description")})})]});de.alert({title:a("common.fee"),message:m})},d=!!i&&i!=="0";return t.jsxs(u,{size:"xs",intensity:36,className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",onClick:l,children:[`${a("common.fee")} ≈ `,t.jsxs(u,{size:"xs",intensity:80,children:["$",t.jsx(u.numeral,{dp:2,padding:!1,rm:N.ROUND_UP,children:s})," "]}),d&&t.jsxs("span",{children:["(",t.jsxs(u,{intensity:54,children:[t.jsx(u.numeral,{dp:n,padding:!1,rm:N.ROUND_UP,children:r}),o]}),")"]})]})},Ks=(e=>(e[e.Deposit=0]="Deposit",e[e.Approve=1]="Approve",e[e.Increase=2]="Increase",e))(Ks||{}),Ys=e=>{let{disabled:i,loading:r,actionType:s,symbol:n="USDC",onDeposit:o,onApprove:a,networkId:l}=e,{t:d}=_(),m=c.useMemo(()=>({1:{children:d("transfer.deposit.approve.symbol",{symbol:n}),onClick:a,disabled:!1,"data-testid":"oui-testid-deposit-dialog-approve-btn"},2:{children:d("transfer.deposit.increase.symbol",{symbol:n}),onClick:a,"data-testid":"oui-testid-deposit-dialog-increase-btn"},0:{children:d("common.deposit"),onClick:o,"data-testid":"oui-testid-deposit-dialog-deposit-btn"}})[s],[a,o,s,n,d]),p={initial:"md",lg:"lg"};return t.jsx(X,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(Vi,{status:Fe.EnableTrading,networkId:l,buttonProps:{fullWidth:!0,size:p},children:t.jsx(J,{fullWidth:!0,disabled:i,loading:r,size:p,...m})})})},Xs=e=>{let{token:i,tokens:r,onTokenChange:s,amount:n,quantity:o,maxQuantity:a,onQuantityChange:l,hintMessage:d,inputStatus:m,chains:p,currentChain:x,settingChain:y,onChainChange:b,actionType:g,onDeposit:j,onApprove:f,fetchBalance:w,dst:v,wrongNetwork:P,balanceRevalidating:k,loading:$,disabled:T,networkId:A,fee:S}=e;return t.jsxs(X,{id:"oui-deposit-form",className:ct({weight:"semibold"}),children:[t.jsxs(X,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(Xi,{}),t.jsxs(X,{mt:3,mb:1,children:[t.jsx(Ki,{chains:p,value:x,onValueChange:b,wrongNetwork:P,loading:y}),t.jsx(mt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},value:o,onValueChange:l,tokens:r,token:i,onTokenChange:s,status:m,hintMessage:d,fetchBalance:w,"data-testId":"oui-testid-deposit-dialog-quantity-input"})]}),t.jsx(Ji,{token:i,amount:n,maxQuantity:a,loading:k,onClick:()=>{l(a)}}),t.jsx(Yi,{}),t.jsx(Gi,{}),t.jsx(mt,{readOnly:!0,token:v,value:o,classNames:{root:"oui-mt-3 oui-border-transparent focus-within:oui-outline-transparent"}}),t.jsxs(h,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:[t.jsx(Qs,{token:i,dst:v,price:1}),t.jsx(Hs,{...S})]})]}),t.jsx(h,{justify:"center",children:t.jsx(Ys,{actionType:g,symbol:i==null?void 0:i.symbol,disabled:T,loading:$,onDeposit:j,onApprove:f,networkId:A})})]})};function Gs(e){let{isNativeToken:i,allowance:r,quantity:s,maxQuantity:n}=e;return c.useMemo(()=>{let o=i?Number.MAX_VALUE:Number(r);if(o<=0)return 1;let a=Number(s),l=Number(n);return o<a&&a<=l?2:0},[i,r,s,n])}function Js(){let{t:e}=_(),i=Re("networkId"),[r]=xe("orderly_link_device",{}),{connectedChain:s,settingChain:n,setChain:o}=At(),[a,{findByChainId:l}]=Si(i,{pick:"network_infos",filter:p=>{var x,y;return((x=p.network_infos)==null?void 0:x.bridge_enable)||((y=p.network_infos)==null?void 0:y.bridgeless)}}),d=c.useMemo(()=>{let p=s?ki(s.id):parseInt(r==null?void 0:r.chainId);if(!p)return null;let x=l(p);return{...s,id:p,info:x}},[l,s,r]),m=c.useCallback(async p=>{var y,b;let x=l(p.chain_id);if(s)return!x||((y=x.network_infos)==null?void 0:y.chain_id)===(d==null?void 0:d.id)?Promise.resolve():o({chainId:Oi(Number((b=x.network_infos)==null?void 0:b.chain_id))}).then(g=>{g?z.success(e("connector.networkSwitched")):z.error(e("connector.switchChain.failed"))}).catch(g=>{g&&g.message&&z.error(`${e("connector.switchChain.failed")}: ${g.message}`)})},[d,o,l]);return{chains:a,currentChain:d,settingChain:n,onChainChange:m}}function Zs(e){let{quantity:i,allowance:r,approve:s,deposit:n,enableCustomDeposit:o,customDeposit:a,onSuccess:l}=e,[d,m]=c.useState(!1),p=Pi(),{t:x}=_(),y=c.useCallback(async()=>{if(!d)return m(!0),s(i).then(j=>{z.success(x("transfer.deposit.approve.success"))}).catch(j=>{z.error(j.message||j.errorCode||x("transfer.deposit.approve.failed"))}).finally(()=>{m(!1)})},[s,d,i,r,x]),b=c.useCallback(async()=>n().then(j=>{z.success(x("transfer.deposit.requested")),p.emit("deposit:requested"),l==null||l()}).catch(j=>{z.error(j.message||j.errorCode||x("transfer.deposit.failed"))}),[n,l,x]),g=c.useCallback(()=>{var f,w;let j=Number(i);if(isNaN(j)||j<=0){z.error(x("transfer.quantity.invalid"));return}d||(m(!0),(w=(f=o?a:b)==null?void 0:f())==null||w.finally(()=>{m(!1)}))},[i,d,b,o,a,x]);return{submitting:d,onApprove:y,onDeposit:g}}function en(e){let{quantity:i,maxQuantity:r}=e,{t:s}=_(),[n,o]=c.useState("default"),[a,l]=c.useState();return c.useEffect(()=>{if(!i){o("default"),l("");return}new N(i).gt(r)?(o("error"),l(s("transfer.insufficientBalance"))):(o("default"),l(""))},[i,r]),{inputStatus:n,hintMessage:a}}function tn(e){let{currentChain:i,tokensFilter:r}=e,[s,n]=c.useState(),[o,a]=c.useState([]),l=c.useCallback(d=>{var m;if(d&&((m=d==null?void 0:d.token_infos)==null?void 0:m.length)>0){let p=typeof r=="function"?r(d):d.token_infos;a(p);let x=Bs(p);if(!x)return;n(x)}},[r]);return c.useEffect(()=>{l(i==null?void 0:i.info)},[i==null?void 0:i.id,l]),{token:s,tokens:o,onTokenChange:n}}var rn=e=>{var D;let{wrongNetwork:i}=Qt(),r=Re("networkId"),{chains:s,currentChain:n,settingChain:o,onChainChange:a}=Js(),{token:l,tokens:d,onTokenChange:m}=tn({currentChain:n}),{dst:p,balance:x,allowance:y,depositFeeRevalidating:b,depositFee:g,quantity:j,setQuantity:f,approve:w,deposit:v,isNativeToken:P,balanceRevalidating:k,fetchBalance:$}=Hr({address:l==null?void 0:l.address,decimals:l==null?void 0:l.decimals,srcChainId:n==null?void 0:n.id,srcToken:l==null?void 0:l.symbol}),T=c.useMemo(()=>new N(x||0).todp((l==null?void 0:l.precision)??2,N.ROUND_DOWN).toString(),[x,l]),{inputStatus:A,hintMessage:S}=en({quantity:j,maxQuantity:T}),C=()=>{f("")},L=c.useCallback(()=>{var ee;C(),(ee=e.onClose)==null||ee.call(e)},[e.onClose]),{submitting:R,onApprove:F,onDeposit:q}=Zs({quantity:j,allowance:y,approve:w,deposit:v,onSuccess:L}),M=R||b,W=!j||Number(j)===0||!l||A==="error"||b,K=c.useMemo(()=>new N(j||0).mul(1).toNumber(),[j]),ne=Gs({isNativeToken:P,allowance:y,quantity:j,maxQuantity:T}),B=sn({nativeToken:(D=n==null?void 0:n.info)==null?void 0:D.nativeToken,depositFee:g});return c.useEffect(()=>{C()},[l,n==null?void 0:n.id]),{token:l,tokens:d,onTokenChange:m,amount:K,quantity:j,maxQuantity:T,onQuantityChange:f,hintMessage:S,inputStatus:A,chains:s,currentChain:n,settingChain:o,onChainChange:a,actionType:ne,onDeposit:q,onApprove:F,fetchBalance:$,dst:p,wrongNetwork:i,balanceRevalidating:k,loading:M,disabled:W,networkId:r,fee:B}};function sn(e){let{nativeToken:i,depositFee:r=0}=e,{account:s}=We(),n=i==null?void 0:i.symbol,{data:o}=Jr(`SPOT_${n}_USDC`);return{...c.useMemo(()=>{var d;let a=new N(r.toString()).div(new N(10).pow(((d=s.walletAdapter)==null?void 0:d.chainNamespace)===Zr.solana?9:18)).toString(),l=new N(a).mul(o||0).toString();return{dstGasFee:a,feeQty:a,feeAmount:l,dp:Vs(4)}},[r,o]),nativeSymbol:n}}var nn=e=>{let i=rn(e);return t.jsx(Xs,{...i})},on=({checkIsBridgeless:e,quantity:i,chainVaultBalance:r,currentChain:s,maxAmount:n,crossChainTrans:o})=>{let{t:a}=_(),{wrongNetwork:l}=Qt(),{state:d}=We(),m=c.useMemo(()=>{if(s&&s.info&&s.info.network_infos)return s.info.network_infos.name},[s]),p=c.useMemo(()=>!r||!n||!i||new N(i).gt(n)?!1:!!new N(i).gt(r),[i,r]),x=(()=>{if(d.status!==Fe.NotConnected){if(l||!e)return t.jsx(X,{children:m?a("transfer.withdraw.unsupported.networkName",{networkName:m}):a("transfer.withdraw.unsupported.chain")});if(o)return a("transfer.withdraw.crossChain.process");if(p)return a("transfer.withdraw.crossChain.vaultWarning",{networkName:m,chainVaultBalance:r})}})();return x?t.jsx(h,{className:"oui-text-warning-darken oui-text-xs oui-justify-center oui-text-center",mb:3,children:x}):null},an=({hasPositions:e,unsettledPnl:i,onSettlle:r})=>{let{t:s}=_();if(i===0&&!e)return t.jsx(t.Fragment,{});let n=()=>{de.confirm({title:s("settle.settlePnl"),content:t.jsx(ut,{i18nKey:"settle.settlePnl.description"}),onOk:()=>r()})};return t.jsxs(h,{justify:"between",className:"oui-text-2xs oui-text-base-contrast-36 oui-mt-1 oui-mx-2",children:[t.jsxs(h,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(ye,{className:"oui-max-w-[274px]",content:s("settle.unsettled.tooltip"),children:t.jsxs(h,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(Kr,{size:14,className:"oui-text-warning-darken"}),t.jsx(u,{className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",children:`${s("settle.unsettled")}:`})]})}),t.jsx(u.numeral,{showIdentifier:!0,coloring:!0,weight:"semibold",dp:6,"data-testid":"oui-testid-withdraw-dialog-unsettledPnl-value",children:i}),t.jsx(u,{children:"USDC"})]}),t.jsxs(h,{itemAlign:"center",gap:1,className:"oui-cursor-pointer",children:[t.jsx(Us,{className:"oui-text-primary"}),t.jsx(u,{"data-testid":"oui-testid-withdraw-dialog-settle-text",size:"2xs",color:"primary",className:" oui-select-none",onClick:n,children:s("common.settle")})]})]})},ln=({address:e,amount:i,currentChain:r})=>{let{t:s}=_(),n=c.useMemo(()=>{if(r&&r.info&&r.info.network_infos)return r.info.network_infos.name},[r]);return t.jsxs(h,{direction:"column",itemAlign:"start",justify:"start",className:"oui-gap-1 lg:oui-gap-3",children:[t.jsxs(h,{direction:"column",itemAlign:"start",mb:5,className:"oui-gap-3 lg:oui-gap-4",children:[t.jsxs(h,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(u,{size:"2xs",intensity:36,children:s("transfer.withdraw.crossChain.recipientAddress")}),t.jsx(u,{size:"sm",intensity:98,className:"oui-break-all",children:e})]}),t.jsxs(h,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(u,{size:"2xs",intensity:36,children:s("transfer.withdraw.crossChain.recipientNetwork")}),t.jsxs(h,{gap:1,children:[t.jsx(Et,{className:"oui-h-[18px] oui-w-[18px]",size:"sm",chainId:r.id}),t.jsx(u,{size:"sm",intensity:98,children:n})]})]}),t.jsxs(h,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(u,{size:"2xs",intensity:36,children:`${s("transfer.withdraw.crossChain.withdrawAmount")} (USDC)`}),t.jsx(u.numeral,{size:"sm",intensity:98,dp:2,children:i})]})]}),t.jsx(h,{justify:"center",className:"oui-text-warning-darken oui-text-2xs lg:oui-text-xs oui-text-center",mb:3,children:s("transfer.withdraw.crossChain.warning")})]})};function dn(e){let{t:i}=_(),r=()=>{de.show(Ps,{networkId:e.networkId,bridgeLessOnly:!0}).then(s=>{z.success(i("connector.networkSwitched"))},s=>{})};return t.jsx(h,{direction:"column",children:t.jsx(J,{color:"warning",size:e.size,fullWidth:!0,onClick:()=>{r()},children:i("connector.switchNetwork")})})}var un=e=>{let{disabled:i,loading:r,onWithdraw:s,networkId:n,crossChainWithdraw:o,address:a,currentChain:l,quantity:d,fee:m,checkIsBridgeless:p}=e,{t:x}=_(),y=c.useMemo(()=>d?new N(d).minus(m??0).toNumber():0,[d,m]),b=()=>{if(o){de.confirm({title:x("transfer.withdraw.crossChain.confirmWithdraw"),content:t.jsx(ln,{address:a,amount:y,currentChain:l}),classNames:{content:"oui-font-semibold",body:"!oui-pb-0",footer:"!oui-pt-0"},onOk:async()=>{s()}});return}s()},g={initial:"md",lg:"lg"};return t.jsx(X,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(Vi,{status:Fe.EnableTrading,networkId:n,bridgeLessOnly:!0,buttonProps:{fullWidth:!0,size:g},children:p?t.jsx(J,{"data-testid":"oui-testid-withdraw-dialog-withdraw-btn",fullWidth:!0,disabled:i,loading:r,onClick:b,size:g,children:x("common.withdraw")}):t.jsx(dn,{networkId:n,size:g})})})},cn=({address:e,loading:i,disabled:r,quantity:s,onQuantityChange:n,token:o,inputStatus:a,hintMessage:l,amount:d,maxQuantity:m,balanceRevalidating:p,chains:x,currentChain:y,onChainChange:b,fee:g,settingChain:j,wrongNetwork:f,hasPositions:w,unsettledPnL:v,onSettlePnl:P,onWithdraw:k,chainVaultBalance:$,crossChainWithdraw:T,crossChainTrans:A,showQty:S,networkId:C,checkIsBridgeless:L})=>{let{t:R}=_();return t.jsxs(X,{id:"oui-withdraw-form",className:ct({weight:"semibold"}),children:[t.jsxs(X,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(Gi,{}),t.jsx(X,{mt:3,mb:1,children:t.jsx(mt,{value:s,onValueChange:n,token:o,onTokenChange:()=>{},status:a,hintMessage:l,testId:"oui-testid-withdraw-dialog-quantity-input"})}),t.jsx(Ji,{token:o,amount:d,maxQuantity:m.toString(),loading:p,onClick:()=>{n(m.toString())}}),t.jsx(an,{unsettledPnl:v,hasPositions:w,onSettlle:P}),t.jsx(Yi,{}),t.jsx(Xi,{}),t.jsxs(X,{mt:3,children:[t.jsx(Ki,{chains:x,value:y,onValueChange:b,wrongNetwork:f,loading:j}),t.jsx(mt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},token:o,value:S,readOnly:!0})]}),t.jsx(h,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:t.jsxs(u,{size:"xs",intensity:36,children:[`${R("common.fee")} ≈ `,t.jsx(u,{size:"xs",intensity:80,children:`${g} `}),t.jsx(u,{children:"USDC"})]})})]}),t.jsx(on,{checkIsBridgeless:L,chainVaultBalance:$,currentChain:y,quantity:s,maxAmount:m,crossChainTrans:A}),t.jsx(h,{justify:"center",children:t.jsx(un,{checkIsBridgeless:L,networkId:C,disabled:r,loading:i,onWithdraw:k,crossChainWithdraw:T,currentChain:y,address:e,quantity:s,fee:g})})]})},li=1,mn=({onClose:e})=>{let{t:i}=_(),[r]=Ni(),[s,n]=c.useState(!1),[o,a]=c.useState(!1),{data:l}=Ci("/v1/asset/history",{revalidateOnMount:!0}),d=Re("networkId"),m=Pi(),[p,x]=c.useState(""),[y,b]=c.useState({symbol:"USDC",decimals:6,address:"",display_name:"",precision:6}),[g,j]=c.useState("default"),[f,w]=c.useState(),{wrongNetwork:v}=Qt(),{account:P}=We(),[k]=xe("orderly_link_device",{}),{data:$}=ni("/v1/public/vault_balance",{revalidateOnMount:!0}),{connectedChain:T,wallet:A,setChain:S,settingChain:C}=At();Re();let{walletName:L,address:R}=c.useMemo(()=>{var E;return{walletName:A==null?void 0:A.label,address:(E=A==null?void 0:A.accounts)==null?void 0:E[0].address}},[A]),F=E=>{x(E)},q=c.useMemo(()=>new N(p||0).mul(li).toNumber(),[p,li]),{dst:M,withdraw:W,maxAmount:K,unsettledPnL:ne}=Br(),[B,D]=c.useState(!0),[ee,{findByChainId:re}]=Si(d,{pick:"network_infos",filter:E=>{var ae,Ne;return((ae=E.network_infos)==null?void 0:ae.bridge_enable)||((Ne=E.network_infos)==null?void 0:Ne.bridgeless)}}),he=c.useMemo(()=>d==="mainnet"?ee.filter(E=>E.bridgeless):ee,[ee,d]),{configStore:nt}=c.useContext(Vr),Ct=nt.get("apiBaseUrl"),{data:qe}=ni(`${Ct}/v1/public/token?t=withdraw`,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateOnMount:!0,dedupingInterval:36e5,formatter:E=>{if(E.rows.length===1)return E.rows[0].chain_details}}),te=c.useMemo(()=>{let E=T?ki(T.id):parseInt(k==null?void 0:k.chainId);if(!E)return null;let ae=re(E);return{...T,id:E,info:ae}},[re,T,k]),Pt=c.useMemo(()=>v||!te?!1:d==="testnet"?!0:!(!te.info||!te.info.network_infos||!te.info.network_infos.bridgeless),[te,v]),St=()=>{x("")},Ke=c.useCallback(async E=>{var Ne,ri;let ae=re(E.chain_id);return!ae||((Ne=ae.network_infos)==null?void 0:Ne.chain_id)===(te==null?void 0:te.id)?Promise.resolve():S==null?void 0:S({chainId:Oi(Number((ri=ae.network_infos)==null?void 0:ri.chain_id))}).then(Ot=>{Ot?(z.success(i("connector.networkSwitched")),St()):z.error(i("connector.switchChain.failed"))}).catch(Ot=>{z.error(`${i("connector.switchChain.failed")}: ${Ot.message}`)})},[te,S,re,i]),De=c.useMemo(()=>{var E;return((E=r==null?void 0:r.rows)==null?void 0:E.length)>0},[r]),Le=async()=>P.settle().catch(E=>(E.code==-1104&&z.error(i("settle.settlement.error")),E.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1&&m.emit("wallet:sign-message-with-ledger-error",{message:E.message,userAddress:P.address}),E.message.indexOf("user rejected")!==-1&&z.error(i("transfer.rejectTransaction")),Promise.reject(E))).then(E=>(z.success(i("settle.settlement.requested")),Promise.resolve(E))),ot=c.useMemo(()=>{if(!$||!te)return null;let E=$.find(ae=>parseInt(ae.chain_id)===(te==null?void 0:te.id));return E?E.balance:null},[he,te,$]),at=c.useMemo(()=>{if(ot!==null){let E=parseFloat(p);return E>ot&&E<=K}return!1},[p,K,ot]),ii=c.useMemo(()=>he.minimum_withdraw_amount??1,[he]),Tr=async()=>{if(!o&&g==="default"){if(new N(p).lt(ii)){z.error(i("transfer.withdraw.minAmount.error",{minAmount:ii}));return}return a(!0),W({amount:p,token:"USDC",chainId:te==null?void 0:te.id,allowCrossChainWithdraw:at}).then(E=>{z.success(i("transfer.withdraw.requested")),m.emit("withdraw:requested"),e&&e(),x("")}).catch(E=>{if(E.message.indexOf("user rejected")!==-1){z.error(i("transfer.rejectTransaction"));return}if(E.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1){m.emit("wallet:sign-message-with-ledger-error",{message:E.message,userAddress:P.address});return}z.error(E.message)}).finally(()=>{a(!1)})}},kt=c.useMemo(()=>{if(!te)return 0;let E=qe==null?void 0:qe.find(ae=>parseInt(ae.chain_id)===te.id);return E?at?(E.withdrawal_fee||0)+(E.cross_chain_withdrawal_fee||0):E.withdrawal_fee||0:0},[te,qe,he,at]),$r=c.useMemo(()=>{if(!p)return"";let E=new N(p).sub(kt??0);return E.isNegative()?"":E.toNumber()},[kt,p]);return c.useEffect(()=>{if(s&&D(!0),!p){j("default"),w(""),D(!0);return}let E=new N(p??0);ne<0?E.gt(K)?(j("error"),w(i("transfer.insufficientBalance")),D(!0)):(j("default"),w(""),D(!1)):E.gt(K)?(j("error"),w(i("transfer.insufficientBalance")),D(!0)):E.gt(new N(K).minus(ne))&&E.lessThanOrEqualTo(K)?(j("warning"),w(i("settle.settlePnl.warning")),D(!0)):(j("default"),w(""),D(!1))},[p,K,ne,s]),c.useEffect(()=>{let E=l==null?void 0:l.find(ae=>ae.trans_status==="pending_rebalance".toUpperCase());n(!!E)},[l]),Qr({onMessage(E){if(!s)return;let{trxId:ae,transStatus:Ne}=E;ae===s&&Ne==="COMPLETED"&&n(!1)}}),{walletName:L,address:R,quantity:p,onQuantityChange:F,token:y,inputStatus:g,hintMessage:f,dst:M,amount:q,balanceRevalidating:!1,maxQuantity:K,disabled:B,loading:o,hasPositions:De,unsettledPnL:ne,wrongNetwork:v,settingChain:C,chains:he,currentChain:te,onChainChange:Ke,onSettlePnl:Le,onWithdraw:Tr,chainVaultBalance:ot,fee:kt,crossChainWithdraw:at,crossChainTrans:s,showQty:$r,networkId:d,checkIsBridgeless:Pt}},pn=e=>{let i=mn({onClose:e.close});return t.jsx(cn,{...i})},hn=e=>t.jsx(Ur,{position:Wr.DepositForm,defaultWidget:nn,...e}),xn="DepositAndWithdrawWithDialogId",gn="DepositAndWithdrawWithSheetId",Zi=e=>{let[i,r]=c.useState(e.activeTab||"deposit"),{t:s}=_();return t.jsxs(vi,{value:i,onValueChange:r,variant:"contained",size:"lg",classNames:{tabsList:"oui-px-0",tabsContent:"oui-pt-5"},children:[t.jsx(we,{title:s("common.deposit"),icon:t.jsx(Fs,{}),value:"deposit",children:t.jsx(hn,{onClose:e.close})}),t.jsx(we,{title:s("common.withdraw"),icon:t.jsx(Rs,{}),value:"withdraw",children:t.jsx(pn,{...e})})]})};xt(xn,Zi,{size:"md",classNames:{content:"oui-border oui-border-line-6"}});zt(gn,Zi);var er=e=>{let{pnl:i,hide:r}=e,s=i==null?void 0:i.entity,n=je(),{getFirstRefCode:o}=Ft(),a=c.useMemo(()=>{var p;let m=(p=o())==null?void 0:p.code;return{code:(i==null?void 0:i.refCode)??m,slogan:i==null?void 0:i.refSlogan,link:i==null?void 0:i.refLink}},[o,i]),l=c.useMemo(()=>{if(s)return n[s==null?void 0:s.symbol]("base_dp")},[s,n]),d=c.useMemo(()=>{if(s)return n[s==null?void 0:s.symbol]("quote_dp")},[s,n]);return{entity:s,leverage:i==null?void 0:i.leverage,baseDp:l,quoteDp:d,referralInfo:a,shareOptions:i,hide:r}};function tr(e,i,r,s,n,o,a,l,d){let{t:m}=_(),{symbol:p,currency:x}=fn(e.symbol),y={symbol:p,currency:x,side:e.side};switch(n){case"pnl":{e.pnl!=null&&(y.pnl=new N(e.pnl).toFixed(2,N.ROUND_DOWN));break}case"roi":{e.roi!=null&&(y.ROI=new N(e.roi).toFixed(2,N.ROUND_DOWN));break}case"roi_pnl":{e.pnl!=null&&(y.pnl=new N(e.pnl).toFixed(2,N.ROUND_DOWN)),e.roi!=null&&(y.ROI=new N(e.roi).toFixed(2,N.ROUND_DOWN));break}}let b=[];o.has("leverage")&&(y.leverage=i),["openPrice","closePrice","openTime","closeTime","markPrice","quantity"].forEach(j=>{if(o.has(j))switch(j){case"leverage":break;case"openPrice":{e.openPrice!=null&&b.push({title:m("share.pnl.optionalInfo.openPrice"),value:lt(e.openPrice,l||2)});break}case"closePrice":{e.closePrice!=null&&b.push({title:m("share.pnl.optionalInfo.closePrice"),value:lt(e.closePrice,l||2)});break}case"openTime":{e.openTime!=null&&b.push({title:m("share.pnl.optionalInfo.openTime"),value:di(e.openTime)});break}case"closeTime":{e.closeTime!=null&&b.push({title:m("share.pnl.optionalInfo.closeTime"),value:di(e.closeTime)});break}case"markPrice":{e.markPrice!=null&&b.push({title:m("common.markPrice"),value:lt(e.markPrice,l||2)});break}case"quantity":e.quantity!=null&&b.push({title:m("common.quantity"),value:lt(e.quantity,a||2)})}}),y.informations=b;let g={position:y,updateTime:yn(new Date),domain:s};return r.length>0&&(g.message=r),typeof d<"u"&&d.code!==void 0&&(g.referral=d),g}function fn(e){let i=e.split("_");if(i.length!==3)return{symbol:e,currency:"USDC"};let[r,s,n]=i;return{symbol:`${s}-${r}`,currency:n||"USDC"}}function yn(e){var m,p,x,y,b;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},s=new Intl.DateTimeFormat("en-US",r).formatToParts(i),n=(m=s.find(g=>g.type==="year"?g.value:""))==null?void 0:m.value,o=(p=s.find(g=>g.type==="month"?g.value:""))==null?void 0:p.value,a=(x=s.find(g=>g.type==="day"?g.value:""))==null?void 0:x.value,l=(y=s.find(g=>g.type==="hour"?g.value:""))==null?void 0:y.value,d=(b=s.find(g=>g.type==="minute"?g.value:""))==null?void 0:b.value;return`${n}-${o}-${a} ${l}:${d}`}function di(e){var d,m,p,x;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},s=new Intl.DateTimeFormat("en-US",r).formatToParts(i),n=(d=s.find(y=>y.type==="month"?y.value:""))==null?void 0:d.value,o=(m=s.find(y=>y.type==="day"?y.value:""))==null?void 0:m.value,a=(p=s.find(y=>y.type==="hour"?y.value:""))==null?void 0:p.value,l=(x=s.find(y=>y.type==="minute"?y.value:""))==null?void 0:x.value;return`${n}-${o} ${a}:${l}`}function lt(e,i){return new N(e).toFixed(i,N.ROUND_DOWN)}function ir(e,i,r,s){localStorage.setItem("pnl_config_key",JSON.stringify({bgIndex:r,pnlFormat:e,options:Array.from(i),message:s}))}function rr(){let e=localStorage.getItem("pnl_config_key");if(e&&e.length>0)try{return JSON.parse(e)}catch{}return{bgIndex:0,pnlFormat:"roi_pnl",options:["openPrice","closePrice","openTime","closeTime","markPrice","quantity","leverage"],message:""}}var sr=c.forwardRef((e,i)=>{let{width:r,height:s,className:n,data:o,style:a}=e,{ref:l,download:d,toDataURL:m,copy:p,toBlob:x}=es(o,{ratio:e.ratio});return c.useImperativeHandle(i,()=>({download:d,toDataURL:m,toBlob:x,copy:p})),t.jsx("canvas",{ref:l,width:r,height:s,className:n,style:a})}),bn=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M11.186 5.348a.67.67 0 0 0-.436.27l-2.657 4a.69.69 0 0 0 0 .75l2.657 4a.68.68 0 0 0 .934.188.685.685 0 0 0 .187-.937L9.463 9.993 11.87 6.37a.685.685 0 0 0-.187-.938.65.65 0 0 0-.498-.083",fill:"#fff",fillOpacity:".54"})]})})},jn=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M8.777 5.348a.65.65 0 0 0-.498.083.685.685 0 0 0-.187.938L10.5 9.993 8.092 13.62a.685.685 0 0 0 .187.937.68.68 0 0 0 .934-.187l2.657-4a.69.69 0 0 0 0-.75l-2.657-4a.67.67 0 0 0-.436-.271",fill:"#fff",fillOpacity:".54"})]})})},_n=e=>{let{backgroundImages:i,selectedSnap:r,setSelectedSnap:s}=e,[n,o]=Qi({containScroll:"keepSnaps",dragFree:!0}),a=c.useCallback(()=>{o&&(o!=null&&o.canScrollPrev()?o.scrollPrev():r-1>=0&&s(r-1))},[o,r]),l=c.useCallback(()=>{o&&(o!=null&&o.canScrollNext()?o.scrollNext():r+1<i.length&&s(r+1))},[o,r]),d=c.useCallback(m=>{s(m.selectedScrollSnap())},[]);return c.useEffect(()=>{o&&(d(o),o.on("reInit",d),o.on("select",d),o==null||o.scrollTo(r))},[o,d]),t.jsxs(h,{mt:4,px:2,children:[t.jsx(bn,{onClick:a}),t.jsx("div",{ref:n,className:"oui-w-full oui-overflow oui-overflow-x-auto oui-scrollbar-hidden oui-hide-scrollbar oui-mx-0",children:t.jsx(h,{children:i.map((m,p)=>t.jsx(X,{onClick:()=>{o!=null&&o.canScrollPrev()||o!=null&&o.canScrollNext()?o==null||o.scrollTo(p):s(p)},mx:2,my:1,mr:6,r:"base",className:I("oui-shrink-0 oui-w-[162px]",r===p&&"oui-outline oui-outline-1 oui-outline-primary-darken"),children:t.jsx("img",{src:m,className:"oui-rounded-sm"})},m))})}),t.jsx(jn,{onClick:l})]})},wn=e=>{let{type:i,curType:r,setPnlFormat:s}=e,{t:n}=_(),o=c.useMemo(()=>{switch(i){case"roi_pnl":return n("share.pnl.displayFormat.roi&Pnl");case"roi":return n("share.pnl.displayFormat.roi");case"pnl":return n("share.pnl.displayFormat.pnl")}},[i,n]),a=i===r,l="oui-flex oui-items-center oui-gap-1 oui-cursor-pointer";return a?l+=" oui-text-base-contrast":l+="",t.jsxs("div",{className:l,onClick:()=>{s(i)},children:[t.jsx(vn,{sel:a}),t.jsx(u,{size:"xs",intensity:54,className:I("oui-ml-2 "),children:o})]})},vn=e=>t.jsx("button",{type:"button",children:e.sel===!0?t.jsx(Nn,{}):t.jsx(Cn,{})}),Nn=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-primary-darken",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),Cn=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),nr=e=>{let{size:i=16,className:r}=e;return t.jsx("button",{type:"button",onClick:s=>{e.onCheckedChange(!e.checked)},className:r,children:e.checked?t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm6.664 2.922a.8.8 0 0 1 .557-.208c.2 0 .406.063.558.208a.734.734 0 0 1 0 1.063l-5.434 5.179a.826.826 0 0 1-1.115 0l-2.33-2.22a.736.736 0 0 1 0-1.063.827.827 0 0 1 1.117 0l1.77 1.687z",fill:"#fff",fillOpacity:".8"})}):t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm0 1.334h6.667c.737 0 1.334.596 1.334 1.333v6.667c0 .736-.597 1.333-1.334 1.333H4.661a1.333 1.333 0 0 1-1.334-1.333V4.62c0-.737.597-1.333 1.334-1.333",fill:"#fff",fillOpacity:".8"})})})},Pn=e=>{let{type:i,curType:r,setShareOption:s}=e,{t:n}=_(),o=c.useMemo(()=>{switch(i){case"openPrice":return n("share.pnl.optionalInfo.openPrice");case"closePrice":return n("share.pnl.optionalInfo.closePrice");case"openTime":return n("share.pnl.optionalInfo.openTime");case"closeTime":return n("share.pnl.optionalInfo.closeTime");case"markPrice":return n("common.markPrice");case"quantity":return n("common.quantity");case"leverage":return n("common.leverage")}},[i,n]),a=r.has(i);return t.jsxs(h,{itemAlign:"center",gap:1,className:I("hover:oui-cursor-pointer"),onClick:()=>{s(l=>{let d=new Set(l);return a?d.delete(i):d.add(i),d})},children:[t.jsx(nr,{size:16,checked:a,className:"oui-pt-[2px]",onCheckedChange:l=>{s(d=>{let m=new Set(d);return a?m.delete(i):m.add(i),m})}}),t.jsx(u,{size:"xs",intensity:54,children:o})]})},Sn=e=>{let{message:i,setMessage:r,check:s,setCheck:n}=e,[o,a]=c.useState(!1),l=c.useRef(null),{t:d}=_();return t.jsxs("div",{className:"oui-mt-3 oui-mb-6 oui-flex oui-items-center",children:[t.jsx(nr,{className:"oui-mt-[2px]",checked:s,onCheckedChange:m=>{n(m)}}),t.jsx("div",{className:"oui-text-xs oui-text-base-contrast-54 oui-ml-1 hover:oui-cursor-pointer",onClick:()=>{n(!e.check)},children:d("share.pnl.optionalInfo.message")}),t.jsx("div",{className:"oui-bg-base-900 oui-mx-2 oui-rounded-sm",children:t.jsx(me,{ref:l,placeholder:d("share.pnl.optionalInfo.message.placeholder"),classNames:{root:"oui-w-[320px]"},size:"sm",value:i,autoFocus:!1,suffix:o&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:m=>{r(""),setTimeout(()=>{var p;(p=l.current)==null||p.focus()},50),m.stopPropagation()},children:t.jsx(Ti,{size:18,color:"white"})}),onFocus:()=>a(!0),onBlur:()=>a(!1),onChange:m=>{if(m.target.value.length>25){z.error(d("share.pnl.optionalInfo.message.maxLength"));return}n(m.target.value.length>0),r(m.target.value)}})})]})},kn=e=>{let{onClickDownload:i,onClickCopy:r}=e,{t:s}=_();return t.jsxs(h,{px:8,gap:3,mt:3,itemAlign:"center",children:[t.jsxs(J,{color:"secondary",className:"oui-flex-1 oui-flex oui-gap-1",onClick:i,children:[t.jsx("span",{children:t.jsx(On,{})}),s("common.download")]}),t.jsxs(J,{className:"oui-flex-1 oui-flex oui-gap-1",onClick:r,children:[t.jsx("span",{children:t.jsx(qn,{})}),s("common.copy")]})]})},On=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.994A2.667 2.667 0 0 0 1.995 4.66v6.666a2.667 2.667 0 0 0 2.667 2.667h6.666a2.667 2.667 0 0 0 2.667-2.667V4.661a2.667 2.667 0 0 0-2.667-2.667zM7.995 4.66c.368 0 .667.298.667.666V8.66h2l-2.667 2.666L5.328 8.66h2V5.327c0-.368.299-.667.667-.667",fill:"#fff",fillOpacity:".98"})}),qn=()=>t.jsx("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5.166 1.994A2.667 2.667 0 0 0 2.499 4.66v4a2.667 2.667 0 0 0 2.667 2.667 2.667 2.667 0 0 0 2.666 2.667h4a2.667 2.667 0 0 0 2.667-2.667v-4a2.667 2.667 0 0 0-2.667-2.667 2.667 2.667 0 0 0-2.666-2.666zm6.666 4c.737 0 1.334.596 1.334 1.333v4c0 .737-.597 1.334-1.334 1.334h-4A1.333 1.333 0 0 1 6.5 11.327h2.667a2.667 2.667 0 0 0 2.666-2.667z",fill:"#fff",fillOpacity:".98"})}),Dn=e=>{let{shareOptions:i}=e,{t:r}=_(),s=rr(),n=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=c.useState(n.length==1?n[0]:s.pnlFormat),[l,d]=c.useState(new Set(s.options)),[m,p]=c.useState(s.bgIndex),[x,y]=c.useState(s.message),[b,g]=c.useState(!1),{backgroundImages:j,...f}=i??{backgroundImages:[]},[w,v]=c.useState(""),P=c.useRef(null);c.useEffect(()=>{let C=window.location.hostname;v(C)},[]);let k=c.useMemo(()=>{var C;return(C=i==null?void 0:i.backgroundImages)==null?void 0:C[m]},[i==null?void 0:i.backgroundImages,m]),$=tr(e.entity,e.leverage,b?x:"",w,o,l,e.baseDp,e.quoteDp,e.referral),T=()=>{var C;(C=P.current)==null||C.copy().then(()=>{var L;(L=e.hide)==null||L.call(e),z.success(r("share.pnl.image.copied"))}).catch(L=>{z.error(()=>t.jsxs("div",{children:[t.jsx("div",{children:r("common.copy.failed")}),t.jsx("div",{className:"oui-text-2xs oui-max-w-[396px] oui-mt-2 oui-text-base-contrast-54",children:r("share.pnl.copy.failed.description")})]}))})},A=()=>{var C,L;(C=P.current)==null||C.download("Poster.png"),(L=e.hide)==null||L.call(e)},S=[...e.entity.openPrice?["openPrice"]:[],...e.entity.closePrice?["closePrice"]:[],...e.entity.markPrice?["markPrice"]:[],...e.entity.openTime?["openTime"]:[],...e.entity.closeTime?["closeTime"]:[],...e.leverage?["leverage"]:[],...e.entity.quantity?["quantity"]:[]];return ir(o,l,m,x),t.jsxs("div",{className:"oui-h-full oui-flex oui-flex-col oui-relative oui-w-full",children:[t.jsxs("div",{className:"oui-flex-1 oui-h-full oui-overflow-y-auto",children:[t.jsxs(X,{mt:9,height:422,children:[t.jsx(h,{itemAlign:"center",justify:"center",children:t.jsx(sr,{width:552,height:310,data:{backgroundImg:k,...f,data:$},ratio:3,ref:P})}),t.jsx(_n,{backgroundImages:(i==null?void 0:i.backgroundImages)??[],selectedSnap:m,setSelectedSnap:p})]}),t.jsxs(h,{direction:"column",px:10,mt:6,justify:"start",itemAlign:"start",width:"100%",children:[t.jsx(u,{size:"sm",intensity:80,children:r("share.pnl.displayFormat")}),t.jsx(h,{pt:3,gap:3,itemAlign:"center",children:n.map((C,L)=>t.jsx(wn,{setPnlFormat:a,type:C,curType:o},L))}),t.jsx(ge,{className:"oui-w-full oui-pt-6 oui-border-white/10"}),t.jsxs(h,{mt:6,direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(u,{size:"sm",intensity:80,children:r("share.pnl.optionalInfo")}),t.jsx(h,{mt:3,gap:4,className:"oui-flex-wrap",children:S.map((C,L)=>t.jsx(Pn,{setShareOption:d,type:C,curType:l},L))})]}),t.jsx(Sn,{message:x,setMessage:y,check:b,setCheck:g})]})]}),t.jsx(kn,{onClickCopy:T,onClickDownload:A})]})},or=se.createContext(null);function Ve(){let e=se.useContext(or);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}var ar=se.forwardRef(({orientation:e="horizontal",opts:i,setApi:r,plugins:s,className:n,children:o,...a},l)=>{let[d,m]=Qi({...i,axis:e==="horizontal"?"x":"y"},s),[p,x]=se.useState(!1),[y,b]=se.useState(!1),[g,j]=se.useState(a.initIndex||0),[f,w]=se.useState([]),v=se.useCallback(T=>{T&&(f.length===0&&w(T.scrollSnapList()),j(T.selectedScrollSnap()),x(T.canScrollPrev()),b(T.canScrollNext()))},[f]),P=se.useCallback(()=>{m==null||m.scrollPrev()},[m]),k=se.useCallback(()=>{m==null||m.scrollNext()},[m]),$=se.useCallback(T=>{T.key==="ArrowLeft"?(T.preventDefault(),P()):T.key==="ArrowRight"&&(T.preventDefault(),k())},[P,k]);return se.useEffect(()=>{!m||!r||r(m)},[m,r]),se.useEffect(()=>{if(m)return v(m),m.on("reInit",v),m.on("select",v),a.initIndex&&m.scrollTo(a.initIndex),()=>{m==null||m.off("select",v)}},[m,v]),t.jsx(or.Provider,{value:{carouselRef:d,api:m,opts:i,orientation:e||((i==null?void 0:i.axis)==="y"?"vertical":"horizontal"),scrollPrev:P,scrollNext:k,canScrollPrev:p,canScrollNext:y,selectedIndex:g,scrollSnaps:f},children:t.jsx("div",{ref:l,onKeyDownCapture:$,className:I("oui-relative",n),role:"region","aria-roledescription":"carousel",...a,children:o})})});ar.displayName="Carousel";var Kt=se.forwardRef(({className:e,...i},r)=>{let{carouselRef:s,orientation:n}=Ve();return t.jsx("div",{ref:s,className:"oui-overflow-hidden",children:t.jsx("div",{ref:r,className:I("oui-flex",n==="horizontal"?"oui--ml-4":"oui--mt-4 oui-flex-col",e),...i})})});Kt.displayName="CarouselContent";var Yt=se.forwardRef(({className:e,...i},r)=>{let{orientation:s}=Ve();return t.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:I("oui-min-w-0 oui-shrink-0 oui-grow-0 oui-basis-full",s==="horizontal"?"oui-pl-4":"oui-pt-4",e),...i})});Yt.displayName="CarouselItem";var lr=se.forwardRef(({className:e,variant:i="contained",size:r="icon",...s},n)=>{let{orientation:o,scrollPrev:a,canScrollPrev:l}=Ve();return t.jsxs(J,{ref:n,variant:i,className:I("oui-absolute  oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--left-12 oui-top-1/2 oui--translate-y-1/2":"oui--top-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...s,children:[t.jsx(ChevronLeft,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Previous slide"})]})});lr.displayName="CarouselPrevious";var dr=se.forwardRef(({className:e,variant:i="contained",size:r="icon",...s},n)=>{let{orientation:o,scrollNext:a,canScrollNext:l}=Ve();return t.jsxs(J,{ref:n,variant:i,className:I("oui-absolute oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--right-12 oui-top-1/2 oui--translate-y-1/2":"oui--bottom-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...s,children:[t.jsx(ChevronRight,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Next slide"})]})});dr.displayName="CarouselNext";var ur=e=>{let{scrollSnaps:i,selectedIndex:r}=Ve();return t.jsx("div",{className:I("oui-flex oui-gap-1",e.className),children:i.map((s,n)=>t.jsx(cr,{index:n,active:n===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},n))})};ur.displayName="CarouselIdentifier";var cr=({index:e,active:i,onClick:r,className:s,activeClassName:n})=>t.jsx("button",{onClick:()=>r==null?void 0:r(e),className:I("oui-w-2 oui-h-2 oui-rounded-full oui-bg-white/30",s,i&&`active ${n||"oui-bg-primary-darken"}`)}),Qe=ar;Qe.Content=Kt;Qe.Item=Yt;Qe.Next=dr;Qe.Previous=lr;Qe.indentify=ur;var Ln=e=>{var q,M;let{shareOptions:i}=e,{t:r}=_(),s=rr(),n=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=c.useState(n.length==1?n[0]:s.pnlFormat),[l,d]=c.useState(new Set(s.options)),[m,p]=c.useState(s.message),[x,y]=c.useState(s.bgIndex),{backgroundImages:b,...g}=i??{backgroundImages:[]},[j,f]=c.useState(""),w=(q=i==null?void 0:i.backgroundImages)==null?void 0:q.map(()=>c.useRef(null));c.useEffect(()=>{let W=window.location.hostname;f(W)},[]);let v=tr(e.entity,e.leverage,m,j,o,l,e.baseDp,e.quoteDp,e.referral),P=c.useRef(),k=552/310,[$,T]=c.useState(1),[A,S]=c.useState(0),[C,L]=c.useState(!1),R=c.useRef(null);c.useEffect(()=>{if(P.current){let W=P.current.offsetWidth,K=W/k;S(K),T(W/552)}},[P,j]);let F=async W=>{var B,D;if(!W.current)return;let K=(B=W.current)==null?void 0:B.toDataURL(),ne=Tn(K);try{navigator.share&&await navigator.share({text:m,files:[new File([ne],"image.png",{type:"image/png"})]}),(D=e.hide)==null||D.call(e)}catch{}};return ir(o,l,x,m),t.jsxs("div",{className:"oui-w-full",children:[t.jsx("div",{ref:P,className:"oui-w-full oui-mt-4 oui-overflow-hidden",style:{height:`${A+20}px`},children:t.jsxs(Qe,{className:"oui-w-full oui-overflow-hidden",opts:{align:"start"},initIndex:x,children:[t.jsx(Kt,{style:{height:`${A}px`},children:(M=i==null?void 0:i.backgroundImages)==null?void 0:M.map((W,K)=>t.jsx(Yt,{children:t.jsx(sr,{className:"oui-transform oui-origin-top-left",style:{scale:`${$}`},width:552,height:310,data:{backgroundImg:W,...g,data:v},ratio:3,ref:w==null?void 0:w[K]})},K))}),t.jsx("div",{className:"oui-mt-2 oui-mb-1 oui-flex oui-justify-center",children:t.jsx($n,{dotClassName:"oui-w-[16px] oui-h-[4px] oui-bg-base-300",dotActiveClassName:"!oui-bg-primary-darken oui-w-[20px]",setSelectIndex:y})})]})}),t.jsxs(Ii,{className:"oui-max-h-[200px] oui-overflow-y-auto oui-custom-scrollbar",children:[t.jsxs("div",{className:"oui-mt-4",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54",children:r("share.pnl.displayFormat")}),t.jsx("div",{className:"oui-pt-3 oui-px-1 oui-justify-between oui-gap-3 oui-grid oui-grid-cols-3 oui-row-span-1",children:n.map(W=>t.jsx(In,{setPnlFormat:a,type:W,curType:o}))})]}),t.jsxs("div",{className:"oui-mt-3",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:r("share.pnl.optionalInfo")}),t.jsxs("div",{className:"oui-flex oui-flex-wrap oui-gap-3 oui-mt-3",children:[e.entity.openPrice&&t.jsx(Ce,{setShareOption:d,type:"openPrice",curType:l}),e.entity.closePrice&&t.jsx(Ce,{setShareOption:d,type:"closePrice",curType:l}),e.entity.openTime&&t.jsx(Ce,{setShareOption:d,type:"openTime",curType:l}),e.entity.closeTime&&t.jsx(Ce,{setShareOption:d,type:"closeTime",curType:l}),e.leverage&&t.jsx(Ce,{setShareOption:d,type:"leverage",curType:l}),e.entity.markPrice&&t.jsx(Ce,{setShareOption:d,type:"markPrice",curType:l}),e.entity.quantity&&t.jsx(Ce,{setShareOption:d,type:"quantity",curType:l})]})]}),t.jsxs("div",{className:"oui-mt-3 oui-mb-8",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:r("share.pnl.optionalInfo.message")}),t.jsx("div",{className:"oui-mt-3 oui-h-[48px] oui-bg-base-600 oui-mx-1",children:t.jsx(me,{placeholder:r("share.pnl.optionalInfo.message.placeholder"),containerClassName:"oui-bg-transparent oui-h-[48px]",value:m,autoFocus:!1,onChange:W=>{if(W.target.value.length>25){z.error(r("share.pnl.optionalInfo.message.maxLength"));return}p(W.target.value)},ref:R,onFocus:()=>L(!0),onBlur:()=>L(!1),suffix:C&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:W=>{p(""),setTimeout(()=>{var K;(K=R.current)==null||K.focus()},50),W.stopPropagation()},children:t.jsx(Ti,{size:18,color:"white"})})})})]})]}),t.jsx("div",{className:"oui-pt-2",children:t.jsx(J,{fullWidth:!0,className:"oui-h-[40px] oui-text-[16px]",onClick:()=>{let W=w==null?void 0:w[x];W&&F(W)},children:r("common.share")})})]})},In=e=>{let{type:i,curType:r,setPnlFormat:s}=e,{t:n}=_(),o=c.useMemo(()=>{switch(i){case"roi_pnl":return n("share.pnl.displayFormat.roi&Pnl");case"roi":return n("share.pnl.displayFormat.roi");case"pnl":return n("share.pnl.displayFormat.pnl")}},[i]);return t.jsx("div",{className:I("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-flex-1 oui-bg-base-4 hover:oui-cursor-pointer oui-flex oui-items-center oui-px-3 oui-referral-shadow",i===r&&"oui-bg-primary-darken oui-dot-sel"),onClick:()=>{s(i)},children:t.jsx("div",{className:"oui-text-sm oui-text-base-contrast",children:o})})},Ce=e=>{let{type:i,curType:r,setShareOption:s}=e,{t:n}=_(),o=c.useMemo(()=>{switch(i){case"openPrice":return n("share.pnl.optionalInfo.openPrice");case"closePrice":return n("share.pnl.optionalInfo.closePrice");case"openTime":return n("share.pnl.optionalInfo.openTime");case"closeTime":return n("share.pnl.optionalInfo.closeTime");case"markPrice":return n("common.markPrice");case"quantity":return n("common.quantity");case"leverage":return n("common.leverage")}},[i,n]),a=r.has(i);return t.jsxs("div",{className:I("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-mt-0 oui-w-[calc(50%-6px)] oui-bg-base-4 hover:oui-cursor-pointer oui-items-center oui-flex oui-p-3 oui-referral-shadow"),onClick:()=>{s(l=>{let d=new Set(l);return a?d.delete(i):d.add(i),d})},children:[t.jsx("div",{className:"oui-text-sm oui-flex-1 oui-text-base-contrast",children:o}),a&&t.jsx(En,{})]})};function Tn(e){let i=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(i.length),n=new Uint8Array(s);for(let o=0;o<i.length;o++)n[o]=i.charCodeAt(o);return new Blob([s],{type:r})}var $n=e=>{let{scrollSnaps:i,selectedIndex:r}=Ve();return c.useEffect(()=>{e.setSelectIndex(r)},[r]),t.jsx("div",{className:I("oui-flex oui-gap-1"),children:i.map((s,n)=>t.jsx(cr,{index:n,active:n===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},n))})},En=()=>t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.01416 11.9989C2.01416 6.47589 6.49136 1.9989 12.0142 1.9989C17.5372 1.9989 22.0142 6.47589 22.0142 11.9989C22.0142 17.5219 17.5372 21.9989 12.0142 21.9989C6.49136 21.9989 2.01416 17.5219 2.01416 11.9989ZM16.9853 7.31211C17.2125 7.09537 17.5236 7 17.8218 7C18.1201 7 18.4312 7.09537 18.6583 7.31211C19.1139 7.74546 19.1139 8.47384 18.6583 8.9072L10.5077 16.675C10.0534 17.1083 9.28909 17.1083 8.83472 16.675L5.34077 13.3459C4.88641 12.9126 4.88641 12.1841 5.34077 11.7508C5.79631 11.3175 6.56057 11.3175 7.01493 11.7508L9.67122 14.2822L16.9853 7.31211Z",fill:"white",fillOpacity:"1"})}),Mn=e=>{let{leverage:i,entity:r,baseDp:s,quoteDp:n,referralInfo:o,shareOptions:a,hide:l}=e,[d,m]=c.useState(window.innerHeight<900?660:807);return c.useEffect(()=>{let p=()=>{m(window.innerHeight<900?660:807)};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]),a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Dn,{entity:r,leverage:i,hide:l,baseDp:s,quoteDp:n,referral:o,shareOptions:a})},zn=e=>{let{leverage:i,entity:r,baseDp:s,quoteDp:n,referralInfo:o,shareOptions:a,hide:l}=e;return a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Ln,{entity:r,leverage:i,hide:l,baseDp:s,quoteDp:n,referral:o,shareOptions:a})},An=e=>{let i=er({hide:e.hide,pnl:e.pnl});return t.jsx(zn,{...i})},Fn=e=>{let i=er({hide:e.hide,pnl:e.pnl});return t.jsx(Mn,{...i})},_t="sharePnLDialog",wt="sharePnLBottomSheet";xt(_t,Fn,{classNames:{content:"!oui-max-w-[624px] oui-p-0"}});zt(wt,An,{title:O.t("share.pnl.sharePnl"),classNames:{body:"oui-pb-4 oui-pt-0"}});var Rn=e=>{let{type:i,values:r}=e,[s,n]=xe("TP/SL_Mode","Offset%"),[o,a]=c.useState(!0),{t:l}=_(),d=c.useMemo(()=>{switch(s){case"Offset":return`${i.toLowerCase()}_offset`;case"Offset%":return`${i.toLowerCase()}_offset_percentage`;default:return`${i.toLowerCase()}_pnl`}},[s]),m=c.useMemo(()=>r[s],[r,s]),p=c.useMemo(()=>[{label:l("tpsl.pnl"),value:"PnL",testId:"PnL_menu_item"},{label:l("tpsl.offset"),value:"Offset",testId:"Offset_mneu_item"},{label:`${l("tpsl.offset")}%`,value:"Offset%",testId:"Offset%_menu_item"}],[l]),x=c.useRef(""),y=g=>{e.onChange(d,g)},b=g=>{let{dp:j=2}=g;return{onRenderBefore:(f,w)=>(f=`${f}`,o&&i==="SL"&&s==="PnL"&&(f=f.startsWith("-")?f:"-"+f),f===""||f==="-"?"":s==="Offset%"?`${new N(f.replace(new RegExp(x.current.replace(".","\\.")+"$"),"")).mul(100).todp(2,4).toString()}${x.current}`:(s==="Offset"&&(f=qt(f,j)),`${f}`)),onSendBefore:f=>{if(/^\-?0{2,}$/.test(f))return"0";if(s==="Offset%"){if(f!==""){f=qt(f,2);let w=f.match(/\.0{0,2}$/);w?x.current=w[0]:x.current="",f=new N(f).div(100).toString(),f=`${f}${x.current}`}}else s==="PnL"&&i==="SL"&&o?f=f.startsWith("-")?f:"-"+f:f=qt(f,j);return f===""||f==="-"?"":f}}};return{mode:s,modes:p,type:e.type,formatter:b,onModeChange:g=>{n(g)},value:m,pnl:r.PnL,onValueChange:y,quote_dp:e.quote_dp,setFocus:a}},Un=e=>{let{mode:i,modes:r,onModeChange:s,onValueChange:n,quote:o,quote_dp:a,value:l,pnl:d}=e,{t:m}=_(),[p,x]=c.useState(i),[y,b]=c.useState(i==="Offset%"?"%":o),g=c.useMemo(()=>{let j=Number(d);if(isNaN(j)||j===0)return"";if(j>0)return"oui-text-trade-profit";if(j<0)return"oui-text-trade-loss"},[d]);return c.useEffect(()=>{var f;let j=(f=r.find(w=>w.value===i))==null?void 0:f.label;x(j),b(i==="Offset%"?"%":o)},[i,r]),t.jsx(me,{prefix:p,size:{initial:"lg",lg:"md"},placeholder:y,align:"right",value:l,"data-testid":e.testId,autoComplete:"off",onValueChange:n,formatters:[e.formatter({dp:a,mode:i}),Q.currencyFormatter,Q.decimalPointFormatter],classNames:{input:g,prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onFocus:()=>{b(""),e.setFocus(!0)},onBlur:()=>{b(i==="Offset%"?"%":o),e.setFocus(!1)},suffix:t.jsxs(t.Fragment,{children:[i==="Offset%"&&!!l&&t.jsx(u,{size:"2xs",color:"inherit",className:I("oui-ml-[2px]",g),children:"%"}),t.jsx(Wn,{mode:i,modes:r,onModeChange:j=>s(j.value)})]})})},Wn=e=>t.jsx(os,{currentValue:e.mode,menu:e.modes,align:"end",size:"xs",className:"oui-min-w-[80px]",onSelect:i=>e.onModeChange(i),children:t.jsx("button",{className:"oui-p-2",children:t.jsx(Ei,{size:12,color:"white"})})}),ui=e=>{let{testId:i,quote:r,...s}=e,n=Rn(s);return t.jsx(Un,{...n,testId:i,quote:r})},Bn=e=>{let{TPSL_OrderEntity:i,symbolInfo:r,onCancel:s,onComplete:n,status:o,errors:a,isPosition:l}=e,{t:d}=_(),{parseErrorMsg:m}=it(a);return t.jsxs("div",{id:"orderly-tp_sl-order-edit-content",children:[(!e.isEditing||e.isEditing&&!e.isPosition)&&t.jsxs(t.Fragment,{children:[t.jsx(Vn,{maxQty:e.maxQty,quantity:e.orderQuantity??e.maxQty,baseTick:r("base_tick"),dp:r("base_dp"),onQuantityChange:e.setQuantity,quote:r("base"),isEditing:e.isEditing,isPosition:l,errorMsg:m("quantity")}),t.jsx(ge,{my:4,intensity:8})]}),t.jsx(Qn,{sl_pnl:i.sl_pnl,tp_pnl:i.tp_pnl,quote:r("quote"),quote_dp:r("quote_dp"),onPriceChange:e.setOrderPrice,onPnLChange:e.setPnL,errors:a,tp_values:{PnL:`${i.tp_pnl??""}`,Offset:`${i.tp_offset??""}`,"Offset%":`${i.tp_offset_percentage??""}`},sl_values:{PnL:`${i.sl_pnl??""}`,Offset:`${i.sl_offset??""}`,"Offset%":`${i.sl_offset_percentage??""}`},tp_trigger_price:i.tp_trigger_price??"",sl_trigger_price:i.sl_trigger_price??""}),t.jsxs(fe,{cols:2,gap:3,mt:4,children:[t.jsx(J,{size:"md",color:"secondary","data-testid":"tpsl-cancel",onClick:()=>{s==null||s()},children:d("common.cancel")}),t.jsx(Be,{size:"md","data-testid":"tpsl-confirm",disabled:!e.valid||o.isCreateMutating,loading:o.isCreateMutating||o.isUpdateMutating,onClick:()=>{e.onSubmit().then(()=>{n==null||n()},()=>{})},children:d("common.confirm")})]})]})},Vn=e=>{let{isPosition:i}=e,r=c.useRef(null),s=ss(e.quantity,0,e.maxQty)/100,{t:n}=_(),o=()=>{var d,m;(d=e.onQuantityChange)==null||d.call(e,0),(m=r.current)==null||m.focus(),setTimeout(()=>{var p;(p=r.current)==null||p.setSelectionRange(0,1)},0)},a=d=>{var m;e.baseTick>0&&((m=e.onQuantityChange)==null||m.call(e,ie.formatNumber(d,e.baseTick)??d))},l=(i?"":e.quantity).toString().length>0?e.errorMsg:void 0;return t.jsxs(t.Fragment,{children:[t.jsxs(h,{gap:2,children:[t.jsx("div",{className:"oui-flex-1",children:t.jsx(me.tooltip,{"data-testid":"oui-testid-tpsl-popUp-quantity-input",ref:r,prefix:n("common.quantity"),size:{initial:"lg",lg:"md"},align:"right",value:i?"":e.quantity,autoComplete:"off",classNames:{prefix:"oui-text-base-contrast-54",root:I("oui-bg-base-5 oui-outline-line-12",l&&"oui-outline-danger")},tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},tooltip:l,color:l?"danger":void 0,formatters:[Q.dpFormatter(e.dp),Q.numberFormatter,Q.currencyFormatter,Q.decimalPointFormatter],onValueChange:d=>{var p,x,y;(p=e.onQuantityChange)==null||p.call(e,d);let m=Number(d);if(m&&m>e.maxQty){let b=i?0:e.maxQty;(x=e.onQuantityChange)==null||x.call(e,b),(y=r.current)==null||y.blur()}},onBlur:d=>a(d.target.value),suffix:i?t.jsx("button",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",onClick:()=>{o()},children:n("tpsl.entirePosition")}):t.jsx("span",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",children:e.quote})})}),!e.isEditing&&t.jsx(J,{onClick:()=>{var m;let d=i?0:e.maxQty;(m=e.onQuantityChange)==null||m.call(e,d),d===0&&o()},variant:"outlined",className:I("oui-text-2xs oui-w-[68px] oui-h-[40px] xl:oui-h-[32px]",i?"oui-border-primary-light oui-text-primary-light hover:oui-bg-primary-light/20":"oui-bg-base-6 oui-border-line-12 oui-text-base-contrast-54 hover:oui-bg-base-5"),children:n("common.position")})]}),t.jsx(h,{mt:2,itemAlign:"center",height:"15px",children:t.jsx(Ue.single,{markCount:5,color:"primary",max:e.maxQty,min:0,showTip:!0,step:e.baseTick,value:e.quantity,onValueCommit:d=>{a(`${d}`)},onValueChange:d=>{var m;(m=e.onQuantityChange)==null||m.call(e,d)}})}),t.jsxs(h,{justify:"between",children:[t.jsx(u.numeral,{rule:"percentages",color:"primary",size:"2xs",children:s}),t.jsxs(h,{itemAlign:"center",gap:1,children:[t.jsx("button",{className:"oui-leading-none",style:{lineHeight:0},onClick:()=>{var d;(d=e.onQuantityChange)==null||d.call(e,e.maxQty)},children:t.jsx(u,{color:"primary",size:"2xs",children:n("common.max")})}),t.jsx(u.numeral,{rule:"price",size:"2xs",intensity:54,tick:e.baseTick,children:e.maxQty})]})]})]})},Qn=e=>{var n,o;let{t:i}=_(),{parseErrorMsg:r}=it(e.errors),s=(a,l)=>{e.onPnLChange(a,l)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsxs(h,{justify:"between",children:[t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",intensity:80,children:i("tpsl.takeProfit")}),t.jsx(u,{size:"2xs",intensity:36,children:`(${(n=i("orderEntry.orderType.marketOrder"))==null?void 0:n.toLowerCase()})`})]}),t.jsxs(h,{children:[t.jsx(u,{size:"2xs",intensity:36,children:`${i("tpsl.estPnl")}:`}),t.jsx(u.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.tp_pnl??"-"})]})]}),t.jsxs(fe,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(ci,{type:"TP",value:e.tp_trigger_price,error:r("tp_trigger_price"),onValueChange:a=>{e.onPriceChange("tp_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(ui,{type:"TP",onChange:s,quote:e.quote,quote_dp:e.quote_dp,values:e.tp_values})]})]}),t.jsxs("div",{children:[t.jsxs(h,{justify:"between",children:[t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",intensity:80,children:i("tpsl.stopLoss")}),t.jsx(u,{size:"2xs",intensity:36,children:`(${(o=i("orderEntry.orderType.marketOrder"))==null?void 0:o.toLowerCase()})`})]}),t.jsxs(h,{children:[t.jsx(u,{size:"2xs",intensity:36,children:`${i("tpsl.estPnl")}:`}),t.jsx(u.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.sl_pnl??"-"})]})]}),t.jsxs(fe,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(ci,{type:"SL",value:e.sl_trigger_price,error:r("sl_trigger_price"),onValueChange:a=>{e.onPriceChange("sl_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(ui,{type:"SL",onChange:s,quote:e.quote,quote_dp:e.quote_dp,values:e.sl_values})]})]})]})},ci=e=>{let[i,r]=c.useState("USDC"),{t:s}=_();return t.jsx(me.tooltip,{"data-testid":`oui-testid-tpsl-popUp-${e.type.toLowerCase()}-input`,prefix:s("common.markPrice"),size:{initial:"lg",lg:"md"},tooltip:e.error,placeholder:i,align:"right",autoComplete:"off",value:e.value,color:e.error?"danger":void 0,classNames:{prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onValueChange:e.onValueChange,onFocus:()=>{r("")},onBlur:()=>{r("USDC")},formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp),Q.currencyFormatter,Q.decimalPointFormatter]})},mr=e=>{let{symbol:i,tpPrice:r,slPrice:s,qty:n,maxQty:o,side:a,quoteDP:l,baseDP:d,isEditing:m,isPositionTPSL:p}=e,{t:x}=_(),[y,b]=xe("orderly_order_confirm",!0),g=ct({size:"xs",intensity:54}),j=p??n>=o;return t.jsxs(t.Fragment,{children:[m&&t.jsx(u,{as:"div",size:"2xs",intensity:80,className:"oui-mb-3",children:`You agree to edit your ${ts(i)} order.`}),t.jsxs(h,{pb:4,children:[t.jsx(X,{grow:!0,children:t.jsx(u.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,as:"div",intensity:80,children:i})}),t.jsxs(h,{gap:1,children:[j&&t.jsx(H,{size:"xs",color:"primary",children:x("common.position")}),t.jsx(Hn,{tpPrice:r,slPrice:s}),a===pe.SELL?t.jsx(H,{size:"xs",color:"success",children:x("common.buy")}):t.jsx(H,{size:"xs",color:"danger",children:x("common.sell")})]})]}),t.jsx(ge,{}),t.jsxs(h,{direction:"column",itemAlign:"stretch",gapY:1,pt:4,className:I(g,"oui-pb-4 xl:oui-pb-5"),children:[t.jsxs(h,{children:[t.jsx(X,{grow:!0,children:x("common.qty")}),t.jsx("div",{children:j?t.jsx("span",{className:"oui-text-base-contrast",children:x("tpsl.entirePosition")}):t.jsx(u.numeral,{intensity:98,dp:d,padding:!1,children:n})})]}),typeof r=="number"&&r>0?t.jsxs(h,{children:[t.jsx(X,{grow:!0,children:x("tpsl.tpPrice")}),t.jsx(u.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:r})]}):null,typeof s=="number"&&s>0?t.jsxs(h,{children:[t.jsx(X,{grow:!0,children:x("tpsl.slPrice")}),t.jsx(u.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,className:"oui-text-trade-loss",unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:s})]}):null,t.jsxs(h,{children:[t.jsx(X,{grow:!0,children:x("common.price")}),t.jsx("div",{className:"oui-text-base-contrast",children:x("common.marketPrice")})]})]}),t.jsx(X,{pt:2,children:t.jsxs(h,{gap:1,children:[t.jsx($i,{id:"disabledConfirm",color:"white",checked:!y,onCheckedChange:f=>{b(!f)}}),t.jsx("label",{htmlFor:"disabledConfirm",className:ct({size:"xs",intensity:54,className:"oui-ml-1"}),children:x("orderEntry.disableOrderConfirm")})]})})]})},Hn=e=>{let{tpPrice:i,slPrice:r}=e,{t:s}=_();return i&&r?t.jsx(H,{size:"xs",color:"neutral",children:s("common.tpsl")}):i?t.jsx(H,{size:"xs",color:"neutral",children:s("tpsl.tp")}):r?t.jsx(H,{size:"xs",color:"neutral",children:s("tpsl.sl")}):null},Kn=e=>{let{position:i,order:r,isEditing:s}=e;if(s&&!r)throw new is("order is required when isEditing is true");let n=s?r.symbol:i.symbol,o=je(),a=c.useRef(V.TP_SL),[l]=xe("orderly_order_confirm",!0),[d,{submit:m,deleteOrder:p,setValue:x,validate:y,errors:b,isCreateMutating:g,isUpdateMutating:j}]=rs({symbol:n,position_qty:i.position_qty,average_open_price:i.average_open_price},{defaultOrder:r,isEditing:s}),f=C=>{x("quantity",C)},w=(C,L)=>{x(C,L)},v=(C,L)=>{x(C,L)},P=c.useMemo(()=>Math.abs(Number(i.position_qty)),[i.position_qty]),k=c.useMemo(()=>{let C=(r==null?void 0:r.algo_type)===V.POSITIONAL_TP_SL?P:r==null?void 0:r.quantity,L=0;if((Number(d.quantity)!==C||!s&&d.quantity)&&(L=1),r&&s){let R=r.child_orders.find(q=>q.algo_type===le.TAKE_PROFIT),F=r.child_orders.find(q=>q.algo_type===le.STOP_LOSS);(R==null?void 0:R.trigger_price)!==Number(d.tp_trigger_price)&&typeof typeof d.tp_trigger_price<"u"&&(L=2),(F==null?void 0:F.trigger_price)!==Number(d.sl_trigger_price)&&typeof d.sl_trigger_price<"u"&&(L=3)}return L===1&&!d.tp_trigger_price&&!d.sl_trigger_price&&(L=-1),L},[d.tp_trigger_price,d.sl_trigger_price,d.quantity,r,s]),$=c.useMemo(()=>(r==null?void 0:r.algo_type)===V.POSITIONAL_TP_SL&&Number(d.quantity)<P&&!d.tp_trigger_price&&!d.sl_trigger_price?!1:k>0&&!!d.quantity&&!b,[d.quantity,P,k,b]),T=c.useMemo(()=>s?r&&r.algo_type!==V.POSITIONAL_TP_SL?!1:d.algo_order_id&&d.quantity==0?!0:Number(d.quantity)>=P:Number(d.quantity)>=P,[d.quantity,P,r==null?void 0:r.algo_type,s]);c.useEffect(()=>{if(!s&&T){let C=ie.findTPSLFromOrder(r);!d.tp_trigger_price&&C.tp_trigger_price&&w("tp_trigger_price",C.tp_trigger_price),!d.sl_trigger_price&&C.sl_trigger_price&&w("sl_trigger_price",C.sl_trigger_price)}},[s,T,d]),c.useEffect(()=>{let C=Number(d.quantity)<P?V.TP_SL:V.POSITIONAL_TP_SL;typeof e.onTPSLTypeChange=="function"&&a.current!==C&&e.onTPSLTypeChange(C),a.current=C},[d.quantity,P]);let A=()=>r!=null&&r.algo_order_id&&(r!=null&&r.symbol)?p(r==null?void 0:r.algo_order_id,r==null?void 0:r.symbol):Promise.reject("order id or symbol is invalid"),S=async()=>Promise.resolve().then(()=>typeof e.onConfirm!="function"||!l?m().then(()=>!0,C=>(C!=null&&C.message&&z.error(C.message),Promise.reject(!1))):e.onConfirm(d,{position:i,submit:m,cancel:A})).then(C=>{});return{isEditing:s,symbolInfo:o[n],maxQty:P,setQuantity:f,orderQuantity:d.quantity,isPosition:T,TPSL_OrderEntity:d,setOrderValue:x,setPnL:v,setOrderPrice:w,onSubmit:S,valid:$,errors:b,status:{isCreateMutating:g,isUpdateMutating:j}}},pr=e=>{let{onCancel:i,onComplete:r,...s}=e,n=Kn(s);return t.jsx(Bn,{...n,onCancel:i,onComplete:r})},Xt=e=>{let{position:i,order:r,baseDP:s,quoteDP:n,buttonProps:o,isEditing:a}=e,[l,d]=c.useState(!1),[m,p]=c.useState(!0),[x]=xe("orderly_order_confirm",!0),{t:y}=_(),b=a?(r==null?void 0:r.algo_type)===V.POSITIONAL_TP_SL:void 0;return t.jsxs(Rt,{onOpenChange:g=>{m&&d(g)},open:l,children:[t.jsx(Ut,{asChild:!0,onClick:()=>{d(!0)},children:e.children||t.jsx(J,{variant:"outlined",size:"sm",color:"secondary",...o,children:e.label})}),t.jsx(Wt,{className:I("oui-w-[360px]",m?"oui-visible":"oui-invisible"),align:"end",side:"top",children:t.jsx(pr,{position:i,order:r,isEditing:a,onComplete:()=>{d(!1)},onCancel:()=>{d(!1)},onConfirm:(g,j)=>{if(!x)return Promise.resolve(!0);p(!1);let f=Math.abs(Number(i.position_qty));if(`${g.tp_trigger_price??""}`.length===0&&`${g.sl_trigger_price??""}`.length===0)return de.confirm({title:y("orders.cancelOrder"),content:y("tpsl.cancelOrder.description"),onOk:()=>j.cancel()}).then(()=>(d(!1),p(!0),!0),()=>(p(!0),Promise.reject(!1)));let w=a||!!g&&g.algo_type===V.POSITIONAL_TP_SL&&g.quantity===f;return de.confirm({title:y(w?"orders.editOrder":"tpsl.confirmOrder"),onOk:()=>j.submit(),classNames:{body:"!oui-pb-0"},content:t.jsx(mr,{isPositionTPSL:b,isEditing:w,symbol:g.symbol,qty:Number(g.quantity),maxQty:f,tpPrice:Number(g.tp_trigger_price),slPrice:Number(g.sl_trigger_price),side:g.side,quoteDP:n??2,baseDP:s??2})}).then(()=>(d(!1),p(!0),!0),()=>(p(!0),Promise.reject(!1)))}})})]})},hr=e=>{let{position:i,order:r,symbolInfo:s,isEditing:n}=e,{resolve:o,hide:a,updateArgs:l}=Bt(),[d]=xe("orderly_order_confirm",!0),{t:m}=_(),p=n?(r==null?void 0:r.algo_type)===V.POSITIONAL_TP_SL:void 0,x=j=>{n||l({title:j})},y=()=>{o(),a()},{quote_dp:b,base_dp:g}=s;return t.jsxs(t.Fragment,{children:[t.jsx(Yn,{position:i,symbolInfo:s}),t.jsx(pr,{...e,onTPSLTypeChange:j=>{x(j===V.TP_SL?m("common.tpsl"):m("tpsl.positionTpsl"))},onComplete:y,onConfirm:(j,f)=>{if(!d)return Promise.resolve(!0);let w=Math.abs(Number(i.position_qty)),v=n||!!j&&j.algo_type===V.POSITIONAL_TP_SL&&j.quantity===w;return de.confirm({title:m(v?"orders.editOrder":"tpsl.confirmOrder"),bodyClassName:"oui-pb-0 lg:oui-pb-0",onOk:()=>f.submit(),content:t.jsx(mr,{isPositionTPSL:p,isEditing:n,symbol:j.symbol,qty:Number(j.quantity),maxQty:w,tpPrice:Number(j.tp_trigger_price),slPrice:Number(j.sl_trigger_price),side:j.side,quoteDP:b??2,baseDP:g??2})}).then(()=>!0,P=>(P!=null&&P.message&&z.error(P.message),Promise.reject(!1)))},onCancel:()=>{a()}})]})},Yn=e=>{var l;let{position:i,symbolInfo:r}=e,{data:s}=ns(i.symbol),n=Bt(),{t:o}=_(),a=c.useMemo(()=>{var d;return((d=n.args)==null?void 0:d.title)===o("tpsl.positionTpsl")},[(l=n.args)==null?void 0:l.title,o]);return t.jsxs(t.Fragment,{children:[t.jsxs(h,{justify:"between",pb:3,itemAlign:"center",children:[t.jsx(u.formatted,{rule:"symbol",className:"oui-text-xs",showIcon:!0,children:i.symbol}),t.jsxs(h,{gapX:1,children:[a&&t.jsx(H,{size:"xs",color:"primary",children:o("common.position")}),t.jsx(H,{size:"xs",color:"neutral",children:o("common.tpsl")}),i.position_qty<0?t.jsx(H,{size:"xs",color:"buy",children:o("common.buy")}):t.jsx(H,{size:"xs",color:"sell",children:o("common.sell")})]})]}),t.jsx(ge,{intensity:8}),t.jsxs(X,{py:3,className:"oui-space-y-1",children:[t.jsxs(h,{justify:"between",children:[t.jsx(u,{size:"sm",intensity:54,children:o("common.avgOpen")}),t.jsx(u.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:i.average_open_price})]}),t.jsxs(h,{justify:"between",children:[t.jsx(u,{size:"sm",intensity:54,children:o("common.markPrice")}),t.jsx(u.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:s})]})]})]})},xr=c.createContext({}),be=()=>c.useContext(xr),vt=e=>{let i=je()[e.symbol];return t.jsx(xr.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},gr=c.createContext({}),_e=()=>c.useContext(gr),fr=e=>{var C;let[i,r]=c.useState(Math.abs(e.position.position_qty).toString()),{t:s}=_();c.useEffect(()=>{r(Math.abs(e.position.position_qty).toString())},[e.position.position_qty]);let[n,o]=c.useState(""),a=e.position.position_qty>0?pe.SELL:pe.BUY,[l,d]=c.useState(void 0),[m,p]=c.useState(Y.MARKET),x=je(),y=e.position.symbol,b=x==null?void 0:x[y],g=b("quote_dp"),j=b("base_dp"),f=b("base_tick"),{helper:w,onSubmit:v,submitting:P}=ls((C=e.position)==null?void 0:C.symbol,a,!0),k=(L,R)=>{if(p(L),L===Y.LIMIT){if(!R)throw new Error(s("orderEntry.orderPrice.error.required"));o(R)}else o("")},$=c.useMemo(()=>{let{position:L}=e;if(!L)return null;let R={order_quantity:i,symbol:e.position.symbol,order_type:m,side:a,reduce_only:!0};return m===Y.LIMIT&&(R.order_price=n),R},[e.position,n,m,i]),T=L=>{let R=w.calculate({},"order_quantity",L);r(R.order_quantity)},A=L=>{let R=w.calculate({},"order_price",L);o(R.order_price)};c.useEffect(()=>{let L=$;w.validator(L).then(R=>{d(R)})},[$]);let S=()=>v($).catch(L=>(typeof L=="string"?z.error(L):z.error(L.message),Promise.resolve()));return t.jsx(gr.Provider,{value:{quantity:i,price:n,type:m,side:a,position:e.position,updatePriceChange:A,updateQuantity:T,updateOrderType:k,tpslOrder:e.position.algo_order,onSubmit:S,submitting:P,closeOrderData:$,quoteDp:g,baseDp:j,baseTick:f,errors:l},children:e.children})},Xn=()=>{let[e,i]=c.useState(!1),{onSubmit:r,price:s,quantity:n,closeOrderData:o,type:a,submitting:l,quoteDp:d,errors:m}=_e(),{base:p,quote:x}=be(),[y]=xe("orderly_order_confirm",!0),{t:b}=_(),{parseErrorMsg:g}=it(m),j=()=>r().then(v=>{i(!1)},v=>{typeof v=="string"?z.error(v):z.error(v.message)}).catch(v=>{typeof v=="string"?z.error(v):z.error(v.message)}),f=()=>{i(!1)},w=c.useMemo(()=>a===Y.MARKET?!n:!s||!n,[s,n,a]);return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",size:"sm",color:"secondary",disabled:w||l,loading:l,onClick:v=>{v.stopPropagation();let P=g("order_quantity"),k=g("order_price"),$=P||k;if($){z.error($);return}if(!y){r();return}i(!0)},children:b("positions.column.close")}),t.jsx(tt,{open:e,onOpenChange:i,size:"sm",children:a===Y.MARKET?t.jsx(Gt,{base:p,quantity:n,onClose:f,onConfirm:j,submitting:l,classNames:{root:"oui-items-start"},hideCloseIcon:!0}):t.jsx(jr,{base:p,quantity:n,price:s,onClose:f,onConfirm:j,submitting:l,quoteDp:d,order:o,hideCloseIcon:!0})})]})},yr=e=>{let{hideCloseIcon:i=!1}=e;return t.jsxs("div",{className:"oui-pb-3 oui-border-b oui-border-line-4 oui-relative oui-w-full",children:[t.jsx(u,{size:"base",children:e.title}),!i&&t.jsx("button",{onClick:e.onClose,className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54 hover:oui-text-base-contrast-80 oui-p-2",children:t.jsx(Ui,{size:18,color:"white"})})]})},br=({onCancel:e,onConfirm:i,submitting:r})=>{let{t:s}=_();return t.jsxs(h,{id:"oui-positions-confirm-footer",gap:2,width:"100%",className:"oui-mt-3 oui-pb-1",children:[t.jsx(J,{id:"oui-positions-confirm-footer-cancel-button",color:"secondary",fullWidth:!0,onClick:e,size:"md",children:s("common.cancel")}),t.jsx(Be,{id:"oui-positions-confirm-footer-confirm-button",onClick:i,fullWidth:!0,loading:r,size:"md",children:s("common.confirm")})]})},Gn=e=>{let{quantity:i,price:r,quoteDp:s,side:n}=e,{t:o}=_(),a=c.useMemo(()=>r&&i?new N(r).mul(i).toFixed(s,N.ROUND_DOWN):"--",[r,i]);return t.jsxs(h,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:5,children:[t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:o("common.qty")}),t.jsx(u,{color:n===pe.BUY?"success":"danger",children:i})]}),t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:o("common.price")}),t.jsx(u.formatted,{intensity:98,suffix:t.jsx(u,{intensity:54,children:"USDC"}),children:r})]}),t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:o("common.notional")}),t.jsx(u.formatted,{intensity:98,suffix:t.jsx(u,{intensity:54,children:"USDC"}),children:a})]})]})},Gt=e=>{var s;let{t:i}=_(),r=()=>{var n;(n=(e==null?void 0:e.onClose)??e.close)==null||n()};return t.jsxs(h,{direction:"column",className:(s=e.classNames)==null?void 0:s.root,children:[t.jsx(yr,{onClose:r,title:i("positions.marketClose"),hideCloseIcon:e.hideCloseIcon}),t.jsx(u,{intensity:54,size:"sm",className:"oui-my-5",children:i("positions.marketClose.description",{quantity:G(e.quantity),base:e.base})}),t.jsx(br,{onCancel:r,onConfirm:async()=>{var n;await((n=e.onConfirm)==null?void 0:n.call(e)),r()},submitting:e.submitting})]})},jr=e=>{let{order:i,quoteDp:r,quantity:s,price:n,submitting:o}=e,{side:a}=i,{t:l}=_(),d=()=>{var m;(m=e.onClose)==null||m.call(e)};return t.jsxs(t.Fragment,{children:[t.jsx(yr,{onClose:d,title:l("positions.limitClose"),hideCloseIcon:e.hideCloseIcon}),t.jsx(X,{mt:5,children:t.jsx(u,{intensity:54,size:"sm",children:l("positions.limitClose.description",{quantity:Ri(e.quantity),base:e.base})})}),t.jsxs(h,{gap:2,mb:4,mt:5,justify:"between",children:[t.jsx(u.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:i.symbol}),t.jsxs(h,{gap:1,children:[t.jsx(H,{color:"neutral",size:"xs",children:l("orderEntry.orderType.limit")}),t.jsx(H,{color:a===pe.BUY?"success":"danger",size:"xs",children:a===pe.BUY?l("common.buy"):l("common.sell")})]})]}),t.jsx(ge,{className:"oui-w-full"}),t.jsx(Gn,{className:"oui-text-sm",price:n,quantity:s,side:i.side,quoteDp:r??2}),t.jsx(br,{onCancel:d,onConfirm:e.onConfirm,submitting:e.submitting})]})},Jn=()=>{let{type:e,quoteDp:i,price:r,updatePriceChange:s,updateOrderType:n,position:o}=_e(),[a,l]=c.useState(!1),{t:d}=_();return t.jsxs(qi,{children:[t.jsx(me,{size:"sm",value:e===Y.LIMIT?r:d("orderEntry.orderType.market"),onValueChange:m=>s(m),formatters:[Q.numberFormatter,...i?[Q.dpFormatter(i)]:[]],onFocus:m=>{e===Y.MARKET&&n(Y.LIMIT,`${o.mark_price}`),l(!0)},onBlur:m=>{setTimeout(()=>{l(!1)},100)},suffix:t.jsx(Di,{asChild:!0,children:t.jsx("button",{className:"oui-px-1 oui-h-full",children:t.jsx(Ei,{size:12,color:"white"})})}),classNames:{root:I("oui-outline-line-12 focus-within:oui-outline-primary-light")}}),t.jsx(Li,{align:"end",className:"oui-w-[96px] oui-min-w-[96px]",onCloseAutoFocus:m=>m.preventDefault(),children:t.jsx(us,{children:t.jsx(cs,{size:"xs",onSelect:m=>{n(Y.MARKET)},children:t.jsx("span",{children:d("common.marketPrice")})})})})]})},Zn=e=>{let[i,r]=c.useState(!1),[s,n]=c.useState(100),{baseDp:o,quoteDp:a,updateQuantity:l,quantity:d,type:m,errors:p,baseTick:x}=_e();c.useEffect(()=>{let g=j=>{j.target.closest("[data-popover-root]")||r(!1)};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}},[]);let y=g=>{b(`${e.value*(g/100)}`)},b=g=>{if(x&&x>0){let j=ie.formatNumber(g,x)??g;l(j)}};return t.jsxs(Rt,{children:[t.jsx(Ut,{children:t.jsx(me,{size:"sm",onFocus:()=>{r(!0)},classNames:{root:"oui-outline-line-12 "},formatters:[Q.numberFormatter,...o?[Q.dpFormatter(o)]:[]],value:d,onBlur:g=>b(g.target.value),onValueChange:g=>{if(l(g),g=="0"||g==""){n(0);return}let j=new N(g).div(e.value).mul(100).abs().toFixed(0,N.ROUND_DOWN);n(Math.min(100,Number(j)))}})}),t.jsx(Wt,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:g=>{g.preventDefault()},children:t.jsxs(h,{p:1,gap:2,width:"100%",itemAlign:"start",children:[t.jsx(u,{size:"xs",intensity:98,className:"oui-min-w-[30px]",children:`${s}%`}),t.jsxs(h,{direction:"column",width:"100%",gap:2,children:[t.jsx(Ue,{markCount:4,value:[s],onValueChange:g=>{let j=Array.from(g.values());n(j[0]),y(j[0])}}),t.jsx(eo,{onClick:g=>{n(g*100),y(g*100)}})]})]})})]})},eo=e=>{let{t:i}=_(),r=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:i("common.max"),value:1}];return t.jsx(h,{gap:2,width:"100%",children:r.map((s,n)=>t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),e.onClick(s.value)},className:"oui-w-1/5",children:s.label},n))})},to=(e,i)=>{let r=be();return t.jsx(u.numeral,{dp:r.base_dp,rm:N.ROUND_DOWN,padding:!1,coloring:!0,children:e})},io=(e,i)=>t.jsx(Zn,{value:i.position_qty}),ro=e=>t.jsx(Jn,{}),so=e=>{if(e.sharePnLConfig==null)return t.jsx(t.Fragment,{});let{position:i}=e,r=()=>{let s=e.isPositionHistory?{side:i.side,pnl:i.netPnL,openPrice:Math.abs(i.avg_open_price),closePrice:Math.abs(i.avg_close_price),openTime:i.open_timestamp,closeTime:i.close_timestamp,quantity:i.closed_position_qty}:{side:i.position_qty>0?"LONG":"SHORT",pnl:i.unrealized_pnl,roi:new N(i.unrealized_pnl_ROI*100).toFixed(2,N.ROUND_DOWN),openPrice:Math.abs(i.average_open_price),markPrice:i.mark_price,openTime:i.timestamp,quantity:i.position_qty};de.show(e.modalId,{pnl:{entity:{symbol:i.symbol,...s},refCode:e.refCode,...e.sharePnLConfig,leverage:e.isPositionHistory?void 0:e.leverage}})};return t.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),r()},children:t.jsx(Fi,{color:"white",opacity:.54,size:e.iconSize??16})})},no=e=>{let{sharePnLConfig:i,position:r,modalId:s,iconSize:n,isPositionHistory:o}=e,{getFirstRefCode:a}=Ft(),l=c.useMemo(()=>{var m;return(m=a())==null?void 0:m.code},[a]),d=Ai(e.position.symbol);return{iconSize:n,position:r,refCode:l,leverage:d,sharePnLConfig:i,modalId:s,isPositionHistory:o}},Nt=e=>{let i=no(e);return t.jsx(so,{...i})},oo=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:s}=_e(),{t:n}=_();return t.jsx(Xt,{position:e,order:s,label:n("common.tpsl"),baseDP:i,quoteDP:r,isEditing:!1})},ao=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:s}=_e();return t.jsx(Xt,{position:e,order:s,baseDP:i,quoteDP:r,isEditing:!0,children:t.jsx(ms,{opacity:1,className:"oui-text-base-contrast-54 oui-cursor-pointer",size:16})})},lo=e=>{let{stopLossPrice:i,takeProfitPrice:r}=e,{tpslOrder:s,position:n}=_e();return t.jsx(uo,{stopLossPrice:i,takeProfitPrice:r,direction:"column",order:s,position:n,tooltip:!0})},mi=e=>{let{qty:i,price:r,entryPrice:s,orderSide:n,orderType:o,symbolInfo:a}=e,l=ie.priceToPnl({qty:i,price:r,entryPrice:s,orderSide:n,orderType:o},{symbol:a}),d=o===le.TAKE_PROFIT?"TP":"SL";return t.jsxs(h,{children:[t.jsx(u,{intensity:54,className:"oui-mr-1",children:`${d} PnL:`}),t.jsx(u.formatted,{rule:"price",className:l===0?"oui-text-base-contrast-36":l>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx(u,{children:l===0?"":l>0?"+":"-"}),suffix:t.jsx(u,{intensity:36,className:"oui-ml-1",children:"USDC"}),children:`${Math.abs(l)}`})]})},uo=e=>{let{direction:i="row",order:r,position:s}=e,n=je(),{t:o}=_(),a=c.useMemo(()=>{let p=[];if(!e.tooltip||!r||!s)return;let x=r.quantity;return x===0&&r.child_orders[0].type==="CLOSE_POSITION"&&(x=s.position_qty),e.takeProfitPrice&&p.push(t.jsx(mi,{qty:x,price:e.takeProfitPrice,entryPrice:s.average_open_price,orderSide:r.side,orderType:le.TAKE_PROFIT,symbolInfo:n[r.symbol]()},"tp")),e.stopLossPrice&&p.push(t.jsx(mi,{qty:x,price:e.stopLossPrice,entryPrice:s.average_open_price,orderSide:r.side,orderType:le.STOP_LOSS,symbolInfo:n[r.symbol]()},"sl")),t.jsx("div",{children:p})},[e.takeProfitPrice,e.stopLossPrice,s==null?void 0:s.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),l=c.useMemo(()=>{let p=[];return r!=null&&r.symbol?(e.takeProfitPrice&&p.push(t.jsx(u.formatted,{className:I("oui-text-trade-profit oui-gap-0 oui-decoration-white/20"),rule:"price",dp:n[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsx(u,{intensity:54,children:`${o("tpsl.tp")} - `}):""},"tp")),e.stopLossPrice&&p.push(t.jsx(u.formatted,{className:I("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 "),rule:"price",dp:n[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsx(u,{intensity:54,children:`${o("tpsl.sl")} - `}):""},"sl")),p.length===0?t.jsx(u,{children:"-"}):(p.length===2&&i==="row"&&p.splice(1,0,t.jsx(u,{children:"/"},"split")),p)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol,o]),d=t.jsx("div",{className:I("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l}),m=Array.isArray(l)?!!l.length:!l;return e.tooltip?t.jsxs(h,{gapX:2,children:[t.jsx(ye,{content:a,children:d}),m&&t.jsx(ao,{})]}):d},co=e=>{let[i,r]=xe("unPnlPriceBasis","markPrice"),{t:s}=_();return t.jsxs(h,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-items-start",children:[t.jsx(u,{children:s("positions.column.unrealPnl.tooltip")}),t.jsx(ge,{className:"oui-w-full"}),t.jsx("div",{className:"oui-mb-0",children:s("positions.column.unrealPnl.priceBasis")}),t.jsx(mo,{value:i,onValueChange:r})]})},mo=e=>{let{value:i,onValueChange:r}=e,{t:s}=_();return t.jsxs(h,{gap:2,children:[t.jsx(pi,{sel:i==="markPrice",label:s("common.markPrice"),value:"markPrice",onCheckChange:r}),t.jsx(pi,{sel:i==="lastPrice",label:s("common.lastPrice"),value:"lastPrice",onCheckChange:r})]})},pi=e=>{let{sel:i,label:r,value:s,onCheckChange:n}=e;return t.jsxs(h,{onClick:o=>{n(s),o.stopPropagation()},gap:1,className:"oui-cursor-pointer",children:[i?t.jsx(po,{}):t.jsx(ho,{}),t.jsx(u,{size:"xs",intensity:i?98:54,children:r})]})},po=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),ho=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Dt=e=>{let{tick:i="quote_dp",...r}=e,s=be();if(!s)throw new Error("NumeralWithCtx must be used inside SymbolProvider");return t.jsx(u.numeral,{as:"span",...r,dp:s[i]})},xo=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e,{t:s}=_();return c.useMemo(()=>[{title:s("common.symbol"),dataIndex:"symbol",fixed:"left",width:140,onSort:(n,o)=>n.symbol.localeCompare(o.symbol),render:(n,o)=>t.jsxs(h,{gap:2,children:[t.jsx(X,{width:4,height:20,className:I("oui-rounded-[1px]",o.position_qty>0?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsx(u.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:a=>{var l;(l=e.onSymbolChange)==null||l.call(e,{symbol:n}),a.stopPropagation(),a.preventDefault()},children:`${n.split("_")[1]}-PERP`})]})},{title:s("common.quantity"),dataIndex:"position_qty",onSort:(n,o)=>n.position_qty-o.position_qty,width:120,className:"oui-pl-6",render:to},{title:s("common.avgOpen"),className:"oui-h-[48px]",width:120,onSort:!0,dataIndex:"average_open_price",render:(n,o)=>t.jsx(Dt,{rm:N.ROUND_DOWN,children:n})},{title:s("common.markPrice"),dataIndex:"mark_price",width:120,onSort:!0,className:"oui-h-[48px]",render:(n,o)=>t.jsx(Dt,{rm:N.ROUND_DOWN,children:n})},{title:t.jsx(ye,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:s("positions.column.liqPrice.tooltip"),children:t.jsx(u,{children:s("positions.column.liqPrice")})}),width:100,onSort:!0,dataIndex:"est_liq_price",render:(n,o)=>Number(n)===0?"--":t.jsx(Dt,{rm:N.ROUND_DOWN,className:Number(n)>0?"oui-text-warning-light":"",children:n??"--"})},{title:t.jsx(ds,{content:t.jsx(co,{}),side:"top",align:"center",className:"oui-max-w-[280px] oui-text-2xs",children:t.jsx(u,{children:s("common.unrealizedPnl")})}),dataIndex:"unrealized_pnl",width:180,onSort:!0,rule:"price",numeralProps:{coloring:!0},render:(n,o)=>t.jsxs(h,{gap:2,children:[t.jsxs(h,{children:[t.jsx(u.numeral,{dp:e.pnlNotionalDecimalPrecision,rm:N.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",children:n}),t.jsx(u.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:N.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",prefix:"(",suffix:")",children:o.unrealized_pnl_ROI})]}),t.jsx(Nt,{position:o,sharePnLConfig:e.sharePnLConfig,modalId:_t})]})},{title:s("common.tpsl"),dataIndex:"__",width:150,render:(n,o)=>t.jsx(lo,{stopLossPrice:o.sl_trigger_price,takeProfitPrice:o.tp_trigger_price})},{title:s("common.notional"),dataIndex:"notional",className:"oui-h-[48px]",width:100,onSort:!0,render:n=>t.jsx(u.numeral,{dp:i,children:n})},{title:t.jsx(ye,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:t.jsxs(h,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-bg-base-8 oui-rounded-sm",children:[t.jsx("span",{children:s("positions.column.margin.tooltip")}),t.jsx(ge,{className:"oui-w-full"}),t.jsx("span",{children:s("positions.column.margin.formula")})]}),children:t.jsx(u,{children:s("positions.column.margin")})}),dataIndex:"mm",onSort:!0,width:100,rule:"price",render:n=>t.jsx(u.numeral,{children:n})},{title:s("common.qty"),dataIndex:"close_qty",width:100,fixed:"right",render:io},{title:s("common.price"),dataIndex:"close_price",width:100,fixed:"right",render:ro},{title:"",dataIndex:"close_position",align:"right",width:160,fixed:"right",render:n=>t.jsxs(h,{gapX:2,justify:"end",children:[t.jsx(Xn,{}),t.jsx(oo,{})]})}],[i,r,s])},go=e=>{let{item:i}=e,r=i.position_qty>0,{t:s}=_();return t.jsx(u.formatted,{rule:"symbol",formatString:"base-type",size:"2xs",suffix:t.jsx(H,{color:r?"success":"danger",size:"xs",children:s(r?"common.long":"common.short")}),showIcon:!0,onClick:()=>{var n;(n=e.onSymbolChange)==null||n.call(e,{symbol:i.symbol})},children:i.symbol})},fo=e=>{let{item:i}=e,{t:r}=_();return t.jsxs(h,{gap:3,children:[t.jsxs(h,{direction:"column",className:"oui-text-2xs",itemAlign:"end",children:[t.jsxs("div",{children:[t.jsx(u,{intensity:36,children:r("common.unrealizedPnl")}),t.jsx(u,{intensity:20,children:"(USDC)"})]}),t.jsx(u.numeral,{size:"xs",dp:e.pnlNotionalDecimalPrecision,rm:N.ROUND_DOWN,coloring:!0,className:"orderly-font-semibold",suffix:t.jsx(u.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:N.ROUND_DOWN,prefix:"(",suffix:")",className:I("oui-ml-1",i.unrealized_pnl_ROI>0?"oui-text-success-darken":"oui-text-danger-darken"),children:i.unrealized_pnl_ROI}),children:i.unrealized_pnl})]}),t.jsx(Nt,{position:i,sharePnLConfig:e.sharePnLConfig,modalId:wt,iconSize:12})]})},yo=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:r("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.base_dp,padding:!1,coloring:!0,children:i.position_qty})})},bo=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:t.jsxs("span",{children:[r("positions.column.margin"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,intensity:80,children:i.mm})})},jo=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{align:"end",label:t.jsxs("span",{children:[r("common.notional"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,intensity:80,children:i.notional})})},_o=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:r("common.avgOpen"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,children:i.average_open_price})})},wo=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:r("common.markPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,children:i.mark_price})})},vo=e=>{let{item:i}=e,{t:r}=_(),s=i.est_liq_price&&i.est_liq_price>0?i.est_liq_price:"-";return t.jsx(Z,{label:r("positions.column.liqPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,color:"warning",children:s})})},No=e=>{let{item:i}=e,{t:r}=_();return i.tp_trigger_price==null&&i.sl_trigger_price==null?t.jsx(t.Fragment,{}):t.jsxs(h,{className:"oui-text-2xs oui-text-base-contrast-36",children:[t.jsxs(u,{children:[`${r("common.tpsl")}:`," "]}),t.jsxs(h,{className:"oui-gap-[2px]",children:[i.tp_trigger_price&&t.jsx(u.numeral,{color:"buy",children:i.tp_trigger_price}),i.sl_trigger_price&&"/",i.sl_trigger_price&&t.jsx(u.numeral,{color:"sell",children:i.sl_trigger_price})]})]})},Co=e=>{var T,A;let{item:i,sheetOpen:r,setSheetOpen:s,dialogOpen:n,setDialogOpen:o,updatePriceChange:a,base:l,quantity:d,price:m,onClose:p,onConfirm:x,submitting:y,quote_dp:b,closeOrderData:g,onCloseDialog:j}=e,f=i.position_qty>0,{t:w}=_(),{parseErrorMsg:v}=it(e.errors),P=v("order_quantity"),k=v("order_price"),$=S=>{if(e.baseTick&&e.baseTick>0){let C=ie.formatNumber(S,e.baseTick)??S;e.updateQuantity(C)}};return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{a("limit"),s(!0)},children:w("positions.limitClose")}),r&&t.jsx(hs,{title:w("positions.limitClose"),open:r,onOpenChange:s,children:t.jsxs(h,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u.formatted,{rule:"symbol",showIcon:!0,children:i.symbol}),t.jsxs(h,{gap:1,children:[t.jsx(H,{color:"neutral",size:"xs",children:w("orderEntry.orderType.limit")}),f&&t.jsx(H,{color:"success",size:"xs",children:w("common.buy")}),!f&&t.jsx(H,{color:"danger",size:"xs",children:w("common.sell")})]})]}),t.jsx(ge,{className:"oui-w-full"}),t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u,{intensity:54,children:w("common.lastPrice")}),t.jsx(u.numeral,{dp:(A=(T=e.item)==null?void 0:T.symbolInfo)==null?void 0:A.quote_dp,suffix:t.jsx(u,{intensity:36,children:" USDC"}),children:e.curMarkPrice})]}),t.jsxs(h,{width:"100%",direction:"column",gap:2,children:[t.jsx(me.tooltip,{prefix:w("common.price"),suffix:e.quote,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],triggerClassName:"oui-w-full",tooltip:k,color:k?"danger":void 0,value:e.price,onValueChange:S=>e.updatePriceChange(S),classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:I("oui-outline-line-12 oui-w-full",k?"oui-outline-danger":void 0)}}),t.jsx(me,{prefix:w("common.quantity"),suffix:e.base,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.base_dp)],value:e.quantity,onBlur:S=>$(S.target.value),onValueChange:S=>{e.updateQuantity(S);let C=new N(S).div(e.item.position_qty).mul(100).toDecimalPlaces(2,N.ROUND_DOWN).toNumber();e.setSliderValue(C)},classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:I("oui-outline-line-12 oui-w-full")}}),t.jsx(Ue,{markCount:4,value:[e.sliderValue],color:"primary",onValueChange:S=>{e.setSliderValue(S[0]);let C=new N(S[0]).div(100).mul(e.item.position_qty).toFixed(e.base_dp,N.ROUND_DOWN);$(C)}}),t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u,{color:"primary",size:"2xs",children:`${e.sliderValue}%`}),t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",color:"primary",children:w("common.max")}),t.jsx(u.numeral,{intensity:54,size:"2xs",children:Math.abs(e.item.position_qty)})]})]})]}),t.jsxs(h,{width:"100%",gap:3,mt:2,children:[t.jsx(J,{fullWidth:!0,color:"secondary",onClick:S=>{p()},children:w("common.cancel")}),t.jsx(Be,{fullWidth:!0,disabled:y,loading:y,onClick:S=>{S.stopPropagation(),S.preventDefault();let C=P||k;if(C){z.error(C);return}if(!e.orderConfirm){x();return}o(!0)},children:w("common.confirm")})]})]})}),n&&t.jsx(tt,{open:n,onOpenChange:o,size:"xs",children:t.jsx(jr,{base:l,quantity:d,price:m,onClose:j,onConfirm:x,submitting:y,quoteDp:b,order:g,hideCloseIcon:!0})})]})},Po=e=>{let{state:i}=e,[r,s]=c.useState(!1),[n,o]=c.useState(!1),{onSubmit:a,price:l,quantity:d,closeOrderData:m,submitting:p,type:x,updatePriceChange:y,updateOrderType:b,updateQuantity:g,errors:j,baseTick:f}=_e(),w=c.useRef(!1),[v,P]=c.useState(100),[k]=xe("orderly_order_confirm",!0),$=()=>a().then(M=>{s(!1),o(!1)},M=>{typeof M=="string"?z.error(M):z.error(M.message)}),T=()=>{s(!1)},A=()=>{o(!1)},S=ps(),C=c.useMemo(()=>{var M;return((M=S==null?void 0:S.data)==null?void 0:M[i.item.symbol])??"--"},[S]),{quote_dp:L,base_dp:R,base:F,quote:q}=be();return c.useEffect(()=>{!w.current&&C&&r&&(w.current=!0,b(Y.LIMIT,`${C}`))},[w,C,r]),c.useEffect(()=>{r||(b(Y.MARKET),w.current=!1)},[r]),{...i,sheetOpen:r,setSheetOpen:s,curMarkPrice:C,quote_dp:L,base_dp:R,base:F,quote:q,baseTick:f,orderConfirm:k,onClose:T,onConfirm:$,price:l,quantity:d,closeOrderData:m,submitting:p,updatePriceChange:y,updateQuantity:g,errors:j,sliderValue:v,setSliderValue:P,dialogOpen:n,setDialogOpen:o,onCloseDialog:A}},So=e=>{let i=Po(e);return t.jsx(Co,{...i})},ko=e=>{let{t:i}=_();return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",disabled:e.submitting,loading:e.submitting,onClick:r=>{if(r.stopPropagation(),r.preventDefault(),e.updateOrderType(Y.MARKET),!e.orderConfirm){e.onConfirm();return}e.setDialogOpen(!0)},children:i("positions.marketClose")}),t.jsx(tt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,size:"xs",children:t.jsx(Gt,{base:e.base,quantity:e.quantity,onClose:e.onClose,onConfirm:e.onConfirm,submitting:e.submitting,hideCloseIcon:!0})})]})},Oo=e=>{let i=be(),[r,s]=c.useState(!1),{onSubmit:n,price:o,quantity:a,closeOrderData:l,submitting:d,type:m,updatePriceChange:p,updateOrderType:x,updateQuantity:y}=_e(),[b]=xe("orderly_order_confirm",!0);return{...e,...i,dialogOpen:r,setDialogOpen:s,orderConfirm:b,onSubmit:n,quantity:a,onClose:()=>{s(!1)},onConfirm:()=>n().then(g=>{s(!1)},g=>{typeof g=="string"?z.error(g):z.error(g.message)}),submitting:d,updateOrderType:x,updateQuantity:y}},qo=e=>{let i=Oo(e);return t.jsx(ko,{...i})},Do=e=>{let{t:i}=_();return t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:r=>{r.stopPropagation(),r.preventDefault(),e.openTP_SL()},children:i("common.tpsl")})},Lo=e=>{let i=je()[e.state.item.symbol](),{tpslOrder:r}=_e(),{t:s}=_();return{openTP_SL:()=>{de.sheet({title:s("common.tpsl"),content:t.jsx(hr,{position:e.state.item,symbolInfo:i,order:r,isEditing:!1})})},...e,...i}},Io=e=>{let i=Lo(e);return t.jsx(Do,{...i})},To=e=>{let{className:i,...r}=e;return t.jsxs(h,{direction:"column",width:"100%",gap:2,p:2,r:"xl",itemAlign:"start",className:I(i,"oui-bg-base-9"),children:[t.jsx($o,{...r}),t.jsx(ge,{intensity:6,className:"oui-w-full"}),t.jsx(Eo,{...r}),t.jsx(No,{...r}),t.jsx(Mo,{...r})]})},$o=e=>t.jsxs(h,{justify:"between",width:"100%",children:[t.jsx(go,{...e}),t.jsx(fo,{...e})]}),Eo=e=>t.jsxs(fe,{cols:3,rows:2,gap:2,width:"100%",children:[t.jsx(yo,{...e}),t.jsx(bo,{...e}),t.jsx(jo,{...e}),t.jsx(_o,{...e}),t.jsx(wo,{...e}),t.jsx(vo,{...e})]}),Mo=e=>t.jsxs(fe,{width:"100%",gap:2,cols:3,rows:1,children:[t.jsx(Io,{state:e}),t.jsx(So,{state:e}),t.jsx(qo,{state:e})]}),zo=e=>{let i=be();return{...e,...i}},Ao=e=>{let i=zo(e);return t.jsx(To,{...i,className:e.className})},Fo=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r,pagination:s}=e,n=xo({pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange});return t.jsx(jt,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:n,bordered:!0,dataSource:e.dataSource,generatedRowKey:o=>o.symbol,renderRowContainer:(o,a,l)=>t.jsx(vt,{symbol:o.symbol,children:t.jsx(fr,{position:o,children:l})}),manualPagination:!1,pagination:s,testIds:{body:"oui-testid-dataList-position-tab-body"}})},Ro=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e;return t.jsx(yt,{className:"oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",contentClassName:"!oui-space-y-1",dataSource:e.dataSource,renderItem:(s,n)=>t.jsx(vt,{symbol:s.symbol,children:t.jsx(fr,{position:s,children:t.jsx(Ao,{item:s,index:n,pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange})})})})},_r=e=>{let{symbol:i,calcMode:r,includedPendingOrder:s,pnlNotionalDecimalPrecision:n,sharePnLConfig:o,onSymbolChange:a}=e,{pagination:l,setPage:d}=ft({pageSize:50}),[m,p,{isLoading:x}]=Ni(i,{calcMode:r,includedPendingOrder:s});return c.useEffect(()=>{d(1)},[i]),{dataSource:bt(m==null?void 0:m.rows,{fallbackData:[]})??void 0,isLoading:x,pnlNotionalDecimalPrecision:n,sharePnLConfig:o,symbol:i,onSymbolChange:a,pagination:l}},Ql=e=>{let i=_r(e);return t.jsx(Fo,{...i})},Hl=e=>{let i=_r(e);return t.jsx(Ro,{...i})},Uo=e=>{let{onSymbolChange:i,pnlNotionalDecimalPrecision:r}=e,{t:s}=_();return c.useMemo(()=>[{title:s("common.symbol"),dataIndex:"symbol",fixed:"left",width:200,onSort:(n,o)=>n.symbol.localeCompare(o.symbol),render:(n,o)=>t.jsx(Wo,{record:o,onSymbolChange:i})},{title:s("positions.history.column.closed&maxClosed"),dataIndex:"close_maxClose",width:200,render:(n,o)=>t.jsx(Bo,{record:o})},{title:s("positions.history.column.netPnl"),dataIndex:"netPnL",width:140,onSort:(n,o)=>n.netPnL==null||o.netPnL==null?-1:(n.netPnL??0)-(o.netPnL??0),render:(n,o)=>t.jsxs(h,{gapX:1,children:[t.jsx(Vo,{record:o,pnlNotionalDecimalPrecision:r}),t.jsx(Nt,{position:o,sharePnLConfig:e.sharePnLConfig,modalId:_t,isPositionHistory:!0})]})},{title:s("common.avgPrice"),dataIndex:"avg_open",width:140,render:(n,o)=>{let a=o.avg_open_price!=null?Math.abs(o.avg_open_price):"--",{quote_dp:l}=be();return t.jsx(u.numeral,{dp:l,padding:!1,children:a})}},{title:s("common.avgClose"),dataIndex:"avg_close",width:175,render:(n,o)=>{let a=o.avg_close_price!=null?Math.abs(o.avg_close_price):"--",{quote_dp:l}=be();return t.jsx(u.numeral,{dp:l,padding:!1,children:a})}},{title:s("positions.history.column.timeOpened"),dataIndex:"open_timestamp",width:175,onSort:!0,render:(n,o)=>t.jsx(u.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.open_timestamp})},{title:s("positions.history.column.timeClosed"),dataIndex:"close_timestamp",width:175,onSort:!0,render:(n,o)=>o.position_status=="closed"&&o.close_timestamp?t.jsx(u.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.close_timestamp??"--"}):"--"},{title:s("positions.history.column.updatedTime"),dataIndex:"last_update_time",width:175,onSort:!0,render:(n,o)=>t.jsx(u.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.last_update_time})}],[r,s])},Wo=e=>{let{record:i,onSymbolChange:r}=e,{t:s}=_(),n=c.useMemo(()=>{let o=[],a=i.position_status,l=()=>a==="closed"?s("positions.history.status.closed"):a==="partial_closed"?s("positions.history.status.partialClosed"):zi(a.replace("_"," "));return o.push(t.jsx(H,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:l()})),i.type==="adl"?o.push(t.jsx(H,{color:"danger",size:"xs",children:s("positions.history.type.adl")})):i.type==="liquidated"&&o.push(t.jsx(ye,{className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},content:t.jsxs(h,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[i.liquidation_id!=null&&t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("positions.history.liquidated.liquidationId")}),t.jsx(u,{intensity:98,children:i.liquidation_id})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("positions.history.liquidated.liquidatorFee")}),t.jsxs(u,{color:"lose",children:[i.liquidator_fee>0&&"-",G(i.liquidator_fee)]})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("positions.history.liquidated.insFundFee")}),t.jsxs(u,{color:"lose",children:[i.insurance_fund_fee>0&&"-",G(i.insurance_fund_fee)]})]})]}),children:t.jsx("div",{children:t.jsx(H,{size:"xs",color:"danger",className:"oui-cursor-pointer",children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:s("positions.history.type.liquidated")})})})})),o},[i,s]);return t.jsxs(h,{gap:2,height:48,children:[t.jsx(X,{width:4,height:38,className:I("oui-rounded-[1px] oui-shrink-0",i.side==="LONG"?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(h,{direction:"column",itemAlign:"start",children:[t.jsx(u.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:o=>{r==null||r({symbol:i.symbol}),o.stopPropagation(),o.preventDefault()},children:`${i.symbol.split("_")[1]}-PERP`}),t.jsx(h,{gap:1,children:n})]})]})},Bo=e=>{let{record:i}=e,{base_dp:r}=be();return t.jsxs(h,{gap:1,direction:"column",itemAlign:"start",className:"oui-overflow-hidden oui-whitespace-nowrap oui-text-ellipsis",children:[t.jsx(u.numeral,{dp:r,padding:!1,children:Math.abs(i.closed_position_qty)}),t.jsx(u.numeral,{dp:r,padding:!1,className:"oui-truncate",children:Math.abs(i.max_position_qty)})]})},Vo=e=>{let{record:i,pnlNotionalDecimalPrecision:r}=e,{t:s}=_(),n=i.netPnL!=null?i.netPnL:void 0,o=()=>t.jsx(u.numeral,{dp:r,color:i.netPnL!=null?i.netPnL>0?"profit":"lose":void 0,className:n==null?"":"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:n??"--"});return i.netPnL==null?o():t.jsx(ye,{delayDuration:200,content:t.jsxs(h,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[t.jsx(u,{intensity:80,children:s("positions.history.column.netPnl")}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("common.realizedPnl")}),t.jsx(u,{color:i.realized_pnl>=0?"profit":"lose",className:"oui-cursor-pointer",children:G(i.realized_pnl)})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("positions.history.netPnl.fundingFee")}),t.jsx(u,{color:i.accumulated_funding_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:G(-i.accumulated_funding_fee)})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:s("positions.history.netPnl.tradingFee")}),t.jsx(u,{color:i.trading_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:G(-i.trading_fee)})]})]}),className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:t.jsx("div",{children:o()})})};function ue(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function ce(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var pt=e=>({from:ue(e.from),to:ce(e.to??e.from)}),ht=(e,i)=>e.getTime()===i.getTime(),wr=e=>{let{onSymbolChange:i,symbol:r,pnlNotionalDecimalPrecision:s}=e,{state:n}=We(),{data:o,isLoading:a}=Ci(r?`/v1/position_history?symbol=${r}&limit=1000`:"/v1/position_history?limit=1000",{formatter(w){var v;return(v=w.rows??null)==null?void 0:v.map(P=>{if(P.realized_pnl!=null&&P.accumulated_funding_fee!=null&&P.trading_fee!=null){let k=P.realized_pnl-P.accumulated_funding_fee-P.trading_fee;return{...P,netPnL:k}}return P})},revalidateOnFocus:!0}),{pagination:l,setPage:d}=ft({pageSize:10}),{status:m,side:p,dateRange:x,filterDays:y,updateFilterDays:b,filterItems:g,onFilter:j}=Qo();c.useEffect(()=>{d(1)},[m,p,x,y,r]);let f=c.useMemo(()=>o==null?o:o.filter(w=>{let v=p==="all"?!0:w.side.toLowerCase()===p.toLowerCase(),P=m==="all"?!0:w.position_status.toLowerCase()===m.toLowerCase(),k=(w==null?void 0:w.last_update_time)??w.open_timestamp,$=x.from&&x.to?k>=x.from.getTime()&&k<=x.to.getTime():!0,T=r?w.symbol==r:!0;return v&&P&&$&&T}),[m,p,x,o,r]);return{dataSource:bt(f,{accountStatus:n.status===Fe.EnableTradingWithoutConnected?Fe.EnableTradingWithoutConnected:Fe.EnableTrading,fallbackData:[]}),isLoading:a,onSymbolChange:i,pagination:l,filterItems:g,onFilter:j,symbol:r,filterDays:y,updateFilterDays:b,pnlNotionalDecimalPrecision:s}},Qo=()=>{let{t:e}=_(),[i,r]=c.useState("all"),[s,n]=c.useState("all"),o=pt({to:ce(new Date),from:ue(oe(new Date,89))}),[a,l]=c.useState(90),[d,m]=c.useState(o),p=b=>{l(b),m({from:ue(oe(new Date,b-1)),to:ce(new Date)})},x=b=>{if(b.name==="side"&&n(b.value),b.name==="status"&&r(b.value),b.name==="dateRange"){let g=pt(b.value);if(m(g),g.from&&g.to){let j=Math.abs(Ht(g.from,g.to))+1,f={1:{from:ue(new Date),to:ce(new Date)},7:{from:ue(oe(new Date,6)),to:ce(new Date)},30:{from:ue(oe(new Date,29)),to:ce(new Date)},90:{from:ue(oe(new Date,89)),to:ce(new Date)}}[j];f&&ht(f.from,g.from)&&ht(f.to,g.to)?l(j):l(null)}}},{isMobile:y}=Mi();return{filterItems:c.useMemo(()=>{let b={type:"select",name:"side",options:[{label:e("common.side.all"),value:"all"},{label:e("common.buy"),value:"LONG"},{label:e("common.sell"),value:"SHORT"}],value:s},g={type:"range",name:"dateRange",value:d,fromDate:ue(oe(new Date,89)),toDate:ce(new Date)},j={type:"select",name:"status",options:[{label:e("common.status.all"),value:"all"},{label:e("positions.history.status.closed"),value:"closed"},{label:e("positions.history.status.partialClosed"),value:"partial_closed"}],value:i};return y?[b,j]:[b,j,g]},[s,i,d]),onFilter:x,side:s,dateRange:d,status:i,filterDays:a,updateFilterDays:p}},Ho=e=>{let{side:i,symbol:r}=e.item,{t:s}=_(),n=i==="LONG";return t.jsx(u.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(H,{color:n?"success":"danger",size:"xs",children:s(n?"common.buy":"common.sell")}),onClick:()=>{var o;(o=e.onSymbolChange)==null||o.call(e,{symbol:r})},children:r})},Ko=e=>{let{item:i}=e,{t:r}=_(),s=()=>{de.alert({title:r("positions.liquidation"),message:t.jsxs(h,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[i.liquidation_id!=null&&t.jsxs(h,{justify:"between",width:"100%",children:[t.jsx(u,{children:r("positions.history.liquidated.liquidationId")}),t.jsx(u,{intensity:98,children:i.liquidation_id})]}),t.jsxs(h,{justify:"between",width:"100%",children:[t.jsx(u,{children:r("positions.history.liquidated.liquidatorFee")}),t.jsxs(u,{color:"lose",children:[i.liquidator_fee>0&&"-",G(i.liquidator_fee)]})]}),t.jsxs(h,{justify:"between",width:"100%",children:[t.jsx(u,{children:r("positions.history.liquidated.insFundFee")}),t.jsxs(u,{color:"lose",children:[i.insurance_fund_fee>0&&"-",G(i.insurance_fund_fee)]})]})]})})},n=c.useMemo(()=>{let o=[],a=i.position_status,l=()=>a==="closed"?r("positions.history.status.closed"):a==="partial_closed"?r("positions.history.status.partialClosed"):zi(a.replace("_"," "));return o.push(t.jsx(H,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",children:l()})),i.type==="adl"?o.push(t.jsx(H,{color:"danger",size:"xs",children:r("positions.history.type.adl")})):i.type==="liquidated"&&o.push(t.jsx(H,{size:"xs",color:"danger",className:"oui-cursor-pointer",onClick:s,children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:r("positions.history.type.liquidated")})})),o},[i]);return t.jsx(h,{gap:1,children:n})},Yo=e=>{let{item:i}=e,{t:r}=_(),s=i.closed_position_qty!=null?Math.abs(i.closed_position_qty):"--";return t.jsx(Z,{label:t.jsx(u,{children:r("positions.history.column.closed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:s})})},Xo=e=>{let{item:i}=e,{t:r}=_(),s=i.max_position_qty!=null?Math.abs(i.max_position_qty):"--";return t.jsx(Z,{label:t.jsx(u,{children:r("positions.history.column.maxClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:s})})},Go=e=>{let{item:i}=e,r=i.avg_open_price!=null?Math.abs(i.avg_open_price):"--",{t:s}=_();return t.jsx(Z,{label:t.jsxs(h,{gap:1,children:[s("common.avgOpen"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:r})})},Jo=e=>{let{item:i}=e,r=i.avg_close_price!=null?Math.abs(i.avg_close_price):"--",{t:s}=_();return t.jsx(Z,{label:t.jsxs(h,{gap:1,children:[s("common.avgClose"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:r})})},Zo=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:t.jsx(u,{children:r("positions.history.column.timeOpened")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsx(u.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.open_timestamp})})},ea=e=>{let{item:i}=e,{t:r}=_(),s=i.position_status=="closed"&&i.close_timestamp?t.jsx(u.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.close_timestamp}):"--";return t.jsx(Z,{label:t.jsx(u,{children:r("positions.history.column.timeClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:s})},ta=e=>{var i;return t.jsxs(h,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(ia,{...e}),t.jsx(ge,{intensity:6,className:"oui-w-full"}),t.jsx(ra,{...e})]})},ia=e=>{let{t:i}=_(),r=()=>{let{item:s}=e;de.alert({title:i("positions.history.column.netPnl"),message:t.jsxs(h,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:i("common.realizedPnl")}),t.jsx(u,{color:s.realized_pnl>=0?"profit":"lose",children:G(s.realized_pnl)})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:i("positions.history.netPnl.fundingFee")}),t.jsx(u,{color:s.accumulated_funding_fee>0?"lose":"profit",children:G(-s.accumulated_funding_fee)})]}),t.jsxs(h,{justify:"between",width:"100%",gap:2,children:[t.jsx(u,{intensity:54,children:i("positions.history.netPnl.tradingFee")}),t.jsx(u,{color:s.trading_fee>0?"lose":"profit",children:G(-s.trading_fee)})]})]})})};return t.jsxs(h,{gap:1,width:"100%",children:[t.jsxs(h,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(Ho,{...e}),t.jsx(Ko,{...e})]}),t.jsxs(h,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(u,{size:"2xs",intensity:36,children:i("positions.history.column.netPnl")}),t.jsxs(h,{gapX:1,children:[t.jsx("button",{onClick:r,children:t.jsx(u.numeral,{size:"xs",coloring:!0,children:e.item.netPnL??"--"})}),t.jsx(Nt,{position:e.item,sharePnLConfig:e.sharePnLConfig,modalId:wt,iconSize:12,isPositionHistory:!0})]})]})]})},ra=e=>t.jsxs(fe,{cols:3,rows:2,width:"100%",gap:0,className:"oui-grid-cols-[1fr,1fr,135px]",children:[t.jsx(Yo,{...e}),t.jsx(Xo,{...e}),t.jsx(Zo,{...e}),t.jsx(Go,{...e}),t.jsx(Jo,{...e}),t.jsx(ea,{...e})]}),sa=e=>{let i=be();return{...e,...i}},na=e=>{let i=sa(e);return t.jsx(ta,{...i})},oa=e=>{let{onSymbolChange:i,pagination:r,pnlNotionalDecimalPrecision:s}=e,n=Uo({onSymbolChange:i,pnlNotionalDecimalPrecision:s,sharePnLConfig:e.sharePnLConfig}),{t:o}=_(),a=c.useMemo(()=>({1:o("common.select.1d"),7:o("common.select.7d"),30:o("common.select.30d"),90:o("common.select.90d")}),[o]);return t.jsxs(h,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(h,{gap:3,children:[e.filterItems.length>0&&t.jsx(et,{items:e.filterItems,onFilter:l=>{e.onFilter(l)}}),[1,7,30,90].map(l=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(u.gradient,{color:e.filterDays===l?"brand":void 0,className:I("oui-break-normal oui-whitespace-nowrap",e.filterDays!==l?"oui-text-base-contrast-54":""),children:a[l]||`${l}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(l)}})]}))]}),t.jsx(jt,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:n,bordered:!0,dataSource:e.dataSource,generatedRowKey:l=>`${l.symbol}_${l.position_id}`,renderRowContainer:(l,d,m)=>t.jsx(vt,{symbol:l.symbol,children:m}),manualPagination:!1,pagination:r,testIds:{body:"oui-testid-dataList-positionHistory-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},aa=e=>{var i,r;return t.jsxs(fe,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(h,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(et,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:s=>{e.onFilter(s)}})}),t.jsx(yt,{className:I("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:I("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,renderItem:(s,n)=>{var o;return t.jsx(vt,{symbol:s.symbol,children:t.jsx(na,{item:s,index:n,onSymbolChange:e.onSymbolChange,classNames:{root:(o=e.classNames)==null?void 0:o.cell},sharePnLConfig:e.sharePnLConfig})})}})]})},Kl=e=>{let i=wr(e);return t.jsx(oa,{...i,sharePnLConfig:e.sharePnLConfig})},Yl=e=>{let{classNames:i,...r}=e,s=wr(r);return t.jsx(aa,{...s,classNames:i,sharePnLConfig:e.sharePnLConfig})},la=e=>{let{t:i}=_();return c.useMemo(()=>[{title:i("common.time"),dataIndex:"timestamp",fixed:"left",width:202,render:r=>t.jsx(u.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:r})},{title:i("positions.Liquidation.column.liquidationId"),dataIndex:"liquidation_id",width:202,render:r=>t.jsx(u,{children:r})},{title:i("positions.Liquidation.column.insFundTransfer"),dataIndex:"transfer_amount_to_insurance_fund",width:202,render:r=>t.jsx(u,{children:G(r)})},{title:i("common.symbol"),dataIndex:"Symbol",width:202,render:(r,s)=>{var n;return t.jsx(h,{direction:"column",itemAlign:"start",children:(n=s.positions_by_perp)==null?void 0:n.map(o=>t.jsx(u.formatted,{rule:"symbol",formatString:"base-quote",children:o.symbol}))})}},{title:`${i("common.price")} (USDC)`,dataIndex:"Price_(USDC)",width:202,render:(r,s)=>{var n;return t.jsx(h,{direction:"column",itemAlign:"start",children:(n=s.positions_by_perp)==null?void 0:n.map(o=>t.jsx(Lt,{value:o.transfer_price,type:"quote"}))})}},{title:i("common.quantity"),dataIndex:"Quantity",width:202,render:(r,s)=>{var n;return t.jsx(h,{direction:"column",itemAlign:"start",children:(n=s.positions_by_perp)==null?void 0:n.map(o=>t.jsx(Lt,{value:o.position_qty,type:"base"}))})}},{title:i("positions.Liquidation.column.liquidationFee"),dataIndex:"abs_liquidation_fee",width:202,render:(r,s)=>{var n;return t.jsx(h,{direction:"column",itemAlign:"start",children:(n=s.positions_by_perp)==null?void 0:n.map(o=>t.jsx(Lt,{value:o.abs_liquidation_fee,type:"quote"}))})}}],[i])},Lt=e=>t.jsx(u,{children:G(e.value)}),da=e=>{let{t:i}=_();return t.jsxs(h,{width:"100%",justify:"between",children:[t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",intensity:36,children:i("common.price")}),t.jsx(u,{size:"2xs",intensity:20,children:"(USDC)"})]}),t.jsx(u,{size:"2xs",intensity:80,children:G(e.transfer_price)})]})},ua=e=>{let{t:i}=_();return t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u,{size:"2xs",intensity:36,children:i("common.quantity")}),t.jsx(u,{size:"2xs",intensity:80,children:G(e.position_qty)})]})},ca=e=>{let{t:i}=_();return t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u,{size:"2xs",intensity:36,children:i("positions.Liquidation.column.liquidationFee")}),t.jsx(u,{size:"2xs",intensity:80,children:G(e.abs_liquidation_fee)})]})},ma=e=>{var i;return t.jsxs(h,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(pa,{...e}),t.jsx(ha,{...e})]},e.item.timestamp)},pa=e=>{let{t:i}=_();return t.jsxs(h,{gap:1,width:"100%",children:[t.jsxs(h,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(u.formatted,{size:"2xs",intensity:36,rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:e.item.timestamp}),t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",intensity:36,children:`${i("positions.Liquidation.column.liquidationId")}:`}),t.jsx(u,{size:"2xs",intensity:80,children:` ${e.item.liquidation_id}`})]})]}),t.jsxs(h,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(u,{size:"2xs",intensity:36,children:`${i("positions.Liquidation.column.insFundTransfer")}:`}),t.jsx(u,{intensity:80,size:"xs",children:G(e.item.transfer_amount_to_insurance_fund)})]})]})},ha=e=>{var i;return t.jsx(h,{direction:"column",width:"100%",children:(i=e.item.positions_by_perp)==null?void 0:i.map((r,s)=>t.jsx(xa,{isLast:s===e.item.positions_by_perp.length-1,...r},`${s}-${r.symbol}`))})},xa=e=>t.jsxs(h,{width:"100%",itemAlign:"start",className:I("oui-border-t-[1px] oui-border-line-6 oui-pt-2",!e.isLast&&"oui-pb-2"),children:[t.jsx(u.formatted,{rule:"symbol",formatString:"base-quote",size:"xs",intensity:80,className:"oui-flex-1",children:e.symbol}),t.jsxs(fe,{cols:1,rows:3,width:"100%",gap:1,className:"oui-flex-1",children:[t.jsx(da,{...e}),t.jsx(ua,{...e}),t.jsx(ca,{...e})]})]},e.key),ga=e=>({...e}),fa=e=>{let{classNames:i,...r}=e,s=ga(r);return t.jsx(ma,{classNames:i,...s})},ya=e=>{let i=la();return t.jsxs(h,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(h,{gap:3,children:[e.filterItems.length>0&&t.jsx(et,{items:e.filterItems,onFilter:r=>{e.onFilter(r)}}),[1,7,30,90].map(r=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(u.gradient,{color:e.filterDays===r?"brand":void 0,className:e.filterDays!==r?"oui-text-base-contrast-54":"",children:`${r}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(r)}})]}))]}),t.jsx(jt,{loading:e.isLoading,id:"oui-desktop-liquidation-content",columns:i,bordered:!0,dataSource:e.dataSource,generatedRowKey:r=>`${r.liquidation_id}`,pagination:e.pagination,testIds:{body:"oui-testid-dataList-liquidation-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},ba=e=>{var i,r;return t.jsxs(fe,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(h,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(et,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:s=>{e.onFilter(s)}})}),t.jsx(yt,{className:I("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:I("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,loadMore:e.loadMore,renderItem:(s,n)=>{var o;return t.jsx(fa,{item:s,index:n,classNames:{root:(o=e.classNames)==null?void 0:o.cell}})}})]})},vr=e=>{let{symbol:i,enableLoadMore:r}=e,{page:s,pageSize:n,setPage:o,parsePagination:a}=ft({pageSize:10}),{dateRange:l,filterDays:d,updateFilterDays:m,filterItems:p,onFilter:x}=_a();c.useEffect(()=>{o(1)},[i,l,d]);let[y,{meta:b,isLoading:g,loadMore:j}]=ja({page:r?void 0:s,size:n,symbol:i,start_t:l.from!=null?l.from.getTime():void 0,end_t:l.to!=null?l.to.getTime():void 0});return{dataSource:bt(y,{fallbackData:[]}),isLoading:g,loadMore:j,pagination:a(b),dateRange:l,filterDays:d,updateFilterDays:m,filterItems:p,onFilter:x}},ja=e=>{var o;let i=as(wa(e),{initialSize:1,formatter:a=>a,revalidateOnFocus:!0}),r=c.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a[0])==null?void 0:l.meta},[(o=i.data)==null?void 0:o[0]]),s=c.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a.map(d=>d.rows))==null?void 0:l.flat()},[i.data]),n=i.isLoading;return[s,{meta:r,isLoading:n,loadMore:()=>{i.setSize(i.size+1)}}]},_a=()=>{let e=pt({to:ce(new Date),from:ue(oe(new Date,89))}),[i,r]=c.useState(90),[s,n]=c.useState(e),o=d=>{r(d),n({from:ue(oe(new Date,d-1)),to:ce(new Date)})},a=d=>{if(d.name==="dateRange"){let m=pt(d.value);if(n(m),m.from&&m.to){let p=Math.abs(Ht(m.from,m.to))+1,x={1:{from:ue(new Date),to:ce(new Date)},7:{from:ue(oe(new Date,6)),to:ce(new Date)},30:{from:ue(oe(new Date,29)),to:ce(new Date)},90:{from:ue(oe(new Date,89)),to:ce(new Date)}}[p];x&&ht(x.from,m.from)&&ht(x.to,m.to)?r(p):r(null)}}},{isMobile:l}=Mi();return{filterItems:c.useMemo(()=>{let d={type:"range",name:"dateRange",value:s,fromDate:ue(oe(new Date,89)),toDate:ce(new Date)};return l?[d]:[d]},[s]),onFilter:a,dateRange:s,filterDays:i,updateFilterDays:o}},wa=e=>(i,r)=>{var m;if(r&&!((m=r.rows)!=null&&m.length))return null;let{symbol:s,size:n=10,page:o,end_t:a,start_t:l}=e,d=new URLSearchParams([["size",n.toString()],["page",`${i+1}`]]);return o&&d.set("page",`${o}`),s&&d.set("symbol",s),a&&d.set("end_t",`${a}`),l&&d.set("start_t",`${l}`),`/v1/liquidations?${d.toString()}`},Xl=e=>{let i=vr(e);return t.jsx(ya,{...i})},Gl=e=>{let{classNames:i,...r}=e,s=vr(r);return t.jsx(ba,{classNames:i,...s})},va="MarketCloseConfirmID";xt(va,Gt,{size:"md",closable:!1});var Na=e=>{let{current:i,pnlNotionalDecimalPrecision:r,sharePnLConfig:s}=e,n=c.useRef(null);return c.useImperativeHandle(e.ref,()=>({download:()=>{var o,a;(a=(o=n.current)==null?void 0:o.download)==null||a.call(o)}})),{current:i,pnlNotionalDecimalPrecision:r,orderListRef:n,sharePnLConfig:s}},Je=e=>e===void 0||e.length===0?e:e.length===1?e.charAt(0).toUpperCase():e.charAt(0).toUpperCase()+e.toLowerCase().slice(1);function Ze(e){var s,n;let i=e.type,r=e.algo_type;if(typeof i<"u"){let o=[];if(e.parent_algo_type){if(r===le.STOP_LOSS){let l=i===Y.CLOSE_POSITION?[O.t("common.position"),O.t("tpsl.sl")]:[O.t("tpsl.sl")];o.push(...l)}if(r===le.TAKE_PROFIT){let l=i===Y.CLOSE_POSITION?[O.t("common.position"),O.t("tpsl.tp")]:[O.t("tpsl.tp")];o.push(...l)}return o}let a=typeof i=="string"?i.replace("_ORDER",""):"";if([Y.ASK,Y.BID].includes(i))return[O.t("orderEntry.orderType.limit")];if(e.algo_order_id===void 0||e.algo_order_id&&r==="BRACKET")return[{[Y.LIMIT]:O.t("orderEntry.orderType.limit"),[Y.MARKET]:O.t("orderEntry.orderType.market"),[Y.POST_ONLY]:O.t("orderEntry.orderType.postOnly"),[Y.IOC]:O.t("orderEntry.orderType.ioc"),[Y.FOK]:O.t("orderEntry.orderType.fok")}[a]||Je(a)];if(a)return[{[Y.LIMIT]:O.t("orderEntry.orderType.stopLimit"),[Y.MARKET]:O.t("orderEntry.orderType.stopMarket")}[a]||a]}if(typeof r<"u"){let o=[];r===V.POSITIONAL_TP_SL&&o.push(O.t("common.position"));let a=(s=e==null?void 0:e.child_orders)==null?void 0:s.find(d=>d.algo_type===le.TAKE_PROFIT&&!!d.trigger_price),l=(n=e==null?void 0:e.child_orders)==null?void 0:n.find(d=>d.algo_type===le.STOP_LOSS&&!!d.trigger_price);return(a||l)&&o.push(a&&l?O.t("common.tpsl"):a?O.t("tpsl.tp"):O.t("tpsl.sl")),o}}function rt(e){return e.status===U.CANCELLED||e.algo_status===U.CANCELLED}function Ca(e){var n,o,a;if(e.algo_type!==V.BRACKET)return{tpOrder:void 0,slOrder:void 0};let i=(n=e.child_orders)==null?void 0:n[0];if(!i)return{tpOrder:void 0,slOrder:void 0};let r=(o=i==null?void 0:i.child_orders)==null?void 0:o.find(l=>l.algo_type===le.TAKE_PROFIT),s=(a=i==null?void 0:i.child_orders)==null?void 0:a.find(l=>l.algo_type===le.STOP_LOSS);return{tpOrder:r,slOrder:s}}function Nr(e){let i={pnl:{tpPnL:void 0,slPnL:void 0},roi:{tpRoi:void 0,slRoi:void 0}},{tpOrder:r,slOrder:s}=Ca(e);if(!r&&!s||typeof e.price===void 0||!e.price)return i;let n=e.side===pe.BUY?e.quantity:e.quantity*-1,o=(r==null?void 0:r.trigger_price)&&ie.priceToPnl({qty:n,price:r==null?void 0:r.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:r.algo_type}),a=(s==null?void 0:s.trigger_price)&&ie.priceToPnl({qty:n,price:s==null?void 0:s.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:s.algo_type}),l=o?ie.calcTPSL_ROI({pnl:o,qty:e.quantity,price:e.price}):void 0,d=a?ie.calcTPSL_ROI({pnl:a,qty:e.quantity,price:e.price}):void 0;return{pnl:{tpPnL:o,slPnL:a},roi:{tpRoi:l,slRoi:d}}}function hi(e,i){return!e||!i?!1:e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()}var Jt=e=>{let{type:i,base:r,value:s,cancelPopover:n,isSubmitting:o,onConfirm:a}=e,{t:l}=_();return t.jsxs("div",{className:"oui-pt-5 oui-relative",children:[t.jsx("div",{className:"oui-text-base-contrast-54 oui-text-2xs desktop:oui-text-sm",children:(()=>{let d={values:{base:r,value:Ri(s)},components:[t.jsx("span",{className:"oui-text-warning-darken"})]};switch(i){case 0:return t.jsx(ut,{i18nKey:"order.edit.confirm.quantity",...d});case 1:return t.jsx(ut,{i18nKey:"order.edit.confirm.price",...d});case 2:return t.jsx(ut,{i18nKey:"order.edit.confirm.triggerPrice",...d})}})()}),t.jsxs("div",{className:"oui-grid oui-grid-cols-2 oui-gap-2 oui-mt-5",children:[t.jsx(J,{color:"secondary",size:"md",onClick:n,disabled:o,children:l("common.cancel")}),t.jsx(Be,{size:"md",loading:o,onClick:a,children:l("common.confirm")})]}),t.jsx("button",{className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54",onClick:n,children:t.jsx(Ui,{size:16,color:"white",opacity:1})})]})},Zt=e=>{let{inputRef:i,dp:r,value:s,setValue:n,setEditing:o,error:a,handleKeyDown:l,onClick:d,onClose:m,onFocus:p,onBlur:x,hintInfo:y}=e;c.useEffect(()=>{let g=i.current;if(g){let j=g.value.length;g.setSelectionRange(j,j)}o(!0)},[]);let b=((y==null?void 0:y.length)||0)>0;return t.jsx(ye,{content:y,open:b,children:t.jsx(me,{ref:i,type:"text",size:"sm",formatters:[Q.numberFormatter,Q.dpFormatter(r),Q.currencyFormatter],value:s,onValueChange:g=>n(g),helpText:a,onClick:g=>{g.stopPropagation(),g.preventDefault()},autoComplete:"off",onFocus:p,onBlur:x,onKeyDown:l,autoFocus:!0,color:b?"danger":void 0,classNames:{root:"oui-bg-base-700 oui-px-2 oui-py-1 oui-rounded",input:"oui-pr-2"},suffix:t.jsx("button",{onClick:d,children:t.jsx(ws,{size:18,color:"white",opacity:1,className:"oui-cursor-pointer oui-opacity-50 hover:oui-opacity-100"})})})})},Cr=c.createContext({}),He=()=>c.useContext(Cr),Pr=e=>{let{cancelOrder:i,editOrder:r,cancelAlgoOrder:s,editAlgoOrder:n}=e,{t:o}=_(),a=je(),l=c.useCallback(async p=>p.algo_order_id!==void 0?"root_algo_order_id"in p&&p.root_algo_order_id!==p.algo_order_id?s(p.root_algo_order_id,p.symbol):s(p.algo_order_id,p.symbol).then(()=>{}):i(p.order_id,p.symbol).then(()=>{}),[]),d=c.useCallback(async(p,x)=>{p.visible_quantity!==void 0?p.visible_quantity:p.visible!==void 0&&p.visible,await de.sheet({title:o("orders.editOrder"),classNames:{content:"oui-edit-order-sheet-content"},content:t.jsx(t.Fragment,{children:"Content"})})},[o]),m=c.useCallback((p,x,y)=>{let{min_notional:b}=a[p](),g=ys({price:x,qty:y,min_notional:b});if(g!==void 0)return o("orderEntry.total.error.min",{value:g})},[a,o]);return t.jsx(Cr.Provider,{value:{onCancelOrder:l,onEditOrder:d,editOrder:r,editAlgoOrder:n,checkMinNotional:m},children:e.children})},Sr=c.createContext({}),ve=()=>c.useContext(Sr),kr=e=>{let i=je()[e.symbol];return t.jsx(Sr.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},Or=c.createContext({}),Oe=()=>c.useContext(Or),qr=e=>{let{quote_dp:i}=ve(),[r,s]=c.useState(),[n]=Mt("/v1/algo/order","DELETE"),[o]=Mt("/v1/algo/order","PUT"),a=bs(),{state:l}=We(),d=c.useMemo(()=>js(()=>["/v1/positions",l.accountId]),[l.accountId]),m=async f=>n(null,{order_id:f.algo_order_id,symbol:f.symbol}),p=async(f,w)=>o({order_id:f.algo_order_id,child_orders:f.child_orders.map(v=>({order_id:v.algo_order_id,quantity:w.order_quantity}))}),x=f=>{var w;return(w=a.cache.get(d))==null?void 0:w.data.rows.find(v=>v.symbol===f)},{sl_trigger_price:y,tp_trigger_price:b,tpPnL:g,slPnL:j}=Pa({order:e.order,position:r,quote_dp:i});return c.useEffect(()=>{var f;if("algo_type"in e.order||(((f=e.order)==null?void 0:f.reduce_only)??!1)){let w=x(e.order.symbol);w&&s(w)}},[e.order.symbol]),t.jsx(Or.Provider,{value:{order:e.order,sl_trigger_price:y,tp_trigger_price:b,tpPnL:g,slPnL:j,onCancelOrder:m,onUpdateOrder:p,getRelatedPosition:x,position:r},children:e.children})};function Pa(e){var p;let{order:i,position:r,quote_dp:s}=e;if(!r)return{sl_trigger_price:void 0,tp_trigger_price:void 0,slPnL:void 0,tpPnL:void 0};let{sl_trigger_price:n,tp_trigger_price:o}=!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ie.findTPSLFromOrder(i),a=i.quantity;a===0&&((p=i.child_orders)==null?void 0:p[0].type)==="CLOSE_POSITION"&&(a=r.position_qty);let l=r.average_open_price,d=typeof a=="number"&&typeof o=="number"&&typeof l=="number"?ie.priceToPnl({qty:a,price:o,entryPrice:r.average_open_price,orderSide:i.side,orderType:le.TAKE_PROFIT},{symbol:{quote_dp:s}}):void 0,m=typeof a=="number"&&typeof n=="number"&&typeof l=="number"?ie.priceToPnl({qty:a,price:n,entryPrice:r.average_open_price,orderSide:i.side,orderType:le.STOP_LOSS},{symbol:{quote_dp:s}}):void 0;return{sl_trigger_price:n,tp_trigger_price:o,slPnL:m,tpPnL:d}}var Dr=e=>{let{order:i,otherOrderQuantity:r}=e,{reduce_only:s}=i,[n,o]=c.useState(i.quantity.toString()),[a,l]=c.useState(!1),{t:d}=_();c.useEffect(()=>{$(i.quantity.toString())},[e.order.quantity]);let[m,p]=c.useState(!1),[x,y]=c.useState(),{editOrder:b,editAlgoOrder:g,checkMinNotional:j}=He(),{onUpdateOrder:f,position:w}=Oe(),{base_dp:v,base:P,base_tick:k}=ve(),$=async(D,ee)=>{o(D);let re=Math.abs((w==null?void 0:w.position_qty)||0);if(w&&s&&Number(D)>re)y(d("orders.quantity.lessThanPosition",{quantity:re}));else{let he=Number(D);ee&&he>ee?y(d("orders.quantity.lessThan",{quantity:G(ee,{fix:v})})):y(void 0)}return Promise.resolve()},T=()=>{p(!1),l(!1)},A=()=>{p(!1),$(i.quantity.toString()),l(!1)},[S,C]=c.useState(!1),L=c.useRef(null),R=()=>{if(x)return;if(Number(n)===Number(i.quantity)){l(!1);return}let D=i.algo_order_id!==void 0?i.trigger_price:i.price;if(D!==null&&i.reduce_only!==!0){let ee=j(i.symbol,D,n);if(ee){z.error(ee),C(!1),A();return}}p(!0)},F=D=>{D==null||D.stopPropagation(),D==null||D.preventDefault(),R()},q=D=>{D.key==="Enter"&&(D==null||D.stopPropagation(),D==null||D.preventDefault(),R())},M=c.useCallback(()=>{C(!0);let D={symbol:i.symbol,order_type:i.type,side:i.side,order_price:i.price,order_quantity:n,algo_order_id:i.algo_order_id};if(typeof D.algo_order_id<"u"&&D.order_type==="MARKET"){let{order_price:re,...he}=D;D=he}typeof i.reduce_only<"u"&&(D.reduce_only=i.reduce_only),i.order_tag!==void 0&&(D={...D,order_tag:i.order_tag}),(i==null?void 0:i.visible_quantity)===0&&(D.visible_quantity=0),(i==null?void 0:i.tag)!==void 0&&(D.order_tag=i.tag);let ee;"algo_type"in i&&i.algo_type===V.TP_SL?ee=f(i,D):i.algo_order_id!==void 0?ee=g(i.algo_order_id.toString(),D):ee=b(i.order_id.toString(),D),ee.then(re=>{T(),$(n.toString())},re=>{z.error(re.message),$(i.quantity.toString()),A()}).finally(()=>C(!1))},[n]),W=c.useRef(null),K=c.useRef(null),ne=D=>{W.current&&K.current&&!W.current.contains(D.target)&&!K.current.contains(D.target)&&!m&&A()};c.useEffect(()=>(document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}),[m,i.quantity]);let B=()=>!a||e.disableEdit?t.jsx(Sa,{order:i,quantity:n,setEditing:l,disableEdit:e.disableEdit}):t.jsx(ka,{inputRef:L,quantitySliderRef:K,base_dp:v,base_tick:k,quantity:n,setQuantity:$,editing:a,setEditing:l,handleKeyDown:q,onClick:F,onClose:A,symbol:i.symbol,reduce_only:s,positionQty:w==null?void 0:w.position_qty,error:x,confirmOpen:m,side:i.side,order:i,setError:y});return t.jsx(Vt,{open:m,onOpenChange:p,content:t.jsx(Jt,{type:0,base:P,value:n,cancelPopover:A,isSubmitting:S,onConfirm:M}),contentProps:{onOpenAutoFocus:D=>{}},children:t.jsx("div",{onClick:D=>{D.stopPropagation(),D.preventDefault()},ref:W,children:B()})})},Sa=e=>{let{order:i,quantity:r}=e,s=i.total_executed_quantity;return t.jsxs(h,{direction:"row",justify:"start",gap:1,className:I("oui-max-w-[110px] oui-relative",i.side===pe.BUY&&"oui-text-trade-profit",i.side===pe.SELL&&"oui-text-trade-loss",rt(i)&&"oui-text-base-contrast-20"),onClick:n=>{n.stopPropagation(),n.preventDefault(),e.setEditing(!0)},children:["algo_type"in i&&i.algo_type===V.TP_SL?null:t.jsxs(t.Fragment,{children:[t.jsx("span",{children:s}),t.jsx("span",{children:"/"})]}),t.jsx(h,{r:"base",className:I("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(u,{size:"2xs",children:r})})]})},ka=e=>{let{inputRef:i,quantitySliderRef:r,base_dp:s,base_tick:n,quantity:o,setQuantity:a,editing:l,setEditing:d,handleKeyDown:m,onClick:p,onClose:x,error:y,symbol:b,reduce_only:g,positionQty:j,confirmOpen:f,side:w,order:v}=e,P=Bi(b,v.side,v.reduce_only),k=c.useMemo(()=>g?Math.abs(j??0):v.quantity+Math.abs(P),[v.quantity,P,g,j]),[$,T]=c.useState(void 0);c.useEffect(()=>{if($===void 0){let S=new N(o).div(k).abs().mul(100).toNumber();T(S)}},[$,k,o]);let A=async S=>(n>0&&(S=ie.formatNumber(S,n)??S),a(`${S}`,k));return t.jsxs(Rt,{open:!f,children:[t.jsx(Ut,{children:t.jsx(Zt,{inputRef:i,dp:s,value:o,setValue:S=>{let C=Math.abs(Math.min(Number(S),k)).toString();if(a(S,k),S.endsWith("."))return;if(Number(C)===0){T(0);return}let L=new N(S).div(k).mul(100).toDecimalPlaces(2,N.ROUND_DOWN).toNumber();T(Math.min(100,L))},setEditing:d,handleKeyDown:m,onClick:p,onClose:x,onBlur:S=>{A(S.target.value)},hintInfo:y})}),t.jsx(Wt,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:S=>{S.preventDefault()},children:t.jsxs(h,{p:1,gap:2,width:"100%",itemAlign:"start",ref:r,children:[t.jsx(u.numeral,{size:"xs",intensity:98,className:"oui-min-w-[30px] ",dp:2,padding:!1,unit:"%",rm:N.ROUND_DOWN,children:`${$}`}),t.jsxs(h,{direction:"column",width:"100%",gap:2,className:"oui-mt-[6px]",children:[t.jsx(Ue,{markCount:4,value:[$??0],onValueChange:S=>{let C=Array.from(S.values());T(C[0]);let L=new N(C[0]).div(100).mul(k).abs().toFixed(s,N.ROUND_DOWN);a(L,k)},onValueCommit:S=>{let C=new N(S[0]).div(100).mul(k).abs().toFixed(s,N.ROUND_DOWN);A(C).finally(()=>{i.current.focus()})}}),t.jsx(Oa,{onClick:S=>{T(S*100);let C=new N(S).mul(k).abs().toFixed(s,N.ROUND_DOWN);C=ie.formatNumber(C,n)??C,a(C,k),setTimeout(()=>{i.current.focus(),i.current.setSelectionRange(C.length,C.length)},100)}})]})]})})]})},Oa=e=>{let{t:i}=_(),r=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:i("common.max"),value:1}];return t.jsx(h,{gap:2,width:"100%",children:r.map((s,n)=>t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.onClick(s.value)},className:"oui-w-1/5",children:s.label},n))})},qa=e=>{let{order:i}=e,{t:r}=_(),[s,n]=c.useState(()=>{var q;return i.type===Y.MARKET&&!i.price?"Market":((q=i.price)==null?void 0:q.toString())??"Market"}),[o,a]=c.useState(!1),[l,d]=c.useState(!1),m=(i==null?void 0:i.algo_order_id)!==void 0,p=(i==null?void 0:i.type)==="MARKET"&&m,[x,y]=c.useState(!1),{editOrder:b,editAlgoOrder:g,checkMinNotional:j}=He(),{base:f,quote_dp:w}=ve(),v=_s(i.symbol,i.side,m?i.trigger_price:void 0),P=()=>{a(!1),d(!1)},k=()=>{var q;a(!1),n(((q=i.price)==null?void 0:q.toString())??"Market"),d(!1)},$=c.useMemo(()=>!v||p||!l?"":Number(s)>v.max?r("orders.price.greaterThan",{max:v.max}):Number(s)<v.min?r("orders.price.lessThan",{min:v.min}):"",[p,l,v,s,r]),T=q=>{if(q==null||q.stopPropagation(),q==null||q.preventDefault(),!($.length>0)){if(s===`${i.price}`){d(!1);return}if(i.reduce_only!==!0){let M=j(i.symbol,s,i.quantity);if(M){z.error(M),y(!1),k();return}}a(!0)}},A=q=>{q.key==="Enter"&&T(q)},S=()=>{y(!0);let q=i.order_id,M={order_price:s,order_quantity:i.quantity,symbol:i.symbol,order_type:i.type,side:i.side};typeof i.reduce_only<"u"&&(M.reduce_only=i.reduce_only),i.order_tag!==void 0&&(M={...M,order_tag:i.order_tag}),m&&(q=i.algo_order_id,M={...M,order_id:q,price:s,algo_order_id:q}),(i==null?void 0:i.visible_quantity)===0&&(M.visible_quantity=0),i.tag!==void 0&&(M.order_tag=i.tag);let W;i.algo_order_id!==void 0?W=g(i.algo_order_id.toString(),M):W=b(i.order_id.toString(),M),W.then(K=>{P(),n(s)},K=>{z.error(K.message),k()}).finally(()=>y(!1))},C=c.useRef(null);c.useEffect(()=>{e.order.price&&n(`${e.order.price}`)},[e.order.price]);let L=c.useRef(null),R=q=>{L.current&&!L.current.contains(q.target)&&!o&&k()};if(c.useEffect(()=>(document.addEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}),[o,i.price]),i.algo_order_id&&i.type=="MARKET"||s==="Market")return t.jsx("span",{children:r("common.marketPrice")});let F=()=>!l||e.disableEdit?t.jsx(Da,{order:i,price:s,setEditing:d,disableEdit:e.disableEdit}):t.jsx(Zt,{inputRef:C,dp:w,value:s,setValue:n,setEditing:d,handleKeyDown:A,onClick:T,onClose:k,hintInfo:$});return t.jsx(Vt,{open:o,onOpenChange:a,content:t.jsx(Jt,{type:1,base:f,value:s,cancelPopover:k,isSubmitting:x,onConfirm:S}),children:t.jsx("div",{onClick:q=>{q.stopPropagation(),q.preventDefault()},ref:L,children:F()})})},Da=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:I("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",rt(i)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:t.jsx(h,{r:"base",className:I("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2  oui-border oui-border-line-12"),children:t.jsx(u,{size:"2xs",children:G(r)})})})},La=e=>{let{order:i}=e,[r,s]=c.useState("");c.useEffect(()=>{var F;s(((F=i.trigger_price)==null?void 0:F.toString())??"0")},[i.trigger_price]);let n=(i==null?void 0:i.algo_order_id)!==void 0,o=(i==null?void 0:i.algo_type)==="BRACKET",[a,l]=c.useState(!1),[d,m]=c.useState(!1),[p,x]=c.useState(!1),{editAlgoOrder:y,checkMinNotional:b}=He(),{base:g,quote_dp:j,quote_max:f,quote_min:w}=ve(),v=c.useMemo(()=>{if(!((!n||o)&&!d)){if(Number(r)>f)return`Trigger price must be less than ${f}`;if(Number(r)<w)return`Trigger price must be greater than ${w}`}},[d,r,n,o]),P=()=>{l(!1),m(!1)},k=()=>{var F;s(((F=i.trigger_price)==null?void 0:F.toString())??"0"),l(!1),m(!1)},$=c.useRef(null),T=F=>{$.current&&!$.current.contains(F.target)&&!a&&k()};c.useEffect(()=>(document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}),[a,i.trigger_price]);let A=F=>{if(F==null||F.stopPropagation(),F==null||F.preventDefault(),m(!1),Number(r)!==Number(i.trigger_price)){if(i.price&&i.reduce_only!==!0){let q=b(i.symbol,i.price,i.quantity);if(q){z.error(q),x(!1),k();return}}l(!0)}},S=F=>{F.key==="Enter"&&A(F)},C=()=>{if((v??"").length>0)return;x(!0);let F={quantity:i.quantity,trigger_price:r,symbol:i.symbol,algo_order_id:i.algo_order_id};i.order_tag!==void 0&&(F={...F,order_tag:i.order_tag}),y(`${i.algo_order_id}`,F).then(q=>{P(),s(r)},q=>{var M;z.error(q.message),s(((M=i.trigger_price)==null?void 0:M.toString())??"--"),k()}).finally(()=>x(!1))},L=c.useRef(null);if(!n||o)return t.jsx(u,{children:"--"});let R=()=>!d||e.disableEdit?t.jsx(Ia,{order:i,price:r,setEditing:m,disableEdit:e.disableEdit}):t.jsx(Zt,{inputRef:L,dp:j,value:r,setValue:s,setEditing:m,handleKeyDown:S,onClick:A,onClose:k,hintInfo:v});return t.jsx(Vt,{open:a,onOpenChange:l,content:t.jsx(Jt,{type:2,base:g,value:r,cancelPopover:k,isSubmitting:p,onConfirm:C}),children:t.jsx("div",{onClick:F=>{F.stopPropagation(),F.preventDefault()},ref:$,children:R()})})},Ia=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:I("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",rt(i)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:t.jsx(h,{r:"base",className:I("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(u,{size:"2xs",children:r})})})},ei=e=>{let{order:i}=e,{t:r}=_(),{onCancelOrder:s}=He(),[n,o]=c.useState(!1);return t.jsx(Be,{size:"sm",variant:"outlined",color:"secondary",onClick:a=>{s&&(a.preventDefault(),a.stopPropagation(),o(!0),s(i).then(l=>l,l=>{z.error(l.message)}).finally(()=>{o(!1)}))},loading:n,children:r("common.cancel")})},Ta=e=>{let{record:i}=e,[r,s]=c.useState(!1),[n,{data:o,error:a,reset:l,isMutating:d}]=Mt("/v1/order"),{t:m}=_(),p=Re("brokerId"),x=c.useCallback(()=>{s(!1);let y={symbol:i.symbol,order_type:i.type,order_price:i.price,order_quantity:i.quantity,order_amount:i.amount,side:i.side,broker_id:p};Number(i.visible_quantity)<Number(i.quantity)&&(y.visible_quantity=0),typeof i.reduce_only<"u"&&(y.reduce_only=i.reduce_only),n(y)},[]);return t.jsx(J,{size:"sm",variant:"outlined",color:"secondary",loading:d,disabled:d,onClick:y=>{d||(y.preventDefault(),y.stopPropagation(),x())},children:m("orders.history.renew")})},$a=()=>{let{sl_trigger_price:e,tp_trigger_price:i,order:r,position:s}=Oe();return t.jsx(Ea,{stopLossPrice:e,takeProfitPrice:i,direction:"column",order:r,position:s,tooltip:!0})},Ea=e=>{let{direction:i="row",order:r,position:s}=e,n=je(),{t:o}=_(),a=c.useMemo(()=>{var x;let m=[];if(!e.tooltip||!r||!s)return;let p=r.quantity;return p===0&&((x=r.child_orders)==null?void 0:x[0].type)==="CLOSE_POSITION"&&(p=s.position_qty),e.takeProfitPrice&&m.push(t.jsx(xi,{qty:p,price:e.takeProfitPrice,entryPrice:s.average_open_price,orderSide:r.side,orderType:le.TAKE_PROFIT,symbolInfo:n[r.symbol]()},"tp")),e.stopLossPrice&&m.push(t.jsx(xi,{qty:p,price:e.stopLossPrice,entryPrice:s.average_open_price,orderSide:r.side,orderType:le.STOP_LOSS,symbolInfo:n[r.symbol]()},"sl")),t.jsx("div",{children:m})},[e.takeProfitPrice,e.stopLossPrice,s==null?void 0:s.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),l=c.useMemo(()=>{let m=[];return r!=null&&r.symbol?(e.takeProfitPrice&&m.push(t.jsx(u.numeral,{className:I("oui-text-trade-profit oui-gap-0  oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:n[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.tp")} -`," "]}):""},"tp")),e.stopLossPrice&&m.push(t.jsx(u.numeral,{className:I("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:n[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.sl")} -`," "]}):""},"sl")),m.length===0?t.jsx("span",{children:"-"}):(m.length===2&&i==="row"&&m.splice(1,0,t.jsx("span",{children:"/"},"split")),m)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol,o]),d=t.jsx("div",{className:I("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l});return e.tooltip?t.jsx(ye,{content:a,className:"oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:d}):d},xi=e=>{let{qty:i,price:r,entryPrice:s,orderSide:n,orderType:o,symbolInfo:a}=e,{t:l}=_(),d=ie.priceToPnl({qty:i,price:r,entryPrice:s,orderSide:n,orderType:o},{symbol:a}),m=(o===le.TAKE_PROFIT?"TP":"SL")=="TP"?`${l("tpsl.tpPnl")}:`:`${l("tpsl.slPnl")}:`;return t.jsxs("div",{className:"oui-flex oui-items-center",children:[t.jsx("span",{className:"oui-text-base-contrast-54 oui-mr-1",children:m}),t.jsx(u.numeral,{rule:"price",dp:a.quote_dp,padding:!1,className:d===0?"oui-text-base-contrast-36":d>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx("span",{children:d===0?"":d>0?"+":"-"}),suffix:t.jsx("span",{className:"oui-text-base-contrast-36 oui-ml-1",children:"USDC"}),children:`${Math.abs(d)}`})]})},Ma=e=>{let{order:i}=e,{quote_dp:r,base_dp:s}=ve(),{t:n}=_(),{sl_trigger_price:o,tp_trigger_price:a}=c.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ie.findTPSLFromOrder(e.order.child_orders[0]),[e.order]),{pnl:l,roi:d}=Nr(i);return!a&&!o?"--":t.jsx(ye,{content:t.jsxs(h,{direction:"column",itemAlign:"start",gap:1,children:[typeof l.tpPnL<"u"&&t.jsx(u.numeral,{prefix:t.jsxs(u,{intensity:80,children:[`${n("tpsl.tpPnl")}:`,"  "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),dp:r,color:"buy",showIdentifier:!0,children:l.tpPnL}),typeof l.slPnL<"u"&&t.jsx(u.numeral,{prefix:t.jsxs(u,{intensity:80,children:[`${n("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),dp:r,color:"sell",children:l.slPnL})]}),className:"oui-bg-base-6",children:t.jsxs(h,{direction:"column",width:"100%",justify:"start",itemAlign:"start",children:[t.jsx(gi,{type:"TP",value:a,quote_dp:r}),t.jsx(gi,{type:"SL",value:o,quote_dp:r})]})})},gi=e=>{let{type:i,value:r,quote_dp:s}=e,{t:n}=_();return r?t.jsx(u.numeral,{className:I("oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:s,prefix:t.jsxs("span",{className:"oui-text-base-contrast-54",children:[i==="TP"?`${n("tpsl.tp")} -`:`${n("tpsl.sl")} -`," "]}),children:r},"tp"):t.jsx(t.Fragment,{})},za=e=>{let{position:i,order:r}=Oe(),{quote_dp:s,base_dp:n}=ve(),{t:o}=_();return t.jsx(Xt,{quoteDP:s,baseDP:n,position:i,order:r,label:o("common.edit"),isEditing:!0})},Aa=()=>{let{sl_trigger_price:e,tp_trigger_price:i}=Oe(),{t:r}=_();return t.jsxs("div",{children:[i?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsxs(u,{intensity:54,children:[`${r("tpsl.tp")} -`," "]}),t.jsx("span",{children:r("common.marketPrice")})]}):null,e?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${r("tpsl.sl")} -`," "]}),t.jsx("span",{children:r("common.marketPrice")})]}):null]})};function Fa(e){let{sl_trigger_price:i,tp_trigger_price:r}=!("algo_type"in e)||!Array.isArray(e.child_orders)?{}:ie.findTPSLFromOrder(e),s=r?`${O.t("tpsl.tp")} - ${O.t("common.marketPrice")}`:void 0,n=i?`${O.t("tpsl.sl")} - ${O.t("common.marketPrice")}`:void 0;return{tpTriggerPrice:s,slTriggerPrice:n}}var Ra=e=>{let{t:i}=_();return e.sharePnLConfig==null?t.jsx(t.Fragment,{}):t.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),de.show(e.modalId,{pnl:{entity:{symbol:e.order.symbol,pnl:e.order.realized_pnl,side:e.order.side=="BUY"?i("share.pnl.share.long"):i("share.pnl.share.short"),openPrice:e.order.average_executed_price,openTime:e.order.updated_time,quantity:e.order.quantity},refCode:e.refCode,leverage:e.leverage,...e.sharePnLConfig}})},children:t.jsx(Fi,{color:"white",opacity:.54,size:e.iconSize??16})})},Ua=e=>{let{sharePnLConfig:i,order:r,modalId:s,iconSize:n}=e,{getFirstRefCode:o}=Ft(),a=c.useMemo(()=>{var d;return(d=o())==null?void 0:d.code},[o]),l=Ai(e.order.symbol);return{iconSize:n,order:r,refCode:a,leverage:l,sharePnLConfig:i,modalId:s}},Lr=e=>{let i=Ua(e);return t.jsx(Ra,{...i})},Wa=e=>{let{_type:i,onSymbolChange:r,pnlNotionalDecimalPrecision:s,sharePnLConfig:n}=e,{t:o}=_();return c.useMemo(()=>{switch(i){case"all":return[Pe({width:130,showType:!0,onSymbolChange:r,enableSort:!1}),Ie({width:130,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Te({width:130,title:o("orders.column.orderPrice"),disableEdit:!0,enableSort:!1}),dt({width:130,enableSort:!1}),fi({width:130,symbolsInfo:e.symbolsInfo}),It({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:n,symbolsInfo:e.symbolsInfo}),$e({width:130,enableSort:!1}),Xe({width:130}),Ge({width:130}),Se({width:130}),Ee({width:130}),yi({width:130}),Me({width:160,enableSort:!1})];case"pending":return[Pe({width:172,showType:!0,onSymbolChange:r,enableSort:!1}),Ie({width:162,className:"oui-pr-0",enableSort:!1}),Te({width:162,className:"oui-pr-0",enableSort:!1}),Ye({width:162,className:"oui-pr-0"}),Ha({width:130}),$e({width:162,isPending:!0}),Se({width:162}),Ee({width:162}),Me({width:162,enableSort:!1}),Ya({width:162})];case"tp_sl":return[Pe({width:176,showType:!0,onSymbolChange:r,enableSort:!1}),Ba({width:176}),fi({width:176,symbolsInfo:e.symbolsInfo}),Va({width:176}),Ka({width:176}),Se({width:176}),Me({width:176,enableSort:!1}),Xa({width:176})];case"filled":return[Pe({showType:!0,width:154,onSymbolChange:r}),Ie({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Te({width:124,title:o("orders.column.orderPrice"),disableEdit:!0}),Qa({width:124}),Ye({width:124,disableEdit:!0}),It({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:n,symbolsInfo:e.symbolsInfo,hideShare:!0}),$e({width:124}),Xe({width:124}),Ge({width:124}),Se({width:124}),Ee({width:124}),Me({width:176})];case"cancelled":return[Pe({showType:!0,width:154,onSymbolChange:r,enableSort:!1}),Ie({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Te({width:124,disableEdit:!0,enableSort:!1}),dt({width:124,enableSort:!1}),Ye({width:124,disableEdit:!0}),$e({width:124}),Xe({width:124}),Ge({width:124}),Se({width:124}),Ee({width:124})];case"rejected":return[Pe({showType:!0,width:154,onSymbolChange:r}),Ie({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Te({width:124,disableEdit:!0}),dt({width:124}),Ye({width:124,disableEdit:!0}),$e({width:124}),Xe({width:124}),Ge({width:124}),Se({width:124}),Ee({width:124}),Me({width:176})];case"orderHistory":return[Pe({showType:!0,width:154,onSymbolChange:r}),Ie({width:150,disableEdit:!0,className:"oui-pl-6 oui-pr-0"}),Te({width:124,disableEdit:!0}),dt({width:124}),Ye({width:124,disableEdit:!0}),It({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:n,symbolsInfo:e.symbolsInfo}),$e({width:124}),Xe({width:124}),Ge({width:124}),Se({width:124}),Ee({width:124}),Me({width:150}),yi({width:80})]}},[i,s,n,o])};function Pe(e){return{title:O.t("common.symbol"),dataIndex:"symbol",fixed:"left",width:e==null?void 0:e.width,onSort:e!=null&&e.enableSort?(i,r)=>i.symbol.localeCompare(r.symbol):void 0,renderPlantText:(i,r)=>{var o;let s=(o=Ze(r))==null?void 0:o.join(","),n=s!=null&&s.length?` (${s})`:"";return`${i.split("_")[1]}-PERP${n}`},render:(i,r)=>{var n;let s=rt(r);return t.jsxs(h,{gap:2,children:[t.jsx("div",{className:I("oui-rounded-[1px] oui-w-1 oui-h-7 oui-shrink-0",r.side===pe.BUY?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(h,{direction:"column",itemAlign:"start",children:[t.jsx(u.formatted,{size:"xs",className:"oui-cursor-pointer oui-text-xs",onClick:o=>{var a;(a=e==null?void 0:e.onSymbolChange)==null||a.call(e,{symbol:i}),o.stopPropagation(),o.preventDefault()},children:`${i.split("_")[1]}-PERP`}),(e==null?void 0:e.showType)&&t.jsx(h,{direction:"row",gap:1,children:(n=Ze(r))==null?void 0:n.map((o,a)=>t.jsx(H,{color:o.toLocaleLowerCase()==="position"?s?"neutral":"primary":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:o},a))})]})]})}}}function Ie(e){return{title:O.t("orders.column.fill&Quantity"),dataIndex:"fill_quantity",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let s=(i.algo_type===V.POSITIONAL_TP_SL?0:i.quantity)??0,n=(r.algo_type===V.POSITIONAL_TP_SL?0:r.quantity)??0;return st(s,n)}:void 0,renderPlantText:(i,r)=>{if(r.type===Y.CLOSE_POSITION&&r.status!==U.FILLED)return O.t("tpsl.entirePosition");let s=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===V.TP_SL?"":`${s} / `)+`${r.quantity}`},render:(i,r)=>r.type===Y.CLOSE_POSITION&&r.status!==U.FILLED?O.t("tpsl.entirePosition"):t.jsx(Dr,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function Ba(e){return{title:O.t("common.quantity"),className:e==null?void 0:e.className,dataIndex:"quantity",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let s=(i.algo_type===V.POSITIONAL_TP_SL?0:i.quantity)??0,n=(r.algo_type===V.POSITIONAL_TP_SL?0:r.quantity)??0;return st(s,n)}:void 0,renderPlantText:(i,r)=>{if(r.algo_type===V.POSITIONAL_TP_SL)return O.t("tpsl.entirePosition");let s=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===V.TP_SL?"":`${s}/`)+`${r.quantity}`},render:(i,r)=>r.algo_type===V.POSITIONAL_TP_SL?O.t("tpsl.entirePosition"):t.jsx(Dr,{order:r})}}function Te(e){return{title:(e==null?void 0:e.title)??O.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,s)=>st(i.price??0,r.price??0):void 0,renderPlantText:(i,r)=>{var s;return G((s=r.price)==null?void 0:s.toString(),{fallback:O.t("common.marketPrice")})},render:(i,r)=>t.jsx(qa,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function Va(e){return{title:(e==null?void 0:e.title)??O.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let{tpTriggerPrice:s,slTriggerPrice:n}=Fa(r),o=`${s||""}${n?`${s?`
`:""}${n}`:""}`;return o.length>0?o:"--"},render:(i,r)=>t.jsx(Aa,{})}}function Qa(e){return{title:O.t("common.avgPrice"),dataIndex:"average_executed_price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,render:(i,r)=>G(i)}}function Ye(e){return{title:O.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let s=(r==null?void 0:r.algo_order_id)!==void 0,n=(r==null?void 0:r.algo_type)==="BRACKET";return!s||n?"--":G(i)},render:(i,r)=>t.jsx(La,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function fi(e){return{title:(e==null?void 0:e.title)??O.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"tpsl_trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{var d;let s=(d=e==null?void 0:e.symbolsInfo)==null?void 0:d[r.symbol],n=s==null?void 0:s("quote_dp"),{sl_trigger_price:o,tp_trigger_price:a}=!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:ie.findTPSLFromOrder(r),l=(a!=null?`${O.t("tpsl.tp")}: ${G(a,{fix:n,padEnd:!0})}`:"")+(o!=null?`${a?`
`:""}${O.t("tpsl.sl")}: ${G(o,{fix:n,padEnd:!0})}`:"");return l.length>0?l:"--"},render:(i,r)=>t.jsx($a,{})}}function Ha(e){return{title:O.t("common.tpsl"),className:e==null?void 0:e.className,dataIndex:"bracketOrderPrice",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let s=()=>!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:ie.findTPSLFromOrder(r.child_orders[0]),{sl_trigger_price:n,tp_trigger_price:o}=s(),a=(o!=null?`${O.t("tpsl.tp")}: ${o}`:"")+(n!=null?`${o?`
`:""}${O.t("tpsl.sl")}: ${n}`:"");return a.length>0?a:"--"},render:(i,r)=>t.jsx(Ma,{order:r})}}function $e(e){return{title:O.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,className:e==null?void 0:e.className,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,s)=>{let n=i.type===Y.CLOSE_POSITION&&i.status!==U.FILLED||i.total_executed_quantity===0||Number.isNaN(i.average_executed_price)||i.average_executed_price===null?0:i.total_executed_quantity*i.average_executed_price,o=r.type===Y.CLOSE_POSITION&&r.status!==U.FILLED||r.total_executed_quantity===0||Number.isNaN(r.average_executed_price)||r.average_executed_price===null?0:r.total_executed_quantity*r.average_executed_price;return st(n,o)}:void 0,renderPlantText:(i,r)=>Tt(r,(e==null?void 0:e.isPending)??!1)==="Entire position"?O.t("tpsl.entirePosition"):G(Tt(r,(e==null?void 0:e.isPending)??!1),{fix:2}),render:(i,r)=>{let s=Tt(r,(e==null?void 0:e.isPending)??!1);return s==="Entire position"?O.t("tpsl.entirePosition"):t.jsx(u.numeral,{rm:N.ROUND_DOWN,dp:2,children:s})}}}function It(e){return{title:O.t("common.realizedPnl"),dataIndex:"realized_pnl",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{var d;let s=(d=e==null?void 0:e.symbolsInfo)==null?void 0:d[r.symbol],n=s==null?void 0:s("quote_dp"),o=(e==null?void 0:e.pnlNotionalDecimalPrecision)??n,a=new N(i??0).toDecimalPlaces(o,N.ROUND_DOWN).toNumber(),l=G(a);return a>0?`+${l}`:l},render:(i,r)=>{let{quote_dp:s}=ve(),n=(e==null?void 0:e.pnlNotionalDecimalPrecision)??s,o=new N(i??0).toDecimalPlaces(n,N.ROUND_DOWN).toNumber();return t.jsxs(h,{gap:1,children:[t.jsx(u.numeral,{dp:n,rm:N.ROUND_DOWN,padding:!1,intensity:(o??0)==0?80:void 0,showIdentifier:(o??0)>0,coloring:(o??0)!=0,children:o??"--"}),!(e!=null&&e.hideShare)&&t.jsx(Lr,{order:r,sharePnLConfig:e==null?void 0:e.sharePnLConfig,modalId:_t})]})}}}function Se(e){return{title:O.t("orderEntry.reduceOnly"),dataIndex:"reduce_only",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i?O.t("common.yes"):O.t("common.no"),render:i=>t.jsx(u,{children:i?O.t("common.yes"):O.t("common.no")})}}function Ee(e){return{title:O.t("orders.column.hidden"),dataIndex:"visible",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i!==0?O.t("common.no"):O.t("common.yes"),render:(i,r)=>t.jsx(u,{children:r.visible_quantity!==0?O.t("common.no"):O.t("common.yes")})}}function Me(e){return{title:O.t("orders.column.orderTime"),dataIndex:"created_time",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{let s=new Date(i);return Wi(s,"yyyy-MM-dd HH:mm:ss")},render:i=>t.jsx(u.formatted,{rule:"date",formatString:(e==null?void 0:e.formatString)||"yyyy-MM-dd HH:mm:ss",className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i})}}function Xe(e){return{title:O.t("common.fee"),dataIndex:"total_fee",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className}}function Ka(e){return{title:O.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>r.algo_type===V.POSITIONAL_TP_SL?O.t("tpsl.entirePosition"):G(r.quantity===0?"--":`${new N(r.mark_price).mul(r.quantity).todp(2).toNumber()}`),render:(i,r)=>r.algo_type===V.POSITIONAL_TP_SL?O.t("tpsl.entirePosition"):t.jsx(u.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:r.quantity===0?"--":`${new N(r.mark_price).mul(r.quantity).todp(2).toNumber()}`})}}function Ge(e){let i={[U.NEW]:O.t("orders.status.pending"),[U.FILLED]:O.t("orders.status.filled"),[U.PARTIAL_FILLED]:O.t("orders.status.partialFilled"),[U.CANCELLED]:O.t("orders.status.canceled"),[U.REJECTED]:O.t("orders.status.rejected"),[U.INCOMPLETE]:O.t("orders.status.incomplete"),[U.COMPLETED]:O.t("orders.status.completed")};return{title:O.t("common.status"),dataIndex:"status",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(r,s)=>{let n=r||s.algo_status;return i[n]||Je(n)},render:(r,s)=>{let n=r||s.algo_status;return i[n]||Je(n)}}}function dt(e){return{title:O.t("common.avgPrice"),dataIndex:"average_executed_price",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>st(i.average_executed_price??0,r.average_executed_price??0):void 0,className:e==null?void 0:e.className,render:(i,r)=>r.type===Y.MARKET&&!i?"--":t.jsx(u,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i}),renderPlantText:(i,r)=>G(i,{fix:2})}}function yi(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>r.status===U.CANCELLED?t.jsx(Ta,{record:r}):r.status===U.NEW||r.algo_status===U.NEW?t.jsx(ei,{order:r}):null}}function Ya(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsx(ei,{order:r})}}function Xa(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsxs(h,{gap:3,children:[t.jsx(za,{order:r}),t.jsx(ei,{order:r})]})}}function st(e,i){return e>i?1:e<i?-1:0}function Tt(e,i){return i?e.price&&e.quantity?new N(e.price).mul(e.quantity).toFixed(2,N.ROUND_DOWN):"--":e.type===Y.CLOSE_POSITION&&e.status!==U.FILLED?O.t("tpsl.entirePosition"):e.total_executed_quantity===0||Number.isNaN(e.average_executed_price)||e.average_executed_price===null?"--":`${e.total_executed_quantity*e.average_executed_price}`}var Ga=e=>{let{item:i}=e,r=i.side===pe.BUY,{t:s}=_();return t.jsx(u.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(H,{color:r?"success":"danger",size:"xs",children:s(r?"common.buy":"common.sell")}),onClick:()=>{var n;(n=e.onSymbolChange)==null||n.call(e,{symbol:i.symbol})},children:i.symbol})},Ja=e=>{var r;let{item:i}=e;return c.useCallback(()=>{let s=typeof i.type=="string"?i.type.replace("_ORDER","").toLowerCase():i.type;return i.algo_order_id&&i.algo_type!==V.BRACKET?`Stop ${s}`:Je(i.type)},[i]),t.jsx(h,{direction:"row",gap:1,children:(r=Ze(e.item))==null?void 0:r.map((s,n)=>t.jsx(H,{color:s.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:s},n))})},Za=e=>{let{item:i}=e;return t.jsx(u.formatted,{rule:"date",formatString:"yyyy-MM-dd hh:mm:ss",intensity:36,size:"2xs",children:i.updated_time})},el=e=>{let{item:i}=e,{t:r}=_(),s=i.status||i.algo_status,n=c.useMemo(()=>({[U.NEW]:r("orders.status.pending"),[U.FILLED]:r("orders.status.filled"),[U.PARTIAL_FILLED]:r("orders.status.partialFilled"),[U.CANCELLED]:r("orders.status.canceled"),[U.REJECTED]:r("orders.status.rejected"),[U.INCOMPLETE]:r("orders.status.incomplete"),[U.COMPLETED]:r("orders.status.completed")}),[r]);return t.jsx(u.formatted,{intensity:80,size:"2xs",children:n[s]||Je(s)})},bi=e=>{let{item:i}=e,{t:r}=_(),s=i.type===Y.CLOSE_POSITION&&(i==null?void 0:i.status)!==U.FILLED;return t.jsx(Z,{label:r("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.base_dp,padding:!1,coloring:!0,placeholder:r("tpsl.entirePosition"),intensity:80,children:s?r("tpsl.entirePosition"):i.quantity})})},ji=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:t.jsx(u,{children:r("orders.status.filled")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.base_dp,intensity:80,padding:!1,rm:N.ROUND_DOWN,children:i.total_executed_quantity})})},tl=e=>{let{item:i}=e,{t:r}=_(),s=c.useMemo(()=>i.price&&i.quantity?new N(i.price).mul(i.quantity).toFixed(e.quote_dp,N.ROUND_DOWN):"--",[i.price,i.quantity]);return t.jsx(Z,{align:"end",label:t.jsxs(u,{children:[r("common.notional"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,coloring:!0,intensity:80,padding:!1,rm:N.ROUND_DOWN,children:s})})},_i=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:r("orders.column.triggerPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:e.align,children:t.jsx(u.numeral,{dp:e.quote_dp,intensity:80,padding:!1,rm:N.ROUND_DOWN,children:i.trigger_price??"--"})})},il=e=>{let{item:i}=e,{t:r}=_();return t.jsx(Z,{label:r("common.markPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,padding:!1,children:i.mark_price})})},rl=e=>{let{item:i}=e,{t:r}=_(),s=(i==null?void 0:i.algo_order_id)!==void 0,n=(i==null?void 0:i.type)==="MARKET"&&s;return t.jsx(Z,{label:r("common.limitPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n?t.jsx(u,{children:r("common.marketPrice")}):t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,padding:!1,children:i.price??"--"})})},sl=e=>{let{tp_trigger_price:i,tpPnL:r}=Oe(),{t:s}=_();return t.jsx(Z,{label:s("tpsl.tpTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(ti,{content:r&&t.jsx(u.numeral,{size:"2xs",showIdentifier:!0,prefix:t.jsxs(u,{intensity:54,children:[`${s("tpsl.tpPnl")}:`," "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,color:"buy",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},nl=e=>{let{sl_trigger_price:i,slPnL:r}=Oe(),{t:s}=_();return t.jsx(Z,{label:s("tpsl.slTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(ti,{content:r&&t.jsx(u.numeral,{size:"2xs",prefix:t.jsxs(u,{intensity:54,children:[`${s("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,color:"sell",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},ol=e=>{let{t:i}=_();return t.jsx(Z,{label:i("tpsl.tpPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u,{intensity:80,children:i("common.marketPrice")})})},al=e=>{let{t:i}=_();return t.jsx(Z,{label:i("tpsl.slPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u,{intensity:80,children:i("common.marketPrice")})})},ll=e=>{let{item:i}=e,{t:r}=_(),s=c.useMemo(()=>i.algo_type===V.POSITIONAL_TP_SL?t.jsx("span",{className:"oui-text-base-contrast-80",children:r("tpsl.entirePosition")}):t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,padding:!1,children:i.quantity}),[i,r]);return t.jsx(Z,{label:r("common.quantity"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:s})},dl=e=>{var r;let{t:i}=_();return t.jsx(Z,{label:t.jsxs(u,{children:[i("common.avgPrice"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,padding:!1,children:((r=e.item)==null?void 0:r.average_executed_price)??"--"})})},ul=e=>{var r;let{t:i}=_();return t.jsx(Z,{label:t.jsxs(u,{children:[i("orders.column.orderPrice"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,intensity:80,padding:!1,placeholder:i("common.marketPrice"),children:((r=e.item)==null?void 0:r.price)??"--"})})},cl=e=>{var s;let i=(s=e==null?void 0:e.item)==null?void 0:s.realized_pnl,{t:r}=_();return t.jsx(Z,{label:t.jsxs(u,{children:[r("common.realizedPnl"),t.jsx(u,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsxs(h,{gap:1,children:[t.jsx(u.numeral,{dp:e.quote_dp,rm:N.ROUND_DOWN,padding:!1,intensity:(i??0)==0?80:void 0,showIdentifier:(i??0)>0,coloring:(i??0)!=0,children:i??"--"}),t.jsx(Lr,{order:e.item,sharePnLConfig:e.sharePnLConfig,modalId:wt,iconSize:12})]})})},ti=e=>{let{classNames:i,content:r}=e,[s,n]=c.useState(!1);return typeof r>"u"?e.children:t.jsx(ye,{content:r,className:i==null?void 0:i.content,open:s,onOpenChange:n,arrow:{className:i==null?void 0:i.arrow},children:t.jsx("div",{onClick:()=>n(o=>!o),children:e.children})})},ml=e=>{let{t:i}=_(),{item:r}=e;return r.quantity>0,t.jsx(t.Fragment,{children:t.jsx(J,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{e.onShowEditSheet()},children:i("common.edit")})})},pl=e=>{var d;let{side:i}=e.item,{price:r,quantity:s,triggerPrice:n,isAlgoOrder:o}=e,a=i===pe.BUY,{t:l}=_();return t.jsxs("div",{className:"oui-pt-2",children:[t.jsx(u,{intensity:80,children:`You agree to edit your ${e.base}-PERP order.`}),t.jsxs(h,{gap:2,mb:3,mt:2,justify:"between",children:[t.jsx(u.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:e.item.symbol}),t.jsxs(h,{direction:"row",gap:1,children:[(d=Ze(e.item))==null?void 0:d.map((m,p)=>t.jsx(H,{color:m.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:m},p)),a&&t.jsx(H,{color:"success",size:"xs",children:l("common.buy")}),!a&&t.jsx(H,{color:"danger",size:"xs",children:l("common.sell")})]})]}),t.jsx(ge,{}),t.jsxs(h,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:3,children:[o&&t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:l("orders.column.triggerPrice")}),t.jsx(u.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:N.ROUND_DOWN,suffix:t.jsx(u,{intensity:54,children:" USDC"}),children:n??"--"})]}),t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:l("common.price")}),t.jsx(u.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:N.ROUND_DOWN,suffix:t.jsx(u,{intensity:54,children:" USDC"}),placeholder:e.isStopMarket?l("common.marketPrice"):"--",children:e.isStopMarket?l("common.marketPrice"):r??"--"})]}),t.jsxs(h,{justify:"between",width:"100%",gap:1,children:[t.jsx(u,{children:l("common.qty")}),t.jsx(u.numeral,{color:i===pe.BUY?"buy":"sell",dp:e.base_dp,padding:!1,rm:N.ROUND_DOWN,children:s??"--"})]})]}),t.jsxs(h,{className:"oui-gap-[2px]",children:[t.jsx($i,{color:"white",id:"oui-checkbox-disableOrderConfirmation",checked:!e.orderConfirm,onCheckedChange:m=>{e.setOrderConfirm(!m)}}),t.jsx("label",{className:"oui-text-2xs oui-text-base-contrast-54",htmlFor:"oui-checkbox-disableOrderConfirmation",children:l("orderEntry.disableOrderConfirm")})]})]})},hl=e=>{var p,x,y;let{item:i}=e,r=i.side===pe.BUY,{t:s}=_(),{parseErrorMsg:n}=it(e.errors),o=n("order_quantity"),a=n("order_price"),l=n("trigger_price"),d=e.quantity&&e.maxQty?Math.min(Number(e.quantity)/e.maxQty,1):void 0,m=b=>{let g=e.baseTick;if(g&&g>0){let j=ie.formatNumber(b,g)??b;e.setQuantity(j)}};return t.jsxs(t.Fragment,{children:[t.jsxs(h,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u.formatted,{rule:"symbol",showIcon:!0,intensity:80,children:i.symbol}),t.jsxs(h,{direction:"row",gap:1,children:[(p=Ze(e.item))==null?void 0:p.map((b,g)=>t.jsx(H,{color:b.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:b},g)),r&&t.jsx(H,{color:"success",size:"xs",children:s("common.buy")}),!r&&t.jsx(H,{color:"danger",size:"xs",children:s("common.sell")})]})]}),t.jsx(ge,{intensity:8,className:"oui-w-full"}),t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u,{children:s("common.lastPrice")}),t.jsx(u.numeral,{dp:(y=(x=e.item)==null?void 0:x.symbolInfo)==null?void 0:y.duote_dp,children:e.curMarkPrice??"--"})]}),t.jsxs(h,{width:"100%",direction:"column",itemAlign:"stretch",gap:2,children:[e.isAlgoOrder&&t.jsx(me.tooltip,{prefix:t.jsx(u,{intensity:54,className:"oui-px-3",children:s("orders.column.triggerPrice")}),suffix:t.jsx(u,{intensity:54,className:"oui-px-3",children:e.quote}),color:l?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],value:e.triggerPrice,onValueChange:b=>e.setTriggerPrice(b),tooltip:l,tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast oui-w-full",root:I("oui-outline-line-12",l&&"oui-outline-danger")}}),t.jsx(me.tooltip,{prefix:t.jsx(u,{intensity:54,className:"oui-px-3",children:s("common.price")}),suffix:t.jsx(u,{intensity:54,className:"oui-px-3",children:e.quote}),color:a?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],disabled:!e.priceEdit,value:e.isStopMarket?s("orderEntry.orderType.market"):e.price,onValueChange:b=>e.setPrice(b),tooltip:a,tooltipProps:{content:{className:"oui-bg-base-5"},arrow:{className:"oui-fill-base-5"}},classNames:{input:"oui-text-base-contrast",root:I("oui-outline-line-12",a&&"oui-outline-danger")}}),t.jsx(me.tooltip,{prefix:t.jsx(u,{intensity:54,className:"oui-px-3",children:s("common.quantity")}),suffix:t.jsx(u,{intensity:54,className:"oui-px-3",children:e.base}),color:o?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.base_dp)],value:e.quantity,onValueChange:b=>{e.setQuantity(b)},onBlur:b=>m(b.target.value),tooltip:o,tooltipProps:{content:{className:"oui-bg-base-6"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast",root:I("oui-outline-line-12",o&&"oui-outline-danger")}}),t.jsx(Ue,{markCount:4,value:[e.sliderValue??0],onValueChange:b=>{e.setSliderValue(b[0])},color:"primary"}),t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(u.numeral,{color:"primary",size:"2xs",dp:2,padding:!1,rule:"percentages",children:`${d??0}`}),t.jsxs(h,{gap:1,children:[t.jsx(u,{size:"2xs",color:"primary",children:s("common.max")}),t.jsx(u.numeral,{intensity:54,size:"2xs",dp:e.base_dp,children:e.maxQty})]})]})]}),t.jsxs(h,{width:"100%",gap:3,mt:2,children:[t.jsx(J,{fullWidth:!0,color:"secondary",onClick:b=>{e.onClose()},children:s("common.cancel")}),t.jsx(Be,{fullWidth:!0,onClick:b=>{b.stopPropagation(),b.preventDefault(),e.onSheetConfirm()},loading:e.submitting,disabled:!e.isChanged,children:s("common.confirm")})]})]}),t.jsx(tt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,title:s("orders.editOrder"),size:"xs",actions:{primary:{label:s("common.confirm"),onClick:e.onDialogConfirm,loading:e.submitting,fullWidth:!0},secondary:{label:s("common.cancel"),onClick:e.onCloseDialog,fullWidth:!0}},classNames:{content:"oui-pb-4",body:"oui-p-0",footer:"oui-pt-3 oui-pb-0"},children:t.jsx(pl,{...e})})]})},xl=e=>{let{state:i,editAlgoOrder:r,editOrder:s,autoCheckInput:n=!0,position:o}=e,{item:a}=i,{hide:l}=Bt(),[d,m]=c.useState(!1),p=(a==null?void 0:a.algo_order_id)!==void 0&&a.algo_type!==V.BRACKET,x=(a==null?void 0:a.type)==="MARKET"&&p;x||(a==null||a.type);let[y,b]=c.useState(!1),g=c.useMemo(()=>p&&a.algo_type!==V.BRACKET?`STOP_${a.type}`:a.type,[a,p]),[j,f]=xe("orderly_order_confirm",!0),{base_dp:w,base_tick:v}=e.state,{formattedOrder:P,setValue:k,markPrice:$,errors:T,validate:A,maxQty:S}=gl({order:a,orderType:g,position:o}),C=()=>{A().then(B=>{j?m(!0):q(P)},B=>{var D;(D=B==null?void 0:B.total)!=null&&D.message&&z.error(B==null?void 0:B.total.message)}).catch(B=>{})},L=c.useCallback(()=>{m(!1)},[]),R=()=>P?q(P):Promise.reject(),F=c.useCallback(()=>{l()},[]),q=c.useCallback(async B=>{let D,ee=a.visible_quantity!==void 0?a.visible_quantity===0:a.visible!==void 0?a.visible===0:!1;if(a.algo_order_id!==void 0){if(x&&"order_price"in B){let{order_price:re,...he}=B;B=he}D=r(a.algo_order_id.toString(),{...B})}else D=s(a.order_id.toString(),{...B,...ee?{visible_quantity:0}:{}});try{b(!0);let re=await D;F()}catch(re){z.error((re==null?void 0:re.message)??`${re}`)}finally{b(!1)}},[r,s]),M=c.useMemo(()=>{let B=P.order_quantity;return B&&Number(B)!==0&&S!==0?new N(B).div(S).mul(100).toDecimalPlaces(2,N.ROUND_DOWN).toNumber():0},[P.order_quantity,S]),W=a.price!=P.order_price||a.quantity!=P.order_quantity||a.trigger_price!=P.trigger_price,K=vs(B=>{let D=new N(B).div(100).mul(S).toDecimalPlaces(w,N.ROUND_DOWN).toNumber();k("order_quantity",ie.formatNumber(D,v))},50,{}),ne=(B,D)=>{k(B,D)};return{...i,curMarkPrice:$,isAlgoOrder:p,isStopMarket:x,price:P.order_price,setPrice:B=>ne("order_price",B),priceEdit:!x,triggerPrice:P.trigger_price,setTriggerPrice:B=>ne("trigger_price",B),quantity:P.order_quantity,setQuantity:B=>{ne("order_quantity",B)},maxQty:S,sliderValue:M,setSliderValue:K,onClose:F,onSheetConfirm:C,errors:T,orderType:g,isChanged:W,baseTick:v,dialogOpen:d,setDialogOpen:m,onDialogConfirm:R,onCloseDialog:L,submitting:y,orderConfirm:j,setOrderConfirm:f}},gl=e=>{let{order:i,orderType:r,position:s}=e,[n,o]=c.useState({side:i.side,order_type:r,order_price:i.price,order_quantity:i.quantity,trigger_price:i.trigger_price,reduce_only:i.reduce_only,symbol:i.symbol}),{reduce_only:a}=i,l=s==null?void 0:s.position_qty,d=Bi(i.symbol,i.side,i.reduce_only),m=c.useMemo(()=>a?Math.abs(l??0):i.quantity+Math.abs(d),[i.quantity,d,a,l]),{symbolInfo:p,markPrice:x,errors:y,validate:b}=Ns({...n,symbol:i.symbol},{maxQty:m});return{symbolInfo:p,markPrice:x,errors:y,validate:b,setValue:(g,j)=>{o(f=>({...f,[g]:j}))},formattedOrder:n,maxQty:m}},fl=e=>{let i=xl(e);return t.jsx(hl,{...i})},yl=e=>{let{state:i}=e,{t:r}=_(),{editAlgoOrder:s,editOrder:n}=He(),{order:o,position:a}=Oe(),l=c.useCallback(()=>{e.state.type==="tp_sl"?de.sheet({title:r("common.tpsl"),content:t.jsx(hr,{isEditing:!0,order:e.state.item,position:a,symbolInfo:e.state.origin})}).catch(d=>{}):de.sheet({title:r("orders.editOrder"),classNames:{content:"oui-bg-base-8"},content:t.jsx(fl,{position:a,state:i,editAlgoOrder:s,editOrder:n})}).catch(d=>{})},[i]);return{...i,onShowEditSheet:l}},bl=e=>{let i=yl(e);return t.jsx(ml,{...i})},jl=e=>{let{t:i}=_();return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:r=>e.setOpen(!0),children:i("common.cancel")}),e.open&&t.jsx(tt,{size:"xs",open:e.open,onOpenChange:e.setOpen,title:i("orders.cancelOrder"),actions:{primary:{label:i("common.confirm"),loading:e.isLoading,fullWidth:!0,size:"md",onClick:r=>{e.onCancel(r)}},secondary:{label:i("common.cancel"),fullWidth:!0,size:"md",onClick:()=>{e.onClose()}}},children:t.jsx(u,{size:"2xs",intensity:54,children:i("orders.cancelOrder.description")})})]})},_l=e=>{let{state:i}=e,[r,s]=c.useState(!1),{onCancelOrder:n}=He(),[o,a]=c.useState(!1);return{...i,open:r,setOpen:s,onCancel:l=>n?(l==null||l.preventDefault(),l==null||l.stopPropagation(),a(!0),n(i.item).then(d=>{s(!1)},d=>{z.error(d.message)}).finally(()=>{a(!1)})):Promise.resolve(),onClose:()=>{s(!1)},isLoading:o}},wl=e=>{let i=_l(e);return t.jsx(jl,{...i})},vl=e=>{var r,s,n,o;let{t:i}=_();return!e.sl_trigger_price&&!e.tp_trigger_price?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx(ti,{classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},content:t.jsxs(h,{direction:"column",itemAlign:"start",gap:1,children:[typeof((r=e.pnl)==null?void 0:r.tpPnL)<"u"&&t.jsx(u.numeral,{prefix:t.jsxs(u,{intensity:80,children:[`${i("tpsl.tpPnl")}:`,"  "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"buy",showIdentifier:!0,children:(s=e.pnl)==null?void 0:s.tpPnL}),typeof((n=e.pnl)==null?void 0:n.slPnL)<"u"&&t.jsx(u.numeral,{prefix:t.jsxs(u,{intensity:80,children:[`${i("tpsl.slPnl")}:`,"  "]}),suffix:t.jsx(u,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"sell",children:(o=e.pnl)==null?void 0:o.slPnL})]}),children:t.jsx("button",{onClick:()=>{e.setOpen(!e.open)},children:t.jsxs(h,{gap:1,width:"1",children:[e.tp_trigger_price&&t.jsx(wi,{type:"TP",value:e.tp_trigger_price,quote_dp:e.quote_dp}),e.sl_trigger_price&&t.jsx(wi,{type:"SL",value:e.sl_trigger_price,quote_dp:e.quote_dp})]})})})})},wi=e=>{let{type:i,value:r,quote_dp:s}=e;return r?t.jsx(u.numeral,{size:"2xs",className:I("oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:s,padding:!1,rm:N.ROUND_DOWN,prefix:t.jsxs("span",{className:"oui-text-base-contrast-36",children:[`${i} `,":  "]}),children:r},"tp"):t.jsx(t.Fragment,{})},Nl=e=>{let{item:i,quote_dp:r,base_dp:s}=e,[n,o]=c.useState(!1),{sl_trigger_price:a,tp_trigger_price:l}=c.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ie.findTPSLFromOrder(i.child_orders[0]),[i]),{pnl:d,roi:m}=Nr(i);return{sl_trigger_price:a,tp_trigger_price:l,pnl:d,roi:m,quote_dp:r,open:n,setOpen:o}},Cl=e=>{let i=Nl(e);return t.jsx(vl,{...i})},Pl=e=>t.jsxs(h,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:e.className,children:[t.jsx(Sl,{...e}),t.jsx(ge,{intensity:6,className:"oui-w-full"}),t.jsx(kl,{...e}),e.type==="pending"&&t.jsx(Cl,{...e}),e.type!=="orderHistory"&&t.jsx(Ol,{...e})]}),Sl=e=>t.jsxs(h,{direction:"column",gap:1,width:"100%",children:[t.jsxs(h,{justify:"between",width:"100%",children:[t.jsx(Ga,{...e}),t.jsx(Za,{...e})]}),t.jsxs(h,{width:"100%",justify:"between",children:[t.jsx(Ja,{...e}),e.type==="orderHistory"&&t.jsx(el,{...e})]})]}),kl=e=>t.jsx(fe,{cols:3,rows:2,width:"100%",gap:1,children:ql(e)}),Ol=e=>t.jsxs(fe,{cols:3,rows:1,width:"100%",gap:2,children:[t.jsx("div",{}),t.jsx(bl,{state:e}),t.jsx(wl,{state:e})]});function ql(e){switch(e.type){case"all":return t.jsx(t.Fragment,{});case"pending":return t.jsxs(t.Fragment,{children:[t.jsx(bi,{...e}),t.jsx(ji,{...e}),t.jsx(tl,{...e}),t.jsx(_i,{...e}),t.jsx(rl,{...e}),t.jsx(il,{...e})]});case"tp_sl":return t.jsxs(t.Fragment,{children:[t.jsx(sl,{...e}),t.jsx(ol,{...e}),t.jsx(ll,{...e}),t.jsx(nl,{...e}),t.jsx(al,{...e})]});case"filled":return t.jsx(t.Fragment,{});case"cancelled":return t.jsx(t.Fragment,{});case"rejected":return t.jsx(t.Fragment,{});case"orderHistory":return t.jsxs(t.Fragment,{children:[t.jsx(bi,{...e}),t.jsx(ji,{...e}),t.jsx(_i,{...e,align:"end"}),t.jsx(dl,{...e}),t.jsx(ul,{...e}),t.jsx(cl,{...e})]})}}var Dl=e=>{let i=ve();return{...e,...i}},Ll=e=>{let{className:i,...r}=e,s=Dl(r);return t.jsx(Pl,{...s,className:i})},Il=e=>{var n;let{sharePnLConfig:i,...r}=e,s=Wa({_type:e.type,onSymbolChange:e.onSymbolChange,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:i,symbolsInfo:e.symbolsInfo});return t.jsx(Pr,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(h,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[e.filterItems.length>0&&t.jsx(et,{items:e.filterItems,onFilter:o=>{e.onFilter(o)},trailing:["pending","tp_sl"].includes(e.type)&&t.jsx($l,{...e})}),t.jsx(jt,{columns:s,loading:e.isLoading,dataSource:e.dataSource,bordered:!0,ignoreLoadingCheck:!0,testIds:{body:(n=e.testIds)==null?void 0:n.tableBody},classNames:{header:"oui-h-[38px]",root:"oui-items-start !oui-h-[calc(100%_-_49px)]"},onRow:(o,a)=>({className:I("oui-h-[48px]",rt(o)?"oui-text-base-contrast-20":"oui-text-base-contrast-80")}),generatedRowKey:(o,a)=>`${e.type}${a}${o.order_id||o.algo_order_id}_index${a}`,renderRowContainer:(o,a,l)=>((e.type==="tp_sl"||e.type==="pending")&&(l=t.jsx(qr,{order:o,children:l})),t.jsx(kr,{symbol:o.symbol,children:l})),pagination:e.pagination,manualPagination:e.manualPagination,features:[gs.DownloadFeature],getTableInstance:o=>{e.tableInstance.current=o}})]})})},Tl=e=>{var r,s;let{t:i}=_();return t.jsx(Pr,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(fe,{cols:1,rows:2,className:"oui-w-full oui-grid-rows-[auto,1fr]",gap:2,children:[e.showFilter?t.jsx(h,{gap:2,p:2,className:"oui-rounded-b-xl oui-bg-base-9",children:e.filterItems.map(n=>n.type!=="select"?t.jsx(t.Fragment,{}):t.jsx(fs,{options:n.options,size:"sm",value:n.value,className:"oui-text-2xs oui-text-base-contrast-54 ",placeholder:n.name==="side"?i("common.side.all"):n.name==="status"?i("common.status.all"):"",onValueChange:o=>{var a;(a=e.onFilter)==null||a.call(e,{name:n.name,value:o})}},n.name))}):t.jsx("div",{}),t.jsx(yt,{className:(r=e.classNames)==null?void 0:r.root,contentClassName:(s=e.classNames)==null?void 0:s.content,dataSource:e.dataSource,loadMore:e.loadMore,isLoading:e.isLoading,renderItem:(n,o)=>{var l;let a=t.jsx(Ll,{item:n,index:o,className:(l=e.classNames)==null?void 0:l.cell,type:e.type,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig});return["tp_sl","pending"].includes(e.type)&&(a=t.jsx(qr,{order:n,children:a})),t.jsx(kr,{symbol:n.symbol,children:a})}})]})})},$l=e=>{var r;let{t:i}=_();return t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",disabled:(((r=e.dataSource)==null?void 0:r.length)??0)==0,className:"disabled:oui-bg-transport",onClick:s=>e.onCancelAll(),"data-testid":`oui-testid-dataList-${e.type.toLowerCase()}-cancelAll-button`,children:i("orders.cancelAll")})},El=e=>c.useMemo(()=>{let i=[];for(let r=0;r<e.length;r++){let s=e[r];if(s.algo_type===V.POSITIONAL_TP_SL||s.algo_type===V.TP_SL)if(s.algo_status!==U.FILLED&&s.algo_status!==U.PARTIAL_FILLED)for(let n=0;n<s.child_orders.length;n++){let o=s.child_orders[n];!o.is_activated||!o.trigger_price||(o.parent_algo_type=s.algo_type,i.push(o))}else for(let n=0;n<s.child_orders.length;n++){let o=s.child_orders[n];o&&(o.algo_status===U.FILLED||o.algo_status===U.PARTIAL_FILLED)&&(o.parent_algo_type=s.algo_type,i.push(o))}else i.push(s)}return i},[e]),Ir=e=>{let{ordersStatus:i,type:r,enableLoadMore:s=!1,onSymbolChange:n,filterConfig:o,pnlNotionalDecimalPrecision:a,sharePnLConfig:l}=e,{t:d}=_(),m=je(),p=c.useMemo(()=>i!==U.INCOMPLETE,[i]),x=50,{page:y,pageSize:b,setPage:g,pagination:j,parsePagination:f}=ft({pageSize:x});c.useEffect(()=>{g(1)},[e.symbol]);let{orderStatus:w,ordersSide:v,dateRange:P,filterItems:k,onFilter:$,filterDays:T,updateFilterDays:A}=Ml(r,{ordersStatus:i,setPage:g,filterConfig:o}),S=c.useMemo(()=>{if(r==="tp_sl")return[V.POSITIONAL_TP_SL,V.TP_SL]},[r]),C=c.useMemo(()=>{if(r==="pending")return[V.POSITIONAL_TP_SL,V.TP_SL]},[r]),L=c.useRef();c.useImperativeHandle(e.ref,()=>({download:()=>{var De;let Ke=`orders_${Wi(new Date,"yyyyMMdd_HHmmss")}`;(De=L.current)==null||De.download(Ke)}}));let[R,{isLoading:F,loadMore:q,cancelOrder:M,updateOrder:W,cancelAlgoOrder:K,updateAlgoOrder:ne,cancelAllOrders:B,cancelAllTPSLOrders:D,meta:ee,refresh:re}]=xs({symbol:e.symbol,status:w,side:v,page:s||!p?void 0:y,size:p?b:500,dateRange:P,includes:S,excludes:C}),he=`orderly_${r}_pageSize`,[nt,Ct]=xe(he,x);c.useEffect(()=>{nt!==b&&Ct(b)},[b,nt]);let qe=c.useCallback(()=>{let Ke=e.type==="pending"?d("orders.pending.cancelAll"):e.type==="tp_sl"?d("orders.tpsl.cancelAll"):"",De=d("orders.pending.cancelAll.description");de.confirm({title:Ke,content:t.jsx(u,{size:"sm",children:De}),onCancel:async()=>{},onOk:async()=>{try{return r==="tp_sl"?await D():await B(),re(),Promise.resolve(!0)}catch(Le){return(Le==null?void 0:Le.message)!==void 0&&toast.error(Le.message),Promise.resolve(!1)}finally{Promise.resolve()}}})},[r,d]),te=El(R??[]),Pt=bt(r!=="tp_sl"?te:R,{fallbackData:[]})??void 0,St=c.useMemo(()=>p?f(ee):j,[ee,p,f,j]);return{type:r,dataSource:Pt,isLoading:F,loadMore:q,cancelOrder:M,updateOrder:W,cancelAlgoOrder:K,updateAlgoOrder:ne,pagination:St,manualPagination:p,pnlNotionalDecimalPrecision:a,onFilter:$,filterItems:k,onCancelAll:qe,onSymbolChange:n,sharePnLConfig:l,tableInstance:L,symbolsInfo:m,filterDays:T,updateFilterDays:A}},Ml=(e,i)=>{var g,j;let{t:r}=_(),[s,n]=c.useState(i.ordersStatus??"all"),[o,a]=c.useState(((g=i.filterConfig)==null?void 0:g.side)??"all"),[l,d]=c.useState(90),m=((j=i.filterConfig)==null?void 0:j.range)??(e==="all"||e==="orderHistory"?$t({to:new Date,from:ke(oe(new Date,89))}):{}),[p,x]=c.useState(m),y=f=>{d(f),x({from:Ae(oe(new Date,f-1)),to:ke(new Date)}),i.setPage(1)},b=f=>{if(f.name==="side"&&(a(f.value),i.setPage(1)),f.name==="status"&&(n(f.value),i.setPage(1)),f.name==="dateRange"){x($t(f.value)),i.setPage(1);let w=$t(f.value);if(w.from&&w.to){let v=Math.abs(Ht(w.from,w.to))+1,P={1:{from:Ae(new Date),to:ke(new Date)},7:{from:Ae(oe(new Date,6)),to:ke(new Date)},30:{from:Ae(oe(new Date,29)),to:ke(new Date)},90:{from:Ae(oe(new Date,89)),to:ke(new Date)}}[v];P&&hi(P.from,w.from)&&hi(P.to,w.to)?d(v):d(null)}}};return{filterItems:c.useMemo(()=>{let f={type:"select",name:"side",options:[{label:r("common.side.all"),value:"all"},{label:r("common.buy"),value:"BUY"},{label:r("common.sell"),value:"SELL"}],value:o},w={type:"range",name:"dateRange",value:p},v={type:"select",name:"status",options:[{label:r("common.status.all"),value:"all"},{label:r("orders.status.pending"),value:U.INCOMPLETE},{label:r("orders.status.filled"),value:U.FILLED},{label:r("orders.status.partialFilled"),value:U.PARTIAL_FILLED},{label:r("orders.status.canceled"),value:U.CANCELLED},{label:r("orders.status.rejected"),value:U.REJECTED}],value:s};switch(e){case"all":return[f,v,w];case"pending":return[f];case"tp_sl":return[f];case"filled":return[f];case"cancelled":return[f];case"rejected":return[f];case"orderHistory":return[f,v,w]}},[e,o,s,p,r]),onFilter:b,ordersSide:o==="all"?void 0:o,dateRange:p,orderStatus:s==="all"?void 0:s,filterDays:l,updateFilterDays:y}};function Ae(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function ke(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var $t=e=>({from:Ae(e.from),to:ke(e.to??e.from)}),ze=c.forwardRef((e,i)=>{let{testIds:r,...s}=e,n=Ir({...s,ref:i});return t.jsx(Il,{...n,testIds:r})}),Jl=e=>{let i=Ir({...e,enableLoadMore:!0});return t.jsx(Tl,{...i,classNames:e.classNames,showFilter:e.showFilter})},zl=e=>{let{t:i}=_(),r={pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision};return t.jsxs(vi,{defaultValue:e.current||"all",variant:"contained",className:"oui-h-full",classNames:{tabsContent:"oui-h-[calc(100%_-_28px)]"},children:[t.jsx(we,{value:"all",title:i("common.all"),children:t.jsx(ze,{ref:e.orderListRef,type:"all",pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...r})}),t.jsx(we,{value:"pending",title:i("orders.status.pending"),children:t.jsx(ze,{ref:e.orderListRef,type:"pending",ordersStatus:U.INCOMPLETE,...r})}),t.jsx(we,{value:"tp_sl",title:i("common.tpsl"),children:t.jsx(ze,{ref:e.orderListRef,type:"tp_sl",ordersStatus:U.INCOMPLETE,...r})}),t.jsx(we,{value:"filled",title:i("orders.status.filled"),children:t.jsx(ze,{ref:e.orderListRef,type:"filled",ordersStatus:U.FILLED,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...r})}),t.jsx(we,{value:"cancelled",title:i("orders.status.canceled"),children:t.jsx(ze,{ref:e.orderListRef,type:"cancelled",ordersStatus:U.CANCELLED,...r})}),t.jsx(we,{value:"rejected",title:i("orders.status.rejected"),children:t.jsx(ze,{ref:e.orderListRef,type:"rejected",ordersStatus:U.REJECTED,...r})})]})},Al=(e=>(e.all="all",e.pending="pending",e.tp_sl="tp_sl",e.filled="filled",e.cancelled="cancelled",e.rejected="rejected",e.orderHistory="orderHistory",e))(Al||{}),Zl=c.forwardRef((e,i)=>{let r=Na({...e,ref:i});return t.jsx(zl,{...r})});export{Ql as G,xn as H,Hl as K,Kl as L,Jl as M,Al as P,gn as X,Zl as a,Ht as d,ze as h,Xl as j,$s as o,Yl as q,Ts as r,Gl as t};
